try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="84977d15-a2b4-4a4c-92e5-be7104f5cc1f",e._sentryDebugIdIdentifier="sentry-dbid-84977d15-a2b4-4a4c-92e5-be7104f5cc1f")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[17421],{0xbdad302d:(e,t,n)=>{n.d(t,{$D:()=>h,Ey:()=>v,I5:()=>y,Oo:()=>M,QJ:()=>g,Z1:()=>C,ct:()=>E,eG:()=>w,gn:()=>m,oz:()=>_,pC:()=>k,ts:()=>D});var s=n(0xf32c56dd),r=n(0x12c9046cd),i=n(0x14de19ae8),o=n(0x49fac030),u=n(0xac309a83),a=n(0xe670e093),l=n(0x22f291c2a),d=n(0x17e725145),c=n(0xfc89b4a4),f=n(0x21687185c),p=n(0xe6c3f31e);function g(){return(0,u.fS)("yukon_gold")}let h=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,i.YL)(),s=null==n?void 0:n.uuid;return(0,r.Sk)("/v1/sessions",{queryKey:[o.Rv,{orgUuid:s}],enabled:!!n&&e,staleTime:3e4,refetchInterval:t,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...s?{"x-organization-uuid":s}:{}}})};function v(e,t,n){let s=e;if(t.length>0||n.length>0){let r="<uploaded_files>\n"+[...n.map(e=>"<file><file_path>".concat(e.path||e.file_name,"</file_path></file>")),...t.map(e=>{let t="<file_path>".concat(e.path||e.file_name,"</file_path>"),n=e.file_uuid?"<file_uuid>".concat(e.file_uuid,"</file_uuid>"):"";return"<file>".concat(t).concat(n,"</file>")})].join("\n")+"\n</uploaded_files>";s="".concat(r,"\n\n").concat(e)}return s}function y(e,t){return{uuid:(0,a.b)(),session_id:t,type:"user",parent_tool_use_id:null,message:{role:"user",content:e}}}let m=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/v1/sessions/".concat(e),{queryKey:[o.Ex,{orgUuid:n,sessionId:e}],enabled:!!t,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})};function _(){let e=b();return(0,c.useCallback)(t=>{let{title:n,customPrompt:s,model:r,gitRepoUrl:i,gitBranch:o,environmentId:u,mcpConfig:a,mcpTools:l}=t,d=[],c=[];return i&&o&&(d.push({type:"git_repository",url:i}),c.push({type:"git_repository",git_info:{type:"github",repo:i.split("github.com/")[1],branches:[o]}})),e.mutateAsync({title:n,environment_id:u,session_context:{sources:d,outcomes:c,mcp_config:a,mcp_tools:l,...void 0!==s?{custom_system_prompt:s}:{},...void 0!==r?{model:r}:{}}})},[e])}let b=()=>{let{activeOrganization:e}=(0,i.YL)(),t=(0,d.useQueryClient)(),n=null==e?void 0:e.uuid;return(0,r.L2)("/v1/sessions","POST",{onMutate:e=>{var s;if("config_id"in e&&"yukon_gold"===e.config_id)throw Error("Invalid config_id; use the other hook");let r=[o.Rv,{orgUuid:n}],i=t.getQueryData(r),u=null==i||null==(s=i.data.find(e=>e.id.startsWith("immediate-temp-")))?void 0:s.id,a=u||"temp-".concat(Date.now());if(i&&!u){let n={type:"session",id:a,title:e.title||"New session",session_status:"running",environment_id:e.environment_id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),session_context:e.session_context||{sources:[],outcomes:[]}};t.setQueryData(r,{...i,data:[n,...i.data]})}return{previousSessions:i,tempSessionId:a}},onSuccess:(e,s,r)=>{let i=[o.Rv,{orgUuid:n}];t.setQueryData(i,t=>{let n;if(!t)return t;let s=t.data.some(t=>t.id===e.id),i=t.data.some(e=>e.id===(null==r?void 0:r.tempSessionId));return n=s&&i?t.data.filter(e=>e.id!==(null==r?void 0:r.tempSessionId)):s?t.data:i?t.data.map(t=>t.id===(null==r?void 0:r.tempSessionId)?e:t):[e,...t.data],{...t,data:n}})},onError:(e,s,r)=>{let i=[o.Rv,{orgUuid:n}];(null==r?void 0:r.previousSessions)&&t.setQueryData(i,r.previousSessions)},meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})};function w(){let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)("/api/organizations/".concat(t,"/dust/generate_title_and_branch"),"POST")}function S(e,t){return{onMutate:async n=>{let s=[o.Rv,{orgUuid:e}],r=[o.Ex,{orgUuid:e,sessionId:n.sessionId}];await Promise.all([t.cancelQueries({queryKey:s}),t.cancelQueries({queryKey:r})]);let i=t.getQueryData(s),u=t.getQueryData(r);return t.setQueryData(s,e=>e?{...e,data:e.data.map(e=>e.id===n.sessionId?{...e,...n.optimisticUpdate}:e)}:e),t.setQueryData(r,e=>e?{...e,...n.optimisticUpdate}:e),{previousSessionsList:i,previousSession:u}},onError:(n,s,r)=>{(null==r?void 0:r.previousSessionsList)&&t.setQueryData([o.Rv,{orgUuid:e}],r.previousSessionsList),(null==r?void 0:r.previousSession)&&t.setQueryData([o.Ex,{orgUuid:e,sessionId:s.sessionId}],r.previousSession)},onSuccess:(n,s)=>{t.setQueryData([o.Rv,{orgUuid:e}],e=>e?{...e,data:e.data.map(e=>e.id===s.sessionId?n:e)}:e),t.setQueryData([o.Ex,{orgUuid:e,sessionId:s.sessionId}],n)}}}function M(){let{activeOrganization:e}=(0,i.YL)(),t=(0,d.useQueryClient)(),n=null==e?void 0:e.uuid,s=S(n,t);return(0,r.L2)(e=>"/v1/sessions/".concat(e.sessionId),"PATCH",{transformVariables:e=>({title:e.title,session_status:e.session_status}),onMutate:e=>s.onMutate({sessionId:e.sessionId,optimisticUpdate:e}),onError:s.onError,onSuccess:s.onSuccess,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})}function k(){let{activeOrganization:e}=(0,i.YL)(),t=(0,d.useQueryClient)(),n=null==e?void 0:e.uuid,s=S(n,t);return(0,r.L2)(e=>"/v1/sessions/".concat(e.sessionId,"/archive"),"POST",{transformVariables:()=>({}),onMutate:e=>s.onMutate({sessionId:e.sessionId,optimisticUpdate:{session_status:"archived"}}),onError:s.onError,onSuccess:s.onSuccess,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})}let T=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s="/v1/sessions/ws/".concat(t,"/subscribe"),r=new URLSearchParams;r.append("organization_uuid",e),n.replay&&r.append("replay","true");let i=r.toString();i&&(s+="?".concat(i));let o="https:"===window.location.protocol?"wss:":"ws:";return"".concat(o,"//").concat(window.location.host).concat(s)},x=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,i.YL)(),s=null==n?void 0:n.uuid;return(0,r.Sk)("/v1/sessions/".concat(e,"/events"),{queryKey:[o.ri,{orgUuid:s,sessionId:e}],enabled:!!n&&t,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...s?{"x-organization-uuid":s}:{}}})};class R{[Symbol.asyncIterator](){if(this.started)throw Error("Stream can only be iterated once");return this.started=!0,this}next(){return this.queue.length>0?Promise.resolve({done:!1,value:this.queue.shift()}):this.isDone?Promise.resolve({done:!0,value:void 0}):this.hasError?Promise.reject(this.hasError):new Promise((e,t)=>{this.readResolve=e,this.readReject=t})}enqueue(e){if(this.readResolve){let t=this.readResolve;this.readResolve=void 0,this.readReject=void 0,t({done:!1,value:e})}else this.queue.push(e)}done(){if(this.isDone=!0,this.readResolve){let e=this.readResolve;this.readResolve=void 0,this.readReject=void 0,e({done:!0,value:void 0})}}error(e){if(this.hasError=e,this.readReject){let t=this.readReject;this.readResolve=void 0,this.readReject=void 0,t(e)}}return(){return this.isDone=!0,this.returned&&this.returned(),Promise.resolve({done:!0,value:void 0})}constructor(e){this.returned=e,this.queue=[],this.isDone=!1,this.started=!1}}function E(e,t,n,s,r){let u=!(arguments.length>5)||void 0===arguments[5]||arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7?arguments[7]:void 0,{data:v,isLoading:y,isError:m,refetch:_}=x(e,u),{streamedMessages:b,interrupt:w,inputStreamRef:S,ensureConnected:M,connectionState:k,lastMessageTime:E}=function(e,t,n,s,r){let u=!(arguments.length>5)||void 0===arguments[5]||arguments[5],a=!(arguments.length>6)||void 0===arguments[6]||arguments[6],g=arguments.length>7?arguments[7]:void 0,h=(0,c.useRef)(null),v=(0,c.useRef)(null),y=(0,c.useRef)(!1),m=(0,c.useRef)(0),_=(0,c.useRef)(null),b=(0,c.useRef)(null),w=(0,c.useRef)(null),[S,M]=(0,c.useState)([]),[k,x]=(0,c.useState)("disconnected"),[E,D]=(0,c.useState)(null),C=(0,f.Tk)(e),P=(0,c.useRef)(e),L=(0,c.useCallback)(()=>{y.current=!0,x("disconnected"),D(null),_.current&&(clearTimeout(_.current),_.current=null),v.current&&(v.current.abort(),v.current=null),w.current&&(w.current.done(),w.current=null),h.current=null,b.current=null,m.current=0},[]);(0,c.useEffect)(()=>{P.current!==e&&(L(),M([]),x("disconnected"),D(null),m.current=0,P.current=e)},[e,L]);let{activeOrganization:Q}=(0,i.YL)(),q=null==Q?void 0:Q.uuid,j=(0,d.useQueryClient)(),O=(0,c.useRef)(r);O.current=r;let z=(0,c.useCallback)(()=>{var t;if(!u||!q||!e||h.current&&b.current===e)return;L(),y.current=!1,x("connecting"),b.current=e,v.current=new AbortController,w.current=new R;let r=(0,l.P)({prompt:w.current,websocket:{url:T(q,e)},abortController:v.current,mcpServers:s,canUseTool:O.current?(t=O.current,async(e,n,s)=>{let[r,i,o]=e.split("__");if("mcp"!==r||!i||!o)return{behavior:"deny",message:"Invalid tool name format"};let u=await t(e,n,s);return I(e,n,u)}):void 0});(null==g?void 0:g.maxThinkingTokens)!==void 0&&r.setMaxThinkingTokens(g.maxThinkingTokens);let i=null;(async()=>{var e,t,n;try{let n=new Map,s=!0;for await(let u of(i=setTimeout(()=>{s&&x("connected")},500),r)){if(s&&(s=!1,clearTimeout(i),m.current=0,x("connected")),D(Date.now()),M(e=>u.uuid&&e.some(e=>e.uuid===u.uuid)?e:[...e,u]),"assistant"===u.type&&"message"in u){let t=null==(e=u.message)?void 0:e.content;if(Array.isArray(t))for(let e of t)"tool_use"===e.type&&e.id&&e.name&&n.set(e.id,{name:e.name,id:e.id,input:e.input})}if("user"===u.type&&"message"in u){let e=null==(t=u.message)?void 0:t.content;if(Array.isArray(e)){for(let t of e)if("tool_result"===t.type&&t.tool_use_id){let e=n.get(t.tool_use_id),s=(null==e?void 0:e.name)==="mcp__git__git_push",r=(null==e?void 0:e.name)==="Bash"&&function(e){if(!e||"object"!=typeof e)return!1;let t=e.command;return"string"==typeof t&&/^\s*git\s+push\b/.test(t)}(e.input);(s||r)&&j.invalidateQueries({queryKey:[o.i8],refetchType:"all"})}}}}}catch(s){i&&clearTimeout(i);let e=y.current,t=null==(n=v.current)?void 0:n.signal.aborted;if(y.current=!1,h.current===r&&(x("disconnected"),h.current=null),a&&!e&&!t&&s instanceof Error&&"WebSocket connection aborted by user"!==s.message){let e=m.current;if(e<5){m.current=e+1;let t=1e3*Math.pow(2,e),n=Math.random()*t*.5;_.current=setTimeout(()=>{z()},t+n)}}}})(),n(e=>{var t;null==(t=w.current)||t.enqueue(e)}),h.current=r},[u,q,e,L,n,a,s,j,null==g?void 0:g.maxThinkingTokens]);return(0,c.useEffect)(()=>()=>L(),[L]),(0,c.useEffect)(()=>{if(!E||"connected"!==k||(0,p.m)(S,C))return;let e=3e5-(Date.now()-E);if(e<=0)return void L();let t=setTimeout(()=>{L()},e);return()=>{clearTimeout(t)}},[E,k,S,C,L]),{streamedMessages:S,interrupt:(0,c.useCallback)(()=>{h.current&&(y.current=!0,h.current.interrupt())},[]),inputStreamRef:w,ensureConnected:(0,c.useCallback)(()=>{h.current||(m.current=0,z())},[z]),connectionState:k,lastMessageTime:E}}(e,t,(0,c.useCallback)(e=>{let t=_();return A.current.forEach(t=>{e(t)}),t},[_]),n,s,u&&!m,g,h),D=(0,f.Tk)(e),C=(0,f.jT)(),P=(0,f.Ou)(e=>e.removePendingMessage),L=(0,f.Ou)(e=>e.clearPendingMessages),Q=(0,c.useMemo)(()=>{if(y||!v)return[];let e=new Set;return v.data.filter(t=>!(!t.uuid||e.has(t.uuid))&&(e.add(t.uuid),!0))},[y,v]),q=(0,c.useMemo)(()=>{let e=new Map;for(let t of Q)t.uuid&&e.set(t.uuid,t);for(let t of b)t.uuid&&e.set(t.uuid,t);return Array.from(e.values())},[Q,b]);(0,c.useEffect)(()=>{for(let t of q)t.uuid&&P(e,t.uuid)},[q,e,P]);let j=(0,c.useCallback)(t=>{var n;let s={uuid:(0,a.b)(),type:"user",session_id:e,parent_tool_use_id:null,message:{role:"user",content:t}};C(e,s),null==(n=S.current)||n.enqueue(s)},[C,e,S]),O=(0,c.useCallback)((e,t,n)=>{var s;let r={type:"control_response",response:{subtype:"success",request_id:e,response:I(e,t,n)}};null==(s=S.current)||s.enqueue(r)},[S]),z=(0,c.useMemo)(()=>{if(0===D.length)return[];let e=new Set;for(let t of q)e.add(t.uuid);return D.filter(t=>!e.has(t.uuid))},[D,q]),A=(0,c.useRef)([]);A.current=z,(0,c.useEffect)(()=>{(r||z.length>0)&&M()},[M,r,z.length]);let Y=(0,c.useCallback)(()=>{w(),L(e)},[w,L,e]),K=(0,c.useCallback)(()=>{w(),setTimeout(()=>{M()},100)},[w,M]),U=(0,c.useMemo)(()=>(0,p.m)(q,D),[q,D]);return{loadingInitialMessages:y,initialMessagesError:m,sendMessage:j,sendToolDecision:O,stopSession:Y,initialMessages:null==v?void 0:v.data,streamedMessages:b,messages:q,pendingMessages:z,ensureConnected:M,connectionState:k,lastMessageTime:E,retry:K,isSessionRunning:U}}function I(e,t,n){let s;return"deny"===n?{behavior:"deny",message:"Denied by user"}:("always"===n&&(s=[{type:"replaceRules",rules:[{toolName:e}],behavior:"allow",destination:"localSettings"}]),{behavior:"allow",updatedInput:t,updatedPermissions:s})}function D(){let{activeOrganization:e}=(0,i.YL)(),{track:t}=(0,s.st)(),n=(0,r.L2)("/api/organizations/".concat(null==e?void 0:e.uuid,"/sessions"),"POST",{enabled:!!e,onSuccess:e=>{t({event_key:"claudeai.yukon_gold.session_created",session_id:e.session_id})}});return(0,c.useCallback)(e=>{let{model:t,conversationUuid:s,mcpTools:r}=e;return n.mutateAsync({title:"",config_id:"yukon_gold",model:t,conversation_uuid:s,mcp_tools:r})},[n])}function C(){let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>{let{sessionId:n}=e;return"/api/organizations/".concat(t,"/sessions/").concat(n,"/update")},"POST",{enabled:!!t})}},0xe6c3f31e:(e,t,n)=>{n.d(t,{m:()=>s});function s(e,t){if(t.length>0)return!0;let n=e.filter(e=>"env_manager_log"!==e.type),s=n[n.length-1];return!s||"result"!==s.type}},0x21687185c:(e,t,n)=>{n.d(t,{Ou:()=>i,Tk:()=>a,jT:()=>o});var s=n(0x394ef833),r=n(0x16784b660);let i=(0,s.v)()((0,r.Zr)(e=>({pendingMessages:{},addPendingMessage:(t,n)=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:[...e.pendingMessages[t]||[],n]}}))},clearPendingMessages:t=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:[]}}))},removePendingMessage:(t,n)=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:(e.pendingMessages[t]||[]).filter(e=>e.uuid!==n)}}))}}),{name:"session-pending-messages",storage:(0,r.KU)(()=>sessionStorage)})),o=()=>i(e=>e.addPendingMessage),u=[],a=e=>i(t=>{var n;return null!=(n=t.pendingMessages[e])?n:u})}}]);