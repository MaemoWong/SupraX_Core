try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="bb2ef23a-bd25-4976-a73e-77528e94791b",e._sentryDebugIdIdentifier="sentry-dbid-bb2ef23a-bd25-4976-a73e-77528e94791b")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[31059],{0xede65b:(e,t,a)=>{a.d(t,{n:()=>s});let s=e=>{let t,a=[],s=/\[[^\]]*\]\((computer:\/\/\/[^)]+)\)/g;for(;null!==(t=s.exec(e));)a.push(t[1]);let n=RegExp("(?<!\\]\\()computer:\\/\\/\\/[^\\s)\\].,;!?]+(?![^[]*\\])","g");return a.push(...e.match(n)||[]),[...new Set(a.map(e=>e.replace(/[.,;!?)]+$/,"")))]}},0x1020e1ec:(e,t,a)=>{a.d(t,{w:()=>o,y:()=>d});var s=a(0x12c9046cd),n=a(0x1a3383306),i=a(0xfc89b4a4);function l(e,t){let a=new Map;return t.forEach(e=>{var t;let s=null!=(t=a.get(e.file_name))?t:[];s.push(e),a.set(e.file_name,s)}),a.get(e)}function r(e,t){let a=l(e,t);if(!a||0===a.length)return null;let s=a.filter(e=>e.file_kind===n.M.Blob);return 0===s.length?null:s[s.length-1]}function o(){let e=function(){let e=(0,s.mn)();return(0,i.useCallback)(async(t,a,s,n,i)=>{let l=r(t,a);if(!l&&n){let a=await e("/api/organizations/".concat(s,"/projects/").concat(n,"/docs")),i=(await a.json()).find(e=>e.file_name===t);if(i)return new TextEncoder().encode(i.content);let o=await e("/api/organizations/".concat(s,"/projects/").concat(n,"/files"));l=r(t,await o.json())}if(!l)return null;try{let e=i?"/api/organizations/".concat(s,"/shared_artifact/").concat(i,"/files/").concat(l.file_uuid,"/contents"):"/api/organizations/".concat(s,"/files/").concat(l.file_uuid,"/contents"),t=await fetch(e);if(!t.ok)return null;let a=await t.arrayBuffer();if(a.byteLength>0x80000000-1)return null;return new Uint8Array(a)}catch(e){return null}},[e])}();return(0,i.useCallback)(async(t,a,s,n,i,r)=>{if(!n)return null;let o=function(e,t){let a=l(e,t);if(!a||0===a.length)return null;let s=a[a.length-1];if(s){let e=s.extracted_content;return new TextEncoder().encode(e)}return null}(t,a);return o||await e(t,s,n,i,r)},[e])}function d(e,t,a,s,n){let l=o();return(0,i.useCallback)(async i=>l(i,e,t,a,s,n),[e,t,a,s,l,n])}},0x11a517a9:(e,t,a)=>{a.d(t,{as:()=>S});var s=a(0x22102fd88),n=a(0x253ff6d66),i=a(0x2b390c5f),l=a(0x209ff4fac),r=a(0x11307af4f),o=a(0xbca8e388),d=a(0x236236dc),c=a(0x1f725a926),u=a(0x132beb2b5),x=a(0x225bae024),f=a(0x14023fbb8),m=a(0x1fa9af01),p=a(0x24fcf6beb),h=a(0x1a1f6dda6),g=a(0xcaa21d58),v=a(0xfc89b4a4),b=a(0x38e6572),j=a(0x239a63c1c),y=a(0x20d6272f9);let w=()=>(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)(f.Loading,{size:"md"})}),_=e=>{let{error:t,onRetry:a}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-text-300 gap-4",children:[(0,s.jsx)("div",{children:t}),a&&(0,s.jsx)(x.$,{variant:"secondary",size:"sm",onClick:a,children:(0,s.jsx)(b.A,{defaultMessage:"Try again",id:"FazwRldA7z"})})]})},k=e=>{let{fileName:t}=e,{displayName:a,displayExt:n}=(0,y.FT)(t);return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)(u.JR,{})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-text-100 font-medium text-lg",children:a}),n&&(0,s.jsx)("div",{className:"text-text-300 text-sm",children:n})]}),(0,s.jsx)("div",{className:"text-text-300",children:(0,s.jsx)(b.A,{defaultMessage:"No preview available",id:"vYALkaFo+6"})})]})},M=e=>{let{content:t,language:a,displayFileType:l,showRaw:r,richSandboxRef:d,onSandboxConfirmation:c,richSandboxCapabilities:u,fileName:x,onRefresh:h,mimeType:j}=e;if("image"===l){if(!(t instanceof Blob))throw Error('displayFileType is "image" but content is not Blob')}else if("rich"===l){if("string"!=typeof t&&!(t instanceof ArrayBuffer))throw Error('displayFileType is "rich" but content is not string or ArrayBuffer')}else if("string"!=typeof t)throw Error('displayFileType is "'.concat(l,'" but content is not a string'));let[y,w]=(0,v.useState)(null),[_,k]=(0,v.useState)(!0),[M,C]=(0,v.useState)(!1),[S,A]=(0,v.useState)(null);v.useEffect(()=>{t&&"rich"===l&&!M&&k(!0)},[t,l,M]);let E=(0,v.useCallback)((e,t)=>{if("json"===t&&e)try{let t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(e){}return e},[]),T=(0,v.useCallback)(e=>{w({error:e,artifactId:x,artifactVersion:0})},[x]),z=(0,v.useCallback)(()=>{w(null)},[]),R=(0,v.useCallback)(()=>{w(null),null==h||h()},[h]),I=(0,v.useRef)(null),U=j||("rich"===l?p.vU.Html:void 0),L="rich"===l&&!r&&void 0!==U;return(0,v.useEffect)(()=>{if("image"===l){let e=URL.createObjectURL(t);return A(e),()=>{URL.revokeObjectURL(e)}}A(null)},[t,l]),(0,s.jsxs)(s.Fragment,{children:[L&&(0,s.jsxs)("div",{className:"h-full w-full relative border-none",children:[_&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-20",children:(0,s.jsx)(f.Loading,{size:"md"})}),(0,s.jsx)(i.A,{ref:d,className:"h-full w-full border-none bg-bg-000",content:t,type:U,onSandboxConfirmation:()=>{k(!1),C(!0),null==c||c()},capabilities:u,onReportError:T,onSetContent:z,onRefresh:R,externalLinkBehavior:"ask"}),y&&(0,s.jsx)(n.i,{error:y,handleClose:()=>w(null),isStreaming:!1})]}),("code"===l||r)&&(0,s.jsx)(m.Z,{ref:I,className:"relative flex w-full flex-1 overflow-x-auto overflow-y-scroll min-h-full",children:(0,s.jsx)("div",{tabIndex:0,id:"wiggle-file-content",className:"markdown"!==a&&"plaintext"!==a||r?"":"mx-auto w-full max-w-3xl leading-[1.65rem] px-6 py-4 md:py-6 md:px-11",children:"markdown"!==a||r?(0,s.jsx)(N,{content:E(t,a),language:a,showLineNumbers:"plaintext"!==a,wrapLongLines:"plaintext"===a}):(0,s.jsx)(o.fP,{text:t,className:"font-claude-response",normalizationMode:"markdown-document"})})}),"image"===l&&S&&(0,s.jsx)("div",{className:"h-full p-5",children:(0,s.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,s.jsx)(g.default,{src:S,alt:x,width:0,height:0,sizes:"100vw",className:"w-auto h-auto max-w-full max-h-full object-contain"})})}),"nonrenderable"===l&&(0,s.jsx)("div",{className:"flex items-start justify-center h-full pt-12 text-text-300",children:(0,s.jsx)(b.A,{defaultMessage:"File type cannot be displayed",id:"AZLJvXC/bK"})})]})},C="code-block__code !my-0 flex-1 w-fit min-w-full !rounded-none !text-sm !leading-relaxed [&_.linenumber]:!not-italic",N=e=>{let{content:t,language:a,showLineNumbers:n,wrapLongLines:i}=e,{codeStyle:o}=(0,d.V)(),{exceedsSizeLimit:u}=(0,c.y)(t);return u?(0,s.jsx)(l.R,{code:t,codeClassName:(0,h.A)(C,"p-4")}):(0,s.jsx)(j.A,{className:C,language:a,PreTag:"div",style:o,renderer:r.G,showLineNumbers:n,wrapLongLines:i,lineNumberStyle:{opacity:.667,minWidth:"2.5rem"},children:t})},S=e=>{let{isLoading:t,error:a,onRetry:n,content:i,displayFileType:l,fileName:r,...o}=e;return t&&!i?(0,s.jsx)(w,{}):a?(0,s.jsx)(_,{error:a,onRetry:n}):"nonrenderable"===l?(0,s.jsx)(k,{fileName:r}):void 0===i?null:(0,s.jsx)("div",{className:"h-full",children:(0,s.jsx)(M,{content:i,displayFileType:l,fileName:r,...o})})}},0x18b9bd76:(e,t,a)=>{a.d(t,{_:()=>T});var s=a(0x22102fd88),n=a(0x8aef00d0),i=a(0x8daa74e8),l=a(0x14de19ae8),r=a(0x139b5e710),o=a(0xb91ccc43),d=a(0x225bae024),c=a(0x9f369389),u=a(0xac309a83),x=a(0x1bd175d8c),f=a(0x10e578383),m=a(0x1e7d49d15),p=a(0x48daab68),h=a(0xfb22fb91),g=a(0x4376af8f),v=a(0x24994a9b0),b=a(0xf897c741),j=a(0x1a1f6dda6),y=a(0xfc89b4a4),w=a(0x1ab0d1ca1),_=a(0x38e6572),k=a(0x18175ce17),M=a(0x20d6272f9),C=a(0x21010ec24),N=a(0x1334f6ecc),S=a(0x1f507121),A=a(0x1a65cb992),E=a(0xc628249c);function T(e){let{file:t,conversationUuid:a,onOpen:T,isInSidebar:z=!1,isShared:R}=e,{activeOrganization:I}=(0,l.YL)(),U=(0,w.A)(),[L,O]=(0,y.useState)(null),[F,P]=(0,y.useState)(!1),D=(0,S.P)(),B=(0,x.V)(),G=(0,u.fS)("wiggle_desktop_integration"),W=(0,N.Gk)(),V=(0,k.kO)(),q=(0,u.fS)("claudeai_skill_artifact_integration");(0,y.useEffect)(()=>{let e=!0;if(B&&(null===c.Q2||void 0===c.Q2?void 0:c.Q2.whichApplication)&&G)return c.Q2.whichApplication(t.path).then(t=>{e&&O(t)}),()=>{e=!1}},[G,t.path,B]);let{addError:Y}=(0,r.Y)(),H=(0,M.Ud)(t.name),J={code:{IconComponent:m.l,label:(0,s.jsx)(_.A,{defaultMessage:"Code",id:"G8PgU8iXdR",description:"A label for a category of filetypes"}),isPreviewable:!0},table:{IconComponent:p.K,label:(0,s.jsx)(_.A,{defaultMessage:"Table",id:"o1Bm9Seua1",description:"A label for a category of filetypes"}),isPreviewable:!0},spreadsheet:{IconComponent:p.K,label:(0,s.jsx)(_.A,{defaultMessage:"Spreadsheet",id:"WeEn8OTS2e",description:"A label for a category of filetypes"}),isPreviewable:!0},doc:{IconComponent:h.d,label:(0,s.jsx)(_.A,{defaultMessage:"Document",id:"86Gv/DR1uA",description:"A label for a category of filetypes"}),isPreviewable:!0},image:{IconComponent:g.x,label:(0,s.jsx)(_.A,{defaultMessage:"Image",id:"8mG9Cg7ges",description:"A label for a category of filetypes"}),isPreviewable:!0},diagram:{IconComponent:b.n,label:(0,s.jsx)(_.A,{defaultMessage:"Diagram",id:"HDIA+OJNvT",description:"A label for a category of filetypes"}),isPreviewable:!0},preso:{IconComponent:v.Z,label:(0,s.jsx)(_.A,{defaultMessage:"Presentation",id:"KUNdHQwOKr",description:"A label for a category of filetypes"}),isPreviewable:!1},skill:{IconComponent:o.xPp,label:null,isPreviewable:!1}},{IconComponent:K,label:X}=H?J[H]:{IconComponent:f.o,label:null},{displayName:Z,displayExt:Q}=(0,M.FT)(t.name),$=(0,s.jsxs)(s.Fragment,{children:[X,X&&Q&&(0,s.jsx)("span",{className:"opacity-50",children:" \xb7 "}),Q]}),ee=!z&&!R&&W&&(0,C.z)(t.path,V);return(0,s.jsx)(n.d,{icon:(0,s.jsx)(K,{size:20,weight:"light",className:"text-text-500"}),properties:{id:t.path,title:Z||t.name},isStreaming:!1,className:(0,j.A)(z&&"!m-0"),displayType:$,actions:(0,s.jsxs)("div",{className:"flex min-w-0 items-center justify-center gap-2 shrink-0",children:[ee&&(0,s.jsx)(A.M,{file:t,conversationUuid:a,source:"wiggle_card",variant:"secondary",size:"icon",className:"!rounded-lg"}),!z&&!R&&q&&(0,s.jsx)(E.a,{file:t,conversationUuid:a,source:"wiggle_artifact_card",variant:"secondary",size:"default",className:"!rounded-lg"}),B&&(null===c.Q2||void 0===c.Q2?void 0:c.Q2.writeFileDownloadAndOpen)&&G?(0,s.jsx)(d.$,{"aria-label":U.formatMessage({id:"JfG49wNHKP",defaultMessage:"Open"}),variant:z?"ghost":"secondary",loading:F,onClick:e=>{if(e.preventDefault(),e.stopPropagation(),!(null==I?void 0:I.uuid))return;let s=t.path.split("/");P(!0);let n=(0,i.T)(R?{organizationUuid:I.uuid,snapshotUuid:a,filePath:t.path.replace(/^computer:\/\//,""),isShared:!0}:{organizationUuid:I.uuid,conversationUuid:a,filePath:t.path.replace(/^computer:\/\//,""),isShared:!1});c.Q2.writeFileDownloadAndOpen(s[s.length-1],new URL(n,window.location.href).href).catch(()=>{Y(U.formatMessage({defaultMessage:"Failed to download and open file",id:"cxAbUvhHjJ"}),{messageForLogging:"Failed to download and open file"})}).then(()=>{P(!1)})},size:z?"icon":"default",prepend:!z&&L&&L.appIconBase64&&(0,s.jsx)("img",{src:L.appIconBase64,height:20,width:20,alt:U.formatMessage({defaultMessage:"Open file on desktop",id:"7tjfei6CPJ"})}),children:z?(0,s.jsx)(o.vdG,{size:16,className:"text-text-400"}):L?(0,s.jsx)(_.A,{id:"AsiqC3lr7Z",defaultMessage:"Open in {appName}",values:{appName:L.appName}}):(0,s.jsx)(_.A,{id:"JfG49wNHKP",defaultMessage:"Open"})}):(0,s.jsx)(d.$,{"aria-label":U.formatMessage({id:"5q3qC0sC3r",defaultMessage:"Download"}),variant:z?"ghost":"secondary",onClick:e=>{e.preventDefault(),e.stopPropagation(),(null==I?void 0:I.uuid)&&D(R?{filepath:t.path,orgUuid:I.uuid,snapshotUuid:a,isShared:!0,source:"wiggle_card_download_button"}:{filepath:t.path,orgUuid:I.uuid,conversationUuid:a,isShared:!1,source:"wiggle_card_download_button"})},size:z?"icon":"default",children:z?(0,s.jsx)(o.f5X,{size:16,className:"text-text-400"}):(0,s.jsx)(_.A,{id:"5q3qC0sC3r",defaultMessage:"Download"})})]}),onOpenArtifact:T},t.path)}},0x1f507121:(e,t,a)=>{a.d(t,{P:()=>d,_:()=>c});var s=a(0xf32c56dd),n=a(0xd3117c3a),i=a(0x139b5e710),l=a(0xfc89b4a4),r=a(0x1ab0d1ca1);function o(){let e=(0,r.A)(),{addError:t}=(0,i.Y)();return(0,l.useCallback)(a=>{let s=document.createElement("iframe");s.style.display="none",s.src=a,s.onload=()=>{t(e.formatMessage({defaultMessage:"Failed to download files",id:"ZqhXQGNmd6"})),s.parentElement&&s.remove()},s.onerror=()=>{t(e.formatMessage({defaultMessage:"Failed to download files",id:"ZqhXQGNmd6"})),s.parentElement&&s.remove()},document.body.appendChild(s),setTimeout(()=>{s.parentElement&&s.remove()},2e4)},[e,t])}function d(){let{track:e}=(0,s.st)(),t=o();return(0,l.useCallback)(a=>{let{filepath:s,orgUuid:i,source:l}=a,r=s.replace("computer://","");e({event_key:"wiggle.file.downloaded",...(0,n.k)({filePath:s,isShared:a.isShared,conversationUuid:a.isShared?void 0:a.conversationUuid,snapshotUuid:a.isShared?a.snapshotUuid:void 0,source:l})});let o=a.isShared?"/api/organizations/".concat(i,"/snapshots/").concat(a.snapshotUuid,"/wiggle/download-file"):"/api/organizations/".concat(i,"/conversations/").concat(a.conversationUuid,"/wiggle/download-file"),d=new URLSearchParams;d.append("path",r),t("".concat(o,"?").concat(d.toString()))},[e,t])}function c(){let{track:e}=(0,s.st)(),t=o();return(0,l.useCallback)(a=>{let{filepaths:s,orgUuid:n,source:i}=a,l=s.map(e=>e.replace("computer://","")).filter(e=>!a.isShared||e.startsWith("/mnt/user-data/"));e({event_key:"wiggle.file.downloaded_all",file_count:l.length,is_snapshot:a.isShared,source:i,conversation_uuid:a.isShared?null:a.conversationUuid,snapshot_uuid:a.isShared?a.snapshotUuid:null});let r=a.isShared?"/api/organizations/".concat(n,"/snapshots/").concat(a.snapshotUuid,"/wiggle/download-files"):"/api/organizations/".concat(n,"/conversations/").concat(a.conversationUuid,"/wiggle/download-files"),o=new URLSearchParams;for(let e of l)o.append("paths",e);t("".concat(r,"?").concat(o.toString()))},[e,t])}},0x1f7748bd:(e,t,a)=>{a.d(t,{a:()=>i});var s=a(0xfc89b4a4),n=a(0x214374164);let i=(e,t,a)=>{let i=(0,s.useRef)(!1),l=(0,s.useRef)(null),r=(0,s.useRef)(null),[o,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(!e),{expandedItemKey:x,setExpandedItemKey:f}=(0,n.D8)(),m=t&&f&&!a,p=(0,s.useCallback)(e=>{m&&f(e?t:void 0),d(e)},[m,f,d,t]),h=!!a||(m?x===t:o);return(0,s.useEffect)(()=>(l.current&&(clearTimeout(l.current),l.current=null),r.current&&(clearTimeout(r.current),r.current=null),e?(i.current=!0,p(!0),u(!1)):i.current&&!a&&(l.current=setTimeout(()=>{p(!1),r.current=setTimeout(()=>{u(!0),i.current=!1},600)},2e3)),()=>{l.current&&(clearTimeout(l.current),l.current=null),r.current&&(clearTimeout(r.current),r.current=null)}),[e,p,a]),{isExpanded:h,setIsExpanded:p,snappyTransition:c}}},0x1fc7d761:(e,t,a)=>{a.d(t,{Bk:()=>i,Kc:()=>r,LR:()=>l});var s=a(0x394ef833),n=a(0x16784b660);let i=(0,s.v)()((0,n.eh)((e,t)=>({features:{},setMessageFeatures:(t,a)=>e(e=>({features:{...e.features,[t]:{...e.features[t],...a}}})),clearAllFeatures:()=>e({features:{}}),getMessageFeatures:e=>t().features[e],hasLink:e=>{var a,s;return null!=(s=null==(a=t().features[e])?void 0:a.hasLink)&&s},hasCode:e=>{var a,s;return null!=(s=null==(a=t().features[e])?void 0:a.hasCode)&&s}}))),l=e=>i(t=>{var a,s;return null!=(s=null==(a=t.features[e])?void 0:a.hasLink)&&s}),r=e=>i(t=>{var a,s;return null!=(s=null==(a=t.features[e])?void 0:a.hasCode)&&s})},0x249008d3:(e,t,a)=>{a.d(t,{l:()=>s});var s=function(e){return e.Standard="Standard",e.TimelineGroup="TimelineGroup",e}({})},0x31bda27d:(e,t,a)=>{a.d(t,{b:()=>S});var s=a(0x22102fd88),n=a(0xc4eacc65),i=a(0x18d835460),l=a(0x1afb3afe7),r=a(0x1a1f6dda6),o=a(0xfc89b4a4),d=a(0x6c11e9ff),c=a(0x1b6a4a195),u=a(0x628a9a0b),x=a(0x1065e6d73),f=a(0xb91ccc43),m=a(0x21d170f9),p=a(0x225bae024),h=a(0xb844abc8),g=a(0x23977865),v=a(0x1bd175d8c),b=a(0xef41e510),j=a.n(b),y=a(0x38e6572),w=a(0x6808359f),_=a(0x1dad12e86),k=a(0x1babd1d4e);let M=(0,o.memo)(function(e){let{conversationUuid:t,name:a,isInteractive:n=!0,sharedBy:i,project:l,controlsSidebarIsOpen:d,openControlsSidebar:c,closeControlsSidebar:b,isStreaming:M,isLoading:C,messagesLength:N=0}=e,S=!!i,{data:A}=(0,u.Bq)(t,{enabled:!S}),E=(0,x.u9)(),T=!!l&&!l.is_harmony_project,z=(0,v.V)(g.E_),[R,I]=(0,o.useState)(!1),[U,L]=(0,o.useState)(""),[O,F]=(0,o.useState)(null),P=(0,o.useRef)(null),{mutate:D}=(0,u.HI)(t),[B,G]=(0,o.useState)(!1),W=e=>{A&&!A.is_temporary&&((0,h.fJ)()||(e.preventDefault(),e.stopPropagation(),I(!0),L(a||""),F(null)))},V=()=>{if(U.trim()&&A){let e=U.trim();e!==a&&(F(e),D({name:e},{onSettled:()=>{F(null)}}))}I(!1)},q=e=>{e.nativeEvent.isComposing||("Enter"===e.key?(e.preventDefault(),V()):"Escape"===e.key&&(e.preventDefault(),I(!1),L(a||"")))};return((0,o.useEffect)(()=>{R&&P.current&&(P.current.focus(),P.current.select())},[R]),n&&A&&A.is_temporary)?null:(0,s.jsxs)(_.z,{className:(0,r.A)("h-12",!z&&"-mb-3"),contentClassName:(0,r.A)("gap-6",z?"pl-0":"p-3 lg:pl-4 lg:pr-3"),"data-testid":"chat-header",sticky:!0,children:[(0,s.jsxs)("div",{className:"flex min-w-0 flex-1 shrink md:items-center font-base-bold pr-[100px]",children:[T&&(0,s.jsxs)("div",{className:"text-text-300 hover:text-text-100 inline-flex min-w-0 shrink-[4] items-center max-md:pl-1 gap-1",children:[(0,s.jsx)(j(),{href:"/project/".concat(l.uuid),className:"truncate",children:l.name}),(0,s.jsx)("span",{className:"opacity-50 px-0.5",children:"/"})]}),(0,s.jsx)("div",{className:"flex min-w-0 shrink-1 items-center group",children:C?(0,s.jsx)("div",{className:"animate-pulse h-5 w-32 rounded-lg bg-bg-300"}):n&&A?A.is_temporary?(0,s.jsxs)("div",{className:"flex flex-row items-center text-text-300 gap-2 cursor-default",children:[(0,s.jsx)(m.X3,{}),(0,s.jsx)(y.A,{defaultMessage:"Incognito chat",id:"MZWV60Fq3N"})]}):(0,s.jsx)(s.Fragment,{children:R?(0,s.jsx)("div",{className:"flex items-center bg-bg-000 border border-accent-secondary-100 rounded-md h-7 w-48 px-1.5",onClick:e=>e.stopPropagation(),children:(0,s.jsx)("input",{ref:P,type:"text",value:U,onChange:e=>L(e.target.value),onKeyDown:q,onBlur:V,className:"bg-transparent border-none outline-none focus:outline-none focus:ring-0 focus:border-transparent font-base-bold text-text-000 w-full overflow-x-auto",style:{outline:"none",boxShadow:"none"},"data-testid":"name-chat",autoFocus:!0})}):(0,s.jsxs)("div",{className:"flex items-center group [&:hover>button]:!bg-bg-300 [&>button:hover]:!bg-bg-500",children:[(0,s.jsx)(p.$,{variant:"ghost",size:"default",className:(0,r.A)(0===a.length?"!text-text-500":"!text-text-300 hover:!text-text-100","!shrink !min-w-0 !px-2 !py-0 !scale-100 !h-7 !rounded-r-none","active:!bg-bg-500",B&&"!bg-bg-300"),onClick:W,"data-testid":"chat-title-button",children:(0,s.jsx)("div",{className:"min-w-0 flex-1",children:(0,s.jsx)("div",{className:"truncate font-base-bold",children:O||(a.length>0?a:(0,s.jsx)(y.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"}))})})}),(0,s.jsx)("div",{className:"w-[1.5px] h-7"}),(0,s.jsx)(w.p,{conversation:A,initialName:a,open:B,onOpenChange:G,trigger:(0,s.jsx)(p.$,{variant:"ghost",size:"icon_sm",className:(0,r.A)("!h-7 !w-7 !rounded-l-none !text-text-300 hover:!text-text-100","active:!bg-bg-500",B&&"!bg-bg-500"),"data-testid":"chat-menu-trigger",children:(0,s.jsx)(f.biH,{size:16})})})]})}):(0,s.jsx)("div",{className:"truncate text-text-300 cursor-pointer hover:text-text-100",onClick:W,children:R?(0,s.jsx)("input",{ref:P,type:"text",value:U,onChange:e=>L(e.target.value),onKeyDown:q,onBlur:V,className:"bg-transparent border-0 outline-none focus:outline-none focus:ring-0 font-base-bold text-text-300 w-full","data-testid":"name-chat",onClick:e=>e.stopPropagation()}):(0,s.jsx)(s.Fragment,{children:O||(a.length>0?a:(0,s.jsx)(y.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"}))})})})]}),(0,s.jsxs)("div",{className:"right-3 flex gap-2",children:[S&&(0,s.jsx)("div",{className:"bg-bg-300 text-text-300 rounded-full px-3 py-1.5 font-base-bold",children:(0,s.jsx)(y.A,{defaultMessage:"Shared by {sharedBy}",id:"UMLOHo6H9c",values:{sharedBy:i}})}),t&&!S&&!E&&(0,s.jsx)(k.O,{conversationUuid:t,controlsSidebarIsOpen:d,openControlsSidebar:c,closeControlsSidebar:b,isStreaming:M,isTemporary:null==A?void 0:A.is_temporary,hasConversationLoaded:N>0})]})]})});var C=a(0x18bfd014),N=a(0xec9172c1);function S(e){let{headerProps:t,mainElement:a,drawerElement:u,auxilaryElement:x,isDrawerOpen:f,autoscrollRef:m,rightSidebarElement:p,autoScrollInnerClassName:h}=e,[g,v]=(0,o.useState)(!1),b=(0,o.useRef)(null),j=(0,o.useRef)(null),y=(0,o.useRef)(null),w=(0,o.useRef)({interacted:!1}),{setIsDrawerExpanded:_}=(0,N.x)(),{incognitoModeEnabled:k}=(0,C.S)(),S=(0,i.F)("md");(0,o.useEffect)(function(){let e=!0;if(!j.current||!b.current||!A.current||!y.current)return;let t=b.current,a=j.current,s=y.current;if(S){let e=f?window.innerWidth/2-d.r:a.getBoundingClientRect().width;s.style.width="".concat(e,"px")}let n=S&&!!p,i=A.current.getBoundingClientRect().width,l=n?384/i*100:0,r=Date.now(),o=f?l:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=parseFloat(e);return isNaN(a)?t:a}(a.style.flexGrow,50);return f&&(requestAnimationFrame(function n(){if(!e)return;let i=(Date.now()-r)/220,o=l+i*(50-l);if(i>=1||!S){t.style.flex=String(50),a.style.flex=String(50),s.style.width="auto";return}t.style.flex=String(100-o),a.style.flex=String(o),requestAnimationFrame(n)}),w.current.interacted=!0),!f&&w.current.interacted&&requestAnimationFrame(function n(){if(!e)return;let i=(Date.now()-r)/220,l=o-i*o;if(i>=1||!S){t.style.flex=String(100),a.style.flex=String(0),s.style.width="auto";return}t.style.flex=String(100-l),a.style.flex=String(l),requestAnimationFrame(n)}),()=>{e=!1}},[f]);let[A,E]=(0,l.w)();return(0,o.useEffect)(()=>{if(!j.current||!b.current||!A.current)return;let e=A.current.getBoundingClientRect(),t=b.current.getBoundingClientRect();if(window.innerWidth<c.gU||t.width>c.Db)return;let a=c.Db/e.width*100;b.current.style.flex=String(a),j.current.style.flex=String(100-a)},[E.width,E.height,A]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:(0,r.A)("flex flex-1 h-full w-full overflow-hidden relative",g&&"select-none"),ref:A,onMouseUp:function(){v(!1),document.body.style.removeProperty("cursor")},onMouseMove:e=>{var t,a;if(!g||!j.current||!b.current||!A.current)return;let s=A.current.getBoundingClientRect(),n=b.current.getBoundingClientRect(),i=(t=e.clientX-n.left,a=c.Db,Math.min(Math.max(t,a),s.width-240)/s.width*100);b.current.style.flex=String(i),j.current.style.flex=String(100-i)},children:[(0,s.jsxs)("div",{ref:b,className:"h-full flex flex-col overflow-hidden",style:{flex:"".concat(100," 0")},children:[(0,s.jsx)(M,{...t}),(0,s.jsx)(n.Z,{ref:m,parentClassName:"pt-6 flex-1",innerClassName:h,children:a})]}),(0,s.jsxs)("div",{className:(0,r.A)("max-md:hidden group w-2 relative h-full cursor-col-resize -mr-1 z-30 grid place-items-center",!f&&"hidden"),onMouseDown:function(){v(!0),document.body.style.setProperty("cursor","col-resize")},children:[(0,s.jsx)("div",{className:(0,r.A)("absolute top-0 bottom-0 right-1 w-[0.5px] bg-border-300","transition-all group-hover:delay-75 group-hover:bg-accent-secondary-100 group-hover:w-px group-hover:translate-x-[0.5px]",g&&"!bg-accent-secondary-000")}),(0,s.jsx)("div",{className:(0,r.A)("h-6 w-2 relative","rounded-full border-0.5 bg-bg-100 shadow border-border-300","transition duration-200 group-hover:delay-75 group-hover:border-accent-secondary-900 group-hover:bg-accent-secondary-900","cursor-col-resize",g&&"!bg-accent-secondary-000 !border-accent-secondary-000")})]}),(0,s.jsx)("div",{ref:j,className:(0,r.A)("max-md:absolute top-0 right-0 bottom-0 left-0 z-20","md:flex-grow-0 md:flex-shrink-0 md:basis-0","overflow-hidden h-full",f?"max-md:flex-1":"max-md:hidden",g&&"pointer-events-none"),style:{flex:"0 0"},children:(0,s.jsxs)("div",{ref:y,className:"flex flex-col h-full overflow-hidden",children:[!k&&(0,s.jsx)("div",{className:"h-12 md:hidden bg-bg-000/30 backdrop-blur border-b-0.5 border-border-300",onClick:()=>{_(!1)}}),(0,s.jsx)("div",{className:"flex-1 overflow-hidden h-full bg-bg-100",children:u})]})}),p]}),null!=x?x:null]})}},0x3cebcb0f:(e,t,a)=>{a.d(t,{M9:()=>l,NX:()=>r});var s=a(0x24fcf6beb);async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,a=e.querySelectorAll('link[rel="stylesheet"]');if(0===a.length)return;let s=Array.from(a).map(e=>new Promise(t=>{if(e.sheet)return void t();e.addEventListener("load",()=>t()),e.addEventListener("error",()=>t())}));await Promise.race([Promise.all(s),new Promise(e=>setTimeout(e,t))])}async function i(e){let{title:t,element:a}=e;return new Promise((e,s)=>{try{var i;let l=document.head.innerHTML,r=document.createElement("iframe");r.style.position="fixed",r.style.right="0",r.style.bottom="0",r.style.width="0",r.style.height="0",r.style.border="0",r.setAttribute("sandbox","allow-same-origin allow-modals"),r.setAttribute("csp","");let o=!1;r.onload=()=>{o=!0},document.body.appendChild(r);let d=r.contentDocument||(null==(i=r.contentWindow)?void 0:i.document);if(!d){document.body.removeChild(r),s(Error("Could not access iframe document"));return}d.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>".concat(t,"</title>\n            ").concat(l,"\n            <style>\n              /* Remove browser-added headers and footers */\n              @page {\n                size: auto;\n                margin: 0; /* Keep at 0 to remove datetime, page count, website, etc */\n                padding: 25px 0; /* top and bottom page padding */\n              }\n              @media print {\n                html, body, pre, code {\n                  -webkit-print-color-adjust: exact !important;\n                  color-adjust: exact !important;\n                  print-color-adjust: exact !important;\n                }\n              \n                /* Smart page breaks */\n                h1, h2, h3 {\n                  page-break-after: avoid !important;\n                }\n                img, pre, table {\n                  page-break-inside: avoid !important;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            ").concat(a.outerHTML,"\n          </body>\n        </html>\n      ")),d.close();let c=document.title,u=()=>{try{document.title=c,document.body.removeChild(r)}catch(e){}};(async()=>{try{o||await new Promise((e,t)=>{r.onload=()=>e(),r.onerror=e=>t(e)}),await n(d);try{var a,i;document.title=t;try{null==(a=r.contentWindow)||a.print()}catch(e){null==(i=r.contentDocument)||i.execCommand("print")}setTimeout(()=>{u(),e()},100)}catch(e){u(),s(e)}}catch(e){u(),s(e)}})()}catch(e){s(e)}})}async function l(e){if(e.type!==s.vU.Markdown)throw Error("Only markdown artifacts can be saved as PDF");let t=document.getElementById("markdown-artifact");if(!t)throw Error("Markdown artifact element not found");return i({title:(null==e?void 0:e.title)||"Artifact",element:t})}async function r(e){let t=document.getElementById("wiggle-file-content");if(!t)throw Error("File content element not found");return i({title:e.path.split("/").pop()||e.path,element:t})}},0x52b639a1:(e,t,a)=>{a.d(t,{A:()=>eM});var s=a(0x22102fd88),n=a(0xac309a83),i=a(0x1b813d90),l=a(0xfc89b4a4),r=a(0x1334f6ecc),o=a(0x3769f4df),d=a(0x1b8f3b064),c=a(0x38e6572);let u=()=>(0,s.jsxs)("div",{className:"items-top flex w-full bg-bg-200 mt-5 p-3 rounded-xl items-center text-text-300",children:[(0,s.jsx)(d.R,{size:24}),(0,s.jsx)("p",{className:"font-base ml-3",children:(0,s.jsx)(c.A,{defaultMessage:"Claude has ended this chat.",id:"xJ+abA4nue"})})]});var x=a(0x24573a476),f=a(0xb844abc8),m=a(0x17f3a2521),p=a(0x18eb11a1c),h=a(0x156c4e43b),g=a(0xf8bd7957),v=a(0x1e140f433);let b=h.Ik({url:h.Yj()}),j=e=>{let t,{input:a,toolResult:n,isStreaming:i}=e,r=null==n?void 0:n.is_error,[o,d]=(0,l.useState)(!1),u=(0,l.useMemo)(()=>{if(r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"knowledge"===e.type)){let t=[];for(let a of e.content)"knowledge"===a.type&&t.push(a);return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let a=JSON.parse(t.text);return Array.isArray(a)?a.map(e=>{let t=m.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),h=(0,l.useMemo)(()=>{if(!r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"text"===e.type)){let t=[];for(let a of e.content)if("text"===a.type){let e=function(e){try{return JSON.parse(e)}catch(e){return null}}(a.text);if(null===e)t.push({error_type:"UNKNOWN_ERROR",error_message:a.text});else{let a=m.kS.safeParse(e);a.success&&t.push(a.data)}}return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let a=JSON.parse(t.text);return Array.isArray(a)?a.map(e=>{let t=m.tD.safeParse(e);if(!t.success)return null;{let e=m.kS.safeParse(JSON.parse(t.data.text));return e.success?e.data:null}}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),j=function(e){switch(e){case"INVALID_URL":return(0,s.jsx)(c.A,{defaultMessage:"The URL provided is invalid",id:"EXjAXf5Pbi"});case"URL_NOT_FOUND":return(0,s.jsx)(c.A,{defaultMessage:"Could not find this URL",id:"stDgCXJO7F"});case"RATE_LIMIT_EXCEEDED":return(0,s.jsx)(c.A,{defaultMessage:"Access to this website has been restricted due to rate limits",id:"VhUxwIo+O2"});case"ROBOTS_DISALLOWED":return(0,s.jsx)(c.A,{defaultMessage:"This website has blocked Claude via robots.txt rules",id:"dHtmXRJ647"});case"URL_TOO_LONG":return(0,s.jsx)(c.A,{defaultMessage:"The URL provided is too long",id:"K2DBYJqbtF"});case"SITE_BLOCKED":return(0,s.jsx)(c.A,{defaultMessage:"Access to this website is blocked",id:"WI6DZStAoi"});case"PERMISSIONS_ERROR":return(0,s.jsx)(c.A,{defaultMessage:"The URL was not provided by the user nor was it contained in any web search/fetch results",id:"aXYLYDjU6L"});case"UNKNOWN_ERROR":case"SERVER_ERROR":case"CLIENT_ERROR":return(0,s.jsx)(c.A,{defaultMessage:"An unknown error occurred",id:"3VG8rbxa4v"});case void 0:return null}}(null==h?void 0:h.error_type),{data:y}=b.safeParse(a);if(!y)return;let w=y.url,_=(null==u?void 0:u.title)||w,k=(0,f.Nj)(w);return t=i?k?(0,s.jsx)(c.A,{defaultMessage:"Fetching from {hostname}",id:"5qKeNV67+8",values:{hostname:k}}):(0,s.jsx)(c.A,{defaultMessage:"Fetching from site",id:"TSZq9sKvY7"}):r?(0,s.jsx)(c.A,{defaultMessage:"Failed to fetch <b>{title}</b>",id:"8JHipUo6K+",values:{title:_,b:e=>(0,s.jsx)("span",{className:"text-text-400",children:e})}}):(0,s.jsx)(c.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:_,b:e=>(0,s.jsx)("span",{className:"text-text-400",children:e})}}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.aX,{isError:r,errorMessage:j,text:t,secondaryText:i?void 0:k,handleClick:()=>d(!0),icon:(0,s.jsx)(g.z,{size:16,type:"favicon",src:w,name:k||"Fetch",fallbackToGlobe:!0}),secondaryIcon:(0,s.jsx)(p.B,{size:16,className:"text-text-300"}),...e}),(0,s.jsx)(x.v,{isOpen:o,url:w,onClose:()=>d(!1),onConfirm:()=>{window.open(w,"_blank"),d(!1)}})]})};var y=a(0x1fec22234),w=a(0x865afcc2),_=a(0x1d0c32e96),k=a(0x138249603),M=a(0x1dc411c0f),C=a(0x54824aed),N=a.n(C),S=a(0x1ab0d1ca1),A=a(0x25062734b),E=a(0x18175ce17),T=a(0x1f92f9b94),z=a(0x1f7748bd);function R(e){return"webpage_metadata"===e.metadata.type?e.url||"":e.metadata.doc_uuid}let I=e=>{let{isExpanded:t,toolName:a,results:n}=e;return(null==n?void 0:n.length)?(0,s.jsx)("div",{className:"flex flex-nowrap p-2 pt-0 flex-col",tabIndex:-1,children:"web_search"===a?(0,s.jsx)(L,{results:n,isExpanded:t}):(0,s.jsx)(O,{results:n,isExpanded:t})}):null},U={initial:{opacity:0,scale:.7},animate:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:30,mass:1}}},L=e=>{let{isExpanded:t,results:a}=e;return(0,s.jsx)(s.Fragment,{children:a.map(e=>{var a;return e.knowledge&&"webpage_metadata"===e.knowledge.metadata.type?(0,s.jsx)(M.P.div,{variants:U,children:(0,s.jsx)(w.$,{disabled:!t,icon:(0,s.jsx)(y.d,{url:e.knowledge.metadata.favicon_url,size:16}),title:e.knowledge.title,subtitles:[e.knowledge.metadata.site_domain],url:null!=(a=e.knowledge.url)?a:void 0})},e.knowledge.url):null})})},O=e=>{let{isExpanded:t,results:a}=e;return(0,s.jsx)(s.Fragment,{children:a.map(e=>(0,s.jsx)(M.P.div,{variants:U,children:(0,s.jsx)(F,{disabled:!t,knowledge:e.knowledge})},e.uuid))})},F=e=>{let{disabled:t,knowledge:a}=e,l=(0,n.fS)("mcp_gdrive"),o=(e=>{let{isError:t}=e,a=(0,E.Cg)(i.v8.GDRIVE),s=a.isAuthenticated;return(0,A.v_)(a.server_uuid)?s?t?i.I5.ACCESS_DENIED:i.I5.READY:i.I5.UNAUTHENTICATED:i.I5.DISABLED})({isError:!a}),d=(e=>{let{isError:t}=e,{isDriveAuthenticated:a}=(0,r.cI)();return(0,r.yy)()?a?t?i.I5.ACCESS_DENIED:i.I5.READY:i.I5.UNAUTHENTICATED:i.I5.DISABLED})({isError:!a});return(0,s.jsx)(T.Tc,{syncSourceType:i.v8.GDRIVE,syncStatus:l?o:d,disabled:t,title:(null==a?void 0:a.title)||"Untitled document",subtitles:(null==a?void 0:a.metadata.type)==="google_doc_metadata"&&a.metadata.owner?[a.metadata.owner]:void 0,url:(null==a?void 0:a.url)||void 0})},P=h.Ik({query:h.Yj(),n:h.ai().int().optional()}),D=e=>{var t;let{toolName:a,syncSourceType:n,...i}=e,{input:l,toolResult:r,isStreaming:o,groupItemKey:d}=i,{isExpanded:c,setIsExpanded:u,snappyTransition:x}=(0,z.a)(!1,d),f=(0,S.A)(),p=null==r?void 0:r.is_error,h=p?null:function(e){if(!e)return null;if(e.content.some(e=>"knowledge"===e.type||"rag_reference"===e.type)){let t=[];for(let a of e.content)if("knowledge"===a.type)t.push({uuid:R(a),knowledge:a});else if("rag_reference"===a.type){let e=a.doc_uuid;t.push({uuid:e})}return N()(t,e=>e.uuid)}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let a=JSON.parse(t.text),s=(Array.isArray(a)?a.map(e=>{let t=m.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]).map(e=>({uuid:R(e),knowledge:e}));return N()(s,e=>e.uuid)}catch(e){return[]}}(r),{data:g}=P.safeParse(l),b="web_search"===a?f.formatMessage({defaultMessage:"Searching the web",id:"5KajyzHSXj"}):f.formatMessage({defaultMessage:"Searching Google Drive",id:"V/QOi0yNF0"});if(!g)return;let j=f.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(t=null==h?void 0:h.length)?t:0}),y=!h&&o?b:g.query;return(0,s.jsx)(v.sH,{isExpandingDisabled:!!o,isExpanded:c,setIsExpanded:u,isError:p,text:y,secondaryText:o?void 0:j,icon:"web_search"===a?(0,s.jsx)(k.q,{size:16}):!!n&&(0,s.jsx)(_.A9,{type:n,size:14}),...i,children:(0,s.jsx)(v.NG,{isExpanded:c,snappyTransition:x,isScrollable:!0,children:!p&&!!(null==h?void 0:h.length)&&(0,s.jsx)(I,{isExpanded:c,toolName:a,results:h})})})};var B=a(0x5ae340a6),G=a(0x14de19ae8);h.Ik({prompt:h.Yj()});var W=a(0x249008d3),V=a(0x8aef00d0),q=a(0x24fcf6beb),Y=a(0x1a1f6dda6),H=a(0x17e7bc007);function J(e){var t,a,n,i;let{input:r,toolResult:o,isStreaming:d,isLastMessage:c,onOpenArtifact:u,message:x,artifactCellType:f,selectedArtifactId:m,selectedArtifactVersion:p,isFirstBlockOfMessage:h,isLastBlockOfMessage:g}=e,v=(0,l.useMemo)(()=>q.oE.parse(r),[r]),{versions:b,...j}=null!=(n=(0,H.ST)(null!=(a=v.id)?a:""))?n:{},y=(0,l.useMemo)(()=>{let e=null==b?void 0:b.findIndex(e=>e.uuid===v.version_uuid);if(-1!==e)return e},[b,v.version_uuid]),w=null==(t=null!=(i=v.content)?i:v.new_str)?void 0:t.slice(0,250),_=(0,l.useCallback)(e=>{u&&u(e,x.uuid,v.version_uuid)},[u,x.uuid,v.version_uuid]),k=(0,l.useMemo)(()=>({isClosed:void 0!==o,...j,...v}),[o,j,v]),M=m===k.id&&p===v.version_uuid,C="individual_cell_create"===f||"multi_edit_not_last"!==f;return(0,s.jsx)("div",{className:(0,Y.A)(C&&(h?"pt-2":"pt-3"),C&&(g?"pb-2":"pb-3"),"multi_edit_not_last"===f&&"h-0"),children:(0,s.jsx)(V.d,{versionNum:y?y+1:void 0,preview:w,versionCount:null==b?void 0:b.length,properties:k,isStreaming:d,isEdit:"individual_cell_create"!==f,isNotLastEdit:"multi_edit_not_last"===f,isLastMessage:c,onOpenArtifact:_,isExpanded:M})})}var K=a(0x1e672f605),X=a(0x5ba03586),Z=a(0x196d2b460),Q=a(0x253a5c787),$=a(0xde8f44d0);let ee=h.Ik({code:h.Yj().nullish().transform(e=>(null==e?void 0:e.charAt(0))==="\n"?e.slice(1):null!=e?e:void 0)}),et=e=>{var t;let{input:a,toolResult:n,isStreaming:i,groupItemKey:r}=e,o=(0,S.A)(),{isExpanded:d,setIsExpanded:c,snappyTransition:u}=(0,z.a)(i,r),x=null!=(t=ee.parse(a).code)?t:"",{toolResultLogs:f,toolResultErrors:m}=(0,l.useMemo)(()=>n?(e=>{let t;if(!e.content||0===e.content.length||!e.content[0])return{toolResultLogs:"",toolResultErrors:"Error: Missing content data"};if("text"!==e.content[0].type)return{toolResultLogs:"",toolResultErrors:""};try{t=JSON.parse(e.content[0].text)}catch(e){return(0,Q.Cp)(e,{tags:{source:"repl-tool-result"}}),{toolResultLogs:"",toolResultErrors:"Error: failed to parse Analysis tool result"}}let a=t.logs?"Result\n\n"+t.logs.join("\n"):"";return"error"===t.status?{toolResultLogs:a,toolResultErrors:"Error\n\n"+t.error}:{toolResultLogs:a,toolResultErrors:""}})(n):{toolResultLogs:"",toolResultErrors:""},[n]);return(0,s.jsx)(v.sH,{isExpanded:d,setIsExpanded:c,icon:(0,s.jsx)(Z.N,{size:16}),text:i?o.formatMessage({defaultMessage:"Analyzing data",id:"UkajfL/9Yh"}):o.formatMessage({defaultMessage:"Analyzed data",id:"NbwDtG2acW"}),secondaryText:i?void 0:o.formatMessage({defaultMessage:"View analysis",id:"fL+Q/8QHAy"}),...e,children:(0,s.jsx)(v.NG,{isExpanded:d,snappyTransition:u,isScrollable:!0,children:(0,s.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,s.jsx)($.z,{language:"javascript",code:x}),(0,s.jsx)($.z,{title:o.formatMessage({defaultMessage:"Output",id:"fio5opLcOZ"}),language:"javascript",code:f}),!!m&&(0,s.jsx)($.z,{title:o.formatMessage({defaultMessage:"Error",id:"KN7zKn8z4F"}),code:m,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})]})})})};var ea=a(0x120a0aef1),es=a(0x8f813b9c);let en=e=>{let{streamingAction:t,errorAction:a,successAction:n,target:i,isStreaming:l=!1,isError:r=!1,description:o}=e;return o&&!r?l?(0,s.jsx)(es.N,{children:o}):(0,s.jsx)("span",{className:"text-text-200",children:o}):(0,s.jsxs)("span",{className:"flex items-center min-w-0 text-text-200",children:[(0,s.jsx)("span",{className:"whitespace-nowrap mr-1 text-text-200",children:l?t:r?a:n}),(0,s.jsx)("span",{className:"bg-gradient-to-b from-bg-300 via-bg-300/80 to-bg-300 shadow-xs rounded px-1 py-0.5 font-mono truncate overflow-hidden text-ellipsis min-w-0 text-text-200",title:i,children:i})]})},ei=h.Ik({returncode:h.ai().int(),stdout:h.Yj(),stderr:h.Yj()});function el(e){if(!e.content||0===e.content.length)return null;let t=e.content[0];return(null==t?void 0:t.type)==="text"?t.text:null}let er=e=>{let{input:t,toolResult:a,isStreaming:n,isFirstBlockOfMessage:i,isLastBlockOfMessage:r,renderMode:o,groupItemKey:d,isFirstItemInGroup:c,isLastItemInGroup:u}=e,x=(0,S.A)(),{isExpanded:f,setIsExpanded:m,snappyTransition:p}=(0,z.a)(!1,d),h=(null==t?void 0:t.command)||"",g=(null==a?void 0:a.is_error)||!1,b=(0,l.useMemo)(()=>(function(e,t,a){if(!e)return;if(t)return{type:"error",rawContent:el(e)||JSON.stringify(e,null,2)};let s=el(e);if(!s)return{type:"empty"};try{let e=ei.parse(JSON.parse(s));return{type:"success",data:e}}catch(e){try{let e=JSON.parse(s);if(Array.isArray(e)&&e.length>0&&"text"===e[0].type&&e[0].text){let t=ei.parse(JSON.parse(e[0].text));return{type:"success",data:t}}}catch(e){}return a?void 0:{type:"parse-error",rawContent:s}}})(a,g,n),[a,g,n]),j=null==t?void 0:t.description;return(0,s.jsx)(v.sH,{isExpanded:f,setIsExpanded:m,isStreaming:!!n,icon:(0,s.jsx)(ea.b,{size:16}),text:(0,s.jsx)(en,{streamingAction:x.formatMessage({defaultMessage:"Running",description:"Status header for a bash command",id:"ScRq37Oq7S"}),errorAction:x.formatMessage({defaultMessage:"Failed to run",description:"Status header for a bash command",id:"O15lx6IwMb"}),successAction:x.formatMessage({defaultMessage:"Ran",description:"Status header for a bash command",id:"JUMXBud/d6"}),target:h,isStreaming:n,isError:g,description:j}),isFirstBlockOfMessage:i,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:c,isLastItemInGroup:u,children:(0,s.jsx)(v.NG,{isExpanded:f,snappyTransition:p,isScrollable:!0,children:(0,s.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,s.jsx)($.z,{language:"bash",code:h}),(()=>{if(!b)return null;switch(b.type){case"success":{let{data:e}=b;return(0,s.jsxs)(s.Fragment,{children:[e.stdout&&(0,s.jsx)($.z,{title:x.formatMessage({defaultMessage:"Output",description:"Title for the result of a bash command",id:"98/B4gW/HL"}),language:"bash",code:e.stdout}),e.stderr&&(0,s.jsx)($.z,{title:x.formatMessage({defaultMessage:"Error",description:"Title for the result of a bash command",id:"96iMiC11cz"}),code:e.stderr,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"}),!e.stdout&&!e.stderr&&(0,s.jsx)($.z,{title:x.formatMessage({defaultMessage:"Output",description:"Title for the result of a bash command",id:"98/B4gW/HL"}),code:x.formatMessage({defaultMessage:"exit code {returncode}",description:"The result of a bash command",id:"Uoe/PEvNYN"},{returncode:e.returncode})})]})}case"error":return(0,s.jsx)($.z,{title:x.formatMessage({defaultMessage:"Command failed",description:"Title for the result of a bash command",id:"REMG+p+ZiU"}),code:b.rawContent,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"});case"parse-error":return(0,s.jsx)($.z,{title:x.formatMessage({defaultMessage:"Output",description:"Title for the result of a bash command",id:"98/B4gW/HL"}),code:b.rawContent,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"});case"empty":return(0,s.jsx)($.z,{title:x.formatMessage({defaultMessage:"No output",description:"Title for the result of a bash command",id:"DyoXiEr2fN"}),code:x.formatMessage({defaultMessage:"Command completed with no output",description:"The result of a bash command",id:"TRBc7KuuG+"})});default:return null}})()]})})})};var eo=a(0x2202d81f6),ed=a(0xbca8e388),ec=a(0x1fa9af01),eu=a(0xec9172c1),ex=a(0x16801a2b9),ef=a(0x14a7c225d),em=a(0x16a96a9a2);let ep=e=>{var t,a;let{input:n,toolResult:i,isStreaming:l,isFirstBlockOfMessage:r,isLastBlockOfMessage:o,renderMode:d,groupItemKey:c,isFirstItemInGroup:u,isLastItemInGroup:x,message:f,shareType:m}=e,{chatResourceState:p,dispatchChatResource:h}=(0,ex.i)(),{setIsDrawerExpanded:g}=(0,eu.x)(),b=null==i?void 0:i.is_error,j=null!=(t=null==n?void 0:n.path)?t:"",y=p.streamingFiles.get(j),w=(null==y?void 0:y.showingInRightPane)&&(null==y?void 0:y.renderAs)===q.vU.Markdown,{isExpanded:_,setIsExpanded:k,snappyTransition:M}=(0,z.a)(!w&&l,c),C=null!=(a=null==n?void 0:n.file_text)?a:"",N=(0,ef.S)(j),S="markdown"===N,A=(0,em.W)(j),E=j.split("/").pop()||j,T=null==n?void 0:n.description,R=!b&&j&&(null==f?void 0:f.uuid)&&(0,em.m)(j,m),I=R&&!m;return!(w&&l)&&(l||_||!M)?(0,s.jsx)(v.sH,{isExpanded:_,setIsExpanded:k,isExpandingDisabled:l,isStreaming:!!l,icon:(0,s.jsx)(ef.o,{path:(null==n?void 0:n.path)||"",size:16}),text:(0,s.jsx)(en,{streamingAction:"Creating",errorAction:"Failed to create",successAction:"Created",target:A,isStreaming:l,isError:b,description:T}),secondaryIcon:I?(0,s.jsx)("span",{className:"text-xs text-text-300 max-w-64 truncate shrink-0 min-w-0",children:E}):void 0,isFirstBlockOfMessage:r,isLastBlockOfMessage:o,renderMode:d,isFirstItemInGroup:u,isLastItemInGroup:x,children:(0,s.jsx)(v.NG,{isExpanded:_,snappyTransition:M,children:(0,s.jsx)(ec.Z,{noDefaultScroll:!l,className:"flex flex-col gap-3 p-3 pt-1 max-h-[238px] overflow-y-scroll",disabled:!1,children:(0,s.jsx)("div",{"data-testid":"repl-output",children:C&&(S&&!w?(0,s.jsx)("div",{className:"markdown-wrapper",children:l?(0,s.jsx)(eo.qO,{text:C,className:"font-claude-response prose prose-sm max-w-none",isStreaming:!0}):(0,s.jsx)(ed.fP,{text:C,className:"font-claude-response prose prose-sm max-w-none"})}):(0,s.jsx)($.z,{title:j,language:N,code:C}))})})})}):(0,s.jsx)(v.aX,{isStreaming:!!l,handleClick:R?()=>{j&&(null==f?void 0:f.uuid)&&(h({type:"SELECT_FILE",path:j,toolType:"create_file",messageId:f.uuid}),g(!0))}:void 0,icon:(0,s.jsx)(ef.o,{path:(null==n?void 0:n.path)||"",size:16}),text:(0,s.jsx)(en,{streamingAction:"Creating",errorAction:"Failed to create",successAction:"Created",target:A,isStreaming:l,isError:b,description:T}),secondaryIcon:I?(0,s.jsx)("span",{className:"text-xs text-text-300 max-w-64 truncate shrink-0 min-w-0",children:E}):void 0,isFirstBlockOfMessage:r,isLastBlockOfMessage:o,renderMode:d,isFirstItemInGroup:u,isLastItemInGroup:x})};var eh=a(0xfb22fb91);let eg=e=>{var t,a;let{toolResult:n,isStreaming:i,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:d,isLastItemInGroup:c,message:u}=e,{dispatchChatResource:x}=(0,ex.i)(),{setIsDrawerExpanded:f}=(0,eu.x)(),m=(null==n?void 0:n.message)||(i?"Presenting file(s)...":"Presented file(s)"),p=null==n||null==(a=n.content)||null==(t=a.find(e=>"local_resource"===e.type))?void 0:t.file_path;return(0,s.jsx)(v.aX,{text:m,icon:(0,s.jsx)(eh.i,{size:20}),isStreaming:null!=i&&i,isFirstBlockOfMessage:null!=l&&l,isLastBlockOfMessage:null!=r&&r,renderMode:o,isFirstItemInGroup:d,isLastItemInGroup:c,handleClick:p?()=>{p&&(null==u?void 0:u.uuid)&&(x({type:"SELECT_FILE",path:p,toolType:"present_files",messageId:u.uuid}),f(!0))}:void 0})};var ev=a(0x13132c8f3),eb=a(0x1b370f49d);let ej=l.memo(e=>{let{oldStr:t="",newStr:a="",isStreaming:n=!1}=e,{linesAdded:i,linesRemoved:r}=(0,l.useMemo)(()=>{let e=t?t.split("\n").length:0;return{linesAdded:a?a.split("\n").length:0,linesRemoved:e}},[t,a]),o=(0,l.useMemo)(()=>{let e=[];return i>0&&e.push("".concat(i," ").concat(1===i?"line":"lines"," added")),r>0&&e.push("".concat(r," ").concat(1===r?"line":"lines"," removed")),e.join(", ")},[i,r]);if(0===i&&0===r)return null;let d=(0,s.jsxs)("span",{className:"flex items-center gap-1.5 text-xs font-mono mr-2 border-0.5 border-border-300 rounded px-1 py-0.5",children:[i>0&&(0,s.jsx)("span",{className:"text-forest-green",children:"+".concat(i)}),r>0&&(0,s.jsx)("span",{className:"text-danger-000",children:"-".concat(r)})]}),c=n?(0,s.jsx)(es.N,{children:d}):d;return(0,s.jsx)(eb.Tooltip,{tooltipContent:o,align:"center",children:(0,s.jsx)("span",{className:"inline-flex",children:c})})});ej.displayName="LineDiffCounter";let ey=e=>{var t;let{input:a,toolResult:n,isStreaming:i,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:d,isLastItemInGroup:c,message:u,shareType:x}=e,{dispatchChatResource:f}=(0,ex.i)(),{setIsDrawerExpanded:m}=(0,eu.x)(),p=null==n?void 0:n.is_error,h=null!=(t=null==a?void 0:a.path)?t:"",g=(0,em.W)(h),b=null==a?void 0:a.description,j=h.split("/").pop()||h,y=!p&&h&&(null==u?void 0:u.uuid)&&(0,em.m)(h,x);return(0,s.jsx)(v.aX,{isStreaming:!!i,handleClick:y?()=>{h&&(null==u?void 0:u.uuid)&&(f({type:"SELECT_FILE",path:h,toolType:"str_replace",messageId:u.uuid}),m(!0))}:void 0,icon:(0,s.jsx)(ev.I,{size:16}),text:(0,s.jsx)(en,{streamingAction:"Editing",errorAction:"Failed to edit",successAction:"Edited",target:g,isStreaming:i,isError:p,description:b}),secondaryIcon:(0,s.jsxs)(s.Fragment,{children:[!p&&(0,s.jsx)(ej,{oldStr:null==a?void 0:a.old_str,newStr:null==a?void 0:a.new_str,isStreaming:i}),y&&!x&&(0,s.jsx)("span",{className:"text-xs text-text-300 max-w-64 truncate shrink-0 min-w-0",children:j})]}),isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:d,isLastItemInGroup:c})};function ew(e){let{toolResult:t,fileSyntax:a}=e,{activeOrganization:n}=(0,G.YL)(),i=null==n?void 0:n.uuid;try{var l;if(t.content&&t.content.length>0&&(null==(l=t.content[0])?void 0:l.type)==="text"){let e=t.content[0].text;try{let a=JSON.parse(e);Array.isArray(a)&&(t.content=a)}catch(e){}}if(!t.content||0===t.content.length||!t.content[0])return(0,s.jsx)(s.Fragment,{});return(0,s.jsx)(s.Fragment,{children:t.content.map((e,t)=>"text"===e.type?(0,s.jsx)($.z,{language:a,code:e.text},t):"image"===e.type?(0,s.jsx)("img",{alt:"",src:"/api/".concat(i,"/files/").concat(e.file_uuid,"/preview"),className:"max-w-md max-h-md h-auto rounded-md"},t):null)})}catch(e){return(0,s.jsx)($.z,{title:"Error displaying content - Raw result:",code:JSON.stringify(t,null,2),codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})}}let e_=e=>{let{path:t}=e,a=t.split("/"),n=a.indexOf("skills"),i=a[n+1]||"";return(0,s.jsx)("span",{className:"flex items-center min-w-0 text-text-200 overflow-hidden",children:(0,s.jsx)("span",{className:"whitespace-nowrap text-text-200",children:(0,s.jsx)(c.A,{defaultMessage:"Loading {skill} skill",id:"b2eRiWSxS0",values:{skill:i}})})})},ek=e=>{var t;let{input:a,toolResult:n,isStreaming:i,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,groupItemKey:d,isFirstItemInGroup:u,isLastItemInGroup:x,message:f,shareType:m}=e,{isExpanded:p,setIsExpanded:h,snappyTransition:g}=(0,z.a)(!1,d),{dispatchChatResource:b}=(0,ex.i)(),{setIsDrawerExpanded:j}=(0,eu.x)(),y=null==n?void 0:n.is_error,w=null!=(t=null==a?void 0:a.path)?t:"",_=(0,ef.S)(w),k=/\.[^/]+$/.test(w),M=w.includes("/mnt/skills/"),C=(0,em.W)(w),N=null==a?void 0:a.description,S=w.split("/").pop()||w,A=!y&&w&&(null==f?void 0:f.uuid)&&(0,em.m)(w,m),E=A&&!m&&!M;return k?(0,s.jsx)(v.aX,{isStreaming:!!i,handleClick:A&&!M?()=>{w&&(null==f?void 0:f.uuid)&&(b({type:"SELECT_FILE",path:w,toolType:"view",messageId:f.uuid}),j(!0))}:void 0,isDisabled:M,icon:(0,s.jsx)(ef.o,{path:(null==a?void 0:a.path)||"",size:16}),text:M&&!N?(0,s.jsx)(e_,{path:w}):(0,s.jsx)(en,{streamingAction:"Viewing",errorAction:"Failed to view",successAction:"Viewed",target:C,isStreaming:i,isError:y,description:N}),secondaryIcon:E?(0,s.jsx)("span",{className:"text-xs text-text-300 max-w-64 truncate shrink-0 min-w-0",children:i?S:(0,s.jsx)(c.A,{defaultMessage:"Show working file",id:"qucjoSGi3N"})}):void 0,isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:u,isLastItemInGroup:x}):(0,s.jsx)(v.sH,{isExpanded:p,setIsExpanded:h,isStreaming:!!i,icon:(0,s.jsx)(ef.o,{path:(null==a?void 0:a.path)||"",size:16}),text:M&&!N?(0,s.jsx)(e_,{path:w}):(0,s.jsx)(en,{streamingAction:"Viewing",errorAction:"Failed to view",successAction:"Viewed",target:C,isStreaming:i,isError:y,description:N}),isFirstBlockOfMessage:l,isLastBlockOfMessage:r,renderMode:o,isFirstItemInGroup:u,isLastItemInGroup:x,isExpandingDisabled:!n,children:(0,s.jsx)(v.NG,{isExpanded:p,snappyTransition:g,isScrollable:!0,children:(0,s.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:n&&(0,s.jsx)(ew,{toolResult:n,fileSyntax:_,isStreaming:i})})})})},eM=l.memo(e=>{let{toolUseId:t,isLastMessage:a,isStreaming:l,toolName:d,input:c,message:x,onOpenArtifact:f,publishedArtifacts:m,toolResult:p,artifactCellType:h,isFirstBlockOfMessage:g,isLastBlockOfMessage:v,conversationUuid:b,selectedDrawerItem:y,shareType:w,displayData:_,approvalData:k,context:M,renderMode:C=W.l.Standard,groupItemKey:N,isFirstItemInGroup:S,isLastItemInGroup:A,autoscrollRef:E,isSessionChat:T}=e,z=(0,r.fb)(),R=(0,o.be)();(0,n.fS)("prism_enabled");let I={input:c,toolResult:p,isStreaming:l,isFirstBlockOfMessage:g,isLastBlockOfMessage:v,renderMode:C,groupItemKey:N,isFirstItemInGroup:S,isLastItemInGroup:A,message:x,shareType:w,autoscrollRef:E,isSessionChat:T},U={bash_tool:er,create_file:ep,present_files:eg,view:ek,str_replace:ey}[d];if(U)return(0,s.jsx)(U,{...I});if("end_conversation"===d)return(0,s.jsx)(u,{});let L=(null==y?void 0:y.type)==="artifact"?y:void 0,O=!!p&&!!y&&"compass"===y.type&&y.data.toolUseId===p.tool_use_id;switch(d){case"artifacts":return(0,s.jsx)(J,{input:c,toolResult:p,isLastMessage:a,isStreaming:l,onOpenArtifact:f,publishedArtifacts:m,message:x,artifactCellType:h,selectedArtifactId:null==L?void 0:L.id,selectedArtifactVersion:null==L?void 0:L.versionUuid,isFirstBlockOfMessage:g,isLastBlockOfMessage:v});case"repl":return(0,s.jsx)(et,{...I});case"drive_search":if(!z)break;return(0,s.jsx)(D,{syncSourceType:i.v8.GDRIVE,toolName:d,...I});case"web_search":if(!R)break;return(0,s.jsx)(D,{toolName:d,...I});case"web_fetch":return(0,s.jsx)(j,{...I});case"launch_extended_search_task":return(0,s.jsx)(B.wD,{toolUseId:t,isFirstBlockOfMessage:g,isLastBlockOfMessage:v,conversationUuid:b,toolResult:p,isShared:!!w,isExpanded:O,isStreaming:l,context:M})}return!d.includes(":")&&(null==_?void 0:_.integrationName)?(0,s.jsx)(K.K,{..._,toolName:d,isError:null==p?void 0:p.is_error,isStreaming:l,isFirstBlockOfMessage:g,isLastBlockOfMessage:v,renderMode:C,groupItemKey:N,isFirstItemInGroup:S,isLastItemInGroup:A}):(0,s.jsx)(X.d,{toolName:d,integrationName:null==_?void 0:_.integrationName,integrationIcon:null==_?void 0:_.integrationIcon,approvalData:k,...I})});eM.displayName="ToolUseCell"},0x5ae340a6:(e,t,a)=>{a.d(t,{wD:()=>L,z7:()=>U});var s=a(0x22102fd88),n=a(0x64121218),i=a.n(n),l=a(0x12c9046cd),r=a(0x14de19ae8),o=a(0x8f813b9c),d=a(0x146a6f00),c=a(0xac309a83),u=a(0x17f3a2521),x=a(0xa6a34c14),f=a(0x213bd1299),m=a(0x1a1f6dda6),p=a(0x1dc411c0f),h=a(0x160045b25),g=a(0xfc89b4a4),v=a(0x1ab0d1ca1),b=a(0x38e6572),j=a(0x156c4e43b),y=a(0x225bae024),w=a(0x183548b63),_=a(0x22fc8d729),k=a(0x174350552),M=a(0x1d1a079e9),C=a(0x17ced59d0),N=a(0x17b66474f),S=a(0x2174968e5),A=a(0x19f7d0900);function E(e){let{onCancel:t,onConfirm:a}=e,n=(0,g.useRef)(null),{menuOptions:i,getEnabledRemoteTools:l}=(0,S.$3)(),r=(0,A.Cn)({setMcpDirectoryModalIsOpen:T,setStyleModalOpenWithScreen:T,setCreateProjectModalIsOpen:T,setGithubModalIsOpen:T,setGmailAuthModalIsOpen:T,setCreatePromptArgumentModalIsOpen:T}),o=(0,N._9)({actions:r,inputMenuIsOpen:!0,setInputMenuIsOpen:()=>void 0,rootItems:i,menuType:"research"});return(0,g.useEffect)(()=>{setTimeout(()=>{n.current&&n.current.focus()})},[]),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(w.aF,{isOpen:!0,modalSize:"2lg",onClose:t,children:(0,s.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:(0,s.jsx)(b.A,{defaultMessage:"Enable connectors for Claude to use in research",id:"bnGGwdCceV"})}),(0,s.jsx)("div",{className:"border border-border-300 rounded-lg",children:(0,s.jsxs)("div",{className:"p-2",children:[o.path&&(0,s.jsx)(C.s,{path:o.path,inputMenuSearchQuery:o.inputMenuSearchQuery,setInputMenuSearchQuery:o.setInputMenuSearchQuery,handleBack:o.handleBack}),(0,s.jsx)("div",{className:"space-y-1",children:o.menuView.currentItems.filter(e=>{let{menuItemHidden:t}=e;return!t}).map(e=>(0,s.jsx)(M.$,{item:e,onClick:()=>o.handleClickItem(e),isHighlighted:o.highlightedItemKey===e.key},e.key))})]})}),(0,s.jsx)("div",{className:"bg-bg-300 border-border-400 border px-4 py-3 rounded-lg text-sm text-text-300",children:(0,s.jsx)(b.A,{defaultMessage:"Ensure you have appropriate permissions and trust third-party tools before continuing. <link>Learn more</link> about safely using research with connected apps.",id:"VU67M+9esK",values:{link:e=>(0,s.jsx)(_.Y,{href:"https://support.anthropic.com/",target:"_blank",rel:"noreferrer noopener",children:e})}})}),(0,s.jsxs)("div",{className:"flex flex-row justify-end gap-2",children:[(0,s.jsx)(y.$,{variant:"secondary",onClick:t,children:(0,s.jsx)(b.A,{defaultMessage:"Cancel Research",id:"GuxgLirKvY"})}),(0,s.jsxs)(y.$,{ref:n,onClick:function(){a({tools:l()})},children:[(0,s.jsx)(b.A,{defaultMessage:"Confirm",id:"N2IrpMDHDB"}),(0,s.jsx)("span",{className:"inline-block ml-2 p-1 bg-bg-000/20 rounded-sm",children:(0,s.jsx)(k.y,{size:12})})]})]})]})})})}function T(){}var z=a(0xec9172c1),R=a(0x16801a2b9),I=a(0x19a5dec78);let U=j.vk(e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},j.Ik({task_id:j.Yj()}));function L(e){let{toolUseId:t,isFirstBlockOfMessage:a=!1,isLastBlockOfMessage:n=!1,conversationUuid:i,toolResult:o,isShared:d,isExpanded:x=!1,isStreaming:f=!1,context:p}=e,h=(0,c.fS)("papi_mcp"),{activeOrganization:b}=(0,r.YL)(),{dispatchChatResource:j}=(0,R.i)(),{setIsDrawerExpanded:y}=(0,z.x)(),{decisionState:w,approveTool:_,denyTool:k}=function(e,t,a,s){let[n,i]=(0,g.useState)("pending"),r=!!(e&&t&&s),{isPending:o}=(0,l.Sk)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval_state/").concat(a),{enabled:r}),d=(0,l.L2)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval"),"POST",{enabled:!!(t&&!o),onSuccess(e,t){i(t.is_approved?"approved":"denied")}}).mutate;return{decisionState:n,isStatePending:o,approveTool:(0,g.useCallback)(e=>{let{tools:t}=e;d({tool_use_id:a,is_approved:!0,params:{tools:t}})},[d,a]),denyTool:(0,g.useCallback)(()=>{d({tool_use_id:a,is_approved:!1,params:{disapproval_reason:"user_canceled"}})},[d,a])}}(null==b?void 0:b.uuid,i,t,f),M=f?"approved"===w:o&&!(null==o?void 0:o.is_error),C=h&&(null==p?void 0:p.tools.length)&&f&&"pending"===w,N=(0,g.useMemo)(()=>{if(!(null==o?void 0:o.content))return;let e=o.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:t}=U.safeParse(e);return null==t?void 0:t.task_id},[null==o?void 0:o.content]),{compassStatus:S,isLoading:A,error:T}=(0,I.CH)({organizationUuid:null==b?void 0:b.uuid,conversationUuid:i,taskId:N,isShared:d,enabled:M});(0,I.IK)(i,null==S?void 0:S.status);let L=!S,O=(0,g.useCallback)(()=>{L||(y(!0),j({type:"OPEN_COMPASS_STATUS",data:{conversationUuid:i,organizationUuid:null==b?void 0:b.uuid,isShared:d,toolUseId:null==o?void 0:o.tool_use_id,taskId:N}}))},[L,j,i,null==b?void 0:b.uuid,y,d,o,N]),D=(null==S?void 0:S.status)||u.zu.Starting,B=!!T||!!(null==o?void 0:o.is_error),G=(0,v.A)(),{title:W,subtitle:V}=(0,g.useMemo)(()=>{let e,t;if(B){var a,s;return(null==o?void 0:o.is_error)&&((null==o?void 0:o.message)==="user_canceled"||(null==o||null==(a=o.content)?void 0:a.some(e=>(null==e?void 0:e.type)==="text"&&(null==e?void 0:e.text)==="Denied.")))?{title:G.formatMessage({defaultMessage:"Stopped",id:"1LBny5MvRa"}),subtitle:G.formatMessage({defaultMessage:"At your request",id:"2n0LtR1+bC"})}:(null==o?void 0:o.is_error)&&((null==o?void 0:o.message)==="approval_timeout"||(null==o||null==(s=o.content)?void 0:s.some(e=>(null==e?void 0:e.type)==="text"&&(null==e?void 0:e.text)==="No approval received.")))?{title:G.formatMessage({defaultMessage:"Stopped",id:"1LBny5MvRa"}),subtitle:G.formatMessage({defaultMessage:"No response on which connectors to enable during research",id:"HZp4wEGqGR"})}:{title:G.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})}}let n=(null==S?void 0:S.total_sources)||0,i=0===n?G.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):G.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}} and counting...",id:"wfqjY4cYXF"},{count:n}),l=G.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}}",id:"WrpI57Uej/"},{count:n}),r=(0,I.Ui)(S),d=r||G.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}),c=r||G.formatMessage({defaultMessage:"Research complete",id:"9Tbl1w5GjC"});switch(D){case u.zu.Starting:{let t=[G.formatMessage({defaultMessage:"Getting everything ready...",id:"5nJVpwt8gP"}),G.formatMessage({defaultMessage:"Preparing your research assistant...",id:"vxRKHhLIWM"}),G.formatMessage({defaultMessage:"Initializing research tools...",id:"Lm6wYLrJ1Q"}),G.formatMessage({defaultMessage:"Setting up my research space...",id:"EGN8CB7IRt"}),G.formatMessage({defaultMessage:"Configuring research parameters...",id:"eYoO3vRQgY"}),G.formatMessage({defaultMessage:"Loading research capabilities...",id:"GHM/w3WPnr"}),G.formatMessage({defaultMessage:"Preparing to dive in...",id:"EW22N+F8aq"}),G.formatMessage({defaultMessage:"Setting the stage for discovery...",id:"l8a+mVgI7N"}),G.formatMessage({defaultMessage:"Getting your assistant ready...",id:"GLpbkAPwDC"}),G.formatMessage({defaultMessage:"Activating research mode...",id:"SPBnT2clve"}),G.formatMessage({defaultMessage:"Warming up the engines...",id:"biUnCTBtnQ"})],a=Math.floor(Math.random()*t.length);e=t[a];break}case u.zu.Planning:e=d,t=G.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"});break;case u.zu.InitiatingAgents:e=d,t=G.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"});break;case u.zu.Searching:e=d,t=i;break;case u.zu.CreatingArtifact:e=d,t=G.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"});break;case u.zu.Completed:t=l,e=c;break;case u.zu.Cancelled:e=d,t=G.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"});break;case u.zu.TimedOut:case u.zu.Failed:e=G.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})}return{title:e,subtitle:t}},[G,D,S,B,null==o?void 0:o.is_error,null==o?void 0:o.message,null==o?void 0:o.content]);return C?(0,s.jsx)(E,{onCancel:k,onConfirm:e=>{let{tools:t}=e;_({tools:t})}}):(0,s.jsx)("div",{className:(0,m.A)("my-3",a?"mt-2":"mt-3",n?"mb-2":"mb-3"),children:A?(0,s.jsxs)("div",{className:"w-full p-4 text-text-000 font-ui rounded-xl border border-border-300 shadow-xs",children:[(0,s.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-3/4"}),(0,s.jsx)("div",{className:"flex text-text-300 text-xs items-center mt-2",children:(0,s.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-24"})})]}):(0,s.jsxs)("button",{className:(0,m.A)("transition-[border] duration-300 w-full p-4 !pt-0 text-text-000 font-ui rounded-xl border shadow-xs overflow-hidden",!L&&"cursor-pointer hover:shadow-sm hover:bg-bg-000/50 hover:border-border-200",x?"!border-accent-secondary-200":"border-border-300"),disabled:L,onClick:O,children:[(0,s.jsx)(F,{title:W,compassStatus:S,useShimmer:D===u.zu.Starting,isError:B||D===u.zu.Failed||D===u.zu.TimedOut,isExpanded:x}),(0,s.jsx)(P,{subtitle:V,compassStatus:S,isError:D===u.zu.Cancelled,useShimmer:!x&&!!S&&![u.zu.CreatingArtifact,u.zu.Completed,u.zu.Cancelled,u.zu.TimedOut,u.zu.Failed].includes(S.status)})]})})}function O(e){let{className:t,text:a,useShimmer:n}=e,[l,r]=(0,g.useState)(a),[d,c]=(0,g.useState)(!1),[u,x]=(0,g.useState)("");return(0,g.useEffect)(()=>{if(a!==l){x(l),r(a),c(!0);let e=setTimeout(()=>{c(!1)},300);return()=>clearTimeout(e)}},[a,l]),(0,s.jsxs)("div",{title:l,className:"jsx-34e91f3cef6c43c9 "+((0,m.A)("relative overflow-hidden",t)||""),children:[(0,s.jsx)(i(),{id:"34e91f3cef6c43c9",children:"@keyframes slideUpFadeOut{0%{transform:translatey(0);opacity:1}100%{transform:translatey(-100%);opacity:0}}@keyframes slideUpFadeIn{0%{transform:translatey(100%);opacity:0}100%{transform:translatey(0);opacity:1}}"}),d&&(0,s.jsx)("div",{style:{animation:"slideUpFadeOut 300ms forwards"},className:"jsx-34e91f3cef6c43c9 absolute w-full text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,s.jsx)(o.N,{children:u}):u}),(0,s.jsx)("div",{style:d?{animation:"slideUpFadeIn 300ms forwards"}:void 0,className:"jsx-34e91f3cef6c43c9 w-full relative text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,s.jsx)(o.N,{children:l}):l})]})}function F(e){let{title:t,isError:a,compassStatus:n,useShimmer:i,isExpanded:l}=e,[r,o]=(0,g.useState)(!1),c=(0,I.Nw)(n),u=(0,g.useRef)(c);(0,g.useEffect)(()=>{c&&!u.current&&(o(!0),setTimeout(()=>{o(!1)},3.5*c.length+.5),u.current=c)},[c]);let v=!l&&r;return(0,s.jsxs)("div",{className:"flex flex-row justify-between items-center h-9 gap-4 relative",children:[(0,s.jsxs)("div",{className:"h-9 min-w-0 w-full",children:[v&&!!c&&(0,s.jsx)(p.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:(0,s.jsx)(D,{thought:c})}),(0,s.jsx)(h.N,{initial:!1,children:!(v&&c)&&(0,s.jsxs)(p.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5,ease:d.A.inOutQuart},className:(0,m.A)("absolute w-[calc(100%-1.75rem)] top-0 left-0 flex items-center rounded-lg text-sm min-w-0 mt-4",a?"text-danger-000":""),children:[a&&(0,s.jsx)(x.N,{className:"text-danger-000 mr-1 flex-shrink-0",size:16}),(0,s.jsx)("div",{className:"flex-1 overflow-hidden text-left text-ellipsis break-words text-nowrap",children:(0,s.jsx)(O,{text:t,useShimmer:!!i&&!a})})]})})]}),!!n&&(0,s.jsx)(f.K,{size:12,className:"text-text-500 mt-4"})]})}function P(e){var t,a;let{subtitle:n,isError:i,compassStatus:l,useShimmer:r}=e,o=(0,g.useMemo)(()=>(null==l?void 0:l.agents)&&!(l.agents.length<1)?(0,I.mk)({agents:l.agents,n:3}):[],[null==l?void 0:l.agents]);return n?(0,s.jsxs)("div",{className:"flex text-text-300 text-xs items-center mt-2 tabular-nums h-5",children:[!!o.length&&(0,s.jsx)("div",{className:"flex-shrink-0 mr-1",children:(0,s.jsx)(I.mq,{hrefs:o})}),(null==l?void 0:l.status)===u.zu.Completed&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.A,{defaultMessage:"Research complete",id:"9Tbl1w5GjC"}),(0,s.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:""})]}),(0,s.jsx)(O,{text:n,useShimmer:r,className:i?"text-danger-000":""}),!!(null==l?void 0:l.started_at)&&l.status!==u.zu.Cancelled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:""}),(0,s.jsx)("div",{className:"text-text-500",children:(0,s.jsx)(I.YE,{startedAt:null!=(t=null==l?void 0:l.started_at)?t:null,completedAt:null!=(a=null==l?void 0:l.finished_at)?a:null})})]})]}):null}function D(e){let{thought:t}=e;return(0,s.jsx)("div",{className:"h-9 w-full",children:(0,s.jsx)("div",{className:"blur-[2px] h-11 px-1 -mx-1 -mb-2 w-full relative overflow-y-hidden overflow-x-visible [mask-image:linear-gradient(to_top,_hsl(var(--always-black)/0%)_0%,hsl(var(--always-black)/100%)_75%,_hsl(var(--always-black)/0%)_100%)]",children:(0,s.jsx)(p.P.div,{className:"absolute top-0 left-1 right-0 text-left",initial:{y:40},animate:{y:"calc(-100%)"},transition:{delay:.5,duration:3.5*t.length/1e3,ease:d.A.inOutBase},children:(0,s.jsx)(I.GT,{thought:t})})})})}},0x5ba03586:(e,t,a)=>{a.d(t,{d:()=>y});var s=a(0x22102fd88),n=a(0x14de19ae8),i=a(0x1888e36ef),l=a(0xfc89b4a4),r=a(0x1ab0d1ca1),o=a(0x38e6572),d=a(0xf8bd7957),c=a(0xe824fb1c),u=a(0xac309a83),x=a(0x156c4e43b),f=a(0xde8f44d0),m=a(0x1e140f433),p=a(0x225bae024),h=a(0x37e18afd);function g(e){let{disabled:t,submitToolApproval:a,showAlwaysAllowed:n,setIsExpanded:i}=e,l=e=>{a(e),i(!1)};return(0,h.W)("keydown",e=>{if("Escape"===e.key){e.preventDefault(),l("deny");return}if("Enter"===e.key){let t=e.metaKey||e.ctrlKey;t&&n?(e.preventDefault(),l("always")):t||(e.preventDefault(),l("once"))}}),(0,s.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-0",children:(0,s.jsxs)("div",{className:"self-end flex gap-2",children:[(0,s.jsx)(p.$,{variant:"secondary",onClick:()=>l("deny"),shortcut:"escape",children:(0,s.jsx)(o.A,{defaultMessage:"Deny",id:"htvX+Z11l+"})}),n&&(0,s.jsx)(p.$,{variant:"secondary",disabled:t,onClick:()=>l("always"),shortcut:"cmd+enter",children:(0,s.jsx)(o.A,{defaultMessage:"Always allow",id:"lr3QX/nctD"})}),(0,s.jsx)(p.$,{variant:"primary",disabled:t,onClick:()=>l("once"),shortcut:"enter",children:(0,s.jsx)(o.A,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]})})}var v=a(0x1f7748bd);let b=x.g1(x.Yj()),j=e=>{let{input:t,toolResult:a}=e,i=(0,r.A)(),{activeOrganization:l}=(0,n.YL)(),o=null==l?void 0:l.uuid,d="";if(void 0!==t){try{d=JSON.stringify(t,null,2)}catch(e){d=String(t)}d=(d=d.replace(/\\n/g,"\n").replace(/\\t/g,"	")).replace(RegExp('(?<!\\\\)"',"g"),"`")}return(0,s.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:[(0,s.jsx)(f.z,{title:i.formatMessage({defaultMessage:"Request",id:"p1P+hQq6tY"}),language:"javascript",code:d}),null==a?void 0:a.content.map((e,t)=>"text"===e.type?(0,s.jsx)(f.z,{title:i.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),language:"json",code:e.text},t):"image"===e.type?(0,s.jsx)("img",{src:"/api/".concat(o,"/files/").concat(e.file_uuid,"/preview"),alt:i.formatMessage({defaultMessage:"Tool result",id:"OJmR+3dTK6"}),className:"max-w-md max-h-md h-auto rounded-md"},t):void 0)]})},y=e=>{var t,a;let{toolName:n,integrationName:r,integrationIcon:x,approvalData:f,isSessionChat:p,...h}=e,{input:y,toolResult:w,groupItemKey:_,autoscrollRef:k,shareType:M}=h,C=(0,i.q)(),N=(0,l.useRef)(!1),S=!!(null==f?void 0:f.approvalRequired),{isExpanded:A,setIsExpanded:E,snappyTransition:T}=(0,v.a)(!1,_,S),z=S||!!M,R=(0,u.iW)("claudeai_yukon_gold_tool_names",{},b)[n],I=(0,c.pK)(n),U=R||(null==I||null==(t=I.tool)?void 0:t.displayName)||n.split("__")[2]||n.split(":").pop()||n;(0,c.Q1)();let L=S?r?(0,s.jsx)(o.A,{defaultMessage:"Claude wants to use {toolName} from {integrationName}",id:"wPBSjwhfE4",values:{toolName:U,integrationName:r}}):(0,s.jsx)(o.A,{defaultMessage:"Claude wants to use {toolName}",id:"ZNLjFNb5bD",values:{toolName:U}}):U,O=null==w||null==(a=w.content)?void 0:a[0];return(0,s.jsx)(m.sH,{isExpanded:C&&A,setIsExpanded:E,isExpandingDisabled:z,text:L,isError:null==w?void 0:w.is_error,errorMessage:(null==O?void 0:O.type)==="text"?O.text:void 0,icon:(0,s.jsx)(d.z,{size:16,type:I?I.server.iconType:"favicon",src:I?I.server.iconSrc:x,name:r||U}),...h,children:(0,s.jsx)(m.NG,{isExpanded:C&&A,snappyTransition:T,onAnimationComplete:()=>{if(S&&!N.current){var e;null==k||null==(e=k.current)||e.scrollToBottom("smooth",{onlyIfPinned:!0}),N.current=!0}},isScrollable:!0,footer:S?(0,s.jsx)(g,{...f,setIsExpanded:E}):null,children:(0,s.jsx)(j,{input:y,toolResult:w})})})}},0x695f5df2:(e,t,a)=>{a.d(t,{t:()=>o});var s=a(0x22102fd88),n=a(0xb91ccc43),i=a(0x1b370f49d),l=a(0x1a1f6dda6),r=a(0xfc89b4a4);let o=(0,r.memo)(e=>{let{fileTree:t,selectedPath:a,expandedFolders:o,onFileSelect:d,onToggleFolder:c,className:u}=e,x=(0,r.useCallback)((e,t)=>{if(!e.name){var l;return(0,s.jsx)(s.Fragment,{children:null==(l=e.children)?void 0:l.map(e=>(0,s.jsx)("div",{children:x(e,t)},e.path))})}let r="directory"===e.type,u=o.has(e.path),f=a===e.path,m=16*t+8;if(r)return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:()=>c(e.path),className:"group/folder w-full px-2 py-2 rounded-lg flex justify-between items-center hover:bg-bg-200 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,s.jsx)("div",{className:"w-4 h-4 flex-shrink-0 text-text-500",children:(0,s.jsx)(n.vdG,{size:16})}),(0,s.jsx)(i.Tooltip,{tooltipContent:e.name,side:"top",sideOffset:4,children:(0,s.jsx)("div",{className:"text-left text-text-500 text-sm font-normal truncate",children:e.name})})]}),(0,s.jsx)("div",{className:"w-4 h-4 flex-shrink-0 text-text-300 transition-opacity ml-1.5 ".concat(u?"opacity-100":"opacity-0 group-hover/folder:opacity-100"),children:u?(0,s.jsx)(n.aYp,{size:16}):(0,s.jsx)(n.K3R,{size:16})})]}),u&&e.children&&(0,s.jsx)("div",{children:e.children.map(e=>(0,s.jsx)("div",{children:x(e,t+1)},e.path))})]});let p=0===t?"px-2":"";return(0,s.jsx)(i.Tooltip,{tooltipContent:e.name,side:"top",sideOffset:4,children:(0,s.jsx)("button",{onClick:()=>d(e.path,e),className:"w-full py-2 rounded-lg inline-flex justify-start items-center gap-2 transition-colors ".concat(p," ").concat(f?"bg-bg-300 text-text-100 font-semibold":"hover:bg-bg-200 text-text-500 font-normal"),style:t>0?{paddingLeft:"".concat(m,"px")}:void 0,children:(0,s.jsx)("div",{className:"flex-1 min-w-0 text-left text-sm truncate",children:e.name})})})},[o,a,d,c]);return(0,s.jsx)("div",{className:(0,l.A)("w-60 flex-shrink-0 overflow-y-auto",u),children:(0,s.jsx)("div",{className:"flex flex-col",children:x(t,0)})})});o.displayName="FileTreeSidebar"},0x6f2a2354:(e,t,a)=>{a.d(t,{CV:()=>en,ke:()=>eo});var s=a(0x52e2618c),n=a(0x22102fd88),i=a(0x17aa9d8d7),l=a(0x1dd44336e),r=a(0x202fabf16),o=a(0x20805e624),d=a(0xf32c56dd),c=a(0x14de19ae8),u=a(0x139b5e710),x=a(0x6fe0a7f6),f=a(0x14fe1b2a5),m=a(0x252daebb2),p=a(0xb91ccc43),h=a(0x225bae024),g=a(0x1b03847fb),v=a(0x14023fbb8),b=a(0x183548b63),j=a(0x1b370f49d),y=a(0x1e1f2a153),w=a(0x24fcf6beb),_=a(0x23977865),k=a(0x9845e38c),M=a(0x1bd175d8c),C=a(0x3dfb3b63),N=a(0x1a1f6dda6),S=a(0x160045b25),A=a(0x1dc411c0f),E=a(0x733b8fe2),T=a.n(E),z=a(0xef41e510),R=a.n(z),I=a(0xfc89b4a4),U=a(0x38e6572),L=a(0x1ab0d1ca1),O=a(0xf071fd84),F=a(0x1dbad8fd1),P=a(0xbebfc702),D=a(0x16801a2b9),B=a(0xd4b9b976),G=a(0x22fc8d729),W=a(0xbe814870),V=a(0x1828a127f),q=a(0x1c9acc695);function Y(){let e=(0,s._)(["\n  border\n  border-border-400\n  bg-bg-100\n  w-96\n  rounded-xl\n  font-medium\n  text-text-300\n  text-sm\n"]);return Y=function(){return e},e}function H(e){let t,{onClose:a,onSubmitRating:s,onSubmitNotes:i}=e,l=(0,L.A)(),[r,o]=(0,I.useState)(!1),[d,c]=(0,I.useState)(""),u=e=>{s(e),o(!0)},f=()=>{a()};return t=r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,n.jsx)("div",{className:"ml-1",children:(0,n.jsx)(U.A,{defaultMessage:"What were you trying to accomplish when this artifact was created?",id:"CrrumB/FnI"})}),(0,n.jsx)("div",{className:"pt-1",children:(0,n.jsx)("button",{onClick:f,children:(0,n.jsx)(W.X,{size:20})})})]}),(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault(),i(d),f()},children:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("div",{className:"grow",children:(0,n.jsx)(x.ks,{className:"w-full",placeholder:l.formatMessage({defaultMessage:"e.g. make a graph",id:"g1RrFC72N+"}),value:d,onChange:e=>c(e.target.value)})}),(0,n.jsx)("div",{children:(0,n.jsx)(h.$,{variant:"primary",type:"submit",children:(0,n.jsx)(U.A,{defaultMessage:"Send",id:"9WRlF4R2gm"})})})]})})]}):(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(U.A,{defaultMessage:"Is this artifact useful?",id:"RxVIwIW9vn"})}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!0),"aria-label":l.formatMessage({defaultMessage:"Thumbs up",id:"0HnZ1ci6be"}),children:(0,n.jsx)(V.t,{size:20})}),(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!1),"aria-label":l.formatMessage({defaultMessage:"Thumbs down",id:"go4L4rFJNq"}),children:(0,n.jsx)(q.S,{size:20})}),(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:f,"aria-label":l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:(0,n.jsx)(W.X,{size:20})})]})]}),(0,n.jsxs)(J,{children:[(0,n.jsx)("div",{className:"p-3",children:t}),(0,n.jsx)("div",{className:"p-3 border-t border-border-400 w-full font-normal text-xs text-text-500",children:(0,n.jsx)(G.Y,{href:"https://support.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback",target:"_blank",children:(0,n.jsx)(U.A,{defaultMessage:"Learn more about how Anthropic uses feedback",id:"NBSES31K7c"})})})]})}let J=f.J.div(Y());var K=a(0x2f6cd846),X=a(0x1fb5bdc42),Z=a(0x17e7bc007);let Q=e=>{let{currentArtifact:t,hasMenuOpen:a,setHasMenuOpen:s}=e,i=(0,I.useCallback)(()=>{s(!1)},[s]),l=(0,Z.dd)(),{dispatchChatResource:r}=(0,D.i)(),o=Object.values(l).reverse().sort((e,t)=>{let a=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(a.created_at).getTime()}),d=(0,I.useRef)(t),c=(0,I.useRef)(!1),u=(0,I.useCallback)(e=>{queueMicrotask(()=>{r({type:"SELECT_ARTIFACT",id:e.id,versionUuid:e.versions[e.versions.length-1].uuid})})},[r]);(0,I.useEffect)(()=>{let e=d.current;return()=>{e&&!c.current&&(null==t?void 0:t.id)!==e.id&&u(e),c.current=!1}},[]);let x=(0,K.w)(),f=(0,L.A)();return o.length<2?null:(0,n.jsxs)(X.bL,{open:a,onOpenChange:e=>s(e),children:[(0,n.jsx)(X.l9,{asChild:!0,children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",className:"-mx-1",children:(0,n.jsx)(j.Tooltip,{side:"right",className:"ml-2",tooltipContent:a?"":f.formatMessage({defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),delayDuration:800,children:(0,n.jsx)(p.zDc,{size:20})})})}),(0,n.jsx)(X.UC,{align:"start",asChild:!0,children:(0,n.jsx)("ul",{className:"\n            relative\n            z-dropdown\n            overflow-y-auto\n            max-h-[min(var(--radix-dropdown-menu-content-available-height),var(--dropdown-max-height))]\n            flex flex-col gap-1\n            py-2 pr-3\n          ",onMouseLeave:()=>d.current&&u(d.current),children:o.map((e,t)=>{var a;let s=e.type?x[e.type]:null,l=(null==(a=d.current)?void 0:a.id)===e.id,r=f.formatMessage({defaultMessage:"versions",id:"bhuRmwJBaN"}),m=e.versions.length>1?"".concat(e.versions.length):"",p=e.versions.length>1&&s?" \xb7 ":"";return(0,n.jsx)(A.P.li,{initial:{y:-12,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0,transition:{ease:"easeOut",duration:.1,delay:0}},transition:{delay:.035*t,type:"spring",stiffness:285,damping:25,mass:1},role:"none",children:(0,n.jsxs)(X.q7,{className:(0,N.A)("bg-bg-000 border-0.5 cursor-pointer can-focus","flex flex-col py-2 pl-3 pr-4 w-full max-w-72 mb-px rounded-lg overflow-hidden","text-sm text-left transition duration-300 drop-shadow-[0_2px_8px_hsl(var(--always-black)/8%)] dark:drop-shadow-[0_2px_8px_hsl(var(--always-black)/16%)]",l?"border-accent-secondary-100 shadow-[0_0_0_1px_hsl(var(--accent-secondary-100))]":"text-text-300 hover:text-text-100 border-border-200 hover:border-accent-secondary-100 focus-within:border-accent-secondary-100 focus-within:text-text-100"),onClick:()=>(e=>{c.current=!0,i();let t=o[e];d.current=t,u(t)})(t),onMouseEnter:()=>{u(e)},"aria-label":"".concat(e.title).concat(s?", ".concat(s):"").concat(m?", ".concat(m," ").concat(r):""),children:[(0,n.jsx)("div",{className:"line-clamp-2",children:e.title}),(0,n.jsxs)("span",{className:"text-text-300",children:[e.versions.length>1?(0,n.jsxs)(n.Fragment,{children:[m," ",r]}):null,p?(0,n.jsx)(n.Fragment,{children:p}):null,s]})]},e.id)},e.id)})})})]})};var $=a(0x1bf083d8d),ee=a(0x16f861148),et=a(0x3cebcb0f);function ea(){let e=(0,s._)(["\n  flex\n  flex-none\n  items-center\n  justify-between\n  text-sm\n  text-text-500\n  py-2\n  px-2\n  border-t\n  border-border-400\n"]);return ea=function(){return e},e}function es(){let e=(0,s._)(["\n  border-border-400\n  sticky\n  flex\n  items-center\n  gap-1\n  border-b\n  px-2\n  py-2\n"]);return es=function(){return e},e}let en=e=>{var t,a,s,u,x,f,m,p,h,g;let{onClose:v,artifact:b,isStreaming:j,selectedArtifactMessageUuid:y,selectedArtifactVersionUuid:_,setSelectedArtifactVersionUuid:M,projectUuid:E,selectDoc:T,disablePublishing:z,sendMessage:R,richSandboxCapabilities:U,isOpen:L,isTemporary:F=!1}=e,{account:B}=(0,c.YL)(),G=(0,d.st)(),[W,V]=(0,I.useState)("normal"),q=(0,I.useRef)(null),[Y,J]=(0,I.useState)(!1),K=(0,c.mV)(),[X,Z]=(0,I.useState)(!0),{data:Q}=(0,P.fo)(E),{data:et}=(0,O.mt)({entityId:_,artifactEntityType:"artifact_version"}),ea=(0,I.useMemo)(()=>(null==et?void 0:et.mcp_servers)||[],[et]),es=!z&&!K,[en,{open:el,close:eo}]=(0,C.j)(!1),ec=(0,I.useCallback)(()=>{Z(!1)},[]),{data:eu}=(0,l.rC)({includeDeletedArtifacts:!0}),ex=null==b?void 0:b.versions[b.versions.length-1],ef=j&&!(null==ex?void 0:ex.isClosed),em=(0,I.useMemo)(()=>{if(!b)return 0;if(!ef&&_&&!(null==y?void 0:y.startsWith(o.B6))){let e=b.versions.findIndex(e=>e.uuid===_);if(-1!==e)return e}return ef||!y||y.startsWith(o.B6)?b.versions.length-1:b.versions.findIndex(e=>e.message===y)},[y,_,ef,b]),ep=null==b||null==(t=b.versions[em])?void 0:t.uuid;(0,I.useEffect)(()=>{ep&&ep!==_&&M(ep),V("normal")},[null==b?void 0:b.id,ep,M,_]);let eh=K&&!F,[eg,{open:ev,close:eb}]=(0,C.j)(!1),ej=b&&(null==eu||null==(a=eu.find(e=>{let{artifact_identifier:t,message_uuid:a}=e;return t===b.id&&a===b.versions[em].message}))?void 0:a.published_artifact_uuid),ey=null!=(m=null==eu?void 0:eu.some(e=>{let{published_artifact_uuid:t,deleted:a}=e;return t===ej&&a}))&&m,ew=null==b||null==(s=b.versions[em])?void 0:s.message,[e_,ek]=(0,I.useState)(!1);(0,I.useEffect)(()=>ek(e_||j),[e_,j]);let[eM,eC]=(0,I.useState)(!1);(0,I.useEffect)(()=>eC(!1),[y,ew]);let[eN,eS]=(0,I.useState)(!1),{data:eA}=(0,l.SN)(),{mutate:eE}=(0,i.yJ)(),{track:eT}=(0,d.st)(),ez=null!=(p=(0,D.i)().chatResourceState.conversationUuid)?p:"",{data:eR}=(0,O.Ns)({entityId:_,artifactEntityType:"artifact_version",conversationUuid:ez},{enabled:!j}),[eI,{open:eU,close:eL}]=(0,C.j)(!1),{mutateAsync:eO}=(0,l.cH)(ez),eF=(0,I.useCallback)(async()=>{if(!_)try{var e;let{artifactVersionUUID:t}=await eO({version_index:em,artifact_identifier:null!=(e=null==b?void 0:b.id)?e:""});M(t)}catch(e){k.v.error(k.u.ARTIFACTS,"Error getting artifact UUID",e);return}eT({event_key:"artifact.share_button_clicked",message_uuid:ew,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),ev()},[_,ev,eO,em,null==b?void 0:b.id,M,eT,ew,null==b?void 0:b.type,null==b?void 0:b.language]),eP=(0,I.useCallback)(()=>{eT({event_key:"artifact.publish_button_clicked",message_uuid:ew,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),el()},[el,eT,ew,null==b?void 0:b.type,null==b?void 0:b.language]),eD=(null==b?void 0:b.type)===w.vU.Text,eB=(null==b?void 0:b.type)===w.vU.Markdown||(null==b?void 0:b.type)===w.vU.Code,eG=(null==b?void 0:b.type)===w.vU.Html||(null==b?void 0:b.type)===w.vU.React,eW=(null==b?void 0:b.type)!==w.vU.Text&&!(ef&&((null==b?void 0:b.type)===w.vU.Svg||(null==b?void 0:b.type)===w.vU.Mermaid||(null==b?void 0:b.type)===w.vU.React||(null==b?void 0:b.type)===w.vU.Html)),eV=!eW||"raw"===W,eq=eM||e_&&!j&&!eN&&!(null==B?void 0:B.settings.dismissed_artifact_feedback_form)&&eA,eY=null!=(h=null==b?void 0:b.versions.length)?h:0,[eH,eJ]=(0,I.useState)(!1),eK=E&&b?{show:!ef&&!(null==Q?void 0:Q.is_starter_project),artifact:b,projectUuid:E,selectedVersion:em,selectDoc:T}:void 0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,N.A)(b?"bg-bg-000 flex h-full flex-col relative":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none"),onClick:()=>eH&&eJ(!1),children:[(0,n.jsx)(ei,{versionCount:eY,selectedVersion:em,artifact:b,canRenderNormal:eW,canOnlyRenderRaw:eD,canOnlyRenderNormal:eB,viewing:W,setViewing:V,showRaw:eV,canRefresh:eG,isSandboxLoading:X,handleRefresh:()=>{Z(!0),q.current&&q.current.refresh()},canShare:eh,handleOpenShareModal:eF,isStreaming:j,onClose:v,hasMenuOpen:eH,setHasMenuOpen:eJ,canPublish:es,wasUnpublished:ey,publishedArtifactUuid:ej,openPublishModal:eP,projectParams:eK,richSandboxRef:q,hasArtifactToolConfig:!!(null==et||null==(u=et.mcp_servers)?void 0:u.length),setShowArtifactMcpModal:J,storageInfo:eR,openResetStorageModal:eU,handleVersionSelect:e=>{let t=null==b?void 0:b.versions[e].uuid;t&&M(t)}}),(0,n.jsx)(r.k,{isOpen:L,content:null!=(g=null==b||null==(x=b.versions[em])?void 0:x.resultState)?g:"",type:null==b?void 0:b.type,citations:null==b||null==(f=b.versions[em])?void 0:f.citations,language:void 0===b?void 0:b.language||w.K5[b.type].syntaxName,showRaw:eV,richSandboxRef:q,isCurrentStreaming:ef,isChatStreaming:j,onSandboxConfirmation:ec,sendMessage:R,richSandboxCapabilities:U,isLatestVersion:!!b&&em===b.versions.length-1,artifactId:null==b?void 0:b.id,artifactContext:_?{uuid:_,type:"artifact_version",id:null==b?void 0:b.id}:void 0,artifactVersion:em,onArtifactRuntimeError:e=>{G.track({event_key:"claudeai.artifacts.execution.error",artifact_version_uuid:null==_?void 0:_.toString(),error_type:e.type,source:null==b?void 0:b.versions[em].source})},artifact:b,hasMenuOpen:eH,ArtifactMcpModal:$.I}),(0,n.jsx)(S.N,{children:eq&&(0,n.jsx)(A.P.div,{initial:{opacity:0,y:20,x:"-50%"},animate:{opacity:1,y:0,x:"-50%"},transition:{duration:.3,delay:.8,ease:"easeOut"},exit:{opacity:0,y:20,x:"-50%",transition:{duration:.3,ease:"easeOut"}},className:"absolute bottom-20 left-1/2",children:(0,n.jsx)("div",{children:(0,n.jsx)(H,{onSubmitNotes:e=>{eT({event_key:"artifact.feedback.note",note:e,message_uuid:ew,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),eC(!1)},onSubmitRating:e=>{eT({event_key:"artifact.feedback.sentiment",type:e?"thumbs_up":"thumbs_down",message_uuid:ew,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),eE({dismissed_artifact_feedback_form:!0}),eC(!0)},onClose:()=>{eS(!0),eE({dismissed_artifact_feedback_form:!0}),eC(!1)}})})})})]}),(null==b?void 0:b.versions[em])&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ee.Dr,{messageUuid:b.versions[em].message,isOpen:en&&!ey,onClose:eo,artifact:b,selectedVersion:em,publishedArtifactUuid:ej,richSandboxRef:q}),eh&&_&&(0,n.jsx)(er,{isOpen:eg,onClose:eb,artifactVersionUuid:_,artifact:b,messageUuid:b.versions[em].message,isProjectArtifact:!!(null==Q?void 0:Q.is_private)})]}),Y&&_&&(0,n.jsx)($.I,{isOpen:Y,requestedServers:ea,onClose:()=>J(!1),artifactContext:{uuid:_,type:"artifact_version",id:null==b?void 0:b.id}}),_&&(0,n.jsx)(ed,{isOpen:eI,onClose:eL,artifactVersionUuid:_,conversationUuid:ez})]})};function ei(e){var t;let{versionCount:a,selectedVersion:s,artifact:i,canRenderNormal:l,canOnlyRenderRaw:r,canOnlyRenderNormal:o,viewing:d,setViewing:c,showRaw:f,canRefresh:b,isSandboxLoading:k,handleRefresh:C,canShare:S,handleOpenShareModal:A,isStreaming:E,canPublish:z,wasUnpublished:R,publishedArtifactUuid:O,projectParams:P,onClose:D,openPublishModal:G,handleVersionSelect:W,hasMenuOpen:V,setHasMenuOpen:q,richSandboxRef:Y,hasArtifactToolConfig:H,setShowArtifactMcpModal:J,storageInfo:K,openResetStorageModal:X}=e,Z=(0,L.A)(),$=(0,M.V)(_.E_),{copyToClipboard:ee,didCopy:ea}=(0,y.C)(),{copyToProject:es,isCopiedToProject:en}=function(e){let{projectUuid:t,artifact:a,selectedVersion:s}=e,[i,l]=(0,I.useState)(!1),{mutateAsync:r,data:o}=(0,F.fh)(null!=t?t:""),{addError:d}=(0,u.Y)();return(0,I.useEffect)(()=>{if(null==o?void 0:o.uuid){l(!0);let e=setTimeout(()=>{l(!1)},12e3);return()=>clearTimeout(e)}},[o]),{copyToProject:async()=>{if(a)try{var e;await r({file_name:"".concat(a.title,".").concat(w.K5[a.type].extension()),content:null!=(e=a.versions[s].resultState)?e:""})}catch(e){d((0,n.jsx)(U.A,{defaultMessage:"Error adding artifact to project: {error}",id:"sSg3OiDDja",values:{error:e}}),{error:e})}},isCopiedToProject:i}}({artifact:i,projectUuid:null!=(t=null==P?void 0:P.projectUuid)?t:"",selectedVersion:s});async function ei(){var e,t;if(!i)return;let a=i.type===w.vU.Markdown,n=i.type===w.vU.React,l=null!=(e=i.versions[s].resultState)?e:"";if(n&&Y.current){let e=await (null==(t=Y.current)?void 0:t.copyHtmlContent());e?await ee({text:e,html:e}):await ee(l)}else if(a)try{let e=(0,B.u)(l);await ee({text:l,html:e})}catch(e){await ee(l)}else await ee(l)}let{ref:er,width:eo}=function(){let e=(0,I.useRef)(null),[t,a]=(0,I.useState)(()=>{var t,a;return null!=(a=null==(t=e.current)?void 0:t.offsetWidth)?a:null});return(0,I.useEffect)(()=>{let t=T()(()=>{e.current&&a(e.current.offsetWidth)},20,{leading:!0,trailing:!0}),s=new ResizeObserver(t);if(e.current){let a=e.current;return t(),s.observe(a),()=>s.disconnect()}},[]),{ref:e,width:t}}(),ed=eo&&eo<480,ec=!f&&b,{addError:eu}=(0,u.Y)(),ex=(null==i?void 0:i.type)===w.vU.Markdown&&"raw"!==d?(0,n.jsx)(g.tJ,{onSelect:async()=>{try{await (0,et.M9)(i)}catch(e){eu((0,n.jsx)(U.A,{defaultMessage:"Error downloading PDF",id:"fes7nfwp3b"}),{error:e})}},children:(0,n.jsx)(U.A,{defaultMessage:"Download as PDF",id:"camH0DLf91"})},"saveAsPdf"):null,ef=i?(0,n.jsx)(g.tJ,{asChild:!0,"data-testid":"export-download",children:(0,n.jsx)(el,{artifact:i,selectedVersion:s})},"download"):null;return(0,n.jsxs)("div",{ref:er,className:(0,N.A)("pr-2 pl-3 flex items-center justify-between gap-2 select-none",$?[_.X_,_.zo,"draggable"]:"py-2"),children:[i&&(0,n.jsx)(Q,{currentArtifact:i,hasMenuOpen:V,setHasMenuOpen:q}),V?(0,n.jsxs)("div",{className:"flex justify-between items-center flex-1 text-sm text-text-300 pl-1",children:[(0,n.jsx)(U.A,{defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),!f&&ec&&k?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(v.Loading,{size:"sm"})}):null]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,N.A)("flex items-center flex-1 gap-2"),children:[!(!l||r||o)&&(0,n.jsx)(x.Iz,{options:[{key:"normal",label:(0,n.jsx)(p.kU3,{size:16}),ariaLabel:Z.formatMessage({defaultMessage:"Preview",id:"TJo5E6JuIN"})},{key:"code",label:(0,n.jsx)(p.CyN,{size:16}),ariaLabel:Z.formatMessage({defaultMessage:"Code",id:"h2vipunVVd"})}],initialKey:"normal"===d?"normal":"code",onSelect:e=>{c("normal"===e?"normal":"raw")},itemClassName:"!px-1"},"normal"===d?"normal":"code"),a>1?(0,n.jsx)(g.ms,{align:"start",trigger:(0,n.jsxs)(h.$,{variant:"ghost",size:"sm",className:"group !text-text-000 gap-1 justify-between !pl-1.5 !pr-1 !text-sm","data-testid":"artifact-version-trigger",children:["v",s+1,ed||s!==a-1?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:""}),(0,n.jsx)(U.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}),(0,n.jsx)(p.biH,{size:16,className:"opacity-0 group-hover:opacity-100 group-[&[data-state=open]]:opacity-100"})]}),children:Array.from({length:a}).map((e,t)=>a-t).map(e=>(0,n.jsxs)(g.tJ,{"data-testid":"version-dropdown",className:"flex justify-between",onSelect:()=>W(e-1),children:[(0,n.jsx)(U.A,{defaultMessage:"Version {versionNum}",id:"iMMX+ZCJ/I",values:{versionNum:e}}),e===a?(0,n.jsxs)(n.Fragment,{children:[" - ",(0,n.jsx)(U.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}):null,e-1===s?(0,n.jsx)(p.Jlk,{className:"text-accent-secondary-100",size:16}):null]},e))}):null]}),(0,n.jsxs)("div",{className:(0,N.A)("flex gap-2 items-center text-sm"),children:[ed?(0,n.jsxs)(g.ms,{align:"end",trigger:(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm","data-testid":"artifact-menu-trigger","aria-label":Z.formatMessage({defaultMessage:"More options for artifact",id:"O91Ji7GVP2"}),children:(0,n.jsx)(p.txq,{size:16})}),children:[ec&&(0,n.jsx)(g.tJ,{disabled:k,onSelect:C,children:(0,n.jsx)(U.A,{defaultMessage:"Refresh",id:"rELDbByu8U"})},"refresh"),K&&K.total_size_bytes>0&&!f&&(0,n.jsx)(g.tJ,{onSelect:X,children:(0,n.jsx)(m.YX,{id:"silver_apple_jungle"})},"reset-storage"),H&&!f&&(0,n.jsx)(g.tJ,{onSelect:()=>J(!0),children:(0,n.jsx)(U.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"})},"manage-connectors"),(0,n.jsx)(g.tJ,{onSelect:ei,children:(0,n.jsx)(U.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},"copy"),S?(0,n.jsx)(g.tJ,{onSelect:A,children:(0,n.jsx)(U.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})},"share"):null,R?(0,n.jsx)(g.tJ,{disabled:!0,onSelect:G,children:(0,n.jsx)(U.A,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"})},"unpublished"):z?(0,n.jsx)(g.tJ,{onSelect:G,children:(0,n.jsx)(U.A,{defaultMessage:"Publish",id:"syEQFEKfku"})},"publish"):null,ef,ex]}):(()=>{let e=!f&&ec&&(k?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(v.Loading,{size:"sm"})}):(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:C,children:(0,n.jsx)(p.MvQ,{size:16})})),t=S&&(0,n.jsx)(h.$,{onClick:A,variant:"primary",size:"sm",disabled:E,prepend:(0,n.jsx)(p.SYj,{size:16,className:"mr-0.5"}),children:(0,n.jsx)("span",{className:"text-sm",children:(0,n.jsx)(U.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})}),a=z&&(0,n.jsx)(j.Tooltip,{open:!!R&&void 0,tooltipContent:(0,n.jsx)(U.A,{defaultMessage:"This artifact was previously unpublished. Create a new artifact to publish again.",id:"173M62fqu+"}),children:(0,n.jsx)(h.$,{onClick:G,variant:"primary",size:"sm",disabled:R||E,className:(0,N.A)(R&&"!pointer-events-auto"),children:(0,n.jsx)("span",{className:"text-sm",children:void 0===O||R?(0,n.jsx)(U.A,{defaultMessage:"Publish",id:"syEQFEKfku"}):(0,n.jsx)(U.A,{defaultMessage:"Published",id:"w7tf2zwi6+"})})})}),s=(0,n.jsxs)(g.AM,{mainButtonText:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:(0,N.A)(ea?"invisible":""),children:(0,n.jsx)(U.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})}),ea?(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(p.Jlk,{size:16})}):null]}),onClickMainButton:ei,children:[(null==P?void 0:P.show)?en?(0,n.jsx)(g.tJ,{disabled:!0,children:(0,n.jsx)(U.A,{defaultMessage:"Copied to project",id:"KYVs6Ta+VU"})},"added-to-project"):(0,n.jsx)(g.tJ,{onSelect:es,children:(0,n.jsx)(U.A,{defaultMessage:"Copy to project",id:"Xmf/Sp7n9T"})},"add-to-project"):null,ef,ex]}),i=K&&K.total_size_bytes>0&&!f&&(0,n.jsx)(j.Tooltip,{tooltipContent:(0,n.jsx)(m.YX,{id:"silver_apple_jungle"}),children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:X,children:(0,n.jsx)(p.lMJ,{size:16})})}),l=H&&!f&&(0,n.jsx)(j.Tooltip,{tooltipContent:(0,n.jsx)(U.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"}),children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:()=>J(!0),children:(0,n.jsx)(p.wB_,{size:16})})});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex gap-1 items-center",children:[e,i,l]}),s,t,a]})})(),(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:D,children:(0,n.jsx)(p.X,{size:16})})]})]})]})}function el(e){let{artifact:t,selectedVersion:a}=e,{downloadUrl:s,filename:i}=((e,t)=>{let[a,s]=(0,I.useState)(""),[n,i]=(0,I.useState)("");return(0,I.useEffect)(()=>{var a;let n=null!=(a=e.versions[t].resultState)?a:"",l=(0,w.eg)(e),r=new Blob([n],{type:"text/plain"}),o=URL.createObjectURL(r);return s(o),i("".concat(e.id,".").concat(l)),()=>{URL.revokeObjectURL(o)}},[e,t]),{downloadUrl:a,filename:n}})(t,a),l=function(e){switch(e.type){case w.vU.Markdown:return"Markdown";case w.vU.Html:return"HTML";case w.vU.React:return"TSX";case w.vU.Svg:return"SVG";case w.vU.Text:return"TXT";case w.vU.Mermaid:return"Mermaid";case w.vU.Code:var t;return null!=(t=w.K5[e.type].extension(e))?t:null;default:return null}}(t);return(0,n.jsx)("a",{href:s,download:i,className:"py-1 px-2 rounded-md cursor-pointer whitespace-nowrap overflow-hidden grid grid-cols-[minmax(0,_1fr)_auto] gap-2 hover:bg-bg-200 hover:text-text-000 text-sm",children:l?(0,n.jsx)(U.A,{defaultMessage:"Download as {fileType}",values:{fileType:l},id:"PJh4v0uaV6"}):(0,n.jsx)(U.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})}f.J.div(ea()),f.J.div(es());let er=e=>{let{onClose:t,isOpen:a,artifactVersionUuid:s,artifact:i,messageUuid:r,isProjectArtifact:o}=e,c=(0,L.A)(),{track:u}=(0,d.st)(),{mutateAsync:x,isPending:f}=(0,l.yE)(s),{data:m,isLoading:p}=(0,l.EC)(s),h=(null==m?void 0:m.visibility)==="shared",g=f||p,[v,b]=(0,I.useState)("");(0,I.useEffect)(()=>{if(""===v)return;let e=setTimeout(()=>b(""),5e3);return()=>clearTimeout(e)},[v]);let j="".concat(window.location.origin,"/artifacts/").concat(s),{copyToClipboard:w}=(0,y.C)(),_=g?"loading":h?"shared":"private",k=(0,I.useRef)(_);k.current!==_&&("loading"!==k.current&&"private"===_&&b(c.formatMessage({defaultMessage:"Artifact no longer shared",id:"5AFOwOoFPe"})),k.current=_);let M=e=>{"private"===e&&h&&x({visibility:"private"}).then(()=>t()),"shared"!==e||h||x({visibility:"shared"}).then(()=>w(j))};return(0,n.jsx)(eo,{isOpen:a,onClose:t,isLoading:g,isShared:h,isProjectArtifact:o,sharedLink:j,updateSharedState:M,handleClickShareButton:()=>{M("shared"),u({event_key:"artifact.share.modal.share_button_clicked",message_uuid:r,artifact_type:i.type,artifact_language:i.language})}})};function eo(e){let{isOpen:t,onClose:a,isShared:s,isProjectArtifact:i,sharedLink:l,isLoading:r,updateSharedState:o,handleClickShareButton:d}=e,{copyToClipboard:c,didCopy:u}=(0,y.C)();return(0,n.jsx)(b.aF,{title:(0,n.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:s?(0,n.jsx)(U.A,{defaultMessage:"Artifact shared",id:"0TqmonlxQo"}):(0,n.jsx)(U.A,{defaultMessage:"Share artifact",id:"FeSSOL+/49"})}),isOpen:t,onClose:a,modalSize:"lg",hasCloseButton:!0,children:(0,n.jsx)("div",{className:"mt-1 flex flex-col gap-2.5",children:s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,n.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)("div",{children:(0,n.jsx)(p.qzq,{className:"mt-1",size:16})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)(U.A,{defaultMessage:"Shared",id:"kWI6zXRaHY"})}),(0,n.jsx)("p",{className:"text-text-300",children:i?(0,n.jsx)(U.A,{defaultMessage:"Anyone who has access to this project can view this artifact and its associated attachments and files.",id:"fxjJJNetIb"}):(0,n.jsx)(U.A,{defaultMessage:"Anyone in your organization can view this artifact and its associated attachments and files.",id:"P+skcC6AMa"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)(R(),{className:"text-text-300 truncate text-sm",href:l,children:l}),(0,n.jsx)(h.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{c(l)},prepend:u?(0,n.jsx)(p.rAV,{size:16}):(0,n.jsx)(p.Xq1,{size:16}),children:u?(0,n.jsx)(U.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,n.jsx)(U.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(h.$,{size:"lg",variant:"secondary",loading:r,onClick:()=>o("private"),children:(0,n.jsx)(U.A,{defaultMessage:"Unshare",id:"bEq+NWNIXF"})})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:i?(0,n.jsxs)("p",{className:"bg-bg-300 text-text-300 flex gap-2 rounded-xl p-3 text-sm",children:[(0,n.jsx)(p.R2D,{size:16,className:"mt-0.5 shrink-0"}),(0,n.jsx)(U.A,{defaultMessage:"This artifact was created in a private project. Anyone in your organization who has access to this project will be able to view this artifact.",id:"g6r4HATHuW"})]}):(0,n.jsx)("p",{children:(0,n.jsx)(U.A,{defaultMessage:"Anyone in your organization can view this artifact. It also has access to attachments and files in the conversation.",id:"AnqiBApCMX"})})}),(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex gap-3 rounded-xl py-3 pl-3 pr-5",children:[(0,n.jsx)(p.c_I,{className:"mt-0.5",size:16}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)(U.A,{defaultMessage:"Unshared",id:"0r/9ANkloS"})}),(0,n.jsx)("p",{className:"text-text-300",children:(0,n.jsx)(U.A,{defaultMessage:"Only you have access",id:"U+7IIlpC6m"})})]})]}),(0,n.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,n.jsx)(h.$,{size:"lg",loading:r,onClick:d,children:(0,n.jsx)(U.A,{defaultMessage:"Share & copy link",id:"E7GQdF/HSA"})})})]})})})}let ed=e=>{let{isOpen:t,onClose:a,artifactVersionUuid:s,conversationUuid:i}=e,{addError:l}=(0,u.Y)(),{mutateAsync:r,isPending:o}=(0,O.rz)({entityId:s,artifactEntityType:"artifact_version",conversationUuid:i}),d=async()=>{try{await r(void 0),a()}catch(e){l((0,n.jsx)(m.YX,{id:"cotton_camel_pyramid"}),{error:e})}};return(0,n.jsx)(b.aF,{title:(0,n.jsx)(m.YX,{id:"silver_apple_jungle"}),isOpen:t,onClose:a,modalSize:"md",hasCloseButton:!0,children:(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsx)("p",{className:"text-text-400",children:(0,n.jsx)(m.YX,{id:"golden_pear_forest"})}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(h.$,{variant:"secondary",onClick:a,disabled:o,children:(0,n.jsx)(U.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,n.jsx)(h.$,{variant:"primary",onClick:d,loading:o,children:(0,n.jsx)(m.YX,{id:"silver_apple_jungle"})})]})]})})}},0x84bd1d62:(e,t,a)=>{a.d(t,{Ah:()=>m,LI:()=>y,NG:()=>g,Wk:()=>v,Xd:()=>j,aO:()=>h,hT:()=>b,oE:()=>p,y$:()=>f});var s=a(0x1065e6d73),n=a(0x12c9046cd),i=a(0x14de19ae8),l=a(0x1016c6ed2),r=a(0x49fac030),o=a(0x17e725145),d=a(0xc3731bfa),c=a(0x20892a038),u=a(0x1fe2ab707);function x(e){return{skillId:e.id,skillName:e.name,skillDescription:e.description,creatorType:e.creator_type,updatedAt:e.updated_at,enabled:e.enabled}}let f=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,a=(0,s.JO)();return(0,n.Sk)("/api/organizations/".concat(t,"/skills/list-skills"),{queryKey:[r.Gm,t],enabled:!!t&&a},e=>({skills:e.skills.map(x).sort((e,t)=>{if("user"===e.creatorType&&"anthropic"===t.creatorType)return -1;if("anthropic"===e.creatorType&&"user"===t.creatorType)return 1;if("user"===e.creatorType&&"user"===t.creatorType){let a=e.updatedAt?new Date(e.updatedAt).getTime():0;return(t.updatedAt?new Date(t.updatedAt).getTime():0)-a}return e.skillName.localeCompare(t.skillName)})}))},m=e=>{let{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid;return(0,n.Sk)("/api/organizations/".concat(a,"/skills/list-skill-files?skill_id=").concat(e),{queryKey:["skill-files",a,e],enabled:!!a&&!!e},e=>({filePaths:e.file_paths}))},p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid,s=(0,o.useQueryClient)(),c=(0,n.mn)();return(0,d.useMutation)({mutationFn:async e=>{let t="true"===e.get("overwrite")?"true":"false",s=e.get("check_skill_name"),n=new URLSearchParams({overwrite:t});s&&"string"==typeof s&&n.append("check_skill_name",s);let i=await c("/api/organizations/".concat(a,"/skills/upload-skill?").concat(n),{method:"POST",body:e});if(!i.ok){let e=await i.json();throw(0,l.a5)({status:i.status,response:e,fallbackMessage:"Failed to upload skill"})}let r=await i.json();return"validation_errors"in r?{skill:0===r.validation_errors.length?x(r.skill):null,validationErrors:r.validation_errors}:{skill:x(r),validationErrors:[]}},...e,onSuccess:async function(){for(var t,n=arguments.length,i=Array(n),l=0;l<n;l++)i[l]=arguments[l];await s.invalidateQueries({queryKey:[r.Gm,a]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...i))}})},h=e=>{let{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid;return(0,n.Qv)("/api/organizations/".concat(a,"/skills/enable-skill"),"POST",(e,t)=>{let{skillId:a}=e;return t?{...t,skills:t.skills.map(e=>e.skillId===a?{...e,enabled:!0}:e)}:void 0},{queryKey:[r.Gm,a],transformVariables:e=>{let{skillId:t}=e;return{skill_id:t}},meta:{noToast:!0},onError:e.onError})},g=e=>{let{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid;return(0,n.Qv)("/api/organizations/".concat(a,"/skills/disable-skill"),"POST",(e,t)=>{let{skillId:a}=e;return t?{...t,skills:t.skills.map(e=>e.skillId===a?{...e,enabled:!1}:e)}:void 0},{queryKey:[r.Gm,a],transformVariables:e=>{let{skillId:t}=e;return{skill_id:t}},meta:{noToast:!0},onError:e.onError})},v=e=>{let{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid,s=(0,o.useQueryClient)();return(0,n.L2)("/api/organizations/".concat(a,"/skills/delete-skill"),"POST",{transformVariables:e=>{let{skillId:t}=e;return{skill_id:t}},meta:{noToast:!0},onError:e.onError,onSuccess:async()=>{await s.invalidateQueries({queryKey:[r.Gm,a]})}})},b=e=>{let{skillId:t,path:a}=e,{activeOrganization:s}=(0,i.YL)(),r=null==s?void 0:s.uuid,o=(0,n.mn)();return(0,c.useQuery)({queryKey:["skill-file-content",r,t,a],enabled:!!r&&!!t&&!!a,queryFn:async()=>{let e=new URLSearchParams({skill_id:t,path:a}),s=await o("/api/organizations/".concat(r,"/skills/download-file-from-skill?").concat(e),{method:"GET"});if(!s.ok){let e=await s.json();throw(0,l.a5)({status:s.status,response:e,fallbackMessage:"Failed to load file content"})}let{isImage:n,isTextContent:i}=(0,u.G)(a);return{content:i?await s.text():n?await s.blob():await s.arrayBuffer(),path:a}}})},j=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,a=(0,n.mn)();return(0,d.useMutation)({mutationFn:async e=>{let{skillId:s}=e,n=new URLSearchParams({skill_id:s}),i=await a("/api/organizations/".concat(t,"/skills/download-dot-skill-file?").concat(n),{method:"GET"});if(!i.ok){let e=await i.json();throw(0,l.a5)({status:i.status,response:e,fallbackMessage:"Failed to download skill"})}let r=i.headers.get("Content-Disposition"),o=function(e){if(!e)return null;let t=e.match(/filename\*=([^']+)'([^']*)'(.+)/);if(t)return decodeURIComponent(t[3].trim());let a=e.match(/filename="([^"]+)"/);if(a)return a[1];let s=e.match(/filename=([^;\s]+)/);return s?s[1]:null}(r);if(!o)throw Error("Missing or invalid download header: ".concat(r));let d=await i.blob(),c=URL.createObjectURL(d),u=document.createElement("a");u.href=c,u.download=o,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(c)}})},y=e=>{let{activeOrganization:t}=(0,i.YL)(),a=null==t?void 0:t.uuid,s=(0,o.useQueryClient)(),c=(0,n.mn)();return(0,d.useMutation)({mutationFn:async e=>{let{name:t,instructions:s}=e,n=await c("/api/organizations/".concat(a,"/skills/create-simple-skill"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,instructions:s})});if(!n.ok){let e=await n.json();throw(0,l.a5)({status:n.status,response:e,fallbackMessage:"Failed to create skill"})}return x(await n.json())},onError:e.onError,onSuccess:async t=>{var n;await s.invalidateQueries({queryKey:[r.Gm,a]}),null==(n=e.onSuccess)||n.call(e,t)}})}},0x965113a9:(e,t,a)=>{a.d(t,{d:()=>n});var s=a(0x46988392);function n(e){let t=s.c9.now(),a=s.c9.fromISO(e),n=a.diff(t,"minutes").toObject().minutes;return n&&1>=Math.abs(n)?"just now":a.toRelative()}},0x9f889a90:(e,t,a)=>{a.d(t,{p:()=>n});var s=a(0x30e48ce2);function n(e){let t;try{t=JSON.parse(e)}catch(a){try{let a=(0,s.m)(e);t=JSON.parse(a)}catch(e){}}return t}},0xbe2d73b0:(e,t,a)=>{a.d(t,{W:()=>n});var s=a(0xfc89b4a4);function n(e,t,a){let n=(0,s.useRef)(void 0),i=(0,s.useCallback)(e,t),l=(0,s.useCallback)(()=>{n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(i,a)},[i,a]);return(0,s.useEffect)(()=>(l(),()=>{n.current&&window.clearTimeout(n.current)}),[...t,i,a]),l}},0xc4eacc65:(e,t,a)=>{a.d(t,{Z:()=>r});var s=a(0x22102fd88),n=a(0xab069d99),i=a(0x1a1f6dda6),l=a(0xfc89b4a4);function r(e){let{ref:t,children:a,parentClassName:r,innerClassName:o,pinToBottomConfig:d={disabled:!1,initialValue:!1},containerRef:c}=e,u=(0,l.useRef)((null==c?void 0:c.current)||null),x=(0,n.pc)(c,u),f=(0,l.useRef)(null),m=(0,l.useRef)(d.initialValue),p=(0,l.useRef)(!1),h=(0,l.useRef)(!1),g=(0,l.useRef)(null),v=(0,l.useCallback)(()=>u.current,[]),b=(0,l.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto",t=arguments.length>1?arguments[1]:void 0;if(!u.current||(null==t?void 0:t.onlyIfPinned)&&!m.current)return;let{scrollHeight:a,scrollTop:s,clientHeight:n}=u.current;s>a-n||(h.current=!0,u.current.scrollTo({top:u.current.scrollHeight,behavior:e}),g.current&&clearTimeout(g.current),g.current=window.setTimeout(()=>{h.current=!1},0))},[]),j=(0,l.useCallback)(e=>{m.current=e},[]);return(0,l.useImperativeHandle)(t,()=>({getScrollContainer:v,scrollToBottom:b,setPinToBottom:j,innerRef:f}),[v,b,j]),(0,l.useLayoutEffect)(()=>{let e=u.current,t=f.current;if(!e||!t||d.disabled)return;let a=()=>{if(h.current)return;let{scrollHeight:t,scrollTop:a,clientHeight:s}=e,n=8>Math.floor(t-a-s);p.current=n,n||(m.current=!1)},s=new ResizeObserver(()=>{m.current&&b()});return e.addEventListener("scroll",a),s.observe(t),s.observe(e),()=>{e.removeEventListener("scroll",a),s.disconnect(),g.current&&clearTimeout(g.current)}},[f,d.disabled,b]),(0,s.jsx)("div",{className:(0,i.A)("overflow-y-scroll overflow-x-hidden",r),ref:x,children:(0,s.jsx)("div",{className:(0,i.A)("relative w-full min-h-full",o),ref:f,children:a})})}},0xc628249c:(e,t,a)=>{a.d(t,{a:()=>v});var s=a(0x22102fd88),n=a(0x8daa74e8),i=a(0xf32c56dd),l=a(0x14de19ae8),r=a(0x139b5e710),o=a(0x225bae024),d=a(0x1016c6ed2),c=a(0xef41e510),u=a.n(c),x=a(0xfc89b4a4),f=a(0x1ab0d1ca1),m=a(0x38e6572),p=a(0x84bd1d62),h=a(0x11c7a82c2);function g(e){let{skillName:t,isOpen:a,isLoading:n,onConfirm:i,onCancel:l}=e,r=(0,f.A)();return(0,s.jsx)(h.R,{isOpen:a,onClose:l,onConfirm:i,title:r.formatMessage({defaultMessage:"Replace {skillName} skill?",id:"RSqxaAn/FM"},{skillName:t}),message:r.formatMessage({defaultMessage:"Theres an existing skill with the same name. Uploading this skill will replace the existing one, which cant be restored.",id:"dRMF/vTgCW"}),confirmText:r.formatMessage({defaultMessage:"Upload and replace",id:"TtbWBGHNcO"}),cancelText:r.formatMessage({defaultMessage:"Cancel",id:"47FYwba+bI"}),variant:"danger",isLoading:n})}function v(e){let{file:t,conversationUuid:a,source:c,variant:h="ghost",size:v="default",className:b}=e,{activeOrganization:j}=(0,l.YL)(),{addError:y,addSuccess:w}=(0,r.Y)(),_=(0,i.st)(),k=(0,f.A)(),[M,C]=(0,x.useState)(!1),[N,S]=(0,x.useState)(!1),[A,E]=(0,x.useState)(""),[T,z]=(0,x.useState)(!1),[R,I]=(0,x.useState)(null),[U,L]=(0,x.useState)(!1),O=(0,p.oE)({meta:{noToast:!0},onSuccess:e=>{let{skill:t,validationErrors:a}=e;(T?z:C)(!1),t&&(L(!0),w((0,s.jsxs)("span",{children:[(0,s.jsx)(m.A,{defaultMessage:"Skill uploaded. ",id:"+b9eNOXBBs"}),(0,s.jsx)(u(),{href:"/settings/capabilities#skills",className:"underline hover:no-underline",children:(0,s.jsx)(m.A,{defaultMessage:"View",id:"FgydNeoT78"})})]})),T&&(S(!1),I(null),E(""))),a.length>0&&a.forEach(e=>{y(e.message,{errorContext:{tags:{code:e.error_code}}})})},onError:e=>{e instanceof d.LG&&"upload_skill_already_exists"===e.errorCode?(E(e.extra.details.skill_name),S(!0),C(!1)):((T?z:C)(!1),y(e instanceof Error&&e.message?e.message:k.formatMessage({defaultMessage:"Failed to upload skill. You can try again.",id:"3wfKKwlXcY"}),{error:e,errorContext:{tags:{source:"skill_file_upload"}},messageForLogging:"Failed to upload skill."}))}}),F=(0,x.useCallback)(async(e,t)=>{let a=t?z:C;a(!0);try{let a=new FormData;a.append("file",e),a.append("overwrite",t?"true":"false"),await O.mutateAsync(a)}catch(e){a(!1)}},[O]),P=(0,x.useCallback)(async()=>{if(null==j?void 0:j.uuid){_.track({event_key:"claudeai.skills.file_save_skill.clicked",source:c,file_path:t.path}),C(!0);try{let e=(0,n.T)({organizationUuid:j.uuid,conversationUuid:a,filePath:t.path.replace(/^computer:\/\//,""),isShared:!1}),s=await fetch(e);if(!s.ok)throw Error("Failed to download file: ".concat(s.status," ").concat(s.statusText));let i=await s.blob(),l=t.path.split("/").pop()||"skill.skill",r=new File([i],l,{type:i.type});I(r),await F(r,!1)}catch(t){C(!1);let e=t instanceof Error?t:Error(String(t));y(e.message||k.formatMessage({defaultMessage:"Failed to download and upload skill. You can try again.",id:"KTwAodcnD6"}),{error:e,errorContext:{tags:{source:"skill_file_download"}},messageForLogging:"Failed to download and upload skill."})}}},[j,_,a,t.path,c,F,y,k]),D=(0,x.useCallback)(async()=>{R&&await F(R,!0)},[R,F]),B=(0,x.useCallback)(()=>{S(!1),I(null),E(""),z(!1)},[]);return t.path.endsWith(".skill")?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.$,{variant:h,size:v,loading:M,onClick:e=>{e.preventDefault(),e.stopPropagation(),P()},className:b,children:U?(0,s.jsx)(m.A,{defaultMessage:"Save again",id:"sCntRO8ziR"}):(0,s.jsx)(m.A,{defaultMessage:"Save skill",id:"QvmjxZ7K5S"})}),(0,s.jsx)(g,{skillName:A,isOpen:N,isLoading:T,onConfirm:D,onCancel:B})]}):null}},0xce58ec20:(e,t,a)=>{a.d(t,{x:()=>s});function s(e,t,a){return"share"===e?"".concat(window.location.origin,"/artifacts/").concat(t.artifact_version_uuid):"publish"===e&&t.published_artifact_uuid?"".concat(a,"/public/artifacts/").concat(t.published_artifact_uuid):void 0}},0xd3117c3a:(e,t,a)=>{a.d(t,{k:()=>n});var s=a(0x24fcf6beb);function n(e){let{filePath:t,isShared:a,conversationUuid:n,snapshotUuid:i,source:l}=e,r=t.replace("computer://",""),o=t.split(".").pop()||"";return{file_id:function(e){let t=e.replace("computer://",""),a=5381;for(let e=0;e<t.length;e++)a=(a<<5)+a+t.charCodeAt(e);return Math.abs(a).toString(16)}(t),file_extension:o,is_snapshot:a,is_viewable_file:(0,s.IO)(t),is_output_file:r.startsWith("/mnt/user-data/outputs/"),conversation_uuid:a?null:n||null,snapshot_uuid:a&&i||null,source:l}}},0xd4b9b976:(e,t,a)=>{a.d(t,{u:()=>l});var s=a(0x1da5efa06),n=a(0xe0e96db4),i=a(0x26a67dfc);function l(e){let t=e.trim();return(0,s.yt)(t,{extensions:[(0,n.x)()],htmlExtensions:[(0,i.k)()]})}},0xde8f44d0:(e,t,a)=>{a.d(t,{z:()=>c});var s=a(0x22102fd88),n=a(0x209ff4fac),i=a(0x11307af4f),l=a(0x236236dc),r=a(0x1f725a926),o=a(0x1a1f6dda6),d=a(0x239a63c1c);let c=e=>{let{className:t,code:a,codeTagProps:c,language:x,title:f}=e,{codeStyle:m}=(0,l.V)(),{exceedsSizeLimit:p}=(0,r.y)(a),h="code-block__code !my-0 !p-0 !rounded-none !text-sm !leading-relaxed";return(0,s.jsxs)("div",{className:(0,o.A)("flex flex-col gap-3 p-3 bg-bg-100 rounded-md",t),children:[(0,s.jsx)(u,{language:x,title:f}),p?(0,s.jsx)(n.R,{code:a,codeClassName:(0,o.A)(h,"-px-3")}):(0,s.jsx)(d.A,{className:h,codeTagProps:c,language:x,PreTag:"div",style:m,renderer:i.G,wrapLongLines:!0,children:a})]})},u=e=>{let{language:t,title:a}=e;return(0,s.jsx)("div",{className:"flex justify-between items-center h-3",children:(0,s.jsx)("p",{className:(0,o.A)("text-text-300 text-[0.6875rem]",a?"font-ui font-medium":"font-mono font-[450]"),children:a||t})})}},0xe13d4dc9:(e,t,a)=>{a.d(t,{OC:()=>n,eb:()=>i,nb:()=>l});var s=a(0x5ae340a6);function n(e){var t;return!!l(e)&&!!(null==(t=e.content)?void 0:t.some(e=>"tool_result"===e.type&&"artifacts"===e.name))}function i(e){let t=l(e);if(!t)return;let a=t.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:n}=s.z7.safeParse(a);return null==n?void 0:n.task_id}function l(e){var t;return null==(t=e.content)?void 0:t.find(e=>"tool_result"===e.type&&"launch_extended_search_task"===e.name)}},0xec7fcf66:(e,t,a)=>{(0,a(0x394ef833).v)((e,t)=>({toolUseRequests:{},requestToolApproval:(a,s,n,i,l)=>!t().toolUseRequests[n]&&(e(e=>({...e,toolUseRequests:{[a]:{...e.toolUseRequests[a],[s]:{id:s,toolId:n,input:i,promiseWithResolvers:l}}}})),!0),decideToolUse:(a,s,n)=>{let i=t(),l=i.toolUseRequests[a][s];return!!l&&(l.promiseWithResolvers.resolve(n),e(e=>({...e,toolUseRequests:{...e.toolUseRequests,[a]:{...i.toolUseRequests[a],[s]:{...i.toolUseRequests[a][s],decision:n}}}})),!0)}}))},0xf02ef1a6:(e,t,a)=>{a.d(t,{K:()=>g,h:()=>v});var s=a(0x22102fd88),n=a(0xf32c56dd),i=a(0x14de19ae8),l=a(0xb91ccc43),r=a(0x1d0c32e96),o=a(0x401a1006),d=a(0x225bae024),c=a(0x183548b63),u=a(0x1b813d90),x=a(0xfc89b4a4),f=a(0x38e6572),m=a(0x1334f6ecc),p=a(0x4d9fc74e),h=a(0x18175ce17),g=function(e){return e.NOT_CONNECTED="not_connected",e.MISSING_SCOPE="missing_scope",e.UNKNOWN="unknown",e}({});let v=e=>{let{isOpen:t,onClose:a,errorType:g,onConnectionSuccess:v,callerIdentifier:b,pathname:j}=e,y=(0,n.st)(),{activeOrganization:w}=(0,i.YL)(),[_,k]=(0,x.useState)(!1),M=(0,h.kO)(),{serverId:C}=(0,m.cj)(),N=(0,p.Q)({pathname:j,queryString:"gdrive_export_success=".concat(b||"gdrive-export-modal")}),{initDriveAuth:S}=(0,m.cI)({callerIdentifier:b||"gdrive-export-modal",pathname:j,handleAuthSuccess:()=>{k(!1),y.track({event_key:"wiggle.gdrive.connection.success",organization_id:null==w?void 0:w.uuid,error_type:g,caller_identifier:b}),a(),setTimeout(()=>{null==v||v()},100)}});if((0,h.FZ)({callerIdentifier:b||"gdrive-export-modal",successParam:"gdrive_export_success",handleOpen:()=>{k(!1),y.track({event_key:"wiggle.gdrive.connection.success",organization_id:null==w?void 0:w.uuid,error_type:g,caller_identifier:b}),a(),setTimeout(()=>{null==v||v()},100)}}),(0,x.useEffect)(()=>{t&&y.track({event_key:"wiggle.gdrive.connection.modal_shown",organization_id:null==w?void 0:w.uuid,error_type:g,caller_identifier:b})},[t,g,b,null==w?void 0:w.uuid,y]),"unknown"===g)return null;let{title:A,description:E,buttonText:T}=(()=>{switch(g){case"not_connected":return{title:"Connect Claude to Google Drive",description:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{children:(0,s.jsx)(f.A,{defaultMessage:"This will allow Claude to:",id:"Fh77iGv4CM"})}),(0,s.jsxs)("ul",{className:"list-disc pl-5 text-sm text-text-300 space-y-1",children:[(0,s.jsx)("li",{children:(0,s.jsx)(f.A,{defaultMessage:"Add DOCX, XLSX, and PPTX files that it creates directly to Google Drive",id:"H4PCn1IJGu"})}),(0,s.jsx)("li",{children:(0,s.jsx)(f.A,{defaultMessage:"Search and summarize Google Drive files",id:"o+UM/Lfa+u"})})]})]}),buttonText:"Connect"};case"missing_scope":return{title:"Reconnect Claude to Google Drive",description:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{children:(0,s.jsx)(f.A,{defaultMessage:"This will give Claude permission to see, edit, create, and delete files that it creates in Google Drive.",id:"vHppAPeTNV"})}),(0,s.jsx)(o.l,{icon:l.R2D,message:(0,s.jsx)(f.A,{defaultMessage:"Youll only need to do this once. Any existing Google Drive capabilities in Claude will still work.",id:"v8YR2us4Y6"})})]}),buttonText:"Reconnect"}}})();return(0,s.jsx)(c.aF,{modalSize:"lg",isOpen:t,onClose:a,hasCloseButton:!0,title:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(r.A9,{type:u.v8.GDRIVE,size:20}),(0,s.jsx)("span",{children:A})]}),children:(0,s.jsxs)("div",{className:"mt-5 space-y-6",children:[E,(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(d.$,{onClick:a,variant:"secondary",children:(0,s.jsx)(f.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,s.jsx)(d.$,{onClick:()=>{k(!0),y.track({event_key:"wiggle.gdrive.connection.initiated",organization_id:null==w?void 0:w.uuid,error_type:g,caller_identifier:b}),M&&C?N({uuid:C,url:"https://api.anthropic.com/mcp/gdrive/sse"}):S()},loading:_,disabled:_,children:T})]})]})})}},0x1156b3bea:(e,t,a)=>{a.d(t,{NotificationListener:()=>I,hG:()=>R,Wo:()=>T});var s=a(0xf32c56dd),n=a(0x14de19ae8),i=a(0xac309a83),l=a(0x1bd175d8c),r=a(0x1d0eef17),o=a(0x253a5c787),d=a(0x17e91b9fd),c=a(0x994de5af),u=a(0xfc89b4a4),x=a(0x11af11324),f=a(0x152020469),m=a(0x18c3d05ea),p=a(0x1484204a3);let h=(0,f.w)("CiRhbnRocm9waWMvY2xhdWRlL3B1c2gvZW52ZWxvcGUucHJvdG8SFWFudGhyb3BpYy5jbGF1ZGUucHVzaCJfChVQdXNoT3BlcmF0aW9uRW52ZWxvcGUSDwoHc2VydmljZRgBIAEoCRIOCgZtZXRob2QYAiABKAkSJQoHcmVxdWVzdBgDIAEoCzIULmdvb2dsZS5wcm90b2J1Zi5BbnlC4wEKGWNvbS5hbnRocm9waWMuY2xhdWRlLnB1c2hCDUVudmVsb3BlUHJvdG9QAVpBZ2l0aHViLmNvbS9hbnRocm9waWNzL21vYmlsZS1hcHBzL2dvL3Byb3Rvcy9hbnRocm9waWMvY2xhdWRlL3B1c2iiAgNBQ1CqAhVBbnRocm9waWMuQ2xhdWRlLlB1c2jKAhVBbnRocm9waWNcQ2xhdWRlXFB1c2jiAiFBbnRocm9waWNcQ2xhdWRlXFB1c2hcR1BCTWV0YWRhdGHqAhdBbnRocm9waWM6OkNsYXVkZTo6UHVzaGIGcHJvdG8z",[p.f]),g=(0,m.Z)(h,0);var v=a(0x1206ff42e),b=a(0xd9133b1);let j=(0,f.w)("CiZhbnRocm9waWMvY2xhdWRlL3B1c2gvb3BlcmF0aW9ucy5wcm90bxIVYW50aHJvcGljLmNsYXVkZS5wdXNoItECCg9PcGVuQ2hhdFJlcXVlc3QSIgoMYWNjb3VudF91dWlkGAEgASgJUgxhY2NvdW50X3V1aWQSLAoRb3JnYW5pemF0aW9uX3V1aWQYAiABKAlSEW9yZ2FuaXphdGlvbl91dWlkEiwKEWNvbnZlcnNhdGlvbl91dWlkGAMgASgJUhFjb252ZXJzYXRpb25fdXVpZBJjChxzYW1wbGluZ19jb21wbGV0ZWRfdGltZXN0YW1wGAQgASgLMhouZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcEgAUhxzYW1wbGluZ19jb21wbGV0ZWRfdGltZXN0YW1wiAEBEicKDG1lc3NhZ2VfdXVpZBgFIAEoCUgBUgxtZXNzYWdlX3V1aWSIAQFCHwodX3NhbXBsaW5nX2NvbXBsZXRlZF90aW1lc3RhbXBCDwoNX21lc3NhZ2VfdXVpZCKKAQoWT3BlbkNvZGVTZXNzaW9uUmVxdWVzdBIiCgxhY2NvdW50X3V1aWQYASABKAlSDGFjY291bnRfdXVpZBIsChFvcmdhbml6YXRpb25fdXVpZBgCIAEoCVIRb3JnYW5pemF0aW9uX3V1aWQSHgoKc2Vzc2lvbl9pZBgDIAEoCVIKc2Vzc2lvbl9pZDLFAQodTG9nZ2VkSW5QdXNoT3BlcmF0aW9uc1NlcnZpY2USSgoIT3BlbkNoYXQSJi5hbnRocm9waWMuY2xhdWRlLnB1c2guT3BlbkNoYXRSZXF1ZXN0GhYuZ29vZ2xlLnByb3RvYnVmLkVtcHR5ElgKD09wZW5Db2RlU2Vzc2lvbhItLmFudGhyb3BpYy5jbGF1ZGUucHVzaC5PcGVuQ29kZVNlc3Npb25SZXF1ZXN0GhYuZ29vZ2xlLnByb3RvYnVmLkVtcHR5QuUBChljb20uYW50aHJvcGljLmNsYXVkZS5wdXNoQg9PcGVyYXRpb25zUHJvdG9QAVpBZ2l0aHViLmNvbS9hbnRocm9waWNzL21vYmlsZS1hcHBzL2dvL3Byb3Rvcy9hbnRocm9waWMvY2xhdWRlL3B1c2iiAgNBQ1CqAhVBbnRocm9waWMuQ2xhdWRlLlB1c2jKAhVBbnRocm9waWNcQ2xhdWRlXFB1c2jiAiFBbnRocm9waWNcQ2xhdWRlXFB1c2hcR1BCTWV0YWRhdGHqAhdBbnRocm9waWM6OkNsYXVkZTo6UHVzaGIGcHJvdG8z",[v.t,b.i]),y=(0,m.Z)(j,0),w=(0,m.Z)(j,1);var _=a(0xe9217003),k=a(0x22ca84427),M=a(0x2082b2d4d);let C=(0,_.Iq)(j);function N(e){if(!e)return null;try{let t=(0,k.Rf)(g,JSON.parse(e),{registry:C});if(!t.request||!t.method)return null;switch(t.method){case"OpenChat":{let e=(0,M.rW)(t.request,y);if(null==e?void 0:e.conversationUuid){let t=e.conversationUuid;return{method:"OpenChat",targetUrl:"/chat/".concat(t)}}break}case"OpenCodeSession":{let e=(0,M.rW)(t.request,w);if(null==e?void 0:e.sessionId){let t=e.sessionId;return{method:"OpenCodeSession",targetUrl:"/code/".concat(t)}}}}return null}catch(e){return null}}var S=a(0xc6857cab);let A={apiKey:"AIzaSyDu88493oN_Xq4PNVr_x8GUZPZhe-byS4U",authDomain:"proj-scandium-production-5zhm.firebaseapp.com",projectId:"proj-scandium-production-5zhm",storageBucket:S.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"",messagingSenderId:"365066964946",appId:"1:365066964946:web:920eb01ec340c52cb8420b",measurementId:S.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||""},E="BBn_zDr7ckBwzQe6Tdc1k6E0tSdrG64L2ddLR36jUkdaleKmAdfgt3ao93t-nib3n3oBaAtbd9KyoxHaUGJLEzU",T=()=>{let[e,t]=(0,u.useState)(()=>"Notification"in window?Notification.permission:"default");return(0,u.useEffect)(()=>{"Notification"in window&&t(Notification.permission)},[]),(0,r.M)("focus",()=>{"Notification"in window&&t(Notification.permission)}),e},z=async e=>{let{isClaudeElectronApp:t,onTokenReceived:a,track:s}=e;if(!("Notification"in window))return{success:!1,errorSource:"browser_or_permissions"};try{let e=await Notification.requestPermission();if(s&&s({event_key:"claudeai.notification.permission.result",permission:e}),"granted"!==e)return s&&s({event_key:"claudeai.notification.permission.result",permission:e}),{success:!1,errorSource:"browser_or_permissions"};{let e,s;if(t)return{success:!1,errorSource:"internal"};if(e=0===(0,d.Dk)().length?(0,d.Wp)(A):(0,d.Sx)(),!await (0,c.TT)())return{success:!1,errorSource:"firebase"};try{s=(0,c.dG)(e)}catch(e){return{success:!1,errorSource:"firebase"}}let n=(await navigator.serviceWorker.getRegistrations()).find(e=>{var t;return null==(t=e.active)?void 0:t.scriptURL.includes("firebase-messaging-sw.js")});if(!n&&1)try{n=await navigator.serviceWorker.register("/firebase-messaging-sw.js"),await navigator.serviceWorker.ready}catch(e){(0,o.Cp)(e,{tags:{action:"registerServiceWorker"}})}try{let e=await (0,c.gf)(s,{vapidKey:E,serviceWorkerRegistration:n});if(e)a(e);else throw(0,o.Cp)(Error("FCM token is null"),{tags:{action:"getToken"}}),Error("FCM token is null")}catch(e){throw(0,o.Cp)(e,{tags:{action:"getToken"}}),e}}return{success:!0}}catch(e){return(0,o.Cp)(e,{tags:{action:"requestPermission"}}),{success:!1,errorSource:"internal"}}},R=()=>{let{track:e}=(0,s.st)(),{mutate:t}=(0,x.E)(),a=(0,l.V)();return(0,u.useCallback)(async()=>(e({event_key:"claudeai.notification.permission.request_started"}),await z({isClaudeElectronApp:a,onTokenReceived:e=>{t({channel_type:x.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},track:e})),[t,a,e])},I=()=>{let e=(0,u.useRef)(null),{account:t}=(0,n.YL)(),{mutate:a}=(0,x.E)(),r=(0,l.V)(),f=(0,i.fS)("claudeai_skip_foreground_notifications"),{track:m}=(0,s.st)(),p=async()=>{let t;if(t=0===(0,d.Dk)().length?(0,d.Wp)(A):(0,d.Sx)(),!await (0,c.TT)())return{app:null,messaging:null};if(e.current)return{app:t,messaging:e.current};let a=(0,c.dG)(t);return e.current=a,{app:t,messaging:a}},h=async e=>{try{return await (0,c.gf)(e,{vapidKey:E})}catch(e){return(0,o.Cp)(e,{tags:{action:"getFCMToken"}}),null}},g=(0,u.useCallback)(e=>{a({channel_type:x.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},[a]);return(0,u.useEffect)(()=>{var e;let t=!0,a=null;(async()=>{if(!r&&"Notification"in window&&"granted"===Notification.permission)try{let{messaging:e}=await p();if(!e||!t)return;let s=await h(e);s&&t&&g(s),a=(0,c.xD)(e,e=>{var t,a,s;if(f)return;if((null==(t=e.data)?void 0:t.notification_feature_category)==="completion"){let t=N(e.data.payload);if((null==t?void 0:t.targetUrl)&&window.location.pathname.includes(t.targetUrl))return;navigator.serviceWorker.getRegistrations().then(t=>{let a=t.find(e=>{var t;return null==(t=e.active)?void 0:t.scriptURL.includes("firebase-messaging-sw.js")});(null==a?void 0:a.active)&&a.active.postMessage({type:"SHOW_COMPLETION_NOTIFICATION",payload:e.data})});return}let n=(null==(a=e.data)?void 0:a.title)||"Claude",i={body:null==(s=e.data)?void 0:s.body,icon:"/favicon.svg",badge:"/favicon.svg",data:e.data},l=new Notification(n,i);l.onclick=()=>{var t,a;window.focus(),l.close();let s="/";if(null==(t=e.data)?void 0:t.payload){let t=N(e.data.payload);t&&(s=t.targetUrl)}m({event_key:"claudeai.notification.clicked",category:(null==(a=e.data)?void 0:a.notification_feature_category)||"unknown",target_url:s,location:"foreground"}),window.location.href=s}})}catch(e){(0,o.Cp)(e,{tags:{action:"setupNotifications"}})}})();let s=e=>{let t=e.data;(null==t?void 0:t.type)==="TRACK_NOTIFICATION_CLICK"&&m({event_key:"claudeai.notification.clicked",category:t.category||"unknown",target_url:t.targetUrl,location:t.location||"background"}),(null==t?void 0:t.type)==="NOTIFICATION_CLICK_NAVIGATE"&&(null==t?void 0:t.targetUrl)&&(window.location.href=t.targetUrl),(null==t?void 0:t.type)==="GET_CURRENT_URL"&&(null==t?void 0:t.requestId)&&e.source&&e.source.postMessage({type:"CURRENT_URL_RESPONSE",requestId:t.requestId,url:window.location.href})};return null==(e=navigator.serviceWorker)||e.addEventListener("message",s),()=>{var e;t=!1,a&&a(),null==(e=navigator.serviceWorker)||e.removeEventListener("message",s)}},[t,r,f,m,g]),null}},0x116bf7f07:(e,t,a)=>{a.d(t,{n:()=>k,M:()=>_});var s=a(0x628a9a0b),n=a(0x209960a1a),i=a(0x1e3604791),l=a(0x10a2d47e3),r=a(0x253a5c787),o=a(0xfc89b4a4),d=a(0x14c0dfde7),c=a(0x25062734b),u=a(0x218bd2f97),x=a(0x597e433e),f=a(0xf32c56dd),m=a(0x139b5e710),p=a(0xac309a83),h=a(0xe670e093),g=a(0x2061777d6),v=a(0xe824fb1c);function b(e){let{mimeType:t,base64Data:a}=e;if(!x._F[t])throw(0,r.Cp)(Error("Unsupported image type"),{extra:{mimeType:t}}),Error("The tool returned an image in an unsupported format.");let s=x._F[t];return{type:"image",file_name:"".concat((0,h.b)(),".").concat(s),source:{media_type:t,type:"base64",data:a}}}var j=a(0x1137a9c1a);async function y(e,t){let a=j.zN.safeParse(e);if(a.success)try{let e=await t(a.data.code);return{content:[{type:"text",text:JSON.stringify(e)}]}}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}throw Error("Error parsing input: ".concat(a.error.message))}var w=a(0x9f889a90);function _(){let{mutateAsync:e}=(0,s.Pt)(),t=function(){let{executeReplCode:e}=(0,n.q)(),t=function(){let{track:e}=(0,f.st)(),{addError:t}=(0,m.Y)(),a=(0,p.fS)("mcp_structured_content_support");return(0,o.useCallback)(async(s,n,i)=>{let l;try{let t=await (0,v.KU)(i).callTool({name:n.name,arguments:s},g.zo,{timeout:24e4});e({event_key:"mcp.tools.called",result:"success",argument_count:Object.keys(s).length}),l="structuredContent"in t&&void 0!==t.structuredContent&&null!==t.structuredContent&&a?{content:[{type:"text",text:JSON.stringify(t.structuredContent)}],isError:"isError"in t&&"boolean"==typeof t.isError&&t.isError}:"content"in t?t:{content:[{type:"text",text:JSON.stringify(t.toolResult,null,2)}],isError:!1}}catch(a){throw(0,r.Cp)(a,{tags:{serverUuid:i}}),t('Failed to call tool "'.concat(n.name,'".'),{error:a}),e({event_key:"mcp.tools.called",result:"failure",argument_count:Object.keys(s||{}).length}),Error("Tool execution failed")}return{is_error:l.isError,content:l.content.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return b({mimeType:e.mimeType,base64Data:e.data});case"resource":{let t=e.resource;if("text"in t)return{type:"text",text:t.text};if("blob"in t){if(!t.mimeType)throw(0,r.Cp)(Error("Missing MIME type for resource"),{tags:{serverUuid:i}}),Error("The tool returned a resource without a valid format.");return b({mimeType:t.mimeType,base64Data:t.blob})}}}throw(0,r.Cp)(Error("Unsupported content type"),{tags:{serverUuid:i},extra:{mimeType:e.type}}),Error("The tool returned content in an unsupported format.")})}},[e,t,a])}();return(0,o.useCallback)(async(a,s)=>{let n=(0,w.p)(s);if("repl"===a)return await y(n,e);{let e=(0,v.pK)(a);if((null==e?void 0:e.tool)&&(null==e?void 0:e.server))return await t(n,e.tool,e.server.uuid)}},[e,t])}();return(0,o.useCallback)(async function(a,s,n,i){let{overriddenResult:l}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};try{let o=null!=l?l:await t(s,i);if(void 0===o){(0,v.qT)(s)&&(0,r.Cp)(Error("Tool not found"),{tags:{conversationUuid:a,toolId:n},level:"warning"});return}await e({conversation_uuid:a,type:"tool_result",tool_use_id:n,...o})}catch(s){(0,r.Cp)(s,{tags:{conversationUuid:a,toolId:n}});let t=s instanceof Error?s.message:String(s);await e({conversation_uuid:a,type:"tool_result",tool_use_id:n,content:[{type:"text",text:t}]})}},[t,e])}let k=(e,t)=>{let a=(0,l.wc)(),{value:s}=(0,i.N)(null!=e?e:{}),n=(0,d.p9)(),r=(0,u.Pb)(t),x=(0,c.yr)();return(0,o.useCallback)(()=>{let t=(0,v._b)(n,null==e?void 0:e.enabled_mcp_tools,x),i=null==a?void 0:a[l.U3];return i&&(null==e?void 0:e.enabled_web_search)&&t.push({type:(null==a?void 0:a[l.$6])||"",name:i}),t.push({type:"artifacts_v0",name:"artifacts"}),s&&t.push({type:"repl_v0",name:"repl"}),r&&t.push({type:"project_knowledge_search",name:"project_knowledge_search"}),t},[null==e?void 0:e.enabled_mcp_tools,null==e?void 0:e.enabled_web_search,s,a,r,n,x])}},0x11af11324:(e,t,a)=>{a.d(t,{E:()=>u,Hg:()=>d,KG:()=>x,Lr:()=>p,ZH:()=>m,gT:()=>c,zZ:()=>o});var s=a(0x12c9046cd),n=a(0x14de19ae8),i=a(0x17e725145),l=a(0xfc89b4a4);let r="notificationPreferences";var o=function(e){return e.FCM="FCM",e.APNS="APNS",e}({});let d=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid;return(0,s.Sk)("/api/organizations/".concat(t,"/notification/preferences"),{queryKey:[r,{orgUuid:t}],enabled:!!t})},c=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,a=(0,i.useQueryClient)();return(0,s.L2)("/api/organizations/".concat(t,"/notification/preferences"),"PUT",{onSuccess:()=>{a.invalidateQueries({queryKey:[r,{orgUuid:t}]})}})},u=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,a=(0,i.useQueryClient)();return(0,s.L2)("/api/organizations/".concat(t,"/notification/channels"),"POST",{onSuccess:()=>{a.invalidateQueries({queryKey:["notificationChannels",{orgUuid:t}]})},meta:{noToast:!0}})},x=e=>{var t,a,s;let{data:n}=d();return(null==n||null==(s=n.preferences)||null==(a=s.feature_preference)||null==(t=a[e])?void 0:t.enable_push)===!0},f=["bogosort","compass","completion"],m=()=>{var e;let{data:t}=d(),a=null!=(e=null==t?void 0:t.preferences.feature_preference)?e:{};return f.every(e=>{let t=a[e];return(null==t?void 0:t.enable_push)===!0})},p=()=>{let{data:e}=d(),{mutateAsync:t}=c();return(0,l.useCallback)(async a=>{let s=(null==e?void 0:e.preferences)||{},n={...s.feature_preference};for(let e of f){var i,l;n[e]={...n[e],enable_push:a,enable_email:null!=(l=null==(i=n[e])?void 0:i.enable_email)&&l}}await t({preferences:{...s,feature_preference:n}})},[e,t])}},0x1398bcf3b:(e,t,a)=>{a.d(t,{O:()=>r,f:()=>l});var s=a(0x12c9046cd),n=a(0x14de19ae8),i=a(0x1f22b8dda);let l=e=>{let{conversationUuid:t,source:a}=e,{activeOrganization:l}=(0,n.YL)(),r=null==l?void 0:l.uuid,o=(0,i.Z)(t),d=new URLSearchParams;a&&d.append("source",a);let c=d.toString()?"?".concat(d.toString()):"";return(0,s.Sk)("/api/organizations/".concat(r,"/artifacts/").concat(t,"/versions").concat(c),{queryKey:["conversation_artifacts_query_key",{organizationUuid:r,conversationUuid:t}],enabled:!!r&&!!t&&!o,meta:{noToast:!0}})},r=e=>{let{conversationUuid:t}=e,{activeOrganization:a}=(0,n.YL)(),i=null==a?void 0:a.uuid;return(0,s.L2)("/api/organizations/".concat(i,"/conversations/").concat(t,"/wiggle/convert-file-to-artifact"),"POST",{enabled:!!i&&!!t})}},0x14a7c225d:(e,t,a)=>{a.d(t,{S:()=>R,o:()=>I});var s=a(0x22102fd88),n=a(0xb91ccc43),i=a(0x181ae4ae0),l=a(0x22a0750cf),r=a(0x55ff3537),o=a(0x1ec3cd7c7),d=a(0xe5870a96),c=a(0x8edc02a4),u=a(0x623618cf),x=a(0x4d4b8cc),f=a(0x1704f08b2),m=a(0x21ef1d6f7),p=a(0x1062d322f),h=a(0x23e5be4a6),g=a(0x82a9b531),v=a(0x1212fd474),b=a(0xbdea0192),j=a(0x22d18bc5b),y=a(0x14fc9ef62),w=a(0x1ee41158f),_=a(0x170e3395b),k=a(0x2411cb630),M=a(0x1ebf385af),C=a(0x2fd50c64),N=a(0x71e858ff),S=a(0x121bc2551),A=a(0xfb22fb91),E=a(0x28c00d20);let T={html:"html",htm:"html",xhtml:"html",css:"css",scss:"scss",sass:"sass",less:"less",js:"javascript",jsx:"jsx",ts:"typescript",tsx:"tsx",json:"json",yaml:"yaml",yml:"yaml",xml:"xml",svg:"svg",py:"python",rb:"ruby",php:"php",java:"java",c:"c",h:"c",cpp:"cpp",cc:"cpp",cxx:"cpp",hpp:"cpp",cs:"csharp",go:"go",rs:"rust",swift:"swift",kt:"kotlin",scala:"scala",dart:"dart",lua:"lua",pl:"perl",r:"r",sh:"bash",bash:"bash",zsh:"bash",fish:"fish",bat:"batch",cmd:"batch",ps1:"powershell",md:"markdown",markdown:"markdown",skill:"skill",mermaid:"mermaid",mmd:"mermaid",tex:"latex",rst:"restructuredtext",asciidoc:"asciidoc",adoc:"asciidoc",csv:"csv",tsv:"tsv",toml:"toml",ini:"ini",conf:"ini",cfg:"ini",sql:"sql",graphql:"graphql",gql:"graphql",dockerfile:"dockerfile",dockerignore:"docker",gitignore:"git",gitattributes:"git",editorconfig:"editorconfig",diff:"diff",patch:"diff",nginx:"nginx",htaccess:"apacheconf"};function z(e){var t;return(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""}function R(e){return T[z(e).toLowerCase()]||"plaintext"}function I(e){let{path:t,size:a=16}=e,T=z(t);if(t.includes("SKILL.md"))return(0,s.jsx)(n.xPp,{size:a});switch(T){case"pdf":return(0,s.jsx)(i.T,{size:a});case"c":return(0,s.jsx)(l.s,{size:a});case"cs":return(0,s.jsx)(r.e,{size:a});case"cpp":return(0,s.jsx)(E.y,{size:a});case"css":return(0,s.jsx)(o.y,{size:a});case"csv":return(0,s.jsx)(d.F,{size:a});case"doc":case"docx":return(0,s.jsx)(c.j,{size:a});case"html":case"htm":case"xhtml":return(0,s.jsx)(u._,{size:a});case"jpg":case"jpeg":return(0,s.jsx)(x.a,{size:a});case"js":return(0,s.jsx)(f.u,{size:a});case"jsx":return(0,s.jsx)(m.m,{size:a});case"md":return(0,s.jsx)(p.C,{size:a});case"skill":return(0,s.jsx)(n.xPp,{size:a});case"png":return(0,s.jsx)(h.K,{size:a});case"ppt":case"pptx":return(0,s.jsx)(g.z,{size:a});case"py":return(0,s.jsx)(v.I,{size:a});case"rs":return(0,s.jsx)(b.q,{size:a});case"sql":return(0,s.jsx)(j.b,{size:a});case"svg":return(0,s.jsx)(y.V,{size:a});case"ts":return(0,s.jsx)(w.G,{size:a});case"tsx":return(0,s.jsx)(_.M,{size:a});case"txt":return(0,s.jsx)(k.r,{size:a});case"vue":return(0,s.jsx)(M.x,{size:a});case"xls":case"xlsx":return(0,s.jsx)(C.K,{size:a});case"zip":return(0,s.jsx)(N.g,{size:a});case"gif":case"bmp":case"webp":case"ico":return(0,s.jsx)(S.C,{size:a});default:return(0,s.jsx)(A.i,{size:a})}}},0x1521a7ab3:(e,t,a)=>{a.d(t,{c:()=>tq});var s=a(0x22102fd88),n=a(0x14de19ae8),i=a(0xfc89b4a4),l=a(0x17e7bc007),r=a(0xac309a83),o=a(0x1dc411c0f),d=a(0x52e2618c),c=a(0x1065e6d73),u=a(0x14fe1b2a5),x=a(0x225bae024),f=a(0xa6a34c14),m=a(0xc2057bad),p=a(0x1e6127894),h=a(0x1ab0d1ca1),g=a(0x38e6572),v=a(0x8603234d);function b(){let e=(0,d._)(["\n  flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100\n"]);return b=function(){return e},e}function j(){let e=(0,d._)(["\n  bg-bg-300/80 text-text-300 outline-bg-400/80\n"]);return j=function(){return e},e}function y(){let e=(0,d._)(["\n  bg-accent-secondary-200/20 outline-accent-secondary-200/30\n"]);return y=function(){return e},e}function w(){let e=(0,d._)(["\n  cursor-pointer items-center bg-danger-900/50 hover:bg-danger-900/75 transition group/banner outline-danger-000/25 hover:outline-danger-000/50\n"]);return w=function(){return e},e}let _=u.J.div(b()),k=(0,u.J)(_)(j()),M=(0,u.J)(_)(y()),C=(0,u.J)(_)(w()),N=(0,i.memo)(function(e){var t;let{message:a,messageWarningPropsFromParent:n,hasLink:l,hasCode:o,hasDriveDocWithImages:d,onRetry:u,onSendContinue:b,conversationSettings:j,isLastMessage:y}=e,w=(0,h.A)(),_=(0,c.Yl)(),N=(0,c.u9)(),S=null==j?void 0:j.enabled_web_search,A=(0,r.fS)("claudeai_web_search"),E=(0,i.useMemo)(()=>({a:e=>{let{node:t,...a}=e;return(0,s.jsx)("a",{...a,className:"underline"})}}),[]);if((null==n?void 0:n.style)==="prominent")return(0,s.jsxs)(M,{"data-testid":"message-warning",children:[(0,s.jsx)(f.N,{className:"shrink-0",size:16}),(0,s.jsx)(v.o,{components:E,children:n.contentMarkdown})]});let T="human"===a.sender;if(!T&&"error"===a.stop_reason&&u)return(0,s.jsxs)(C,{"data-testid":"message-warning",onClick:()=>u(a.parent_message_uuid),children:[(0,s.jsxs)("div",{className:"relative h-4 w-4 shrink-0 text-danger-000",children:[(0,s.jsx)(f.N,{className:"absolute inset-0 group-hover/banner:opacity-0 group-hover/banner:scale-75  opacity-50 transition",size:16}),(0,s.jsx)(m.o,{className:"absolute inset-0 group-hover/banner:opacity-75 group-hover/banner:rotate-0 rotate-[20deg] opacity-0 transition",size:16})]}),(0,s.jsx)("div",{className:"flex flex-grow text-danger-000",children:(0,s.jsx)(g.A,{defaultMessage:"This response didnt load. Try again by chatting to Claude.",id:"g0FIIo0clM"})})]});if(!T&&y&&"max_tokens"===a.stop_reason&&b)return(0,s.jsx)(k,{"data-testid":"message-warning",children:(0,s.jsxs)("div",{className:"flex max-sm:flex-col gap-2 w-full",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(p.R,{className:"shrink-0",size:16}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(g.A,{defaultMessage:"This response paused because Claude reached its max length for a message. Hit continue to nudge Claude along.",id:"oje9UAHUmL"})})]}),(0,s.jsx)("div",{className:"ml-6",children:(0,s.jsx)(x.$,{variant:"secondary",size:"sm",className:"block flex-shrink-0",onClick:()=>null==b?void 0:b(),"aria-label":w.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"}),children:(0,s.jsx)(g.A,{defaultMessage:"Continue",id:"acrOozm08x"})})})]})});if(!T&&y&&(null==(t=a.metadata)?void 0:t.is_resume_completion_placeholder_message))return(0,s.jsx)("div",{className:"m-2 w-full",children:(0,s.jsx)(k,{"data-testid":"message-warning",children:(0,s.jsx)("div",{className:"p-1",children:(0,s.jsx)(g.A,{defaultMessage:"Claude is still creating a response in the background. Once its complete, youll see it here.",id:"PBOdLw2o4Z"})})})});let z=[];return(l&&!S&&A&&z.push(w.formatMessage({defaultMessage:"Turn on web search in Search and tools menu. Otherwise, links provided may not be accurate or up to date.",id:"uUjlNFGg26"})),T?d&&z.push(w.formatMessage({defaultMessage:"Claude cannot yet access images from Google Docs.",id:"8Wb1yCJBBv"})):(o&&_&&!N&&z.push(w.formatMessage({defaultMessage:"To run code, enable code execution and file creation in Settings > Capabilities.",id:"BHnMOtM/i0"})),a.stop_reason,"conversation_length_limit"===a.stop_reason&&z.push(w.formatMessage({defaultMessage:"Claude hit the maximum length for this conversation. Please start a new conversation to continue chatting with Claude.",id:"jujWu4WTLz"})),n&&z.push(n.contentMarkdown)),0===z.length)?null:(0,s.jsxs)(k,{"data-testid":"message-warning",children:[(0,s.jsx)(p.R,{className:"shrink-0",size:16}),(0,s.jsx)(v.o,{components:E,children:z.reverse().join(" ")})]})});var S=a(0x1fc7d761);let A=e=>{let{message:t,isLastMessage:a,conversationSettings:n,messageWarningPropsFromParent:i,hasDriveDocWithImages:l,onRetry:r,onSendContinue:o}=e,d=(0,S.LR)(t.uuid),c=(0,S.Kc)(t.uuid);return(0,s.jsx)(N,{message:t,hasLink:d,hasCode:c,isLastMessage:a,hasDriveDocWithImages:l,conversationSettings:n,messageWarningPropsFromParent:i,onRetry:r,onSendContinue:o})};function E(){let e=(0,d._)(["\n  group\n  relative\n  inline-flex\n  gap-2\n  bg-bg-300\n  rounded-xl\n  pl-2.5\n  py-2.5\n  break-words\n  text-text-100\n  transition-all\n  max-w-[75ch]\n  flex-col\n"]);return E=function(){return e},e}function T(){let e=(0,d._)(["\n  group\n  relative\n"]);return T=function(){return e},e}function z(){let e=(0,d._)(["\n  font-claude-response\n  relative\n  leading-[1.65rem]\n  [&_pre>div]:bg-bg-000/50\n  [&_pre>div]:border-0.5\n  [&_pre>div]:border-border-400\n  [&_.ignore-pre-bg>div]:bg-transparent\n  [&_.standard-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2\n  [&_.standard-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8\n  [&_.progressive-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2\n  [&_.progressive-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8\n"]);return z=function(){return e},e}let R={initial:!1,animate:{y:0,opacity:1}},I={initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{type:"spring",damping:10,stiffness:100}},U={initial:{scale:1.02,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"}},L={initial:{height:"0px",opacity:0},animate:{height:"auto",opacity:1},transition:{ease:"linear",duration:.1}},O=(0,u.J)(o.P.div)(E()),F=(0,u.J)(o.P.div)(T()),P=u.J.div(z());var D=a(0x14a6d5f1),B=a(0xf32c56dd),G=a(0xb91ccc43),W=a(0x1e1f2a153),V=a(0x24fcf6beb),q=a(0x1de4b2c21),Y=a(0x1a1f6dda6),H=a(0x160045b25),J=a(0x156c4e43b),K=a(0x22be9474c),X=a(0x31c535e9),Z=a(0x12c9046cd),Q=a(0x236236dc),$=a(0x226530adf),ee=a(0x371cc700),et=a(0x1b03847fb),ea=a(0x14023fbb8),es=a(0x183548b63),en=a(0x239a63c1c),ei=a(0x1c12b3087),el=a(0x116bf7f07);function er(e){let{isOpen:t,onClose:a,conversationUuid:n,messageUuid:i}=e;return(0,s.jsx)(es.aF,{isOpen:t,onClose:a,modalSize:"xl",hasCloseButton:!0,title:(0,s.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,s.jsx)(g.A,{defaultMessage:"Debug information",id:"NqgO+Si31g"}),(0,s.jsx)("span",{className:"ml-2 mt-px pb-px text-sm font-medium text-always-white bg-always-black px-2 rounded",children:(0,s.jsx)(g.A,{defaultMessage:"Internal use only",id:"xg5Va4c/VJ"})})]}),children:(0,s.jsx)(eo,{conversationUuid:n,messageUuid:i})})}function eo(e){let{conversationUuid:t,messageUuid:a}=e,{data:r,isPending:o,mutateAsync:d}=((e,t)=>{let{activeOrganization:a}=(0,n.YL)(),s=null==a?void 0:a.uuid;return(0,Z.L2)("/api/organizations/".concat(s,"/chat_conversations/").concat(e,"/chat_messages/").concat(t,"/debug"),"POST")})(t,a),c=(0,ei.Tc)(e=>e.model,"ChatMessageDebugModal"),u=(0,X.vP)("paprika_mode"),f=(0,ee.B)(),m=(0,el.n)(null!=f?f:void 0),{codeStyle:p}=(0,Q.V)(),h=r?(()=>{let e=l.oz.getState(),a=(e.pathUuidsByConversation[t]||[]).map(t=>e.messageByUuid[t]).filter(Boolean);return JSON.stringify({...function(e){for(let[t,a]of Object.entries(e.logs.api_usage))if("string"==typeof a)try{let s=JSON.parse(a);e.logs.api_usage[t]=s}catch(e){}return e}(r),all_messages:a},null,2)})():"",v=(0,$.Z3)(t);(0,i.useEffect)(()=>{(async()=>{await d({prompt:"",model:c||v,tools:m(),personalized_styles:[],paprika_mode:u})})()},[d,c,m,u,v]);let{didCopy:b,copyToClipboard:j}=(0,W.C)(),y=(0,i.useCallback)(()=>{let e=new Blob([h],{type:"application/json"}),a=URL.createObjectURL(e),s=new Date().toISOString().replace(/[:.]/g,"-"),n="debug-".concat(t,"-").concat(s,".json"),i=document.createElement("a");i.href=a,i.download=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)},[h,t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"absolute top-6 bg-bg-100 right-16 flex items-center space-x-2",children:[(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:()=>{j(h)},prepend:(0,s.jsx)(W.u,{didCopy:b}),tooltip:(0,s.jsx)(g.A,{defaultMessage:"Copy debug information",id:"XVVZO6tEau"}),className:"ml-auto"}),(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:y,prepend:(0,s.jsx)(G.f5X,{}),tooltip:(0,s.jsx)(g.A,{defaultMessage:"Download debug information",id:"mmx3mC6aea"})}),(0,s.jsx)(ed,{messageUuid:a})]}),o?(0,s.jsx)("div",{className:"my-2 flex w-full items-center justify-center h-[32rem]",children:(0,s.jsx)(ea.Loading,{})}):(0,s.jsx)(en.A,{customStyle:{maxHeight:"32rem",fontSize:".875rem"},language:"json",PreTag:"div",style:p,children:h})]})}let ed=e=>{let{messageUuid:t}=e,{copyToClipboard:a}=(0,W.C)(),n=(0,h.A)(),r=(0,i.useCallback)(async()=>{let e=l.oz.getState().messageByUuid[t];if(!e)return;let s=(0,q.C)(e);await a(s)},[t,a]);return(0,s.jsx)(et.ms,{onCloseAutoFocus:e=>{e.preventDefault()},trigger:(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm","aria-label":n.formatMessage({defaultMessage:"More options",id:"IzCVhGdYVc"}),children:(0,s.jsx)(G.FOq,{})}),children:(0,s.jsxs)(et.tJ,{onSelect:r,children:[(0,s.jsx)(G.B0c,{}),(0,s.jsx)(g.A,{defaultMessage:"Copy unmodified message",id:"+yNntDpG9W"})]})})};var ec=a(0x17f3a2521),eu=a(0x8ca4d894);function ex(e){var t,a;let{conversationUuid:n,message:l}=e,[r,o]=(0,i.useState)(void 0),[d,c]=(0,i.useState)(!1),u=e=>{"flag"===e?(null==r?void 0:r.startsWith("flag"))||o(ec.kj.FLAG):r!==ec.kj.UPVOTE&&o(ec.kj.UPVOTE),c(!0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm",className:(null==(t=l.chat_feedback)?void 0:t.type.includes("upvote"))?"bg-bg-200 !text-accent-secondary-100":"",tooltip:(0,s.jsx)(g.A,{defaultMessage:"Give positive feedback",id:"FGCv00cdfW"}),onClick:()=>u("upvote"),prepend:(0,s.jsx)(G.twC,{size:16})}),(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm",className:(0,Y.A)((null==(a=l.chat_feedback)?void 0:a.type.includes("flag"))&&"bg-bg-200 !text-danger-100"),tooltip:(0,s.jsx)(g.A,{defaultMessage:"Give negative feedback",id:"ngzzQUJCXB"}),onClick:()=>u("flag"),prepend:(0,s.jsx)(G.SuN,{size:16})}),(0,s.jsx)(eu.B,{conversationUuid:n,message:l,requestedFeedbackType:r,setRequestedFeedbackType:o,isOpen:d,onClose:()=>c(!1)})]})}var ef=a(0x1b370f49d);function em(e){let{children:t,onClick:a,tooltipContent:n,Icon:i,disabled:l,"data-testid":r}=e,o=(0,s.jsx)(x.$,{variant:"ghost",size:"sm",className:"!font-base !px-2 !h-7 !min-w-0",onClick:a,disabled:l,"data-testid":r,children:i||t});return n?(0,s.jsx)(ef.Tooltip,{tooltipContent:n,children:o}):o}var ep=a(0x252daebb2),eh=a(0xb22529cb);function eg(e){let{paprikaMode:t,supportedPaprikaModes:a,onRetry:n,parentMessageUuid:l,setPaprikaModeState:r}=e,[o,d]=(0,i.useState)(!1),c=(0,eh.Wi)().filter(e=>e.paprika_mode_value&&e.paprika_mode_value!==t&&a.includes(e.paprika_mode_value)),u=(0,i.useCallback)((e,t)=>{n(e,t),r(t)},[n,r]);return(0,s.jsxs)(et.ms,{align:"start",unstyledTrigger:!0,onCloseAutoFocus:e=>e.preventDefault(),open:o,onOpenChange:d,trigger:(0,s.jsx)(x.$,{variant:"ghost",size:"sm",className:"!font-base select-none !pl-2 !pr-1",append:(0,s.jsx)(G.biH,{className:"text-text-500"}),children:(0,s.jsx)(g.A,{defaultMessage:"Retry",id:"62nsdyMyIO"})}),children:[(0,s.jsx)(et.tJ,{className:"text-sm",onClick:()=>n(l),children:(0,s.jsx)(g.A,{defaultMessage:"With no changes",id:"h3WdKJh51e"})}),c.map(e=>(0,s.jsx)(et.tJ,{className:"text-sm",onClick:()=>u(l,e.paprika_mode_value),children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex flex-col",children:"extended"===e.id?(0,s.jsx)(g.A,{defaultMessage:"With extended thinking",id:"/zFAxhC9JS",description:"Lets the user try again using a different thinking mode"}):"With ".concat(e.title.toLowerCase()," thinking")}),(0,s.jsx)("div",{className:"text-text-500 text-xs",children:e.description_key?(0,s.jsx)(ep.X5,{id:e.description_key}):e.description})]})},e.id))]})}var ev=a(0xd4b9b976),eb=a(0x1f22b8dda);let ej={default:{allowed:"never"}},ey=J.g1(J.Ik({allowed:J.k5(["never","first_turn","always"])})),ew=e=>{let{isStreaming:t,isLastMessage:a,isInteractive:n,isAssistant:i,children:l}=e;return(0,s.jsx)(H.N,{children:!t&&(0,s.jsx)(o.P.div,{className:"absolute bottom-0 right-2 pointer-events-none",initial:{scale:.95},animate:{scale:1},transition:{type:"spring",damping:30,stiffness:400},children:(0,s.jsx)("div",{className:(0,Y.A)("rounded-lg transition min-w-max pointer-events-auto",i?"translate-x-2":"translate-y-4 bg-bg-100/80 backdrop-blur-sm translate-x-1 group-hover:translate-x-0.5 border-0.5 border-border-300 p-0.5 shadow-sm",a?"translate-y-full pt-2":"opacity-0 group-hover:opacity-100"),children:l})})})},e_=(0,i.memo)(function(e){var t,a,n,o,d,c;let{message:u,previousMessage:f,conversationUuid:m,isStreaming:p,isTemporary:h=!1,onRetry:v,isLastMessage:b,isLastHumanMessage:j,isInteractive:y=!0,changeDisplayedConversationPath:w,editMessage:_,editable:k=!1,isFirstAssistantMessage:M,isResearchPending:C,model:N,extendedThinkingSetting:S,showArtifacts:A=!1,chatFeedbackEnabled:E}=e,[T,z]=(0,i.useState)(!1),{track:R}=(0,B.st)(),I="human"===u.sender,U="assistant"===u.sender,L=p&&b,O=(0,r.fS)("anthropic_internal_only_expose_chat_debug"),F=!p&&(null!=(o=u.nOptions)?o:0)>1&&w,P=!p&&!C&&k&&_&&u.parent_message_uuid&&y,Y=null==u||null==(t=u.content)?void 0:t.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),H=!p&&!C&&y&&!Y,J=H&&I&&!b&&!u.pending,Z=(0,i.useCallback)((e,t,a)=>{R({event_key:"claudeai.message.user_triggered_retry",is_last_human_message:"assistant_message_footer"===e?b:j,source:e}),v(t,a)},[R,j,b,v]),{didCopy:Q,copyToClipboard:$}=(0,W.C)(),ee=(0,i.useCallback)(async()=>{let e=l.oz.getState().messageByUuid[u.uuid],t=(0,q.C)(e),a=(A?(0,V.it)(t):t).trim();try{let e=(0,ev.u)(a);await $({text:a,html:e})}catch(e){await $(a)}},[A,u.uuid,$]),et=(0,K.QY)(),{toggleConversationSetting:ea}=(0,X.rX)({source:"messageActionBar"}),es=(0,i.useCallback)(e=>{ea("paprika_mode",null!=e?e:null)},[ea]),{allModelOptions:en}=(0,D.A9)(),ei=(0,r.iW)("claude_ai_paprika_retry",ej,ey),el=(0,eb.Z)(m),eo=null!=(c=null!=(d=N&&(null==(a=ei[N])?void 0:a.allowed))?d:null==(n=ei.default)?void 0:n.allowed)?c:"never";if(I&&!P&&!J&&!F)return null;let ed=en.find(e=>e.model===N),ec=null==ed?void 0:ed.paprika_modes,eu=ec&&ec.length>0&&!S&&("always"===eo||"first_turn"===eo&&M);return(0,s.jsx)(ew,{isStreaming:L,isLastMessage:b,isInteractive:y,isAssistant:U,children:(0,s.jsxs)("div",{className:"text-text-300 flex items-stretch justify-between",children:[U&&O&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm",tooltip:(0,s.jsx)(g.A,{defaultMessage:"Debug",id:"z3UjXRZwzQ"}),onClick:()=>z(!0),prepend:(0,s.jsx)(G.IFY,{})}),(0,s.jsx)(er,{isOpen:T,onClose:()=>z(!1),messageUuid:u.uuid,conversationUuid:m})]}),!el&&I&&(P||J)&&(0,s.jsxs)("div",{className:"flex items-center",children:[J&&(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:()=>Z("human_message_hover",u.uuid),tooltip:(0,s.jsx)(g.A,{defaultMessage:"Retry",id:"62nsdyMyIO"}),prepend:(0,s.jsx)(G.MvQ,{})}),P&&(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:()=>_(u,"test edit message"),tooltip:(0,s.jsx)(g.A,{defaultMessage:"Edit",id:"wEQDC6Wv3/"}),prepend:(0,s.jsx)(G.ffu,{})})]}),U&&(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:ee,"data-testid":"action-bar-copy",tooltip:(0,s.jsx)(g.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),prepend:(0,s.jsx)(W.u,{didCopy:Q})}),U&&!L&&!C&&y&&"error"!==u.stop_reason&&(void 0!==E?E:et)&&!h&&(0,s.jsx)(ex,{conversationUuid:m,message:u}),(0,s.jsxs)("div",{className:"flex items-center",children:[F&&(0,s.jsx)(ek,{message:u,changeDisplayedConversationPath:w}),U&&H&&(eu?(0,s.jsx)(eg,{paprikaMode:S,supportedPaprikaModes:ec,onRetry:(e,t)=>Z("assistant_message_footer",null!=e?e:void 0,t),parentMessageUuid:u.parent_message_uuid,setPaprikaModeState:es}):(0,s.jsx)(em,{onClick:()=>{Z("assistant_message_footer",u.parent_message_uuid)},children:(0,s.jsx)(g.A,{defaultMessage:"Retry",id:"62nsdyMyIO"})}))]})]})})});function ek(e){var t;let{message:a,changeDisplayedConversationPath:n}=e,i=(null!=(t=a.selectedOption)?t:0)+1,l=i===a.nOptions,r=(0,h.A)();return(0,s.jsxs)("div",{className:"inline-flex items-center gap-1",children:[(0,s.jsx)(x.$,{variant:"ghost",size:"icon_xs",disabled:1===i,onClick:()=>n(a,-1),"aria-label":r.formatMessage({defaultMessage:"Previous",id:"JJNc3cbYIJ"}),children:(0,s.jsx)(G.ZK0,{})}),(0,s.jsx)("span",{className:"self-center shrink-0 select-none font-small text-text-300",children:(0,s.jsx)(g.A,{defaultMessage:"{selectedOption} / {totalOptions}",id:"0zCqdBEnn7",values:{selectedOption:i,totalOptions:a.nOptions}})}),(0,s.jsx)(x.$,{variant:"ghost",size:"icon_xs",disabled:l,onClick:()=>n(a,1),"aria-label":r.formatMessage({defaultMessage:"Next",id:"9+DdtuCqLw"}),children:(0,s.jsx)(G.K3R,{})})]})}var eM=a(0x1d0c32e96),eC=a(0x15d5dbe20),eN=a(0x78b33fbd),eS=a(0x1334f6ecc);let eA=()=>{let e=(0,B.st)(),{initDriveAuth:t}=(0,eS.cI)({});return(0,i.useEffect)(()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.displayed"})},[e]),(0,s.jsx)(eE,{title:(0,s.jsx)(g.A,{defaultMessage:"Add context from all your docs more easily",id:"gHPka72Ai9"}),icon:(0,s.jsx)(eC.g,{size:18}),cta:(0,s.jsxs)(x.$,{className:"bg-bg-100 border-border-300",size:"sm",variant:"secondary",onClick:()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.start"}),t()},children:[(0,s.jsx)(eM.ft,{size:16,className:"mr-1"}),(0,s.jsx)(g.A,{defaultMessage:"Connect Drive",id:"XzTB2bvNw1"})]})})},eE=e=>{let{title:t,icon:a,cta:n}=e;return(0,s.jsx)(o.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-3",children:(0,s.jsx)("div",{className:"overflow-hidden rounded-lg border-0.5 border-border-300 bg-bg-100 shadow-sm",children:(0,s.jsx)("div",{className:"px-2.5 py-2.5",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"rounded-lg bg-primary-100 p-1",children:a}),(0,s.jsx)("h3",{className:"text-sm text-text-100",children:t})]}),n]})})})})},eT=e=>{let{previousMessage:t}=e,a=(0,eS.LP)(),{isDriveAuthenticated:n}=(0,eS.cI)({}),l=(0,i.useMemo)(()=>!!t&&t.attachments.some(e=>"docx"===e.file_type),[t]),o=(0,r.fS)("pumpernickel_enabled"),d=(0,eN.useLayer)("trials_freemium").get("free_integrations",!1);return(o||d)&&a&&!n&&l?(0,s.jsx)(eA,{}):null};var ez=a(0x132beb2b5),eR=a(0x401a1006);function eI(e){let{message:t,conversationUuid:a,isStreaming:r}=e,{track:o}=(0,B.st)(),d=(e=>{var t;if("assistant"!==e.sender)return!1;let a=null==(t=e.content)?void 0:t.some(e=>{var t,a;if("text"===(t=e).type||"thinking"===t.type||"tool_use"===t.type){return null==(a=e.flags)?void 0:a.includes("self_harm_risk")}return!1});return null!=a&&a})(t),[c,u]=(0,i.useState)(!1),x=(0,i.useRef)(!1),f=(()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid;return(0,Z.L2)(e=>"/api/organizations/".concat(t,"/chat_conversations/").concat(e.conversationUuid,"/chat_messages/").concat(e.messageUuid,"/flags"),"DELETE",{enabled:!!t,transformVariables:e=>({flag_name:e.flagName}),meta:{noToast:!0}})})(),m=(0,l.gP)();(0,i.useEffect)(()=>{!d||c||r||x.current||(o({event_key:"claudeai.safety.self_harm_banner.viewed",conversation_uuid:a,message_uuid:t.uuid}),x.current=!0)},[d,c,r,a,t.uuid,o]);let p=(0,i.useCallback)(()=>{o({event_key:"claudeai.safety.self_harm_banner.dismissed",conversation_uuid:a,message_uuid:t.uuid}),u(!0),f.mutate({conversationUuid:a,messageUuid:t.uuid,flagName:"self_harm_risk"},{onSuccess:()=>{var e;let a=l.oz.getState().messageByUuid[t.uuid];if(!a)return;let s={...a,content:null==(e=a.content)?void 0:e.map(e=>"flags"in e&&Array.isArray(e.flags)&&e.flags.includes("self_harm_risk")?{...e,flags:e.flags.filter(e=>"self_harm_risk"!==e)}:e)};m(t.uuid,s)}})},[a,t.uuid,o,f,m]),h=(0,i.useCallback)(()=>{o({event_key:"claudeai.safety.self_harm_banner.resources_clicked",conversation_uuid:a,message_uuid:t.uuid})},[a,t.uuid,o]);return!d||c||r?null:(0,s.jsx)("div",{className:"mb-3 mt-3",children:(0,s.jsx)(eR.l,{pictogram:ez.v5,message:(0,s.jsx)(g.A,{defaultMessage:"If you or someone you know is having a difficult time, support is available.",id:"2H7uH+vuKu"}),button:{href:"https://findahelpline.com",target:"_blank",onLinkClick:h,children:(0,s.jsx)(g.A,{defaultMessage:"Find resources",id:"ViSIod1c4W"})},onClose:p})})}let eU=e=>{let{title:t,text:a}=e,n=(0,h.A)();t=t||n.formatMessage({defaultMessage:"Untitled note",id:"fkEfiUjl/t"}),a=a||"";let{didCopy:i,copyToClipboard:l}=(0,W.C)(),r=async()=>{let e=t+"\n"+a;try{let t=(0,ev.u)(e);await l({text:e,html:t})}catch(t){await l(e)}};return(0,s.jsxs)("div",{className:"group relative mt-4 mb-1 rounded-2xl border-border-300/25 border font-claude-response-body",children:[(0,s.jsxs)("div",{className:"pt-1 pb-1 px-3 border-b-0.5 border-border-300/25 font-semibold flex justify-between items-center",children:[(0,s.jsx)("span",{className:"flex-1",children:t}),(0,s.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:r,children:(0,s.jsx)(W.u,{didCopy:i})})]}),(0,s.jsx)(v.o,{className:"px-4 pt-2 pb-4",children:a})]})};var eL=a(0xb844abc8),eO=a(0x1a3383306),eF=a(0x1936feed4),eP=a(0x1a2392a8c),eD=a(0xfd3b48b7),eB=a(0x15068fa65);let eG=(0,i.memo)(e=>{let{selection:t,activeRange:a,onOpen:n,showAddToPrompt:l,disableExplain:r}=e,o=(0,i.useRef)(null),{track:d}=(0,B.st)(),c=(0,i.useCallback)(()=>{if(!o.current||!a.current)return;let e=a.current.getBoundingClientRect(),t=e.left+e.width/2,s=e.top-40;o.current.style.transform="translate(".concat(t,"px, ").concat(s,"px) translateX(-50%)")},[a]),u=(null==t?void 0:t.text.length)||0;if((0,i.useEffect)(()=>{u<=1||d({event_key:"claudeai.mini_claude.tooltip_impression",selection_length:u})},[u,d]),(0,i.useEffect)(()=>{if(t)return c(),window.addEventListener("scroll",c,!0),window.addEventListener("resize",c),()=>{window.removeEventListener("scroll",c,!0),window.removeEventListener("resize",c)}},[t,c]),!t||!a.current)return null;let x=!r;return x||l?(0,eB.createPortal)((0,s.jsx)("div",{ref:o,"data-selection-tooltip":"true",style:{position:"fixed",top:0,left:0,pointerEvents:"auto",willChange:"transform"},children:(0,s.jsxs)("div",{className:"flex bg-always-black/80 rounded-lg shadow-lg backdrop-blur border border-always-white/10 text-always-white items-center",children:[x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-px bg-always-white/20 my-1.5 self-stretch"}),(0,s.jsx)("button",{onClick:()=>n("explain"),className:"px-3 py-1.5 text-sm font-medium text-always-white hover:bg-always-white/10 transition-colors cursor-pointer border-none whitespace-nowrap flex ".concat(l?"rounded-l-lg":"rounded-lg"),children:(0,s.jsx)(g.A,{defaultMessage:"Tell me more",id:"k82q+r212G",description:"Button to explain selected text"})})]}),l&&(0,s.jsxs)(s.Fragment,{children:[x&&(0,s.jsx)("div",{className:"w-px bg-always-white/20 my-1.5 self-stretch"}),(0,s.jsxs)("button",{onClick:()=>n("addToPrompt"),className:"px-3 py-1.5 text-sm font-medium text-always-white hover:bg-always-white/10 transition-colors cursor-pointer border-none whitespace-nowrap flex items-center gap-1 ".concat(x?"rounded-r-lg":"rounded-lg"),children:[(0,s.jsx)(g.A,{defaultMessage:"Reply",id:"jNnlTJdFg7",description:"Button to bring the selected text into the chat input as a quote block"}),(0,s.jsx)(eD.Y,{"aria-hidden":"true"})]})]})]})}),document.body):null});eG.displayName="SelectionTooltip",(0,i.memo)(e=>{let{conversationUuid:t,children:a,disableExplain:n}=e,l=(0,i.useRef)(null),{selection:r,clearSelection:o,activeRange:d}=function(e){let[t,a]=(0,i.useState)(null),s=(0,i.useRef)(null),n=(0,i.useRef)(null),l=(0,i.useCallback)(t=>{if(t.target.closest('[data-selection-tooltip="true"]'))return;let i=window.getSelection(),l=(null==i?void 0:i.toString().trim())||"";if(!i||0===i.rangeCount||!l||l.length<2||!e.current){a(null),s.current=null,n.current=null;return}let r=i.getRangeAt(0),o=e.current,d=r.startContainer.nodeType===Node.TEXT_NODE?r.startContainer.parentNode:r.startContainer;if(!d||!o.contains(d)){a(null),s.current=null,n.current=null;return}if(null!==n.current&&l===n.current){a(null),s.current=null,n.current=null,i.removeAllRanges();return}let c=r.getBoundingClientRect();s.current=r,n.current=l,a({text:l,rect:c})},[e]),r=(0,i.useCallback)(()=>{var e;a(null),s.current=null,n.current=null,null==(e=window.getSelection())||e.removeAllRanges()},[]);return(0,i.useEffect)(()=>{if(e.current)return document.addEventListener("mouseup",l),()=>{document.removeEventListener("mouseup",l)}},[e,l]),{selection:t,clearSelection:r,activeRange:s}}(l),c=(0,i.useRef)(null),[u,x]=(0,i.useState)(null),[f,m]=(0,i.useState)(null),{track:p}=(0,B.st)(),h=void 0!==(0,ei.jw)(),g=n||(0,eL.Fr)();(0,i.useEffect)(()=>{},[]);let v=(0,ei.Tc)(e=>e.promptInputRef,"MiniClaudeContainer"),b=(0,ei.Tc)(e=>e.setAttachments,"MiniClaudeContainer"),j=(0,i.useCallback)(e=>{var t;if(!r)return;let a=window.getSelection(),s=null==v||null==(t=v.current)?void 0:t.getEditor();switch(e){case"explain":if(g)return;a&&a.rangeCount>0&&(c.current=a.getRangeAt(0)),x({selectedText:r.text,action:e});break;case"addToPrompt":if(!h)return;if(s&&(null==v?void 0:v.current)){let e=new Blob([r.text]).size,t={file_name:eP.jP,file_size:e,file_type:"txt",extracted_content:r.text,origin:eO.R.UserUpload};b(e=>[...e,t]),s.commands.focus()}o();break;default:(0,eF.x)(e)}p({event_key:"claudeai.mini_claude.selection_action",selection_length:r.text.length,action:e})},[v,o,h,r,p,g,b]);return(0,i.useCallback)(()=>{x(null),c.current=null},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{ref:l,className:"contents",children:[a,!u&&(0,s.jsx)(eG,{selection:r,activeRange:d,onOpen:j,showAddToPrompt:h,disableExplain:g})]}),""]})}).displayName="MiniClaudeContainer";var eW=a(0x249008d3),eV=a(0x214374164),eq=a(0x2129aebe2),eY=a(0x2202d81f6),eH=a(0xbca8e388),eJ=a(0x1b643ff5e),eK=a(0x17774dcd8),eX=a(0x2524bdea9),eZ=a(0x14c0dfde7),eQ=a(0x1d302b010),e$=a(0x25062734b),e0=a(0x9f889a90),e1=a(0xe824fb1c);let e2=(0,i.memo)(e=>{var t,a,n;let{conversationUuid:l,block:r,message:o,updatedMessage:d,index:c,shareType:u,isStreaming:x,isLastMessage:f,publishedArtifacts:m,isFirstBlockOfMessage:p,isLastBlockOfMessage:h,renderMode:g,isFirstItemInGroup:v,isLastItemInGroup:b}=e,j=(0,eK.nb)(),{renderToolUseCell:y}=(0,eX.Q)(),w=(0,eJ.Y)(r),_=r.name,k=r.id,M=r.context,C=null==(t=d.content)?void 0:t[c+1],N=(null==C?void 0:C.type)==="tool_result"?C:void 0,S=function(e,t,a,s,n,l){let r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=null!=l?l:"{}",d=(0,el.M)(),{track:c}=(0,B.st)(),u=(0,eZ.p9)(),{mutate:x}=(0,eQ.p4)(e),{toggleMcpToolAlwaysApproved:f}=(0,e$.es)(),[m,p]=(0,i.useState)(r),h=(0,e1.pK)(t),g=(null==h?void 0:h.tool)||null,v=(null==h?void 0:h.server)||null,b=u&&(null==v?void 0:v.uuid)&&!(0,e1.HG)(null==v?void 0:v.uuid,u)&&(null==v?void 0:v.type)==="remote",j=(0,e$.yr)()(v,g),y=s?s.includes("always"):!!j.showAlwaysAllowed,w=!!a,_=w&&!!g&&(u&&(null==v?void 0:v.type)==="remote"&&!(0,e1.HG)(v.uuid,u)?!!s&&!!n:j.approvalRequired),k=(0,i.useCallback)(s=>{if(w&&g&&!m){if("always"!==s||n||f(g.alwaysApprovedKey,!0),"deny"===s)if(b)x({tool_use_id:a,is_approved:!1,approval_key:n});else{var i;d(e,t,a,o,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),c({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!=(i=(0,e0.p)(o))?i:{}).length})}else b?x({tool_use_id:a,is_approved:!0,approval_key:n,approval_option:s}):d(e,t,a,o);p(!0)}},[w,m,g,n,f,b,x,d,e,t,a,o,c,p]),M=w&&!_&&!m&&!b&&!!l,C=(0,eb.Z)(e);return M&&(d(e,t,a,o),p(!0)),(0,i.useMemo)(()=>({approvalRequired:_&&!m,disabled:!l,submitToolApproval:k,showAlwaysAllowed:y}),[_,l,m,k,y,C])}(l,r.name,r.id,r.approval_options,r.approval_key,r.buffered_input,!!N),A=j?void 0:S,E=!!d.content&&d.content.length<=c+1&&x,T=((e,t,a)=>{var s,n,i,l;let r,o,d,c=(null==t?void 0:t.type)==="tool_use"&&(null==t?void 0:t.name)==="artifacts",u=(null==e?void 0:e.type)==="tool_use"&&(null==e?void 0:e.name)==="artifacts";a.partial_json?a.partial_json.includes('"command":"create"')&&(r=(e=>{let t=e.match(/"id"\s*:\s*"([^"]*)"/);return t?t[1]:void 0})(a.partial_json)):r=null==(n=a.input)?void 0:n.id,u&&(o=null==e||null==(i=e.input)?void 0:i.id),!c||(null==t?void 0:t.partial_json)||(d=null==t||null==(l=t.input)?void 0:l.id);let x=r===o,f=r===d,m="individual_cell_create",p=null==(s=a.input)?void 0:s.command;if(p&&(m=({create:"individual_cell_create",update:"individual_cell_update",rewrite:"individual_cell_rewrite"})[p]),!c&&!u)return m;if(c&&u)if(!x&&!f)return m;else if(x&&!f)return"multi_edit_last";else return"multi_edit_not_last";if(c&&!u)if(!f)return m;else return"multi_edit_not_last";if(!c&&u&&x)return"multi_edit_last";return m})(null==(a=d.content)?void 0:a[c-2],null==(n=d.content)?void 0:n[c+2],r);if(!y)throw Error("renderToolUseCell() is not provided, missing ChatMessageContext?");let z=(0,i.useMemo)(()=>y({toolUseId:k,input:w,isLastMessage:f,message:o,publishedArtifacts:m,isStreaming:E,toolName:_,toolResult:N,displayData:{integrationName:r.integration_name,integrationIcon:r.integration_icon_url,message:(null==N?void 0:N.message)||r.message,input:r.display_content,result:null==N?void 0:N.display_content},approvalData:A,artifactCellType:T,isFirstBlockOfMessage:p,isLastBlockOfMessage:h,shareType:u,context:M,renderMode:g,groupItemKey:String(c),isFirstItemInGroup:v,isLastItemInGroup:b}),[A,T,r.display_content,r.integration_icon_url,r.integration_name,r.message,M,c,w,p,v,h,b,f,o,m,g,y,u,E,_,N,k]);return(0,s.jsx)(i.Fragment,{children:z})});e2.displayName="ToolUse";var e3=a(0xb4b79508),e4=a(0x16a96a9a2),e5=a(0x18b9bd76),e6=a(0xede65b);function e8(e){let{text:t,conversationUuid:a,onOpen:n,onDownloadAll:l,shareType:r,presentFiles:o}=e,d=(0,i.useMemo)(()=>[...(0,e6.n)(t),...null!=o?o:[]].filter(e=>(0,e4.m)(e,r)),[t,r,o]);return 0===d.length?null:(0,s.jsxs)("div",{className:"flex flex-col gap-2 py-2",children:[d.map(e=>{let t=e.split("/").pop()||e;return(0,s.jsx)(e5._,{conversationUuid:a,file:{name:t,path:e},onOpen:()=>{n(e)},isShared:!!r},e)}),d.length>1&&(0,s.jsx)("div",{children:(0,s.jsx)(x.$,{variant:"secondary",prepend:(0,s.jsx)(e3.e,{size:"1.1rem"}),onClick:()=>{l(d)},children:(0,s.jsx)(g.A,{defaultMessage:"Download all",id:"V1UrPNM96z"})})})]})}var e9=a(0x1f507121),e7=a(0xec9172c1),te=a(0x16801a2b9),tt=a(0x20805e624),ta=a(0xbe2d73b0),ts=a(0x46988392);let tn=["year","month","day","hour","minute","second","millisecond"],ti=e=>{let{value:t,...a}=e;return function(e,t){let{listStyle:a,...s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=ts.dw.fromDurationLike(t);return e.formatList(tn.filter(e=>0!==n["".concat(e,"s")]).map(t=>e.formatNumber(n["".concat(t,"s")],{...s,style:"unit",unit:t})),{...s,style:a})}((0,h.A)(),t,a)};var tl=a(0xc6536c20),tr=a(0xef41e510),to=a.n(tr),td=a(0x1e140f433),tc=a(0x1f7748bd);function tu(){let e=(0,d._)(["\nbg-bg-100 text-text-300 border-0.5 border-border-300 flex flex-row gap-1.5 rounded-md p-2 mx-4 mb-4 font-small"]);return tu=function(){return e},e}function tx(e,t){if(!e)return;let a=(t?tl.c9.fromISO(t):tl.c9.now()).diff(tl.c9.fromISO(e),["hours","minutes","seconds"]);return 0>a.toMillis()?tl.dw.fromMillis(0):a}let tf=u.J.div(tu()),tm=()=>(0,s.jsxs)(tf,{"data-testid":"message-warning",children:[(0,s.jsx)(G.R2D,{className:"shrink-0",size:16}),(0,s.jsx)(g.A,{defaultMessage:"The rest of the <link>thought process</link> is not available for this response.",id:"G/67Pe5XhQ",values:{link:e=>(0,s.jsx)(to(),{href:"https://support.anthropic.com/en/articles/10574485-using-extended-thinking-on-claude-3-7-sonnet",className:"underline",target:"_blank",children:e})}})]}),tp=e=>{let{text:t,cutOff:a}=e;return(0,s.jsxs)("div",{className:"text-text-300 text-sm font-normal gap-0.5 relative font-claude-response",children:[(0,s.jsx)(eH.fP,{className:"p-3 pt-0 pr-8",text:t}),!0!==a?null:(0,s.jsx)(tm,{})]})},th=(0,i.memo)(e=>{let t,{index:a,text:n,cutOff:l=!1,startTimestamp:r,stopTimestamp:d,isStreaming:c,mostRecentSummary:u,onToggle:x,messageUuid:f,isFirstBlockOfMessage:m,isLastBlockOfMessage:p,renderMode:g=eW.l.Standard,isFirstItemInGroup:v,isLastItemInGroup:b,conversationUuid:j}=e,y=(0,eN.useDynamicConfig)("claudeai_isp_thinking_ux"),w=y.get("enabled",!1),_=(0,h.A)(),k=_.formatMessage({defaultMessage:"Thinking",id:"AHQWDTo4+e"}),M=_.formatMessage({defaultMessage:"Thinking...",id:"QrZMdiKa7h"}),C=_.formatMessage({defaultMessage:"Thought process",id:"zl6fNbo7RW"}),{isExpanded:N,setIsExpanded:S,snappyTransition:A}=(0,tc.a)(!w&&c,String(a)),E=(0,B.st)(),[T,z]=(0,i.useState)(()=>tx(r,d)),R=(0,i.useRef)(void 0),I=(0,i.useRef)(!1),[U,L]=(0,i.useState)(null),O=(0,i.useRef)([]);(0,i.useEffect)(()=>{(0,tt.GN)(f)&&O.current.length>0&&(O.current.forEach(e=>{E.track({event_key:"claudeai.thinking_cell.clicked",is_opening:e.isOpening,is_streaming:e.wasStreamingWhenClicked,chat_message_uuid:f,timestamp:e.timestamp})}),O.current=[])},[f,E]),(0,i.useEffect)(()=>{c&&(I.current=!0)},[c]);let F=c||I.current?y.get("fallback_summary_debounce_ms",2e3):0;(0,ta.W)(()=>{!c&&n.length>0&&L(tg(n,y))},[n,c],F),(0,i.useEffect)(()=>{let e=()=>{let e=tx(r,void 0);R.current=e,z(e)};if(c){e();let t=setInterval(e,1e3);return()=>clearInterval(t)}!R.current&&d&&z(tx(r,d))},[r,d,c]);let P=null==u?void 0:u.summary,D=(0,eb.Z)(j);if(D)t=n;else if(w)if(c)t=null!=P?P:M;else{var W;t=null!=(W=null!=P?P:U)?W:M}else t=null!=P?P:c?k:C;return(0,s.jsx)(td.sH,{isStreaming:c,isExpanded:N,setIsExpanded:()=>{let e=new Date().toISOString();(0,tt.GN)(f)?E.track({event_key:"claudeai.thinking_cell.clicked",is_opening:!N,is_streaming:c,chat_message_uuid:f,timestamp:e}):O.current.push({isOpening:!N,wasStreamingWhenClicked:c,timestamp:e}),S(!N)},isFirstBlockOfMessage:m,isLastBlockOfMessage:p,text:N?C:!D&&(c||R.current)?(0,s.jsx)(H.N,{mode:"wait",children:(0,s.jsx)(o.P.span,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.3,ease:"easeIn"},className:w?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t},t)}):(0,s.jsx)("span",{className:w?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t}),secondaryText:T&&T.as("seconds")>=10?(0,s.jsxs)("span",{className:"flex items-center gap-1 transition-opacity",children:[(0,s.jsx)(G.Sw4,{className:(0,Y.A)("text-text-300 transition-all duration-300 ease-in-out opacity-50",c?"!opacity-0 scale-50":"scale-100 opacity-100"),size:12}),(0,s.jsx)("span",{className:"tabular-nums",children:(0,s.jsx)(ti,{value:T,listStyle:"narrow",unitDisplay:"narrow",maximumFractionDigits:0})})]}):void 0,renderMode:g,isFirstItemInGroup:v,isLastItemInGroup:b,children:(0,s.jsx)(td.NG,{isExpanded:N,snappyTransition:A,onTransitionEnd:x,isScrollable:!0,children:(0,s.jsx)(tp,{text:n,cutOff:l})})})});th.displayName="ThinkingCell";let tg=(e,t)=>{let a=t.get("fallback_summary_min_len",50),s=t.get("fallback_summary_max_len",100),n=new RegExp(t.get("fallback_summary_regex",".*(\\n|\\.(\\s|$)|)")),i=e.substring(0,s),l=n.exec(i);if(l)return l[0];for(let e=i.length-1;e>=a;e--)if(/\s/.test(i[e]))return i.substring(0,e+1);return i},tv=(0,i.memo)(e=>{var t;let a,{block:n,index:i,isThisMessageStreaming:l,blocksCount:o}=e;if(!(0,r.fS)("empty_your_cup")||"text"!==n.type&&"thinking"!==n.type&&"tool_use"!==n.type||!(!l||i<o-1))return null;let d=new Set(null!=(t=n.flags)?t:[]);return(d.has("a2")?a=(0,s.jsx)(ep.YX,{id:"curvature_propulsion_drive"}):d.has("a1")&&(a=(0,s.jsx)(ep.YX,{id:"bubble_universe_portal"})),a)?(0,s.jsx)("div",{className:"px-1.5 py-0.5 mx-2 my-1 opacity-80 text-xs font-ui bg-danger-900 text-danger-000 rounded border-0.5 border-danger-200 select-none",children:a},"flag-".concat(i)):null});tv.displayName="FlagMessage";let tb=(0,i.memo)(e=>{let{block:t,index:a,blocks:l,isStreaming:r,isThisMessageStreaming:o,isLastMessage:d,updatedMessage:c,message:u,onResize:x,conversationUuid:f,shareType:m,publishedArtifacts:p,onOpenArtifact:h,onOpenWiggleFile:g,presentFiles:v,...b}=e,{renderMode:j,isFirstItemInGroup:y,isLastItemInGroup:w}=b,{setMessageFeatures:_}=(0,S.Bk)(),k=l[a+1],M=l.length,C=(null==k?void 0:k.type)==="tool_result",N=0===a,A=!!M&&a===M-1-!!C,E=(0,i.useCallback)(e=>null==h?void 0:h(e,c.uuid),[h,c.uuid]),T=(0,i.useCallback)(()=>{_(u.uuid,{hasLink:!0})},[_,u.uuid]),z=(0,i.useCallback)(()=>{_(u.uuid,{hasCode:!0})},[_,u.uuid]),{activeOrganization:R}=(0,n.YL)(),{dispatchChatResource:I}=(0,te.i)(),{setIsDrawerExpanded:U}=(0,e7.x)(),L=(0,i.useCallback)((e,t)=>{t.startsWith("computer://")&&(null==R?void 0:R.uuid)&&(e.preventDefault(),I({type:"SELECT_FILE",path:t.replace("computer://",""),toolType:"create_file",messageId:c.uuid}),U(!0))},[null==R?void 0:R.uuid,I,U,c.uuid]),O=(0,e9._)(),F=(0,i.useCallback)(e=>{(null==R?void 0:R.uuid)&&O(m?{filepaths:e,orgUuid:null==R?void 0:R.uuid,snapshotUuid:f,isShared:!0,source:"wiggle_file_card_download_all"}:{filepaths:e,orgUuid:null==R?void 0:R.uuid,conversationUuid:f,isShared:!1,source:"wiggle_file_card_download_all"})},[null==R?void 0:R.uuid,m,f,O]),P=(0,i.useCallback)(()=>{null==x||x()},[x]),D=(0,i.useCallback)(e=>{null==g||g(e,u.uuid)},[g,u.uuid]),B=(0,i.useCallback)(e=>{null==F||F(e)},[F]),G=(0,i.useMemo)(()=>{switch(t.type){case"thinking":var e;return(0,s.jsx)(th,{index:a,text:t.thinking,cutOff:t.cut_off,startTimestamp:t.start_timestamp,stopTimestamp:t.stop_timestamp,isStreaming:o&&!t.stop_timestamp,mostRecentSummary:null==(e=t.summaries)?void 0:e.at(-1),messageUuid:c.uuid,onToggle:P,isFirstBlockOfMessage:N,isLastBlockOfMessage:A,renderMode:j,isFirstItemInGroup:y,isLastItemInGroup:w,conversationUuid:f},a);case"tool_use":return(0,s.jsx)(e2,{conversationUuid:f,block:t,message:u,updatedMessage:c,index:a,shareType:m,isStreaming:r,isLastMessage:d,publishedArtifacts:p,isFirstBlockOfMessage:N,isLastBlockOfMessage:A,renderMode:j||eW.l.Standard,isFirstItemInGroup:y,isLastItemInGroup:w},a);case"text":if(0===a&&""===t.text)return;return(0,s.jsxs)(i.Fragment,{children:[o?(0,s.jsx)(eY.qO,{text:t.text,blockCitations:t.citations,onLinkDetected:T,onCodeDetected:z,className:"progressive-markdown",isStreaming:r,onOpenArtifact:E,isLastMessage:d,publishedArtifacts:void 0,onLinkClick:L}):(0,s.jsx)(eH.fP,{text:t.text,blockCitations:t.citations,onLinkDetected:T,onCodeDetected:z,className:"standard-markdown",isStreaming:r,onOpenArtifact:E,isLastMessage:d,publishedArtifacts:p,onLinkClick:L}),(0,s.jsx)(e8,{text:t.text,onOpen:D,conversationUuid:f,onDownloadAll:B,shareType:m,presentFiles:A?v:void 0})]},"".concat(a,"-").concat(o?"streaming":"static"));default:return null}},[t,f,a,N,y,A,w,d,r,o,u,z,B,L,T,E,D,P,v,p,j,m,c]);return(0,s.jsxs)(s.Fragment,{children:[G,(0,s.jsx)(tv,{block:t,blocksCount:l.length,index:a,isThisMessageStreaming:o})]})});tb.displayName="Block";let tj=(0,i.memo)(e=>{let{blocks:t,isStreaming:a,isThisMessageStreaming:n,isLastMessage:l,updatedMessage:o,message:d,onResize:c,conversationUuid:u,shareType:x,publishedArtifacts:f,onOpenArtifact:m,onOpenWiggleFile:p}=e,h=(0,eN.useDynamicConfig)("claudeai_isp_thinking_ux"),g=(0,r.fS)("claudeai_collapse_timeline_groups"),v=(0,i.useMemo)(()=>{let e=[],a=new Set;return t.forEach((s,n)=>{if(!a.has(n))if((0,eV.Ih)(s,h)){let i={items:[{block:s,index:n,renderable:(0,eV.h4)(s)}],startIndex:n,isLastBlockOfMessage:!1};for(let e=n+1;e<t.length;e++){let s=t[e];if(!(0,eV.Ih)(s,h))break;i.items.push({block:s,index:e,renderable:(0,eV.h4)(s)}),a.add(e),e===t.length-1&&(i.isLastBlockOfMessage=!0)}let l=i.items.findLastIndex(e=>"tool_use"===e.block.type&&"artifacts"===e.block.name);l>=0&&(i.items=i.items.slice(0,l),i.items.forEach(e=>{"tool_use"===e.block.type&&"artifacts"===e.block.name&&(e.renderable=!1)})),0===i.items.filter(e=>e.renderable).length?e.push({type:"single",content:s,index:n}):e.push({type:"group",content:i,index:n})}else e.push({type:"single",content:s,index:n})}),e},[t,h]),b=(0,eq.a)(d),j=(0,i.useMemo)(()=>(0,eq.G)(d),[b]);return(0,s.jsx)(s.Fragment,{children:v.map(e=>{if("group"===e.type){let i=e.content,r=i.items.filter(e=>e.renderable);if(r.length<=1){let r=i.items[0];return r?(0,s.jsx)(tb,{block:r.block,index:r.index,blocks:t,isLastMessage:l,isStreaming:a,isThisMessageStreaming:n,updatedMessage:o,message:d,onResize:c,conversationUuid:u,shareType:x,publishedArtifacts:f,onOpenArtifact:m,onOpenWiggleFile:p,presentFiles:j},"block-".concat(e.type,"-").concat(e.index)):null}return(0,s.jsx)(eV.DT,{isFirstBlockOfMessage:0===i.startIndex,isLastBlockOfMessage:i.isLastBlockOfMessage,isStreaming:a,children:r.map((e,i)=>{let h=g&&r.length>2;return(0,s.jsx)(tb,{block:e.block,index:e.index,blocks:t,renderMode:eW.l.TimelineGroup,isFirstItemInGroup:0===i&&!h,isLastItemInGroup:i===r.length-1,isLastMessage:l,isStreaming:a,isThisMessageStreaming:n,updatedMessage:o,message:d,onResize:c,conversationUuid:u,shareType:x,publishedArtifacts:f,onOpenArtifact:m,onOpenWiggleFile:p,presentFiles:j},e.index)})},"block-".concat(e.type,"-").concat(e.index))}return(0,s.jsx)(tb,{block:e.content,index:e.index,blocks:t,onResize:c,conversationUuid:u,shareType:x,publishedArtifacts:f,onOpenArtifact:m,onOpenWiggleFile:p,isThisMessageStreaming:n,isLastMessage:l,updatedMessage:o,message:d,isStreaming:a,presentFiles:j},"block-".concat(e.type,"-").concat(e.index))})})});tj.displayName="MessageBlocksRenderer";let ty=(0,i.memo)(e=>{var t,a,n;let{isStreaming:i,isThisMessageStreaming:l,isLastMessage:d,updatedMessage:c,onResize:u,previousMessage:x,message:f,isInteractive:m,isFirstAssistantMessage:p,onRetry:h,isResearchPending:g,isTemporary:v,conversationSettings:b,messageWarningPropsFromParent:j,onSendContinue:y,onOpenArtifact:w,shareType:_,publishedArtifacts:k,onOpenWiggleFile:M,...C}=e;(0,r.fS)("claudeai_crabby_claws_enabled");let N=(0,eb.Z)(C.conversationUuid);if((!c.content||!c.content[0])&&!(null==(t=c.metadata)?void 0:t.is_resume_completion_placeholder_message))return null;let S=(0,s.jsxs)(F,{"data-is-streaming":l,...i?I:R,className:d?"pb-3":"pb-8",children:[(0,s.jsx)(P,{children:(0,s.jsx)(tj,{blocks:c.content||[],isStreaming:i,isThisMessageStreaming:l,isLastMessage:d,updatedMessage:c,message:f,onResize:u,conversationUuid:C.conversationUuid,shareType:_,onOpenWiggleFile:M,publishedArtifacts:k,onOpenArtifact:w})}),null==(a=c.content)?void 0:a.map((e,t)=>{if("bell"===e.type||"voice_note"===e.type)return(0,s.jsx)(eU,{text:e.text,title:e.title},t)}),!N&&(0,s.jsxs)(s.Fragment,{children:[!i&&d&&(0,s.jsx)(eT,{previousMessage:x}),(0,s.jsx)(e_,{message:f,previousMessage:x,isLastMessage:d,isInteractive:m,isFirstAssistantMessage:p,onRetry:h,isResearchPending:g,isTemporary:v,showArtifacts:null!=(n=null==b?void 0:b.preview_feature_uses_artifacts)&&n,isStreaming:i,...C}),(0,s.jsx)(A,{message:f,isLastMessage:d,messageWarningPropsFromParent:j,conversationSettings:b,onRetry:h,onSendContinue:y}),(0,s.jsx)(eI,{message:f,conversationUuid:C.conversationUuid,isStreaming:l})]})]});return(0,s.jsx)(o.P.div,{style:{height:"auto"},...i?L:R,children:S})});ty.displayName="AssistantMessage";var tw=a(0xb82ac6f6),t_=a(0x1a18acadd),tk=a(0x6fe0a7f6),tM=a(0x1f59f8010);let tC=(0,i.memo)(e=>{var t,a,n;let{isStreaming:l,currentEdit:r,setCurrentEdit:o,finishEdit:d,cancelEdit:c,author:u,loggedInAccount:f,message:m,selectAttachment:h,showSharedImageMissing:v=!1,showSharedFileMissing:b=!1}=e,j=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=e=>{if(!e.isComposing&&("Enter"!==e.key||e.shiftKey||(e.preventDefault(),d()),"Escape"===e.key&&(e.preventDefault(),c()),"a"===e.key&&(e.metaKey||e.ctrlKey)&&document.activeElement===j.current)){var t;null==(t=j.current)||t.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d,c,j]);let y=null!=(n=m.files_v2)?n:m.files,w=v||b||m.attachments.length+y.length+((null==m||null==(t=m.sync_sources)?void 0:t.length)||0)>0,_=(0,q.C)(m),k=0===r.length||_===r;return(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d()},children:[w&&(0,s.jsxs)("div",{className:"mx-0.5 mb-3 flex flex-wrap gap-0.5",children:[y.map((e,t)=>(0,s.jsx)(tw.NM,{size:"lg",file:e},t)),m.attachments.map((e,t)=>(0,s.jsx)(tw.NM,{size:"lg",file:e,onClick:()=>null==h?void 0:h(e)},t)),null==m||null==(a=m.sync_sources)?void 0:a.map(e=>(0,s.jsx)(tM.V,{uuid:e.uuid,syncSource:e},e.uuid)),v&&(0,s.jsx)(tw.sv,{}),b&&!v&&(0,s.jsx)(tw.lD,{})]}),(0,s.jsx)(O,{...l?U:R,className:"w-full",children:(0,s.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,s.jsx)("div",{className:"flex shrink-0 items-center",children:(0,s.jsx)(t_.e,{name:u||(null==f?void 0:f.full_name)||"",size:"sm"})}),(0,s.jsxs)("div",{className:"font-ui mr-3 grid w-full grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6",children:[(0,s.jsx)(tk.fs,{value:r,onChange:e=>o(e.target.value),autoFocus:!0,className:"w-full",ref:j}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"text-text-300 flex flex-row items-center gap-2 text-xs",children:[(0,s.jsx)(p.R,{"aria-hidden":"true",className:"shrink-0"}),(0,s.jsx)("div",{children:(0,s.jsx)(g.A,{defaultMessage:"Editing this message will create a new conversation branch. You can switch between branches using the arrow navigation buttons.",id:"zqkUZeVH+L"})})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(x.$,{onClick:c,variant:"secondary",children:(0,s.jsx)(g.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,s.jsx)(x.$,{type:"submit",disabled:k,children:(0,s.jsx)(g.A,{defaultMessage:"Save",id:"jvo0vs3nF0"})})]})]})]})]})})]})});tC.displayName="EditingMessage";var tN=a(0x7c3335d0),tS=a(0xcd8c00e0);tS.A.blockRegex;let tA=tS.A.defaultRules,tE=tS.A.parserFor;tS.A.defaultBlockParse;let tT=tS.A.outputFor,tz=e=>{if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(tz);if(i.isValidElement(e)){if(e.props&&"object"==typeof e.props&&"children"in e.props){let t=e.props.children,a=tz(t);if(a!==t)return i.cloneElement(e,void 0,a)}return e}if((e=>"object"==typeof e&&null!==e&&"$$typeof"in e&&"type"in e&&"props"in e)(e)){let{type:t,props:a,key:s}=e,n={};return a&&"object"==typeof a&&(Object.assign(n,a),"children"in a&&(n.children=tz(a.children))),null!=s&&(n.key=s),i.createElement(t,n)}return e};var tR=a(0x11307af4f);let tI={fence:{...tA.fence,parse:(e,t,a)=>({lang:e[2]||void 0,content:e[3]}),react:e=>(0,s.jsx)(tR.I.pre,{flagShowCodeHeader:!1,children:e.content})},blockQuote:{...tA.blockQuote,react:(e,t,a)=>(0,s.jsx)(tR.I.blockQuote,{children:t(e.content,a)})},list:{...tA.list,react:(e,t,a)=>{let n=e.ordered?tR.I.ol:tR.I.ul;return(0,s.jsx)(n,{children:e.items.map((e,n)=>(0,s.jsx)(tR.I.li,{children:t(e,a)},n))},a.key)}},newline:tA.newline,paragraph:{...tA.paragraph,react:(e,t,a)=>(0,s.jsx)(tR.I.p,{children:t(e.content,a)},a.key)},del:tA.del,inlineCode:{...tA.inlineCode,react:e=>{let t=e.content;if(t&&tN.yT.test(t)){var a;if((null==(a=t.match(tN.yT))?void 0:a[0])===t)return(0,s.jsxs)(tR.I.code,{children:[(0,s.jsx)("span",{style:{display:"inline-block",verticalAlign:"middle",position:"relative",top:"-0.15em"},children:(0,s.jsx)(tN.qU,{color:t})}),t]})}return(0,s.jsx)(tR.I.code,{children:t})}},text:{...tA.text,react:e=>(0,tN.fz)(e.content)},url:tA.url,link:{...tA.link,match:(e,t)=>null,react:e=>{let t=e.target;return(0,s.jsx)("a",{href:t,target:"_blank",className:"underline",children:t})}}},tU=(0,i.memo)(e=>{let{text:t}=e,a=tE(tI)(t,{inline:!1});return((e,t,a)=>{let s=tT(e,t,a),n=(e,t)=>tz(s(e,t));return n.displayName="OutputFor_".concat(String(t)),n})(tI,"react")(a)});tU.displayName="AnthropicMarkDown";var tL=a(0x1b813d90),tO=a(0x253a5c787),tF=a(0x18175ce17),tP=a(0x23e87e502);let tD={type:"remote"},tB=(0,i.memo)(e=>{var t,a,n,l,r;let{files:o,updatedMessage:d,message:c,isLastMessage:u,isInteractive:x,editable:f,startEdit:m,onRetry:p,isResearchPending:h,isTemporary:v,author:b,shareType:j,conversationSettings:y,messageWarningPropsFromParent:w,previousMessage:_,isStreaming:k,selectAttachment:M,showSharedImageMissing:C,showSharedFileMissing:N,...S}=e,E=C||N||d.attachments.length+o.length+((null==d||null==(t=d.sync_sources)?void 0:t.length)||0)>0,T=null==(a=d.content)?void 0:a.some(e=>"text"===e.type&&""!==e.text),z="voice"===d.input_mode||"speech_input"===d.input_mode,[I,L]=(0,i.useState)(!1),[F,P]=(0,i.useState)(!1),D=(0,i.useRef)(null);(0,i.useEffect)(()=>{D.current&&P(D.current.scrollHeight>300)},[d.content]);let B=(0,i.useCallback)(()=>{L(e=>!e)},[]),G=(0,i.useMemo)(()=>{var e,t;return null!=(t=null==(e=c.sync_sources)?void 0:e.filter(e=>e.type===tL.v8.GDRIVE).map(e=>e.config.uri))?t:[]},[c.sync_sources]),W=(0,tF.kO)(),V=(0,i.useMemo)(()=>{var e,t;return null!=(t=null==(e=c.sync_sources)?void 0:e.filter(e=>e.type===tL.v8.MCP_RESOURCES).map(e=>e.config.resource.uri))?t:[]},[c.sync_sources]),q=(0,e1.Uz)(tD),H=(0,i.useMemo)(()=>null==q?void 0:q.find(e=>e.url&&tF.TI[e.url]===tL.v8.GDRIVE),[q]),[J,K]=(0,i.useState)([]);(0,i.useEffect)(()=>{if(!W||!H||0===V.length)return void K([]);let e=!1;return(async()=>{try{let t=(0,e1.KU)(H.uuid),a=await Promise.all(V.map(async e=>{try{var a;let s=await t.readResource({uri:e}),n=null==s||null==(a=s.contents)?void 0:a[0];if(!(null==n?void 0:n.text))return{data:null};let i=n.text;return{data:{uri:e,title:(null==n?void 0:n.name)||"",mime_type:n.mimeType||"text/plain",owner:"",text:i,size:i.length}}}catch(t){return(0,tO.Cp)(t,{tags:{component:"HumanMessage",action:"fetch_mcp_resource",serverUuid:H.uuid},extra:{uri:e}}),{data:null}}}));e||K(a)}catch(t){(0,tO.Cp)(t,{tags:{component:"HumanMessage",action:"fetch_mcp_resources_batch",serverUuid:H.uuid}}),e||K([])}})(),()=>{e=!0}},[W,H,V]);let X=(0,eS.qL)(G),Z=(0,i.useMemo)(()=>[...X,...J],[X,J]),Q=(0,i.useMemo)(()=>Z.some(e=>{let{data:t}=e;return t&&/\[image\d*\]/.test(t.text)}),[Z]),$=(0,i.useMemo)(()=>c.created_at?new Date(c.created_at).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}):"",[c.created_at]);return(0,s.jsxs)("div",{className:"mb-1 mt-1",children:[E&&(0,s.jsxs)("div",{className:"gap-2 mx-0.5 mb-3 flex flex-wrap",children:[o.map((e,t)=>(0,s.jsx)(tw.NM,{size:"lg",file:e},t)),d.attachments.map((e,t)=>(0,s.jsx)(tw.NM,{size:"lg",file:e,onClick:()=>null==M?void 0:M(e)},t)),null==d||null==(n=d.sync_sources)?void 0:n.map(e=>(0,s.jsx)(tM.V,{uuid:e.uuid,syncSource:e},e.uuid)),C&&(0,s.jsx)(tw.sv,{}),N&&!C&&(0,s.jsx)(tw.lD,{})]}),(0,s.jsxs)(O,{className:(0,Y.A)({"pr-6":T,"pr-[2.5px]":!T}),...k?U:R,children:[(0,s.jsxs)("div",{className:"flex flex-row gap-2 relative",children:[c.pending&&(0,s.jsx)("div",{className:"absolute size-7 rounded-full bg-bg-500 animate-pulse"}),(0,s.jsx)(ef.Tooltip,{delayDuration:1e3,side:"left",sideOffset:16,tooltipContent:$,children:(0,s.jsx)("div",{className:(0,Y.A)("shrink-0 transition-all duration-300 self-start",{"blur-md opacity-0 origin-center":c.pending}),children:j?(0,s.jsx)(t_.e,{name:b||null,size:"sm"}):(0,s.jsx)(tP.J,{size:"sm"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{ref:D,"data-testid":"user-message",className:(0,Y.A)("font-large !font-user-message grid grid-cols-1 gap-2 py-0.5 relative",{italic:z,"text-text-500 animate-pulse":c.pending}),style:{maxHeight:I||!F?"none":"200px",overflow:"hidden",position:"relative"},children:[null==(l=d.content)?void 0:l.map((e,t)=>"text"!==e.type?null:(0,s.jsx)(tU,{text:e.text},t)),!I&&F&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-bg-300 to-transparent pointer-events-none"})]}),F&&(0,s.jsx)("button",{onClick:B,className:"pb-3 pt-1 text-xs text-text-500/80 hover:text-text-100 transition w-3/4 text-left rounded-lg",children:I?(0,s.jsx)(g.A,{defaultMessage:"Show less",id:"qyJtWyZ0yt"}):(0,s.jsx)(g.A,{defaultMessage:"Show more",id:"aWpBzjCXKS"})})]})]}),(0,s.jsx)(A,{message:c,isLastMessage:u,hasDriveDocWithImages:Q,conversationSettings:y,messageWarningPropsFromParent:w}),(0,s.jsx)(e_,{message:c,isStreaming:k,previousMessage:_,isLastMessage:u,isInteractive:x,editMessage:m,editable:f,onRetry:p,isResearchPending:h,isTemporary:v,showArtifacts:null!=(r=null==y?void 0:y.preview_feature_uses_artifacts)&&r,...S})]})]})});tB.displayName="HumanMessage";var tG=a(0xda044f84),tW=a(0xc5b8d95e);let tV=[],tq=(0,i.memo)(function(e){var t,a;let{lastHumanMessageRef:r,lastAssistantMessageRef:o,isLastMessage:d,isLastHumanMessage:c,selectAttachment:u,author:x,isInteractive:f=!0,onOpenArtifact:m,onOpenWiggleFile:p,onResize:g,editable:v,conversationSettings:b,publishedArtifacts:j=tV,messageWarningProps:y,showSharedImageMissing:w=!1,showSharedFileMissing:_=!1,isFirstAssistantMessage:k,shareType:M=null,isTemporary:C=!1,actionEmitter:N,onSendContinue:S,isResearchPending:A=!1,isSessionConversation:E=!1,...T}=e,{account:z}=(0,n.YL)(),{messageUuid:R="",message:I,previousMessageUuid:U="",previousMessage:L,isStreaming:O}=T,F=(0,l.JX)(R),P=(0,l.JX)(U),D=I||F,B=L||(U?P:void 0),G=(e=>{let t=(0,i.useRef)(1);return(0,i.useEffect)(()=>{e||(t.current+=1)},[e]),t.current})(d),W=(e=>{let{message:t,onOpenArtifact:a,shareType:s}=e,n=(0,tW.n)(),l=(0,h.A)();return(0,i.useMemo)(()=>{let e=(e=>{var t;let a=e.content,s=null==(t=e.content)?void 0:t[0];return(null==s?void 0:s.type)==="text"&&""===s.text.trim()&&(a=null==a?void 0:a.slice(1)),a})(t),i=(null==e?void 0:e.map(e=>(e=>{let{block:t,citationsEnabled:a,shareType:s,onOpenArtifact:n,intl:i}=e;if("text"!==t.type)return t;let l=t.text;if(a&&t.citations&&t.citations.length>0&&(l=(0,tG.k0)(t.citations,l)),l=n?(0,V.Tm)(l):(0,V.it)(l),s){for(let e of(0,e6.n)(l))if(!(0,e4.m)(e,s)){let t="public"===s?"[".concat(i.formatMessage({defaultMessage:"Files hidden in shared chats",id:"ANRUB+TiTq"}),"]"):"[".concat(i.formatMessage({defaultMessage:"Working file hidden in shared chat",id:"oqkUomHXYH"}),"]"),a=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=RegExp("\\[[^\\]]*\\]\\(".concat(a,"\\)"),"g");l=l.replace(n,t)}}return{...t,text:l}})({block:e,citationsEnabled:n,shareType:s,onOpenArtifact:a,intl:l})))||[];return{...t,content:i}},[n,l,t,a,s])})({message:D,onOpenArtifact:m,shareType:M}),q=(0,i.useCallback)((e,t)=>{null==N||N.emit("retry",{parent_message_uuid:e,paprika_mode:t})},[N]),Y=null!=(a=D.files_v2)?a:D.files,H="human"===W.sender,J="assistant"===W.sender,K=d&&O;!function(e,t){if(!t||"human"!==e.sender||!e.content||!Array.isArray(e.content)||1!==e.content.length)return;let a=e.content[0];a&&"object"==typeof a&&"type"in a&&"text"===a.type&&"text"in a&&"string"==typeof a.text&&/^<claude_restart_nudge>[\s\S]*<\/claude_restart_nudge>$/.test(a.text.trim())}(W,E);let{isUserEditing:X,currentEdit:Z,setCurrentEdit:Q,startEdit:$,finishEdit:ee,cancelEdit:et}=(e=>{var t;let{editable:a,updatedMessage:s,actionEmitter:n}=e,[l,r]=(0,i.useState)(!1),[o,d]=(0,i.useState)(""),c="",u=null==(t=s.content)?void 0:t.find(e=>"text"===e.type);u&&"text"in u&&(c=u.text);let x=(0,i.useCallback)(()=>{a&&(d(c),r(!0))},[a,c]),f=(0,i.useCallback)(()=>{0!==o.length&&n&&(n.emit("edit",{message:s,text:o}),r(!1),d(""))},[o,n,s]),m=(0,i.useCallback)(()=>{r(!1),d("")},[]);return{isUserEditing:l,currentEdit:o,setCurrentEdit:d,startEdit:x,finishEdit:f,cancelEdit:m}})({editable:v,actionEmitter:N,updatedMessage:W});return X?(0,s.jsx)(tC,{isStreaming:O,currentEdit:Z,setCurrentEdit:Q,finishEdit:ee,cancelEdit:et,author:x,loggedInAccount:z,message:W,selectAttachment:u,showSharedImageMissing:w,showSharedFileMissing:_}):(0,s.jsxs)("div",{ref:c?r:d?o:null,"data-test-render-count":G,children:[H&&(0,s.jsx)(tB,{files:Y,updatedMessage:W,message:D,isLastMessage:d,isLastHumanMessage:c,isInteractive:f,editable:v,startEdit:$,onRetry:q,isResearchPending:A,isTemporary:C,author:x,shareType:M,conversationSettings:b,messageWarningPropsFromParent:y,previousMessage:B,selectAttachment:u,showSharedImageMissing:w,showSharedFileMissing:_,...T}),J&&(W.content&&W.content[0]||(null==(t=W.metadata)?void 0:t.is_resume_completion_placeholder_message))&&(0,s.jsx)(ty,{isThisMessageStreaming:K,isLastMessage:d,isLastHumanMessage:!1,updatedMessage:W,onResize:g,previousMessage:B,message:D,isInteractive:f,isFirstAssistantMessage:k,onRetry:q,isResearchPending:A,isTemporary:C,conversationSettings:b,messageWarningPropsFromParent:y,onSendContinue:S,onOpenArtifact:m,publishedArtifacts:j,onOpenWiggleFile:p,shareType:M,...T})]})})},0x16a96a9a2:(e,t,a)=>{a.d(t,{W:()=>s,m:()=>n});let s=e=>(e.split("/").pop()||e).replace(/\.[^/.]+$/,"").split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),n=(e,t)=>{if(!t)return!0;let a=e.replace("computer://","");if("org_scoped"===t)return a.startsWith("/mnt/user-data/");if("public"===t)return!1;throw Error("Unknown share type: ".concat(t))}},0x16f861148:(e,t,a)=>{a.d(t,{Dr:()=>E,Hz:()=>A,L_:()=>N,_L:()=>C,gy:()=>T});var s=a(0x22102fd88),n=a(0x1dd44336e),i=a(0xf32c56dd),l=a(0xa5acf583),r=a(0x6fe0a7f6),o=a(0xb91ccc43),d=a(0x225bae024),c=a(0x183548b63),u=a(0x22fc8d729),x=a(0x1b370f49d),f=a(0x1e1f2a153),m=a(0xb844abc8),p=a(0xac309a83),h=a(0x1a1f6dda6),g=a(0x16ab3413b),v=a.n(g),b=a(0xcaa21d58),j=a(0xef41e510),y=a.n(j),w=a(0xfc89b4a4),_=a(0x38e6572),k=a(0x1ab0d1ca1);let M=e=>{let{artifact:t,selectedVersion:a,messageUuid:r,isOpen:o,richSandboxRef:d,copyToClipboard:c}=e,{track:u}=(0,i.st)(),{publishedArtifactsBaseUrl:x}=(0,l._r)(),{mutateAsync:f,isPending:m}=(0,n.yx)(),[p,h]=(0,w.useState)(),g=(0,w.useCallback)(async()=>{var e;let t=await (null==(e=d.current)?void 0:e.getScreenshot());t&&h(t)},[d]);return(0,w.useEffect)(()=>{o&&d.current&&g()},[d,o,g]),(0,s.jsx)(C,{canScreenshot:!0,title:t.title,isLoading:m,screenshot:p,fetchScreenshot:g,setScreenshot:h,handlePublishArtifact:()=>{var e;f({title:t.title,artifact_type:t.type,code_language:t.language,message_uuid:r,artifact_identifier:t.id,content:null!=(e=t.versions[a].resultState)?e:"",screenshot:p,artifact_version_uuid:t.versions[a].uuid}).then(e=>{let{published_artifact_uuid:t}=e;return c("".concat(x,"/public/artifacts/").concat(t))}),u({event_key:"artifact.publish.modal.publish_button_clicked",message_uuid:r,artifact_type:null==t?void 0:t.type,artifact_language:null==t?void 0:t.language})}})};function C(e){let{canScreenshot:t,title:a,isLoading:n,screenshot:i,fetchScreenshot:l,setScreenshot:r,handlePublishArtifact:c}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:(0,s.jsx)("p",{children:(0,s.jsx)(_.A,{defaultMessage:"Publishing this Artifact will make it accessible to anyone on the internet and potentially visible in search engine results. Your chat will remain private.",id:"zG4O5rdNXZ"})})}),(0,s.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col sm:flex-row gap-4 rounded-xl py-3 pl-3 pr-5 items-center",children:[t?(0,s.jsxs)("div",{className:"relative group w-[160px] h-[84px]",children:[(0,s.jsxs)("div",{className:"rounded-lg overflow-hidden shrink-0 relative w-full h-full",children:[i?(0,s.jsx)("img",{src:i,alt:a,className:"w-full h-auto bg-always-white"}):(0,s.jsx)(b.default,{src:"/images/claude_ogimage.png",alt:a,className:"w-full h-auto",width:1138,height:640}),!i&&(0,s.jsx)(R,{handleCapture:()=>void l()})]}),i&&(0,s.jsx)("div",{className:"absolute top-0 right-0 translate-x-1/4 -translate-y-1/4 hidden group-hover:block",children:(0,s.jsx)(z,{handleRemove:()=>r(void 0)})})]}):null,(0,s.jsx)("div",{children:null!=a?a:(0,s.jsx)(_.A,{defaultMessage:"Claude Artifact",id:"l6aMQuX1m4"})})]}),(0,s.jsxs)("div",{className:"bg-bg-300 text-text-300 mt-3 flex gap-3 rounded-xl px-4 py-3 text-sm leading-normal",children:[(0,s.jsx)(o.R2D,{size:16,className:"mt-0.5 shrink-0"}),(0,s.jsx)("span",{children:(0,s.jsx)(_.A,{defaultMessage:"Anthropics <link>Usage Policy</link> prohibits use of Claude for harmful use cases like producing violent, abusive, or deceptive content. Dont share personal information or third-party content without permission.",id:"3BDMxIIlWR",values:{link:e=>(0,s.jsx)(u.Y,{href:"https://www.anthropic.com/legal/aup",target:"_blank",children:e})}})})]}),(0,s.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,s.jsx)(d.$,{size:"lg",loading:n,onClick:c,children:(0,s.jsx)(_.A,{defaultMessage:"Publish & copy link",id:"q8Svey6avC"})})})]})}let N=e=>{let{artifactUuid:t,publishedLink:a,onClose:i,onUnpublish:l}=e,{copyToClipboard:r,didCopy:c}=(0,f.C)(),{mutateAsync:u,isPending:x}=(0,n.lT)(t),m=async()=>{await u({}),null==l||l(),i()};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl my-3",children:[(0,s.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,s.jsx)("div",{children:(0,s.jsx)(o.qzq,{className:"mt-1",size:16})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h6",{className:"font-medium",children:(0,s.jsx)(_.A,{defaultMessage:"Published (Public)",id:"7G+T0FbG5h"})}),(0,s.jsx)("p",{className:"text-text-300",children:(0,s.jsx)(_.A,{defaultMessage:"Anyone on the web with the link can view the Artifact only. Your chat will remain private.",id:"lJBHtZSUCz"})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,s.jsx)(y(),{className:"text-text-300 truncate text-sm",href:a,children:a}),(0,s.jsx)("div",{children:(0,s.jsx)(d.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{r(a)},prepend:c?(0,s.jsx)(o.rAV,{size:16}):(0,s.jsx)(o.Xq1,{size:16}),children:c?(0,s.jsx)(_.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,s.jsx)(_.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(d.$,{size:"lg",variant:"secondary",loading:x,onClick:m,children:(0,s.jsx)(_.A,{defaultMessage:"Unpublish",id:"VjZ6FKc+ZZ"})}),(0,s.jsxs)("p",{className:"text-text-400 text-xs",children:[(0,s.jsx)(_.A,{defaultMessage:"Once Artifact is unpublished, it cannot be republished.",id:"HKGP87Xpbb"}),(0,s.jsx)("br",{}),(0,s.jsx)(_.A,{defaultMessage:"A new Artifact must be created.",id:"vWfM4LMkFW"})]})]})]})},S=e=>e.split(",").map(e=>e.trim().toLowerCase()).filter(e=>e.length>0);function A(e){let{artifactUuid:t,closeEmbedSettings:a,embedLink:i}=e,l=(0,k.A)(),{mutateAsync:c}=(0,n.eH)(t),{data:u,isSuccess:x}=(0,n.gY)(t),{copyToClipboard:m,didCopy:p}=(0,f.C)(),h='<iframe src="'.concat(i,'" title="Claude Artifact" width="100%" height="600" frameborder="0" allow="clipboard-write" allowfullscreen></iframe>'),[g,b]=(0,w.useState)(""),[j,y]=(0,w.useState)(!1),[M,C]=(0,w.useState)(!1),N=/^(?:(\*\.)?)(?:[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,24}[a-z0-9]$/,A=S(g),E=A.filter(e=>!N.test(e)),[T,z]=(0,w.useState)([]),R=!v()([...A].sort(),[...T].sort());(0,w.useEffect)(()=>{if(u){var e,t;let a=null!=(t=null==(e=u.embed_whitelist)?void 0:e.join(", "))?t:"";b(a),z(S(a))}},[x,u]);let I=async()=>{t&&(await c({embed_whitelist:A}),z(A),C(!0))};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("p",{className:"text-text-100 font-base-bold",children:(0,s.jsx)(_.A,{defaultMessage:"Allowed domains",id:"J1MOf/PGed"})}),(0,s.jsx)("p",{className:"text-text-300 font-small mb-2",children:(0,s.jsx)(_.A,{defaultMessage:"Only these domains can embed this artifact. Separate with commas.",id:"mySCaN71No"})}),(0,s.jsx)(r.fs,{value:g,onValueChange:e=>{b(null!=e?e:""),y(!0),C(!1)},onBlur:()=>{y(!1),R&&0===E.length&&I()},placeholder:"www.example.com, www.myblog.com",minRows:1,className:"text-sm"}),(0,s.jsx)("div",{className:"font-base mt-2 text-danger-000",children:E.length>0&&!j?1===E.length?l.formatMessage({defaultMessage:"{invalidDomain} is not a valid domain",id:"4BVWTznQQj"},{invalidDomain:E[0]}):l.formatMessage({defaultMessage:"{invalidDomains} are not valid domains",id:"woDBbyq+SX"},{invalidDomains:"".concat(E.slice(0,E.length-1).join(", ")," and ").concat(E[E.length-1])}):void 0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-text-100 font-base-bold mb-2",children:(0,s.jsx)(_.A,{defaultMessage:"Embed code",id:"O4prKQr/hN"})}),(0,s.jsx)(r.fs,{value:h,readOnly:!0,className:"text-sm read-only:text-text-200 read-only:!opacity-100",rows:5}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2 mt-4",children:[M&&(0,s.jsxs)("div",{className:"text-xs flex-grow flex items-center gap-1",children:[(0,s.jsx)(o.Jlk,{size:12,className:"inline"}),(0,s.jsx)(_.A,{defaultMessage:"Saved",id:"fsB/4pdUqN"})]}),(0,s.jsx)(d.$,{size:"default",variant:"secondary",onClick:a,children:(0,s.jsx)(_.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,s.jsx)(d.$,{size:"default",variant:"primary",prepend:p?(0,s.jsx)(o.rAV,{size:14}):(0,s.jsx)(o.QRo,{size:14}),onClick:()=>m(h),className:"w-28",children:(0,s.jsx)(_.A,{defaultMessage:"Copy code",id:"CNXQN5zp9z"})})]})]})]})}let E=e=>{let t,a,{onClose:n,isOpen:i,artifact:r,selectedVersion:d,messageUuid:u,publishedArtifactUuid:x,richSandboxRef:m}=e,p=(0,k.A)(),{publishedArtifactsBaseUrl:g,publishedArtifactsEmbedBaseUrl:v}=(0,l._r)(),b=!!x,[j,y]=(0,w.useState)(!1),C="".concat(g,"/public/artifacts/").concat(x),S="".concat(v,"/public/artifacts/").concat(x,"/embed"),[E,z]=(0,w.useState)("");(0,w.useEffect)(()=>{if(""===E)return;let e=setTimeout(()=>z(""),5e3);return()=>clearTimeout(e)},[E]);let{copyToClipboard:R}=(0,f.C)(),I=b?"shared":"private",U=(0,w.useRef)(I);U.current!==I&&("private"===I&&z(p.formatMessage({defaultMessage:"Artifact no longer published",id:"2ERgiFTuIj"})),U.current=I);let L=()=>{z(""),y(!1),n()};return j?(t=(0,s.jsxs)("div",{className:"flex items-center justify-start gap-2",children:[(0,s.jsx)("button",{onClick:()=>y(!1),children:(0,s.jsx)(o.ZK0,{})}),(0,s.jsx)(_.A,{defaultMessage:"Get embed code",id:"3TjDDwZ836"})]}),a=(0,s.jsx)(A,{artifactUuid:null!=x?x:"",closeEmbedSettings:()=>y(!1),embedLink:S})):b?(t=(0,s.jsx)(_.A,{defaultMessage:"Artifact published",id:"ykyvCB8a6W"}),a=(0,s.jsx)(N,{artifactUuid:null!=x?x:"",publishedLink:C,onClose:L})):(t=(0,s.jsx)(_.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"}),a=(0,s.jsx)(M,{artifact:r,selectedVersion:d,messageUuid:u,isOpen:i,richSandboxRef:m,copyToClipboard:R})),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(c.aF,{title:(0,s.jsx)("span",{className:"text-text-200 font-heading  font-medium",children:t}),isOpen:i,onClose:L,modalSize:"lg",hasCloseButton:!0,className:(0,h.A)(!j&&"-mt-20","!p-8 !rounded-2xl"),children:[(0,s.jsxs)("div",{className:"mt-2 flex flex-col gap-2.5",children:[E&&(0,s.jsx)("div",{className:"bg-accent-secondary-900 text-accent-secondary-000 rounded-2xl px-3 py-2 text-sm",children:E}),a]}),(0,s.jsx)(T,{isPublished:b,onOpen:()=>{y(!0)}})]})})};function T(e){let{isPublished:t=!0,isEmbedSettingsOpen:a=!1,onOpen:n}=e;return(0,p.fS)("embed_artifacts")&&t&&!a?(0,s.jsx)("div",{className:"absolute top-full left-0 right-0 mt-3",children:(0,s.jsx)("div",{className:"bg-bg-100 border-0.5 border-border-300 rounded-2xl shadow-lg p-3",onClick:n,children:(0,s.jsxs)(d.$,{variant:"ghost",className:"flex items-center justify-between py-3 pl-3 pr-3 cursor-pointer hover:bg-bg-200/50 transition-colors rounded-xl w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-6 h-6 rounded-md flex items-center justify-center",children:(0,s.jsx)(o.NGz,{size:16,className:"text-text-300"})}),(0,s.jsx)("span",{className:"text-text-100",children:(0,s.jsx)(_.A,{defaultMessage:"Get embed code",id:"3TjDDwZ836"})})]}),(0,s.jsx)(o.K3R,{size:16,className:"text-text-300"})]})})}):null}let z=e=>{let{handleRemove:t}=e;return(0,s.jsx)(x.Tooltip,{tooltipContent:(0,s.jsx)(_.A,{defaultMessage:"Remove",id:"G/yZLul6P1"}),side:"bottom",children:(0,s.jsx)("button",{className:(0,h.A)("transition-all hover:bg-bg-000/50 text-text-500 hover:text-text-200 w-5 h-5 rounded-full border-0.5 border-border-300/25 bg-bg-000/90 backdrop-blur-sm flex items-center justify-center",(0,m.Fr)()&&"!opacity-100 !bg-bg-000/50"),onClick:e=>{e.stopPropagation(),e.preventDefault(),t()},children:(0,s.jsx)(o.X,{size:12})})})},R=e=>{let{handleCapture:t}=e;return(0,s.jsx)("div",{className:"absolute inset-0 items-center justify-center bg-accent-main-900/20 hidden group-hover:flex",children:(0,s.jsx)(x.Tooltip,{tooltipContent:(0,s.jsx)(_.A,{defaultMessage:"Capture screenshot",id:"4aPgLNzYUy"}),side:"right",children:(0,s.jsx)(d.$,{variant:"secondary",size:"icon",onClick:t,className:"!bg-bg-100",children:(0,s.jsx)(o.i7d,{})})})})}},0x17e7bc007:(e,t,a)=>{a.d(t,{Ci:()=>G,Gu:()=>O,HF:()=>C,JX:()=>w,P8:()=>A,Po:()=>h,Q3:()=>W,QS:()=>S,RR:()=>B,ST:()=>N,SY:()=>g,U4:()=>I,dd:()=>M,gP:()=>P,gq:()=>D,n5:()=>T,ot:()=>b,oz:()=>p,so:()=>q,uO:()=>R,uQ:()=>F,w0:()=>E,xJ:()=>U,xw:()=>_,zg:()=>L});var s=a(0x628a9a0b),n=a(0x24fcf6beb),i=a(0x16ab3413b),l=a.n(i),r=a(0x394ef833),o=a(0x16784b660),d=a(0x107838ca5),c=a(0x2369694a1),u=a(0xe13d4dc9);let x={uuid:"",sender:"assistant",content:[],created_at:"",updated_at:"",attachments:[],files:[],files_v2:[],sync_sources:[],index:0,parent_message_uuid:void 0},f=e=>{let t={};return e.forEach(e=>{if("assistant"!==e.sender)return;let[a]=m(t,e);Object.keys(a).forEach(e=>{t[e]={...t[e],...a[e]}})}),t},m=(e,t)=>{let a=(0,n.Xz)(t),s=null,i={};return a.forEach(t=>{var a,l,r;let{id:o,currentVersion:d,type:c,title:u,language:x}=t,f=null==(r=((null==(a=i[o])?void 0:a.versions)||(null==(l=e[o])?void 0:l.versions)||[]).slice(-1)[0])?void 0:r.resultState,m=(0,n.zI)(d,f),p={...d,resultState:m};i[o]?i[o]={...i[o],versions:[...i[o].versions,p]}:e[o]?i[o]={...e[o],versions:[...e[o].versions,p]}:i[o]={id:o,type:c||"document",title:u||"Untitled",language:x||void 0,versions:[p]},s=o}),[i,s]},p=(0,r.v)()((0,o.eh)((e,t)=>({selectedMessageUuid:null,messageByUuid:{},pathUuidsByConversation:{},conversationSettings:null,artifacts:{},allFiles:[],allAttachments:[],allSyncSources:[],hasArtifacts:!1,fullText:"",lastStreamingArtifactId:null,streamingArtifacts:{},setSelectedMessage:t=>e({selectedMessageUuid:t}),setMessages:(t,a)=>{e(e=>{let n={},i=[];a.forEach(e=>{n[e.uuid]=e,i.push(e.uuid)});let l=f(a),r=a.flatMap(e=>e.files),o=a.flatMap(e=>e.attachments),d=a.flatMap(e=>e.sync_sources),c=Object.keys(l).length>0,u=a.map(e=>(0,s.Rs)(e)).join(" ");return{messageByUuid:n,pathUuidsByConversation:{...e.pathUuidsByConversation,[t]:i},artifacts:l,streamingArtifacts:{},allFiles:r,allAttachments:o,allSyncSources:d,hasArtifacts:c,fullText:u,lastStreamingArtifactId:null}})},appendMessages:(e,a)=>{let s=t(),n=[...(s.pathUuidsByConversation[e]||[]).map(e=>s.messageByUuid[e]).filter(Boolean),...a];s.setMessages(e,n)},updateMessage:(a,n)=>{let{messageByUuid:i}=t(),l={...i,[a]:n},r=Object.values(l),o=f(r),d=r.flatMap(e=>e.files),c=r.flatMap(e=>e.attachments),u=r.flatMap(e=>e.sync_sources),x=Object.keys(o).length>0;e({messageByUuid:l,artifacts:o,allFiles:d,allAttachments:c,allSyncSources:u,hasArtifacts:x,fullText:r.map(e=>(0,s.Rs)(e)).join(" "),lastStreamingArtifactId:null})},setArtifacts:t=>e({artifacts:t,hasArtifacts:Object.keys(t).length>0}),setConversationSettings:t=>e({conversationSettings:t}),setPathUuids:(t,a)=>e(e=>({pathUuidsByConversation:{...e.pathUuidsByConversation,[t]:a}})),updateStreamingMessage:(a,s,n)=>{let{messageByUuid:i,pathUuidsByConversation:l,artifacts:r}=t(),o=l[a]||[],d=o[o.length-1],c=i[d];if(!c)return;let u={...c,content:n},[x,f]=m(r,u);e({messageByUuid:{...i,[d]:u},lastStreamingArtifactId:f,streamingArtifacts:x})},getConversationMessages:e=>{let a=t();return(a.pathUuidsByConversation[e]||[]).map(e=>a.messageByUuid[e]).filter(Boolean)}}))),h=()=>p(e=>e.setArtifacts),g=()=>p(e=>e.lastStreamingArtifactId),v=[],b=e=>p((0,d.k)(t=>{let a=t.pathUuidsByConversation[e];return a&&0!==a.length?a.map(e=>t.messageByUuid[e]).filter(Boolean):v})),j=new Map,y=[],w=e=>p(t=>{let a=t.messageByUuid[e];return a||(j.has(e)||j.set(e,{...x,uuid:e}),j.get(e))}),_=e=>p(t=>t.pathUuidsByConversation[e]||y),k=e=>p((0,d.k)(e)),M=()=>k(e=>e.artifacts),C=()=>(0,c.n)(p,e=>({...e.artifacts,...e.streamingArtifacts}),l()),N=e=>(0,c.n)(p,t=>t.artifacts[e],l()),S=()=>k(e=>e.allFiles),A=()=>k(e=>e.allAttachments),E=()=>k(e=>e.allSyncSources),T=e=>p(t=>{let a=(t.pathUuidsByConversation[e]||[])[0];return a?t.messageByUuid[a]:void 0}),z=e=>p(t=>{let a=(t.pathUuidsByConversation[e]||[])[1];return a?t.messageByUuid[a]:void 0}),R=e=>{var t;let a=z(e);return(null==a||null==(t=a.content)?void 0:t.length)||0},I=e=>{let t=z(e);return null==t?void 0:t.sender},U=e=>p(t=>{let a=t.pathUuidsByConversation[e]||[],s=a[a.length-1];return s?t.messageByUuid[s]:x}),L=e=>p(t=>(t.pathUuidsByConversation[e]||[]).map(e=>t.messageByUuid[e]).filter(Boolean).some(e=>(0,u.OC)(e))),O=()=>p(e=>e.setMessages),F=()=>p(e=>e.appendMessages),P=()=>p(e=>e.updateMessage),D=()=>p(e=>e.updateStreamingMessage),B=()=>p(e=>e.getConversationMessages),G=(e,t)=>(0,c.n)(p,a=>{let s=a.pathUuidsByConversation[e]||[],n=s[s.length-1],i=n?a.messageByUuid[n]:void 0;if(i){if(t){var l;return{...i,content:(null==(l=i.content)?void 0:l.map(e=>{let t={type:e.type};return("tool_use"===e.type||"tool_result"===e.type)&&(t.name=e.name),t}))||[]}}return i}},(e,a)=>{var s,n,i,l;return e&&a&&t?e.uuid===a.uuid&&(null==(s=e.content)?void 0:s.length)===(null==(n=a.content)?void 0:n.length)&&e.attachments.length===a.attachments.length&&e.files.length===a.files.length&&(null==(i=e.files_v2)?void 0:i.length)===(null==(l=a.files_v2)?void 0:l.length):e===a}),W=e=>p(t=>{let a=t.pathUuidsByConversation[e]||[];for(let e=a.length-1;e>=0;e--){let s=t.messageByUuid[a[e]];if(s&&"human"===s.sender)return s}}),V=new Set(["bash","bash_tool","create_file","str_replace"]),q=e=>p(t=>{let a=t.pathUuidsByConversation[e]||[];for(let e=a.length-1;e>=0;e--){let s=t.messageByUuid[a[e]];if(!s)continue;let n=s.content;if(n)for(let e=n.length-1;e>=0;e--){let t=n[e];if("tool_result"===t.type&&V.has(t.name))return[t.name,s.uuid,e].join("-")}}})},0x18ca729ac:(e,t,a)=>{function s(e){let t=function(e){if(0===e.length)throw Error("Cannot find common root directory: no files provided");let t=e[0].path.split("/").filter(Boolean);if(0===t.length)throw Error("Cannot find common root directory: invalid file path");let a=t[0];if(!e.every(e=>{let t=e.path.split("/").filter(Boolean);return t.length>0&&t[0]===a}))throw Error("Cannot find common root directory: files do not share a common root");return a}(e),a={name:"",path:"",type:"directory",children:[]};for(let s of e){let e=s.path.split("/").filter(Boolean);e[0]===t&&e.shift();let n=a;for(let t=0;t<e.length;t++){let a=e[t],i=t===e.length-1,l=e.slice(0,t+1).join("/");n.children||(n.children=[]);let r=n.children.find(e=>e.name===a);r||(r={name:a,path:l,type:i?"file":"directory",children:i?void 0:[],content:i?s.content:void 0},n.children.push(r)),n=r}}return a.children&&function(e){let t=e.findIndex(e=>"SKILL.md"===e.name);if(t>0){let a=e[t];e.splice(t,1),e.unshift(a)}}(a.children),a}function n(e){return e.replace(/^---\n([\s\S]*?)\n---/,"---\n\n$1\n\n---\n")}a.d(t,{_:()=>s,y:()=>n})},0x18d835460:(e,t,a)=>{a.d(t,{F:()=>i});var s=a(0xdc12822f);let n={sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)",xl:"(min-width: 1280px)","2xl":"(min-width: 1536px)"};function i(e){return(0,s.U)(n[e])}},0x1936feed4:(e,t,a)=>{a.d(t,{x:()=>s});function s(e){throw Error("Unhandled discriminated union member: ".concat(JSON.stringify(e)))}},0x193cc7eb2:(e,t,a)=>{a.d(t,{Q:()=>f,k:()=>x});var s=a(0x12c9046cd),n=a(0x14de19ae8),i=a(0x21e26ba67),l=a(0x189ce0fd0),r=a(0x4d348f95),o=a(0xfc89b4a4),d=a(0x120e6a4a3),c=a(0xedac311);let u=null,x=e=>{u={payload:e,received:new Date}};function f(e){let{chatId:t,chatName:a,onSend:x,hasFirstMessage:f}=e,{activeOrganization:m}=(0,n.YL)(),p=(0,s.mn)(),h=(0,o.useRef)(!1),g=(0,r.useSearchParams)(),v=(0,c.useUpdateSearchParams)(),b=(0,o.useCallback)(e=>e.chatId===t&&!h.current&&!!m&&(h.current=!0,(async()=>{try{let t=[];if("images"in e)for(let a of e.images)try{t.push(...await (0,d.bl)(a.base64,a.mimeType,m.uuid,p))}catch(e){}else if(e.imageBase64&&e.imageMimeType)try{t.push(...await (0,d.bl)(e.imageBase64,e.imageMimeType,m.uuid,p))}catch(e){}return await x({prompt:e.text,files:t}),!0}catch(e){return!1}finally{h.current=!1}})(),!0),[m,t,x,p]);return(0,o.useEffect)(()=>{if(!f)return;let e=u,a="1"===g.get("desktop_quick_entry");a&&v("desktop_quick_entry",null),e&&Date.now()-e.received.getTime()<=6e4&&e.payload.chatId&&e.payload.chatId===t&&a&&(u=null,setTimeout(()=>b(e.payload),1))},[f,t,b,g,v]),(0,i._v)(l.A.ChatInfo,{getCurrentChatInfo:()=>Promise.resolve({chatId:t,chatName:a}),sendToChatWithPayload:b},[t,a,m,p,x]),null}},0x19a5dec78:(e,t,a)=>{a.d(t,{CH:()=>j,GT:()=>N,IK:()=>b,Nw:()=>k,OQ:()=>w,Ui:()=>y,YE:()=>C,mk:()=>v,mq:()=>g});var s=a(0x22102fd88),n=a(0x628a9a0b),i=a(0x1fec22234),l=a(0xbca8e388),r=a(0x12c9046cd),o=a(0x17f3a2521),d=a(0x78b33fbd),c=a(0x1a1f6dda6),u=a(0x1dc411c0f),x=a(0xc6536c20),f=a(0xfc89b4a4),m=a(0x1ab0d1ca1),p=a(0x156c4e43b),h=a(0x1c12b3087);function g(e){let{hrefs:t}=e,a=t.map((e,t)=>(0,s.jsx)(u.P.div,{className:(0,c.A)("shadow-xs h-5 w-5 rounded-full overflow-hidden border-0.5 border-border-300 bg-bg-100 flex items-stretch justify-stretch","z-".concat(t+1)),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.1+.05*t,duration:.3},children:(0,s.jsx)(i.d,{url:e,shouldFillBackground:!0,size:14})},t));return(0,s.jsx)("div",{className:"flex items-center -space-x-2",children:a})}function v(e){let{agents:t,n:a=5}=e,s=new Set;for(let e of t)for(let t of e.annotated_snippets)for(let e of t.tool_calls){var n;if("web_search"===e.tool_name&&(null==(n=e.output)?void 0:n.type)==="rich_content"&&e.output.content.length){for(let t of e.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean))if("string"==typeof t)try{let e=new URL(t);if(s.add(e.origin),s.size>=a)return Array.from(s).slice(0,a)}catch(e){}}}return Array.from(s)}function b(e,t){let a=!t||t===o.zu.Completed,s=(0,f.useRef)(a),{mutate:i}=(0,n.HF)(e,{refetchOnSettled:!0});(0,f.useEffect)(()=>{a&&!s.current&&i({settings:{compass_mode:null}}),s.current=a},[i,a,e])}function j(e){var t,a;let{organizationUuid:s,conversationUuid:i,taskId:l,isShared:c,enabled:u}=e,[m,p]=(0,f.useState)(!0),[,g]=(0,f.useState)(0),v=(0,d.useDynamicConfig)("use_confused_carousel_sounds").get("polling",[{intervalSeconds:30}]),b=null!=(a=null==(t=v[0])?void 0:t.intervalSeconds)?a:30,[j,y]=(0,f.useState)(b),w=(0,n._W)(i),_=(0,h.Tc)(e=>e.setCurrentCompassTask,"useCompassStatus"),k=c?"/api/organizations/".concat(s,"/chat_snapshots/").concat(i,"/task/").concat(l,"/status"):"/api/organizations/".concat(s,"/chat_conversations/").concat(i,"/task/").concat(l,"/status"),{data:M,isLoading:C,error:N}=(0,r.Sk)(k,{refetchInterval:!!m&&1e3*j,enabled:!!(u&&i&&s&&l),meta:{noToast:!0}}),S=(null==M?void 0:M.status)!==void 0&&!(0,o.i3)(null==M?void 0:M.status);return(0,f.useEffect)(()=>{if(u&&i&&s&&l)if(S)p(!1),_(void 0),w(),g(0);else if(N){if(!(null==M?void 0:M.started_at))return void p(!1);g(e=>{let t=e+1,a=x.c9.fromISO(M.started_at).plus({hours:3}),s=x.c9.now();return p(t<3&&s<a),t})}else M&&!S&&(g(0),_(l))},[u,l,S,N,w,s,i,M,_]),(0,f.useEffect)(()=>{if(!(null==M?void 0:M.started_at)||!m)return;let e=setInterval(()=>{let e=function(e,t){let a=x.c9.fromISO(e),s=x.c9.now().diff(a,"seconds").seconds;for(let e of t)if(!e.durationSeconds||s<e.durationSeconds)return e.intervalSeconds;return 30}(M.started_at,v);e!==j&&y(e)},1e3*j);return()=>clearInterval(e)},[null==M?void 0:M.started_at,m,v,j]),{compassStatus:M,isLoading:C,error:N,completed:S}}let y=e=>{var t,a;return null==e||null==(a=e.agents)||null==(t=a[0])?void 0:t.name};function w(e){let t=(0,m.A)(),a=y(e);return a||(e.status!==o.zu.Completed?t.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}):t.formatMessage({defaultMessage:"Done researching",id:"/ONMTL4lXm"}))}let _=p.Ik({thought:p.Yj()});function k(e){let t=null==e?void 0:e.agents[0];return(0,f.useMemo)(()=>{var e,a,s;let n=null==t||null==(e=t.annotated_snippets[0])?void 0:e.thinking_blocks,i=n&&n.length>0?n[0]:void 0;if(i)return i.thinking;let l=null==t||null==(s=t.annotated_snippets[0])||null==(a=s.tool_calls)?void 0:a.find(e=>"think"===e.tool_name);if(null==l?void 0:l.tool_input)try{let e=JSON.parse(l.tool_input),{data:t}=_.safeParse(e);return null==t?void 0:t.thought}catch(e){return}},[null==t?void 0:t.annotated_snippets])}function M(e){let t=Math.floor(e/1e3),a=Math.floor(t/60),s=Math.floor(a/60);return s>0?"".concat(s,"h ").concat(a%60,"m"):a>0?"".concat(a,"m ").concat(t%60,"s"):t>0?"".concat(t,"s"):"0s"}function C(e){let{startedAt:t,completedAt:a}=e,[n,i]=(0,f.useState)(()=>x.c9.now());if((0,f.useEffect)(()=>{if(!t||a)return;let e=setInterval(()=>{i(x.c9.now())},1e3);return()=>clearInterval(e)},[t,a,i]),!t)return"Starting";let l=x.c9.fromISO(t);if(a){let e=x.c9.fromISO(a).diff(l,"milliseconds").milliseconds;return e<=0?"Starting":(0,s.jsx)(s.Fragment,{children:M(e)})}let r=n.diff(l,"milliseconds").milliseconds;return r<=1e3?"Starting":(0,s.jsx)(s.Fragment,{children:M(r)})}function N(e){let{thought:t,className:a}=e;return t?(0,s.jsx)("div",{className:(0,c.A)("text-text-100 font-claude-response-body",a),children:(0,s.jsx)(l.fP,{text:t})}):null}},0x1a65cb992:(e,t,a)=>{a.d(t,{M:()=>u});var s=a(0x22102fd88),n=a(0x1d0c32e96),i=a(0x225bae024),l=a(0x1b370f49d),r=a(0x38e6572),o=a(0x18175ce17),d=a(0xf02ef1a6),c=a(0x21010ec24);function u(e){let{file:t,conversationUuid:a,source:u,variant:x="ghost",size:f="icon_lg",className:m}=e,p=(0,o.kO)(),{handleOpenInGoogleDrive:h,showConnectionModal:g,setShowConnectionModal:v,connectionError:b,isExporting:j}=(0,c.N)({conversationUuid:a,source:u});return(0,c.z)(t.path,p)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Tooltip,{tooltipContent:(0,s.jsx)(r.A,{defaultMessage:"Open in Drive",id:"r80/2fFyeU"}),side:"bottom",children:(0,s.jsx)(i.$,{variant:j?"secondary":x,size:f,loading:j,onClick:e=>{e.preventDefault(),e.stopPropagation(),h(t.path)},className:m,children:!j&&(0,s.jsx)(n.ft,{size:"icon_sm"===f?16:"icon"===f?20:24})})}),(0,s.jsx)(d.h,{isOpen:g,onClose:()=>{v(!1)},errorType:b,callerIdentifier:"google-drive-export-button",pathname:"/chat/".concat(a)})]}):null}},0x1babd1d4e:(e,t,a)=>{a.d(t,{O:()=>v,_:()=>b});var s=a(0x22102fd88),n=a(0x628a9a0b),i=a(0xf32c56dd),l=a(0x139b5e710),r=a(0xb91ccc43),o=a(0x225bae024),d=a(0x23977865),c=a(0x1bd175d8c),u=a(0x1a1f6dda6),x=a(0x23506e4da),f=a(0xfc89b4a4),m=a(0x38e6572),p=a(0x1ab0d1ca1),h=a(0x142811145);let g=(0,x.default)(()=>Promise.all([a.e(39883),a.e(46278),a.e(88059),a.e(44484)]).then(a.bind(a,0xa933a7a4)).then(e=>e.ShareModal),{loadableGenerated:{webpack:()=>[0xa933a7a4]},ssr:!1});function v(e){let{controlsSidebarIsOpen:t,closeControlsSidebar:a,openControlsSidebar:n,conversationUuid:i,isStreaming:l,isTemporary:x,hasConversationLoaded:f=!1}=e,p=(0,c.V)(d.E_),h=b({conversationUuid:i,isStreaming:l}),v=!!n&&!!a&&!t;return(0,s.jsxs)("div",{className:(0,u.A)("flex items-center gap-1","transition-opacity duration-300",t?"md:opacity-0 pointer-events-none user-select-none":"md:opacity-100",!v&&"hidden"),"data-testid":"chat-actions",children:[!x&&!l&&f&&(0,s.jsx)(o.$,{tooltip:p&&(0,s.jsx)(m.A,{defaultMessage:"Share chat",id:"bXa+lJhlYV"}),variant:p?"ghost":"secondary",size:p?"icon_sm":"sm",onClick:h.handleShareClick,disabled:h.isCheckingShareability||!v,prepend:p&&(0,s.jsx)(r.SYj,{}),children:!p&&(0,s.jsx)(m.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})}),p&&(0,s.jsx)(o.$,{tooltip:(0,s.jsx)(m.A,{defaultMessage:"New chat",id:"ATDyLPIoxz"}),href:"/new",size:"icon_sm",variant:"claude",disabled:!v,className:"ml-1",children:(0,s.jsx)(r.OMN,{size:16})}),h.showShareModal&&(0,s.jsx)(g,{...h})]})}function b(e){let{track:t}=(0,i.st)(),{addError:a,addSuccess:s}=(0,l.Y)(),r=(0,p.A)(),{data:o,refetch:d,isFetching:c}=(0,n.O2)(e.conversationUuid),[u,x]=(0,f.useState)(!1),m=(0,f.useCallback)(()=>{x(!0)},[x]),g=(0,f.useCallback)(async()=>{t({event_key:"chat.share.button.clicked",conversation_uuid:e.conversationUuid});let n=await d();if(n.data)if(n.data.shareable||n.data.snapshot)m();else{var i;s(null!=(i=n.data.disabled_reason)?i:r.formatMessage({defaultMessage:"This chat cannot be shared.",id:"WaiZiv2Q4Y"}))}else a(r.formatMessage({defaultMessage:"Failed to check share status. You can try again.",id:"kYQG+MMTz7"}),{errorContext:{tags:{source:"share_check"}}})},[t,e.conversationUuid,d,m,a,s,r]);(0,h.Kh)("share_chat",g);let v=!!(null==o?void 0:o.snapshot);return{conversationUuid:e.conversationUuid,showShareModal:u,openShareModal:g,closeShareModal:()=>x(!1),handleShareClick:g,isCheckingShareability:c,isShared:v,disabled:!!o&&!o.shareable,refetch:d,...o}}},0x1c6cf1a02:(e,t,a)=>{a.d(t,{f:()=>c});var s=a(0x22102fd88),n=a(0x224a0d05),i=a(0x13c38b3e7),l=a(0x225bae024),r=a(0x761f2ec),o=a(0x1ab362a20),d=a(0xfc89b4a4);let c=e=>{let{attachment:t,goBack:a,onClose:c}=e,u=(0,d.useMemo)(()=>(0,i.E)(t),[t]);return(0,s.jsxs)("div",{className:"flex h-full flex-col pb-1 pl-5 pt-3",children:[(0,s.jsxs)("div",{className:"sticky flex items-center gap-1 pr-5",children:[a&&(0,s.jsx)(l.$,{onClick:a,variant:"ghost",size:"icon",className:"-ml-2 shrink-0",children:(0,s.jsx)(r.n,{size:20})}),(0,s.jsx)("h2",{className:"font-ui flex-1 truncate text-lg font-medium",children:u.title}),(0,s.jsx)(l.$,{variant:"ghost",size:"icon",className:"-mr-2",onClick:c,"data-testid":"close-file-preview",children:(0,s.jsx)(o.X,{size:20})})]}),(0,s.jsxs)("div",{className:"mb-1 flex flex-col pb-3 pr-5 min-h-0 flex-1",children:[(0,s.jsx)(n.G,{metaData:u.metaData}),(0,s.jsx)("div",{className:"-m-1 mt-0 min-h-0 flex-1 whitespace-pre-wrap break-all text-xs p-4 bg-bg-000 rounded-lg border-0.5 border-border-300  overflow-y-auto font-mono shadow-sm",children:t.extracted_content})]})]})}},0x1cdcf3e5a:(e,t,a)=>{a.d(t,{yL:()=>es,XO:()=>ea});var s=a(0x22102fd88),n=a(0x1575c7741),i=a(0xf32c56dd),l=a(0xa5acf583),r=a(0x14de19ae8),o=a(0x139b5e710),d=a(0x6fe0a7f6),c=a(0xb91ccc43),u=a(0x225bae024),x=a(0x1b03847fb),f=a(0x183548b63),m=a(0x1b370f49d),p=a(0x1e1f2a153),h=a(0x24fcf6beb),g=a(0xac309a83),v=a(0x965113a9),b=a(0x113daa220),j=a(0x1a1f6dda6),y=a(0x160045b25),w=a(0x1dc411c0f),_=a(0xc6536c20),k=a(0xfc89b4a4),M=a(0x38e6572),C=a(0x1ab0d1ca1),N=a(0xb1890cb4),S=a(0x1398bcf3b),A=a(0xbebfc702),E=a(0x18175ce17),T=a(0x8daa74e8);async function z(e){let t=(0,T.T)(e),a=await fetch(t);if(!a.ok)throw Error("Failed to fetch file: ".concat(a.status," ").concat(a.statusText));return a}var R=a(0x218bd2f97),I=a(0x6f2a2354),U=a(0x16f861148),L=a(0x3cebcb0f),O=a(0x1f507121),F=a(0x1a65cb992),P=a(0xc628249c),D=a(0x1fe2ab707),B=a(0x20d6272f9),G=a(0x21010ec24),W=a(0xd4b9b976),V=a(0xd3117c3a),q=a(0xf071fd84),Y=a(0x1334f6ecc),H=a(0x1bb0f43cc),J=a(0x17e725145),K=a(0x11a517a9),X=a(0xce58ec20),Z=a(0x18ca729ac),Q=a(0x695f5df2),$=a(0x1eb594abd);let ee=(0,k.memo)(e=>{var t;let{files:a}=e,n=(0,k.useMemo)(()=>(0,Z._)(a),[a]),i=(0,k.useMemo)(()=>{if(!n.children)return null;let e=n.children.find(e=>"SKILL.md"===e.name);return e||n.children[0]||null},[n]),[l,r]=(0,k.useState)((null==i?void 0:i.path)||null),[o,d]=(0,k.useState)(null==i?void 0:i.content),[c,u]=(0,$.u)(),x=(0,k.useCallback)((e,t)=>{r(e),d(t.content)},[]),f=null!=(t=null==l?void 0:l.split("/").pop())?t:"file",{fileMimeType:m,fileSyntax:p,displayFileType:h}=(0,D.G)(l||""),g=void 0!==o&&"string"==typeof o&&"SKILL.md"===f?(0,Z.y)(o):o;return(0,s.jsxs)("div",{className:"flex h-full border-t border-border-300",children:[(0,s.jsx)(Q.t,{fileTree:n,selectedPath:l,expandedFolders:c,onFileSelect:x,onToggleFolder:u,className:"border-r border-border-300 bg-bg-000 p-3"}),(0,s.jsx)("div",{className:"flex-1 min-w-0 flex flex-col",children:(0,s.jsx)("div",{className:"bg-bg-000 flex flex-col h-full overflow-hidden",children:(0,s.jsx)("div",{className:"flex-1 min-h-0 overflow-auto",children:void 0!==g?(0,s.jsx)(K.as,{content:g,displayFileType:h,language:p,showRaw:!1,fileName:f,mimeType:m}):(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-text-300",children:(0,s.jsx)(M.A,{defaultMessage:"Select a file to view its content",id:"Cag1YO8/Qh"})})})})})]})});ee.displayName="SkillFileViewer";let et=e=>{let{onLoad:t}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-text-300 gap-4",children:[(0,s.jsx)(M.A,{defaultMessage:"No file content available",id:"H8DU08sy24"}),(0,s.jsx)(u.$,{variant:"secondary",size:"sm",onClick:t,children:(0,s.jsx)(M.A,{defaultMessage:"Load file",id:"xvpw6mFG1S"})})]})},ea=2500,es=e=>{var t,T,Z,Q,$,es;let{file:en,goBack:ei,onClose:el,isShared:er,projectUuid:eo,isTemporary:ed,isStreaming:ec,showBackButton:eu,streamingFile:ex,artifactVersions:ef,cacheBuster:em}=e,ep=er?e.snapshotUuid:e.conversationUuid,[eh,eg]=(0,k.useState)(void 0),[ev,eb]=(0,k.useState)(!1),[ej,ey]=(0,k.useState)(!1),[ew,e_]=(0,k.useState)(!1),[ek,eM]=(0,k.useState)(null),[eC,eN]=(0,k.useState)(null),[eS,eA]=(0,k.useState)("normal"),[eE,eT]=(0,k.useState)([]),{activeOrganization:ez}=(0,r.YL)(),{copyToClipboard:eR}=(0,p.C)(),{addSuccess:eI,addError:eU}=(0,o.Y)(),eL=(0,i.st)(),eO=(0,k.useRef)(null),eF=(0,C.A)(),eP=en.path.split("/").pop()||en.path,eD=(0,J.useQueryClient)(),eB=(0,g.fS)("claudeai_wiggle_pebble_stone_enabled"),eG=(0,k.useMemo)(()=>eB&&!er?{uuid:(0,N.A)("path:".concat(en.path),ep),type:"wiggle_artifact",file_path:en.path.replace(/^\/mnt\/user-data\//,"/")}:void 0,[en.path,ep,eB,er]),eW=(0,n.f)({artifactContext:eG}),eV=(0,k.useCallback)(()=>{eD.invalidateQueries({queryKey:[q.r$]})},[eD]),eq=(0,H.j)({artifactContext:eG,chatConversationUuid:ep,onStorageChange:eV}),eY=(0,k.useMemo)(()=>({claudeComplete:eW,storage:eq}),[eW,eq]),eH=(null==ex?void 0:ex.renderAs)===h.vU.Markdown?"markdown":void 0,{fileMimeType:eJ,fileSyntax:eK,isImage:eX,isMarkdown:eZ,isTextContent:eQ,showViewToggle:e$,displayFileType:e0}=(0,D.G)(en.path,eH),[e1,e2]=(0,k.useState)(!1),[e3,e4]=(0,k.useState)(!1),[e5,e6]=(0,k.useState)(!1),e8=(0,r.mV)(),e9=(0,A.fo)(eo),e7=(0,k.useMemo)(()=>eQ&&void 0!==eh?new Blob([eh]).size<1e6:null,[eQ,eh]),te=(0,k.useMemo)(()=>{if(eh&&eQ&&"string"==typeof eh)return null==ef?void 0:ef.find(e=>e.result_state===eh)},[ef,eh,eQ]),tt=!ed&&"conversationUuid"in e&&e.conversationUuid&&eh&&!ec&&eQ&&e7,ta=(0,S.O)({conversationUuid:"conversationUuid"in e?e.conversationUuid:void 0}),ts=ed||er?null:e8?"share":"publish",{publishedArtifactsBaseUrl:tn,publishedArtifactsEmbedBaseUrl:ti}=(0,l._r)(),tl=(null==(t=ta.data)?void 0:t.published_artifact_uuid)?"".concat(ti,"/public/artifacts/").concat(null==(T=ta.data)?void 0:T.published_artifact_uuid,"/embed"):null,tr=(null==(Z=ta.data)?void 0:Z.published_artifact_uuid)||(null==te||null==(Q=te.published_artifact_uuid)?void 0:Q.toString()),to=(0,k.useMemo)(()=>ts?ta.data?(0,X.x)(ts,ta.data,tn):te?(0,X.x)(ts,{artifact_uuid:te.artifact_uuid,artifact_version_uuid:te.uuid,message_uuid:te.message_uuid,published_artifact_uuid:te.published_artifact_uuid},tn):void 0:null,[ts,ta.data,tn,te]),{handleProjectFileUpload:td}=(0,R.IE)({projectUuid:eo,onError:()=>{eU(eF.formatMessage({defaultMessage:"Error adding file to project",id:"807qgLdlHv"}),{messageForLogging:"Error adding file to project"})},onSuccess:()=>{eI(eF.formatMessage({defaultMessage:"File added to project",id:"aXguBORPUO"}))}}),tc=(0,R.ED)(eo),{maxKbTokens:tu}=(0,R.AO)(),tx=(0,k.useMemo)(()=>null!==eC&&!eQ&&!eX&&!(0,h.IO)(en.path),[eC,eQ,eX,en.path]),tf=(0,Y.Gk)(),tm=(0,E.kO)(),tp=(0,g.fS)("claudeai_skill_artifact_integration"),th=eJ===h.qK.Skill&&tp,tg=tf&&(0,G.z)(en.path,tm),tv=("markdown"===eK||"plaintext"===eK)&&eQ,tb=eh&&eQ,tj=(0,h.Ys)(en.path,eJ)&&eQ,ty=(e=>{let[t,a]=(0,k.useState)("");return(0,k.useEffect)(()=>{if(!e)return void a("");let t=()=>{let t=_.c9.fromJSDate(e).toISO();if(!t)return void a("");a((0,v.d)(t)||"")};t();let s=setInterval(t,6e4);return()=>clearInterval(s)},[e]),t})(eC),tw=(0,k.useMemo)(()=>(0,V.k)({filePath:en.path,isShared:er,conversationUuid:er?void 0:ep,snapshotUuid:er?ep:void 0,source:"file_detail_view"}),[en.path,er,ep]),t_=(0,k.useCallback)(async()=>{if(!(null==ez?void 0:ez.uuid))return void eM(eF.formatMessage({defaultMessage:"Unable to load file content",id:"0IswH+G61x"}));if(!(0,h.IO)(en.path)){eg(void 0),eT([]),e_(!1),eb(!1),eM(null),eN(new Date);return}e_(!0),eM(null),eT([]);try{let e=en.path.replace("computer://",""),t=await z(er?{organizationUuid:ez.uuid,snapshotUuid:ep,filePath:e,isShared:!0}:{organizationUuid:ez.uuid,conversationUuid:ep,filePath:e,isShared:!1});if(eX){let e=await t.blob();eg(e),eT([])}else if(th){let e=await t.arrayBuffer(),s=(await a.e(52313).then(a.t.bind(a,0x3a5ed979,23))).default,n=await s.loadAsync(e),i=[],l=[];n.forEach((e,t)=>{let a;if(t.dir)return;let{isImage:s,isTextContent:n}=(0,D.G)(e);a=n?t.async("text").then(t=>{i.push({path:e,content:t})}):s?t.async("arraybuffer").then(t=>{let a=new Blob([t]);i.push({path:e,content:a})}):t.async("arraybuffer").then(t=>{i.push({path:e,content:t})}),l.push(a)}),await Promise.all(l),i.sort((e,t)=>e.path.localeCompare(t.path)),eT(i),eg(void 0)}else if(eQ){let e=await t.text();eg(e),eT([])}else{let e=await t.arrayBuffer();eg(e),eT([])}eM(null),eN(new Date)}catch(e){eM(eF.formatMessage({defaultMessage:"Failed to load file content",id:"6u3/Jh2Vzp"}))}finally{eb(!1),e_(!1)}},[null==ez?void 0:ez.uuid,en.path,eF,eX,th,er,ep,eQ]);(0,k.useEffect)(()=>{eA("normal"),eT([])},[en.path]),(0,k.useEffect)(()=>{(null==ex?void 0:ex.content)!==void 0?(eg(ex.content),e_(!1),eM(null),eN(new Date),eT([])):t_()},[t_,null==ex?void 0:ex.content,en.path]);let tk=(0,b.Y)(t_,{leading:!1,delay:ea});(0,k.useEffect)(()=>{(0,h.IO)(en.path)&&eb(!0),tk()},[tk,em,null==ex?void 0:ex.content,en.path]);let tM=(0,O.P)(),tC=()=>{(null==ez?void 0:ez.uuid)&&tM(er?{filepath:en.path,orgUuid:ez.uuid,snapshotUuid:ep,isShared:!0,source:"file_detail_view_header_button"}:{filepath:en.path,orgUuid:ez.uuid,conversationUuid:ep,isShared:!1,source:"file_detail_view_header_button"})},tN=async()=>{if(!eX&&"string"==typeof eh){if(eL.track({event_key:"wiggle.file.copy_to_clipboard",...tw}),eZ)try{let e=(0,W.u)(eh);await eR({text:eh,html:e})}catch(e){await eR(eh)}else await eR(eh);ey(!0),setTimeout(()=>ey(!1),2e3)}},tS=async t=>{let{operation:a}=t;if(e.isShared)return;let s=await ta.mutateAsync({path:en.path,operation:a}),n=(0,X.x)(a,s,tn);n&&await eR(n)},tA=(0,k.useCallback)(async()=>{if(void 0!==eh){eL.track({event_key:"wiggle.file.add_to_project",...tw}),e6(!0);try{let e=new File([eh],eP);await td([e],tu-(null!=tc?tc:0))}finally{e6(!1)}}},[eh,eP,td,tu,tc,eL,tw]),{displayName:tE,displayExt:tT}=(0,B.FT)(en.name);return(0,s.jsxs)("div",{className:"flex h-full flex-col relative",children:[(0,s.jsx)(s.Fragment,{children:"share"===ts?(0,s.jsx)(I.ke,{isOpen:e1,isProjectArtifact:!!(null==($=e9.data)?void 0:$.is_private),isLoading:ta.isPending,sharedLink:to||"",isShared:!!ta.data||(null==te?void 0:te.visibility)==="shared",onClose:()=>e2(!1),handleClickShareButton:()=>void tS({operation:"share"}),updateSharedState:()=>void 0}):"publish"===ts?(0,s.jsxs)(f.aF,{hasCloseButton:!0,modalSize:"lg",isOpen:e1,onClose:()=>{e2(!1),e4(!1)},title:(0,s.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:(0,s.jsx)(M.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"})}),children:[(0,s.jsx)("div",{className:"mt-2 flex flex-col gap-2.5",children:e3&&tr&&tl?(0,s.jsx)(U.Hz,{artifactUuid:tr,closeEmbedSettings:()=>e4(!1),embedLink:tl}):tr?(0,s.jsx)(U.L_,{artifactUuid:tr,publishedLink:to||"",onClose:()=>e2(!1)}):(0,s.jsx)(U._L,{title:eP,isLoading:ta.isPending,fetchScreenshot:()=>Promise.resolve(),setScreenshot:()=>void 0,handlePublishArtifact:()=>{tS({operation:"publish"})}})}),(0,s.jsx)(U.gy,{isPublished:!!(null==(es=ta.data)?void 0:es.published_artifact_uuid),isEmbedSettingsOpen:e3,onOpen:()=>e4(!0)})]}):null}),(0,s.jsxs)("div",{className:"flex items-center justify-between px-2 py-2 bg-bg-000 gap-2",children:[eu?(0,s.jsx)(u.$,{variant:"ghost",size:"icon",onClick:ei,disabled:!!ex,"aria-label":eF.formatMessage({defaultMessage:"Go back",id:"orvpWhO3rI"}),className:"!rounded-lg",children:(0,s.jsx)(c.ZK0,{})}):(0,s.jsx)("div",{className:"w-2",children:"\xa0"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 overflow-hidden",children:[e$&&(0,s.jsx)(d.Iz,{options:[{key:"normal",label:(0,s.jsx)(c.kU3,{size:20}),ariaLabel:eF.formatMessage({defaultMessage:"Preview",id:"TJo5E6JuIN"})},{key:"raw",label:(0,s.jsx)(c.CyN,{size:20}),ariaLabel:eF.formatMessage({defaultMessage:"Code",id:"h2vipunVVd"})}],initialKey:eS,onSelect:e=>{eA("normal"===e?"normal":"raw")},itemClassName:"!px-1"},eS),(0,s.jsxs)("h2",{className:(0,j.A)("text-sm font-normal text-text-200 truncate flex-1 min-w-0"),title:tE,children:[tE,tT?(0,s.jsx)("span",{className:"text-text-400 opacity-50",children:" \xb7 "}):"",tT&&(0,s.jsx)("span",{className:"text-text-400",children:tT})]}),(0,s.jsx)(y.N,{children:ej&&(0,s.jsxs)(w.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{enter:{duration:.4,ease:"easeOut"},exit:{duration:.3,ease:"easeIn"}},className:"flex items-center gap-1 text-sm text-success-200 ml-2 mr-3 flex-shrink-0",children:[(0,s.jsx)(c.rAV,{size:16,className:"text-success-200"}),(0,s.jsx)("span",{className:"text-success-200",children:(0,s.jsx)(M.A,{defaultMessage:"Copied",id:"p556q3uvbn"})})]})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[tg&&!er&&e.conversationUuid&&(0,s.jsx)(F.M,{file:en,conversationUuid:e.conversationUuid,source:"file_detail_view",variant:"secondary",size:"icon_sm",className:"!rounded-lg"}),!er&&e.conversationUuid&&tp&&(0,s.jsx)(P.a,{file:en,conversationUuid:e.conversationUuid,source:"file_detail_view",variant:"secondary",size:"sm",className:"!rounded-lg"}),eQ||eo||tv||tb?(0,s.jsx)("div",{className:"[&_button]:!text-xs [&>div]:!rounded-lg",children:(0,s.jsxs)(x.AM,{mainButtonText:tj?(0,s.jsx)(M.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}):(0,s.jsx)(M.A,{defaultMessage:"Download",id:"5q3qC0sC3r"}),onClickMainButton:tj?tN:tC,children:[eQ&&(0,s.jsx)(x.tJ,{onSelect:tj?tC:tN,children:tj?(0,s.jsx)(M.A,{defaultMessage:"Download",id:"5q3qC0sC3r"}):(0,s.jsx)(M.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},tj?"download":"copy"),eo&&(0,s.jsx)(x.tJ,{onSelect:tA,disabled:e5||!eh,children:(0,s.jsx)(M.A,{defaultMessage:"Add to project",id:"+mqxxzVczn"})},"addToProject"),tv&&(0,s.jsx)(x.tJ,{onSelect:async()=>{eL.track({event_key:"wiggle.file.download_as_pdf",...tw});try{await (0,L.NX)(en)}catch(e){eM(eF.formatMessage({defaultMessage:"Error downloading PDF",id:"fes7nfwp3b"}))}},children:(0,s.jsx)(M.A,{defaultMessage:"Download as PDF",id:"camH0DLf91"})},"downloadAsPdf"),tb&&(0,s.jsx)(x.tJ,{disabled:!tt,onSelect:()=>{eL.track({event_key:"share"===ts?"wiggle.file.share_artifact":"wiggle.file.publish_artifact",...tw}),e2(!0)},children:(0,s.jsxs)("div",{className:"flex flex-col",children:["share"===ts?(0,s.jsx)(M.A,{defaultMessage:"Share artifact",id:"FeSSOL+/49"}):(0,s.jsx)(M.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"}),(0,s.jsxs)("span",{className:"text-text-300 text-xs",children:[te&&ts&&("share"===ts?(0,s.jsx)(M.A,{defaultMessage:"Content already shared",id:"nTW7eXdjH7"}):(0,s.jsx)(M.A,{defaultMessage:"Content already published",id:"h9MXOgEjET"})),!(te&&ts)&&!e7&&(0,s.jsx)(M.A,{defaultMessage:"File is too large",id:"uFwMw7Ndmt"})]})]})},(null!=ts?ts:"")+"-"+en.path)]})}):(0,s.jsx)(u.$,{variant:"secondary",onClick:tC,size:"sm",className:"!rounded-lg",children:(0,s.jsx)(M.A,{defaultMessage:"Download",id:"5q3qC0sC3r"})}),(0,s.jsx)(m.Tooltip,{tooltipContent:ev||ew?eF.formatMessage({defaultMessage:"Refreshing",id:"crQQNCV/SV"}):ty?eF.formatMessage({defaultMessage:"Last refreshed {time}",id:"qVxqSOlF4R"},{time:ty}):void 0,delayDuration:50,children:(0,s.jsx)(u.$,{variant:"ghost",size:"icon",onClick:t_,disabled:ew||tx,children:(0,s.jsx)(c.MvQ,{size:20,className:(0,j.A)((ev||ew)&&"animate-spin")})})}),(0,s.jsx)(u.$,{variant:"ghost",size:"icon",onClick:el,children:(0,s.jsx)(c.X,{size:20})})]})]}),(0,s.jsx)("div",{className:"flex-1 min-h-0 bg-bg-000 overflow-auto",children:!ek&&eE.length>0?(0,s.jsx)(ee,{files:eE}):void 0!==eh||ew||ek||tx?(0,s.jsx)(K.as,{content:eh,displayFileType:tx?"nonrenderable":e0,language:eK,showRaw:"raw"===eS,richSandboxRef:eO,richSandboxCapabilities:eY,fileName:eP,onRefresh:t_,mimeType:eJ,isLoading:ew&&void 0===eh&&0===eE.length,error:ek,onRetry:t_}):(0,s.jsx)(et,{onLoad:t_})})]})}},0x1dad12e86:(e,t,a)=>{a.d(t,{z:()=>x});var s=a(0x52e2618c),n=a(0x22102fd88),i=a(0x14fe1b2a5),l=a(0x23977865),r=a(0x1bd175d8c),o=a(0x1a1f6dda6),d=a(0x151bca12b);function c(){let e=(0,s._)(["\n  from-bg-100\n  via-bg-100\n  via-65%\n  to-bg-100/0\n  pointer-events-none\n  absolute\n  inset-0\n  -bottom-5\n  z-[-1]\n  bg-gradient-to-b\n  blur-sm\n"]);return c=function(){return e},e}let u=i.J.div(c());function x(e){let{children:t,className:a,contentClassName:s,sticky:i,fixed:c,mdTitle:x,large:f,narrow:m}=e,{isMobile:p,isExpanded:h}=(0,d.VF)(),g=(0,r.V)(l.E_),v=!t&&!x,b=f&&!g;return(0,n.jsxs)("header",{className:(0,o.A)("flex w-full bg-bg-100",i&&"sticky top-0 z-header",c&&"fixed top-0 z-header",g?l.X_:"h-12",g&&[!h&&"pl-[133px]",!v&&l.zo],b&&["mx-auto md:h-24 md:items-end",m?"max-w-4xl":"max-w-7xl"],a),"aria-hidden":v,"data-testid":"page-header",children:[!g&&(i||c)&&(0,n.jsx)(u,{}),(0,n.jsx)("div",{className:(0,o.A)("flex w-full items-center justify-between gap-4",g&&h&&"lg:px-4",!g&&"pl-11 lg:px-8",g&&!(p&&h)&&"draggable","",s,b?"px-4 md:px-8":"pr-3"),children:x?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{className:(0,o.A)("text-text-200 flex items-center gap-2 text-center max-md:hidden min-w-0",g?"font-medium leading-tight":"font-heading",!g&&(b?"text-2xl":"text-lg")),children:(0,n.jsx)("span",{className:"truncate",children:x})}),(0,n.jsx)("div",{}),t]}):t})]})}},0x1dbbefd33:(e,t,a)=>{a.d(t,{g:()=>al,v:()=>ai});var s=a(0x52e2618c),n=a(0x22102fd88),i=a(0x628a9a0b),l=a(0x1dd44336e),r=a(0x209960a1a),o=a(0x1139502dd),d=a(0x164c6313f),c=a(0x209ab1f87),u=a(0x20805e624),x=a(0x226530adf),f=a(0x145d45a),m=a(0x14a6d5f1),p=a(0x1809b01ca),h=a(0x1065e6d73),g=a(0x14de19ae8),v=a(0x371cc700),b=a(0x14fe1b2a5),j=a(0x25d47d24),y=a(0x1b370f49d),w=a(0xfc89b4a4),_=a(0xac309a83),k=a(0x17f3a2521),M=a(0x1bd175d8c),C=a(0x1457b343f),N=a(0x1a1f6dda6),S=a(0x160045b25),A=a(0xc6536c20),E=a(0x17b9b473e),T=a(0xef41e510),z=a.n(T),R=a(0x4d348f95),I=a(0x38e6572),U=a(0x1ab0d1ca1),L=a(0x156c4e43b),O=a(0xb6b8b1fb),F=a(0x11af11324),P=a(0x22be9474c),D=a(0xbebfc702),B=a(0x1dfbc98e5),G=a(0x218bd2f97),W=a(0x945c7f20),V=a(0x2240fec63),q=a(0x1521a7ab3);let Y=()=>(0,n.jsxs)("div",{className:"animate-pulse flex flex-col gap-8 fade-out-bottom h-[calc(100vh-12.5rem)]",children:[(0,n.jsx)("div",{className:"group relative inline-flex gap-2 bg-bg-300 rounded-xl pl-2.5 py-2.5 break-words text-text-100 transition-all max-w-[75ch] flex-col",children:(0,n.jsx)("div",{className:(0,N.A)("rounded-full h-7 w-7 bg-text-200 opacity-40")})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-9/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]})]}),H=e=>{let{notificationPermission:t,enableNotifications:a,isFeatureEnabled:s=!0,visible:i=!0}=e,[l,r]=(0,w.useState)(!1);return(0,w.useEffect)(()=>{i?requestAnimationFrame(()=>{r(!0)}):r(!1)},[i]),(0,n.jsx)("div",{className:(0,N.A)("inline-block select-none text-text-300 transition-opacity relative -top-4",l?"opacity-100 delay-300 duration-700":"opacity-0 duration-0"),children:"granted"===t&&s?(0,n.jsx)(I.A,{defaultMessage:"Claude is working on your request. Check back later or start a new conversation.",id:"oiMwdVTmaV"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:(0,n.jsx)(I.A,{defaultMessage:"Get notified when Claude finishes longer tasks like this one.",id:"mBieR/vcEO"})}),(0,n.jsx)("button",{onClick:a,className:"text-text-300 hover:text-text-200 underline",children:(0,n.jsx)(I.A,{defaultMessage:"Turn on notifications",id:"IXF/1bytWQ"})})]})})};H.displayName="ChatNotification";let J=(0,w.memo)(H);var K=a(0x22bf04094),X=a(0x19a5dec78),Z=a(0x1156b3bea),Q=a(0x1b6a4a195),$=a(0x17e7bc007),ee=a(0xe13d4dc9);function et(e,t){let a=e.map(e=>t[e]).filter(e=>void 0!==e),s=[];for(let e of a)e.content&&s.push(...e.content);return{displayUuid:e[0],messageUuids:e,firstMessageUuid:e[0],lastMessageUuid:e[e.length-1],mergedContent:s,isChain:e.length>1,messages:a}}var ea=a(0x1f22b8dda),es=a(0x1020e1ec),en=a(0x1575c7741),ei=a(0x1bb0f43cc),el=a(0x17e725145),er=a(0xf071fd84),eo=a(0x1398bcf3b),ed=a(0x6f2a2354),ec=a(0x16801a2b9),eu=a(0x1fec22234),ex=a(0x225bae024),ef=a(0x8f813b9c),em=a(0x1e1f2a153),ep=a(0x146a6f00),eh=a(0x15a45ede),eg=a(0xb111083b),ev=a(0x1ab362a20),eb=a(0x1e711c04c),ej=a(0x18f9bc151),ey=a(0x18eb11a1c),ew=a(0x1dc411c0f),e_=a(0x286b4261),ek=a.n(e_),eM=a(0x1e140f433),eC=a(0x1e672f605);let eN=e=>{let{onClose:t,onBack:a,onDebug:s,title:i,isHidden:l,className:r}=e;return(0,n.jsxs)("div",{className:"shrink-0 flex items-center justify-between gap-4 w-full min-w-0 px-5 h-[3.25rem]",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[!!a&&(0,n.jsx)(ex.$,{variant:"ghost",size:"icon_sm",onClick:a,className:"-ml-1",disabled:l,children:(0,n.jsx)(eh.Z,{size:16})}),(0,n.jsx)("h2",{className:(0,N.A)("text-text-200 truncate text-sm min-w-0 text-ellipsis break-words text-nowrap",r),children:i}),!!s&&(0,n.jsx)(ex.$,{variant:"ghost",size:"icon_sm",onClick:s,disabled:l,children:(0,n.jsx)(eg.z,{size:16})})]}),(0,n.jsx)(ex.$,{variant:"ghost",size:"icon_sm",onClick:t,className:"-mr-1",disabled:l,children:(0,n.jsx)(ev.X,{size:16})})]})};function eS(e){let{compassStatus:t,onOpenSources:a}=e;if(!t.total_sources)return null;let s=(e=>{let t=new Map,a=new Map;for(let s of e)for(let e of s.annotated_snippets)for(let s of e.tool_calls)if("web_search"===s.tool_name||"web_fetch"===s.tool_name){let e=[];if("web_search"===s.tool_name){if(!s.output||"rich_content"!==s.output.type||!s.output.content)continue;e=s.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean)}if("web_fetch"===s.tool_name){if(!s.output||"rich_link"!==s.output.type||!s.output.link.url)continue;e=[s.output.link.url]}for(let t of e)if("string"==typeof t)try{let e=new URL(t),s="https://".concat(e.hostname),i=e.hostname.replace(/^www\./,""),l=a.get(i);a.set(i,{count:((null==l?void 0:l.count)||0)+1,icon:(null==l?void 0:l.icon)||(0,n.jsx)(eu.d,{url:s,size:14})})}catch(e){}}else if(s.output){let e=s.integration_name||s.tool_name,a="rich_content"===s.output.type?s.output.content.length:1,i=t.get(e);t.set(e,{count:((null==i?void 0:i.count)||0)+a,icon:(null==i?void 0:i.icon)||(0,n.jsx)(eC.r,{canShowLetterIcon:!0,size:14,iconUrl:s.server_icon_url||void 0,integrationName:s.integration_name||void 0,toolName:s.tool_name})})}let s=Array.from(t.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4),i=Array.from(a.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4);return s.concat(i).slice(0,4-s.length)})(t.agents),i=s.length>0?s[0][1].count:0,l=t.total_sources-s.reduce((e,t)=>t[1].count+e,0);return 0===s.length?null:(0,n.jsx)("button",{className:"transition-all w-full flex flex-col gap-3 px-4 py-3.5 border-0.5 border-border-300 rounded-xl hover:border-border-100  max-w-[456px]",onClick:a,children:(0,n.jsxs)("div",{className:"flex flex-col gap-2.5 my-1 w-full",children:[s.map((e,t)=>{let[a,{count:s,icon:l}]=e;return(0,n.jsxs)("div",{className:"flex items-center text-xs",children:[(0,n.jsx)("div",{className:"h-4 w-4 flex items-center justify-center mr-2",children:l}),(0,n.jsx)("p",{className:"text-left font-medium w-32 truncate text-text-100 pr-2",title:a,children:a}),(0,n.jsx)("p",{className:"w-24 text-right text-xs text-text-300 pr-2",children:(0,n.jsx)(I.A,{id:"WrpI57Uej/",defaultMessage:"{count, plural, one {# source} other {# sources}}",values:{count:s}})}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(ew.P.div,{className:"h-2 rounded-full bg-bg-400",initial:{width:0},animate:{width:"".concat(s/i*100,"%")},transition:{delay:.1*t,duration:.5}})})]},a)}),l>0&&(0,n.jsxs)("div",{className:"flex items-center text-xs text-text-300",children:[(0,n.jsx)(eb.H,{size:16,className:"text-text-300 mr-2"}),(0,n.jsx)("p",{children:(0,n.jsx)(I.A,{id:"QX3cxMJ9Tc",defaultMessage:"{totalSources, plural, one {# other source} other {# other sources}}",values:{totalSources:l}})})]})]})})}let eA=e=>{let{title:t,complete:a,className:s}=e;return(0,n.jsx)(ew.P.h3,{className:(0,N.A)("text-base text-text-100 font-claude-response",s),initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:a?t:(0,n.jsx)(ef.N,{children:t})},t)};function eE(e){let{title:t,description:a,numSources:s,onClick:i,complete:l}=e;return(0,n.jsxs)(ew.P.button,{variants:{initial:{opacity:0},animate:{opacity:1}},className:"text-left flex flex-col gap-1.5 transition-all duration-500 group/snippet cursor-pointer",onClick:i,children:[(0,n.jsx)(eA,{title:null!=a?a:t,complete:l}),(0,n.jsx)("div",{className:"transition-all flex flex-row items-center gap-1 text-xs text-text-500 group-hover/snippet:text-text-200",children:0===s?(0,n.jsx)(I.A,{id:"NmCRHK7Fm4",defaultMessage:"No sources yet"}):(0,n.jsx)(I.A,{id:"8NMeuJNj8z",defaultMessage:"{totalSources, plural, one {# source} other {# sources}}",values:{totalSources:s}})})]})}function eT(e){let{status:t,allSnippets:a,onOpenSources:s}=e,[i,l]=(0,w.useState)([]);return(0,w.useEffect)(()=>{!(t.agents.length<1)&&(i.length>=3||l((0,X.mk)({agents:t.agents,n:3})))},[null==t?void 0:t.agents,i.length,l]),(0,n.jsxs)("div",{className:"flex flex-col pt-4 pb-6 gap-4 w-full h-full text-sm text-text-200",children:[(0,n.jsx)(eS,{compassStatus:t,onOpenSources:()=>s(!0)}),a&&a.length>0&&(0,n.jsx)("div",{className:"flex flex-col gap-3",children:(0,n.jsx)(ew.P.div,{variants:{initial:{},animate:{transition:{staggerChildren:.08,delayChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col gap-4 w-full",children:a.map((e,t)=>(0,n.jsx)(eE,{...e,onClick:()=>s(!0,e.globalAgentIndex)},t))})})]})}function ez(e){let{data:t,onClose:a}=e,[s,i]=(0,w.useState)(!1),[l,r]=(0,w.useState)({sourcesOpen:!1}),{conversationUuid:o,organizationUuid:d,isShared:c,taskId:u}=t,{compassStatus:x}=(0,X.CH)({organizationUuid:d,conversationUuid:o,taskId:u,isShared:c});if(!x)return null;let f=(e,t)=>{r({sourcesOpen:e,index:t})},m=void 0,p=l.sourcesOpen||s;return(0,n.jsxs)("div",{className:"relative h-full w-full bg-bg-000",children:[(0,n.jsx)(ew.P.div,{className:"w-full h-full",animate:p?"minimized":"full",variants:{minimized:{scale:.95},full:{scale:1}},children:(0,n.jsx)(eR,{compassStatus:x,onClose:a,onDebug:m,handleOpenSources:f})}),(0,n.jsx)("div",{className:(0,N.A)("absolute top-0 left-0 right-0 bottom-0 h-full w-full pointer-events-none bg-always-black/[5%]",p?"opacity-100":"opacity-0")}),(0,n.jsx)(ew.P.div,{animate:p?"visible":"hidden",variants:{visible:{opacity:1,translateX:0},hidden:{opacity:0,translateX:"100%"}},transition:{ease:ep.A.snappyOut},className:(0,N.A)("absolute top-0 left-0 right-0 bottom-0"),children:(0,n.jsx)(eL,{isHidden:!p,compassStatus:x,onBack:s?()=>i(!1):()=>f(!1),onClose:a,onDebug:m,isDebug:s,agentIndex:l.index})})]})}function eR(e){let{compassStatus:t,onClose:a,onDebug:s,handleOpenSources:i}=e,l=(0,U.A)(),r=(0,X.OQ)(t),o=t.status,d=(0,X.Nw)(t),c=t.total_sources||0,u=t.agents.slice(1).flatMap((e,t)=>e.annotated_snippets.flat().filter(e=>e.tool_calls.length>0).map(a=>({...a,total_sources:e.total_sources,description:e.description||e.name,complete:!!(a.complete||e.completed_at),globalAgentIndex:t+1,numSources:e.total_sources}))),x=k.P5.indexOf(o),f=[{title:o===k.zu.Starting||o===k.zu.Planning?l.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"}):l.formatMessage({defaultMessage:"Research plan created",id:"MIzjwRDSc0"}),children:d?(0,n.jsx)(X.GT,{thought:d,className:"pt-4 pb-6"}):void 0,shown:!0,expandable:!!d},{title:o===k.zu.InitiatingAgents||o===k.zu.Searching?0===c?l.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):l.formatMessage({defaultMessage:"Gathering {count, plural, one {# source} other {# sources}} and counting...",id:"kQHn/iXQmy"},{count:c}):l.formatMessage({defaultMessage:"Gathered {count, plural, one {# source} other {# sources}}",id:"DU/dbPu5mV"},{count:c}),titleIcons:(0,n.jsx)(X.mq,{hrefs:(0,X.mk)({agents:t.agents,n:3})}),children:(0,n.jsx)(eT,{allSnippets:u,status:t,onOpenSources:i}),shown:x>=2||t.agents.length>1,expandable:u.length>0},{title:o===k.zu.Completed?l.formatMessage({defaultMessage:"Boom! Research report is ready",id:"8CCPGtuLnt"}):l.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"}),shown:x>=4,expandable:!1}],m=f.filter(e=>e.expandable).length,p=f.findLastIndex(e=>!!e.expandable),h=(0,w.useRef)(p),[g,v]=(0,w.useState)(p),[b,j]=(0,w.useState)(!0),y=(0,w.useCallback)((e,t,a)=>{j(a),t?v(e):v(+(0===e))},[j,v]);(0,w.useEffect)(()=>{p!==h.current&&y(p,!0,!1)},[y,p]);let _=[k.zu.Cancelled,k.zu.Failed,k.zu.TimedOut].includes(t.status),M=f.filter(e=>e.shown).length;return(0,n.jsxs)("div",{className:"flex flex-col h-full bg-bg-000 overflow-hidden",children:[(0,n.jsx)(eN,{onClose:a,onDebug:s,title:r,className:"font-medium"}),(0,n.jsxs)("div",{className:"flex flex-col overflow-y-auto px-5 pb-5 pt-1 -mt-1",children:[f.map((e,a)=>{let{expandable:s,shown:i,title:l,titleIcons:r,children:o}=e,d=_||a<M-1||t.status===k.zu.Completed;return(0,n.jsx)(eI,{title:l,titleIcons:r,noShimmer:d||_,complete:d,isExpanded:s&&g===a,snappyTransition:b,showLine:a<M-1||_||g===a,handleExpand:e=>y(a,e,!0),expandable:s,collapsible:m>1,shown:i,children:o},a)}),_&&(0,n.jsx)(eI,{title:t.status===k.zu.Cancelled?l.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"}):l.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),snappyTransition:!0,noShimmer:!0,isError:!0,handleExpand:ek(),shown:_})]})]})}function eI(e){let{title:t,titleIcons:a,complete:s,expandable:i,collapsible:l,shown:r,isExpanded:o,handleExpand:d,snappyTransition:c,noShimmer:u,isError:x,showLine:f,children:m}=e;return!!r&&(0,n.jsxs)("div",{className:"flex flex-row gap-3 min-h-[2.125rem] shrink-0",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center mt-[5px]",children:[(0,n.jsx)("div",{className:(0,N.A)("transition-all w-2.5 h-2.5 rounded-full shrink-0",x?"bg-danger-200":s?"bg-text-500":"bg-accent-main-200")}),f&&(0,n.jsx)("div",{className:(0,N.A)("transition-all h-full -mb-1 w-[1px]",s?"bg-border-300":"bg-gradient-to-b from-accent-main-200/50 to-accent-main-200/0")})]}),(0,n.jsxs)("div",{className:"w-full flex flex-col",children:[(0,n.jsx)("button",{className:"inline-flex items-center gap-1",onClick:()=>d(!o),disabled:!i||o&&!l,children:(0,n.jsxs)("h4",{className:(0,N.A)("flex flex-row items-center gap-2 transition-colors text-start text-text-100 hover:text-text-000 text-sm h-5 user-select-none",x&&"!text-danger-200"),children:[u?t:(0,n.jsx)(ef.N,{children:t}),(0,n.jsx)(S.N,{children:!!a&&!o&&(0,n.jsx)(ew.P.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},children:a})}),!!i&&l&&(0,n.jsx)(ej.a,{className:(0,N.A)("bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",o?"rotate-0":"-rotate-90"),size:12})]})}),(0,n.jsx)(eM.NG,{isExpanded:!!i&&!!o,isScrollable:!1,snappyTransition:c,className:"!max-h-none w-full",setIsExpanded:d,children:m})]})]})}function eU(e){var t,a;let{toolCall:s,isHidden:i}=e;if("web_fetch"===s.tool_name&&(null==(t=s.output)?void 0:t.type)==="rich_link"&&s.output.link.url){let{url:e,icon_url:t,title:a,subtitles:l}=s.output.link;return(0,n.jsx)(eM.aX,{isDisabled:i,isStreaming:!1,icon:(0,n.jsx)(eu.d,{fadeInOnLoad:!0,url:t,size:16}),text:(0,n.jsx)(I.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:a,b:e=>(0,n.jsx)("span",{className:"text-text-400",children:e})}}),handleClick:()=>{window.open(e,"_blank")},secondaryText:null==l?void 0:l[0],secondaryIcon:(0,n.jsx)(ey.B,{size:16,className:"text-text-300"}),isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0"})}return s.output?(0,n.jsx)(eC.K,{integrationName:s.integration_name||void 0,integrationIcon:s.server_icon_url||void 0,message:s.message,isExpandingDisabled:i,result:s.output,isStreaming:!1,isError:s.is_error,isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0",contentClassName:(null==(a=s.output)?void 0:a.type)==="json_block"?"":"!max-h-none",defaultExpanded:!0}):null}function eL(e){var t;let{isHidden:a,compassStatus:s,onClose:i,onDebug:l,onBack:r,isDebug:o,agentIndex:d}=e,c=(0,w.useRef)(null),u=(0,U.A)(),x=d?!!(null==(t=s.agents[d])?void 0:t.completed_at):s.status===k.zu.Completed,f=void 0===d?null:s.agents[d].description||s.agents[d].name,m=function(e,t){let a=[];for(let s of t?[e.agents[t]]:e.agents)for(let e of s.annotated_snippets)for(let t of e.tool_calls)t.output&&a.push({toolCall:t,timestamp:e.complete&&s.completed_at||s.started_at});return a.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),a.map(e=>{let{toolCall:t}=e;return t})}(s,d),p=void 0===d?s.total_sources:s.agents[d].total_sources;return(0,n.jsxs)("div",{className:(0,N.A)("text-sm bg-bg-000 h-full overflow-hidden flex flex-col",a&&"pointer-events-none user-select-none"),children:[(0,n.jsx)(eN,{onDebug:o?void 0:l,isHidden:a,title:o?"Ant only debug panel":u.formatMessage({defaultMessage:"{totalSources, plural, one {# source} other {# sources}} {status}",id:"8cAP0ZJRie"},{totalSources:p,status:x?"":(0,n.jsx)(I.A,{id:"um9oac7M9y",defaultMessage:"and counting..."})}),onClose:i,onBack:()=>{setTimeout(()=>{c.current&&(c.current.scrollTop=0)},500),r()}}),(0,n.jsxs)("div",{ref:c,className:"relative flex-1 overflow-auto px-5 pt-1 pb-5",children:[!!f&&(0,n.jsx)(eA,{title:f,complete:x,className:"pt-1 pb-5"}),m.length>0?(0,n.jsx)("div",{className:"flex flex-col gap-4",children:m.map((e,t)=>(0,n.jsx)(eU,{toolCall:e,isHidden:a},t))}):(0,n.jsx)("div",{className:"text-text-500 text-center px-8 py-16",children:(0,n.jsx)(I.A,{id:"yWSiuEkfbY",defaultMessage:"No sources found"})})]})]})}var eO=a(0x1c6cf1a02),eF=a(0x1a3383306),eP=a(0x1dbad8fd1);let eD=e=>{let{docUuid:t,projectUuid:a,goBack:s,onClose:i}=e,{data:l}=(0,eP.Rn)({projectUuid:a,docUuid:t});if(!l)return null;let r={file_name:l.file_name,file_size:l.content.length,file_type:"text/plain",extracted_content:l.content,origin:eF.R.UserUpload};return(0,n.jsx)(eO.f,{attachment:r,goBack:s,onClose:i})};var eB=a(0x1cdcf3e5a);let eG=(0,w.memo)(function(e){var t;let{conversationUuid:a,onClose:s,isStreaming:i,projectUuid:l,sendMessage:r,isOpen:o,isTemporary:d=!1}=e,c=(0,$.so)(a),{activeOrganization:u}=(0,g.YL)(),{chatResourceState:{selectedItem:x,activeMessageUuid:f,attachments:m,files:p,streamingFiles:h},dispatchChatResource:v}=(0,ec.i)(),b=null==u?void 0:u.uuid,j=(0,$.HF)(),y=null==(t=(0,eo.f)({conversationUuid:a,source:"w"}).data)?void 0:t.artifact_versions,_=(0,w.useMemo)(()=>{if(!x||"artifact"!==x.type||!y)return;let e=y.find(e=>e.uuid===(null==x?void 0:x.versionUuid));if(e)return{id:e.artifact_uuid,title:e.title,language:e.code_language,type:e.artifact_type,version_uuid:e.uuid,versions:[{command:"create",uuid:e.uuid,resultState:e.result_state,content:e.result_state,message:e.message_uuid,created_at:e.created_at,source:e.source,isClosed:!0}]}},[y,x]),k=(null==x?void 0:x.type)==="artifact"&&x.versionUuid?{uuid:x.versionUuid,type:"artifact_version"}:void 0,M=(0,en.f)({artifactContext:k}),C=(0,el.useQueryClient)(),N=(0,ei.j)({artifactContext:k,chatConversationUuid:a,onStorageChange:()=>{C.invalidateQueries({queryKey:[er.r$]})}}),S=(0,es.y)(m,p,b,l),A=(0,w.useMemo)(()=>({claudeComplete:M,getFile:S,storage:N}),[M,S,N]),E=(0,w.useCallback)(e=>{(null==x?void 0:x.type)==="artifact"&&v({type:"SELECT_ARTIFACT",id:x.id,versionUuid:e})},[x,v]),T=(0,w.useCallback)(e=>v({type:"SELECT_DOC",id:e}),[v]),z=(0,w.useCallback)(()=>v({type:"CLEAR_SELECTED"}),[v]),R=(null==x?void 0:x.type)==="artifact"&&j[x.id]?j[x.id]:_;return(0,n.jsx)(n.Fragment,{children:(null==x?void 0:x.type)==="artifact"&&R?(0,n.jsx)("div",{className:"relative h-full",children:(0,n.jsx)(ed.CV,{isStreaming:i,artifact:R,selectedArtifactMessageUuid:f,selectedArtifactVersionUuid:x.versionUuid,setSelectedArtifactVersionUuid:E,onClose:s,projectUuid:l,selectDoc:T,sendMessage:r,richSandboxCapabilities:A,isOpen:o,isTemporary:d})}):(null==x?void 0:x.type)!=="artifact"||j[x.id]?(null==x?void 0:x.type)==="attachment"?(0,n.jsx)(eO.f,{goBack:()=>v({type:"CLEAR_SELECTED"}),attachment:x.attachment,onClose:s}):(null==x?void 0:x.type)==="compass"?(0,n.jsx)(ez,{data:x.data,onClose:s,goBack:z}):l&&(null==x?void 0:x.type)==="doc"?(0,n.jsx)(eD,{docUuid:x.id,projectUuid:l,onClose:s,goBack:()=>v({type:"CLEAR_SELECTED"})}):(null==x?void 0:x.type)==="file"?(0,n.jsx)(eB.yL,{file:{path:x.path,name:x.path.split("/").pop()||x.path},showBackButton:x.path.startsWith("/mnt/user-data/outputs/"),goBack:()=>v({type:"CLEAR_SELECTED"}),onClose:s,conversationUuid:a,projectUuid:l,isTemporary:d,isShared:!1,isStreaming:i,streamingFile:h.get(x.path),artifactVersions:null!=y?y:[],cacheBuster:c},x.path):null:(0,n.jsx)(ed.CV,{isStreaming:i,artifact:void 0,selectedArtifactMessageUuid:f,selectedArtifactVersionUuid:(null==x?void 0:x.type)==="artifact"?x.versionUuid:void 0,setSelectedArtifactVersionUuid:E,onClose:s,projectUuid:l,selectDoc:T,sendMessage:r,richSandboxCapabilities:A,isOpen:o,isTemporary:d})})});var eW=a(0x1a2392a8c),eV=a(0xa5acf583),eq=a(0xb91ccc43),eY=a(0x1b03847fb),eH=a(0x965113a9),eJ=a(0xb4b79508),eK=a(0x1e6127894),eX=a(0x10b8a0309),eZ=a(0x2514ecdaf),eQ=a(0x23506e4da),e$=a(0x1babd1d4e),e0=a(0x1f507121),e1=a(0xec9172c1),e2=a(0x14a7c225d),e3=a(0x18b9bd76),e4=a(0x1f92f9b94);a(0x183548b63),(0,w.memo)(e=>{let{data:t}=e,a=(0,w.useMemo)(()=>t?JSON.stringify(t,null,2):"",[t]),{didCopy:s,copyToClipboard:i}=(0,em.C)(),l=(0,w.useCallback)(()=>{i(a)},[i,a]),r=(0,w.useCallback)(()=>{let e=new Blob([a],{type:"application/json"}),t=URL.createObjectURL(e),s=new Date().toISOString().replace(/[:.]/g,"-"),n=document.createElement("a");n.href=t,n.download="debug-".concat(s,".json"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)},[a]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"absolute top-6 right-16 flex items-center space-x-2",children:[(0,n.jsx)(ex.$,{variant:"ghost",size:"icon_sm",onClick:l,prepend:(0,n.jsx)(em.u,{didCopy:s}),tooltip:(0,n.jsx)(I.A,{defaultMessage:"Copy debug information",id:"XVVZO6tEau"}),className:"ml-auto"}),(0,n.jsx)(ex.$,{variant:"ghost",size:"icon_sm",onClick:r,prepend:(0,n.jsx)(eq.f5X,{}),tooltip:(0,n.jsx)(I.A,{defaultMessage:"Download debug information",id:"mmx3mC6aea"})})]}),(0,n.jsx)("textarea",{readOnly:!0,className:"h-96 overflow-auto break-words whitespace-pre-wrap text-xs font-mono p-2 my-3",children:a})]})}).displayName="SessionDebugModalContent";var e5=a(0x179f32fa9),e6=a(0x6912ce43),e8=a(0x2503e28ff);let e9=e=>{let{projectUuid:t}=e,{data:a}=(0,D.fo)(t);return a?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,n.jsx)(I.A,{defaultMessage:"Project content",id:"/IJPT7JRFn"})}),(0,n.jsxs)("div",{className:"border-border-400 rounded-lg border px-3 py-4",children:[(0,n.jsxs)(z(),{href:"/project/".concat(t),className:"hover:text-text-000 flex items-center gap-1.5 hover:underline",children:[(0,n.jsx)(e5.D,{size:16,className:"text-text-300 shrink-0"}),(0,n.jsx)("div",{className:"font-claude-response text-text-200 leading-tight",children:a.name})]}),(0,n.jsx)("div",{children:(0,n.jsx)(e8.t,{project:a,className:"text-text-400 text-xs"})}),(0,n.jsx)("ul",{className:"mt-2 flex flex-col",children:(0,n.jsx)(e6.b,{isEditable:!1,project:a,maxItems:3,onViewAll:()=>{window.location.href="/project/".concat(t)}})})]})]})}):null};var e7=a(0xce58ec20),te=a(0x113daa220);async function tt(e,t,a){try{let s=new URL("/api/organizations/".concat(e,"/conversations/").concat(t,"/wiggle/list-files"),window.location.origin);void 0!==a&&s.searchParams.append("prefix",a);let n=await fetch(s.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)return[];let i=await n.json();if(i.files_metadata)return i.files_metadata;if(i.files)return i.files.map(e=>({path:e,size:0,content_type:"application/octet-stream"}));return[]}catch(e){return[]}}let ta=(0,eQ.default)(()=>Promise.all([a.e(39883),a.e(46278),a.e(88059),a.e(44484)]).then(a.bind(a,0xa933a7a4)).then(e=>e.ShareModal),{loadableGenerated:{webpack:()=>[0xa933a7a4]},ssr:!1}),ts=(0,eQ.default)(()=>a.e(55457).then(a.bind(a,0x210f95561)).then(e=>e.WiggleSharingModals),{loadableGenerated:{webpack:()=>[0x210f95561]},ssr:!1});function tn(e){let{conversationUuid:t,projectUuid:a,sessionId:s,isStreaming:i,todos:l,debugInfo:r,isTemporary:o=!1,messagesLength:d=0}=e,c=(0,h.u9)(),{refetchAll:u,selectWiggleFile:x,wiggleFiles:f,wiggleSharedArtifacts:m}=function(e){let{conversationUuid:t,messagesLength:a=0,isStreaming:s}=e,n=(0,$.so)(t),i=(0,h.Yl)(),{isDrawerExpanded:l}=(0,e1.x)(),{chatResourceState:{selectedItem:r},dispatchChatResource:o}=(0,ec.i)(),d=(0,eo.f)({conversationUuid:t,source:"w"}),c=(0,w.useMemo)(()=>{var e,t;return null!=(t=null==(e=d.data)?void 0:e.artifact_versions)?t:[]},[d.data]),u=i&&l&&!r,x=function(e,t,a){let[s,n]=(0,w.useState)([]),[i,l]=(0,w.useState)(!1),[r,o]=(0,w.useState)(null),{activeOrganization:d}=(0,g.YL)(),c=(0,h.u9)(),u=(0,w.useCallback)(async()=>{if(c&&t&&(null==d?void 0:d.uuid)){l(!0),o(null);try{let e=(await tt(d.uuid,t,"")).map(e=>{let t=e.path.split("/").pop()||e.path;return{path:e.path,name:t,content_type:e.content_type||"application/octet-stream"}});n(e)}catch(e){o("Failed to load files")}finally{l(!1)}}},[c,t,null==d?void 0:d.uuid,""]);return(0,w.useEffect)(()=>{c&&a&&u()},[c,a,u]),{files:s,isLoading:i,error:r,refetch:u}}("",t,u),f=(0,w.useMemo)(()=>{var e;let t=[],a=[];return null==(e=x.files)||e.forEach(e=>{"/mnt/user-data/README.md"!==e.path&&(e.path.startsWith("/mnt/user-data/uploads/")||(e.path.startsWith("/mnt/user-data/outputs/")?t.push(e):a.push(e)))}),{output:t,scratchpad:a}},[x.files]),m=f.output.length+f.scratchpad.length,p=(0,w.useCallback)((e,t)=>{o({type:"SELECT_FILE",path:e.replace("computer://",""),toolType:"create_file",messageId:t})},[o]),v=(0,w.useCallback)(async()=>{i&&await Promise.all([x.refetch(),d.refetch()])},[i,x,d]),b=(0,w.useCallback)(async()=>{i&&await x.refetch()},[i,x]),j=(0,te.Y)(v,{leading:!1,delay:eB.XO});(0,w.useEffect)(()=>{r||j()},[l,n]);let y=(0,w.useRef)(!1);return(0,w.useEffect)(()=>{if(a){if(y.current&&!s){let e=$.oz.getState(),a=e.pathUuidsByConversation[t]||[],s=a[a.length-1],n=s?e.messageByUuid[s]:void 0;if(n&&"assistant"===n.sender&&Array.isArray(n.content)&&n.content.some(e=>(null==e?void 0:e.type)==="tool_use"&&(e.input?JSON.stringify(e.input):"").includes("outputs"))){let e=setTimeout(()=>{b()},2e3);return()=>clearTimeout(e)}}y.current=s}},[s,t,b,a]),{wiggleGate:i,showWiggleControls:u,refetchAll:v,refetchWiggleRoot:b,selectWiggleFile:p,wiggleFiles:f,wiggleFilesCount:m,wiggleSharedArtifacts:c}}({conversationUuid:t,messagesLength:d,isStreaming:i}),{isDrawerExpanded:p}=(0,e1.x)(),{chatResourceState:{selectedItem:v,activeMessageUuid:b,files:j,syncSources:_},dispatchChatResource:k}=(0,ec.i)(),{activeOrganization:C}=(0,g.YL)(),[S,A]=(0,w.useState)(null),E=(0,U.A)(),T=(0,e$._)({conversationUuid:t,isStreaming:i}),[z,R]=(0,w.useState)(!1),L=0===f.output.length&&0===m.length&&0===f.scratchpad.length&&0===j.length&&0===_.length&&!l,O=(0,M.V)(),F=(0,e0._)();return c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,N.A)("flex flex-col relative","max-md:absolute max-md:inset-x-0 max-md:top-0",v&&"max-md:hidden",!v&&p&&"max-md:z-header",v&&p&&"md:z-0",!p&&"max-md:pointer-events-none max-md:absolute max-md:inset-0"),inert:!!v&&!!p||void 0,children:[(0,n.jsx)(ti,{sessionId:s,wiggleFiles:f,isTemporary:o,isStreaming:i,messagesLength:d,shareState:T,todos:l,debugInfo:r}),!L&&(0,n.jsx)("div",{className:(0,N.A)("overflow-x-hidden overflow-y-auto md:h-[calc(100%-56px)]","max-md:h-full max-md:border-t max-md:border-border-300 max-md:bg-bg-100","md:transition-[width] md:duration-300 md:ease-in-out",p?"w-full md:mt-12 md:m-2 md:w-[384px] p-5 border-0.5 border-border-300 md:rounded-2xl max-md:border-0":"w-0 p-0 m-0 border-0 overflow-hidden",v&&"md:absolute",O&&p&&"md:mt-[62px]",o&&p&&"md:mt-14"),children:(0,n.jsx)("div",{className:(0,N.A)(p?"md:w-[342px]":"w-0"),children:(0,n.jsxs)("div",{className:(0,N.A)("flex flex-col gap-5 md:transition-opacity md:duration-300",p?"md:animate-[fade_0.3s_ease-in-out_0.1s_forwards]":"opacity-0 pointer-events-none"),children:[f.output.length?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"font-medium text-sm",children:(0,n.jsx)(I.A,{defaultMessage:"Artifacts",id:"eW5eoWkxy3"})}),(0,n.jsx)(ex.$,{variant:"ghost",prepend:(0,n.jsx)(eJ.e,{size:14}),className:(0,N.A)("text-sm font-medium opacity-0",f.output.length>1&&"opacity-100"),size:"sm",onClick:()=>{(null==C?void 0:C.uuid)&&F({filepaths:f.output.map(e=>e.path),orgUuid:C.uuid,conversationUuid:t,isShared:!1,source:"chat_controls_download_all_button"})},children:(0,n.jsx)(I.A,{defaultMessage:"Download all",id:"V1UrPNM96z"})})]}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:f.output.map(e=>(0,n.jsx)(y.Tooltip,{align:"end",tooltipContent:e.name,side:"bottom",children:(0,n.jsx)("div",{children:(0,n.jsx)(e3._,{file:e,conversationUuid:t,onOpen:()=>x(e.path,b||""),isInSidebar:!0,isShared:!1},e.path)})},e.path))})]}):null,m.length?(0,n.jsx)(tl,{artifactVersions:m,onSelectArtifactVersion:e=>{k({type:"SELECT_ARTIFACT",id:"",versionUuid:e})},onComplete:e=>A(e)}):null,f.scratchpad.length?(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsxs)("button",{className:"flex font-medium items-center justify-between p-1 hover:bg-bg-300 rounded-md",onClick:()=>R(e=>!e),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(I.A,{defaultMessage:"Scratchpad",id:"Qb4YubxAW2"}),(0,n.jsx)(y.Tooltip,{tooltipContent:E.formatMessage({defaultMessage:"Files used to create artifacts",id:"T2w69cOLhV"}),side:"right",children:(0,n.jsx)(eK.m,{})})]}),(0,n.jsx)(eX.J,{className:(0,N.A)("transition",z?"rotate-90":"")})]}),(0,n.jsx)(tr,{isExpanded:z,children:(0,n.jsx)("div",{className:"flex flex-col gap-2",children:f.scratchpad.map(e=>(0,n.jsx)(ex.$,{variant:"ghost",prepend:(0,n.jsx)(e2.o,{path:e.path}),className:"!justify-start",onClick:()=>{x(e.path,b||"")},children:e.name},e.path))})})]}):null,a&&(0,n.jsx)(e9,{projectUuid:a}),(0,n.jsx)(to,{}),l.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{className:"font-medium text-sm",children:"TODOs"}),(0,n.jsx)("ul",{className:"list-disc pl-4",children:l.map((e,t)=>(0,n.jsx)(td,{todo:e},t))})]})]})})})]}),S&&(0,n.jsx)(ts,{artifactVersion:S,onClose:()=>A(null),onUpdate:async()=>{await u(),A(null)},projectUuid:a}),T.showShareModal&&(0,n.jsx)(ta,{...T})]}):null}function ti(e){let{sessionId:t,wiggleFiles:a,isTemporary:s,isStreaming:i,messagesLength:l,shareState:r,todos:o,debugInfo:d}=e,c=(0,U.A)(),u=(0,M.V)(),{isDrawerExpanded:x,setIsDrawerExpanded:f}=(0,e1.x)(),{chatResourceState:{selectedItem:m,files:p,syncSources:h},dispatchChatResource:g}=(0,ec.i)(),v=p.length+h.length,b=a.output.length+a.scratchpad.length+v+o.length,j=(0,w.useMemo)(()=>x?c.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}):c.formatMessage({defaultMessage:"Open sidebar",id:"+G35mRWa75"}),[c,x]);(0,_.fS)("yukon_gold_debug_menu_enabled");let[y,k]=(0,w.useState)(!1);return(0,n.jsxs)("div",{className:(0,N.A)("md:absolute md:right-0 md:top-0 z-20","max-md:w-fit max-md:self-end max-md:pointer-events-auto","flex justify-end shrink-0 min-w-0 pr-3 items-center gap-1",u?"!h-[52px] draggable":"!h-12","transition-opacity duration-150 ease-in-out",m&&x?"md:opacity-0 md:pointer-events-none":"md:opacity-100 delay-300",u&&x&&!m&&["md:shadow-[0px_1px_0px_0px_theme(colors.border-300)]","w-full"],s&&"pt-3"),"data-testid":"wiggle-controls-actions",children:["",b>0&&(0,n.jsx)(ex.$,{"aria-label":j,tooltip:j,variant:"ghost",size:"icon_sm",onClick:()=>{g({type:"CLEAR_SELECTED"}),f(!x)},"data-testid":"wiggle-controls-actions-toggle",className:x?"!bg-bg-400":void 0,children:(0,n.jsx)(eq.ZHH,{})}),!s&&!i&&!t&&l>0&&(0,n.jsx)(ex.$,{tooltip:u&&(0,n.jsx)(I.A,{defaultMessage:"Share chat",id:"bXa+lJhlYV"}),variant:u?"ghost":"secondary",size:u?"icon_sm":"sm",onClick:r.handleShareClick,disabled:r.isCheckingShareability,prepend:u&&(0,n.jsx)(eq.SYj,{}),"data-testid":"wiggle-controls-actions-share",children:!u&&(0,n.jsx)(I.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})]})}function tl(e){let{artifactVersions:t,onSelectArtifactVersion:a,onComplete:s}=e,{publishedArtifactsBaseUrl:i}=(0,eV._r)(),{copyToClipboard:l}=(0,em.C)();return(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h3",{className:"text-text-500 text-xs",children:(0,n.jsx)(I.A,{defaultMessage:"Shared",id:"kWI6zXRaHY"})})}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:t.map(e=>{let t=e.published_artifact_uuid?"publish":"share",r=e.published_artifact_uuid?e.published_artifact_deleted_at?(0,n.jsx)(I.A,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"}):(0,eH.d)(e.created_at):"shared"===e.visibility?(0,eH.d)(e.created_at):"private"===e.visibility?(0,n.jsx)(I.A,{defaultMessage:"Unshared",id:"0r/9ANkloS"}):null;return(0,n.jsxs)("div",{className:"flex-1 flex items-center",children:[(0,n.jsxs)(ex.$,{variant:"ghost",className:"flex-1 !justify-start !px-2 text-sm gap-1.5",onClick:()=>{a(e.uuid)},children:[(0,n.jsx)(eq.Xq1,{size:20,className:"shrink-0"}),(0,n.jsxs)("span",{className:"flex items-center min-w-0 overflow-hidden",children:[(0,n.jsx)("span",{className:"truncate",children:e.title}),(0,n.jsx)(eZ.c,{size:16,className:"shrink-0"}),(0,n.jsx)("span",{className:"text-xs text-text-500",children:r})]})]}),(0,n.jsxs)(eY.ms,{align:"end",trigger:(0,n.jsx)(ex.$,{variant:"ghost",size:"icon_sm",children:(0,n.jsx)(eq.qwz,{size:20})}),children:[(0,n.jsx)(eY.tJ,{onClick:()=>{l((0,e7.x)(t,{artifact_uuid:e.artifact_uuid,artifact_version_uuid:e.uuid,message_uuid:e.message_uuid,published_artifact_uuid:e.published_artifact_uuid},i))},children:(0,n.jsx)(I.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})}),e.published_artifact_deleted_at?null:(0,n.jsx)(eY.tJ,{onClick:()=>s(e),children:"publish"===t?(0,n.jsx)(I.A,{defaultMessage:"Unpublish",id:"VjZ6FKc+ZZ"}):"shared"===e.visibility?(0,n.jsx)(I.A,{defaultMessage:"Unshare",id:"bEq+NWNIXF"}):(0,n.jsx)(I.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})]})]},e.uuid)})})]})}function tr(e){let{children:t,isExpanded:a}=e;return(0,n.jsx)(ew.P.div,{className:"overflow-hidden shrink-0",tabIndex:-1,initial:{opacity:0,height:a?"auto":0},animate:a?"expanded":"collapsed",transition:{ease:"easeInOut",duration:.4},variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:t})}function to(){let{chatResourceState:{files:e,attachments:t,syncSources:a},dispatchChatResource:s}=(0,ec.i)();return e.length+a.length>0?(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h3",{className:"font-medium text-sm",children:(0,n.jsx)(I.A,{defaultMessage:"Content",id:"Jq3FDzj0/T"})})}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:(0,n.jsxs)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))] gap-3",children:[e.map((e,t)=>(0,n.jsx)(eW.NM,{size:"stretch",file:e},"".concat(e.file_kind,"-").concat(t))),t.map((e,t)=>(0,n.jsx)(eW.NM,{size:"stretch",file:e,handleClick:()=>s({type:"SELECT_ATTACHMENT",attachment:e})},"attachment-".concat(t))),a.map(e=>(0,n.jsx)(e4.br,{size:"stretch",syncSource:e,isEditable:!1,location:"chat"},e.uuid))]})})]}):null}function td(e){let{todo:t}=e;return"completed"===t.status?(0,n.jsxs)("li",{className:"line-through",children:[t.content," "]}):"in_progress"===t.status?(0,n.jsxs)("li",{children:[t.activeForm," \uD83D\uDD04"]}):(0,n.jsx)("li",{className:"italic",children:t.content})}var tc=a(0x139b5e710),tu=a(0x8ca4d894);function tx(e){let{conversationUuid:t}=e,a=(0,R.useRouter)(),s=(0,tc.Y)(),[i,l]=(0,w.useState)(!1),r=(0,$.xJ)(t);return(0,n.jsxs)("div",{className:" flex flex-col gap-1.5 border-0.5 border-border-300 bg-bg-100 rounded-t-xl text-text-300 font-ui z-10 p-6 ",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row items-center sm:justify-between font-medium",children:[(0,n.jsx)("div",{className:"text-lg",children:(0,n.jsx)(I.A,{defaultMessage:"Chat ended by Claude",id:"dHdfbAOK+j"})}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(ex.$,{onClick:()=>a.push("/new"),children:(0,n.jsx)(I.A,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),(0,n.jsx)(ex.$,{variant:"secondary",onClick:()=>l(!0),children:(0,n.jsx)(I.A,{defaultMessage:"Give feedback",id:"bCmvTYWKoj"})})]})]}),(0,n.jsx)(tu.B,{conversationUuid:t,requestedFeedbackType:k.kj.CHAT_ENDED,setRequestedFeedbackType:()=>{},message:r,isOpen:i,onClose:()=>{l(!1)},onSuccess:()=>s.addSuccess("Feedback submitted"),showOptions:!1})]})}var tf=a(0x9cb4c2a2),tm=a(0x109513363),tp=a(0x12c9046cd),th=a(0x1de4b2c21),tg=a(0x31bda27d),tv=a(0x2524bdea9),tb=a(0xf32c56dd),tj=a(0x22fc8d729),ty=a(0x20e00cddd);function tw(){let e=(0,s._)(["\n  w-full\n  flex\n  gap-2\n  bg-warning-900\n  px-3\n  py-2\n  ","\n"]);return tw=function(){return e},e}let t_=["consumer_restricted_mode","consumer_second_warning","consumer_first_warning","recent_election_discussion"],tk=e=>{let{long:t}=e;return(0,n.jsx)(tj.Y,{href:ty.Z1,target:"_blank",rel:"noreferrer",children:t?(0,n.jsx)(I.A,{defaultMessage:"Learn more about the types of prompts to avoid {arrow}",id:"6DZ92vAY0j",values:{arrow:"\xbb"}}):(0,n.jsx)(I.A,{defaultMessage:"Learn more {arrow}",id:"ZeACTbo6DM",values:{arrow:"\xbb"}})})},tM={consumer_restricted_mode:[{isDismissible:!1,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.A,{defaultMessage:"Because a large number of your prompts have violated our Acceptable Use Policy, we have temporarily applied enhanced safety filters to your chats.",id:"PzePYdPNe4"})," ",(0,n.jsx)(tk,{})]})}],consumer_second_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.A,{defaultMessage:"It appears your recent prompts continue to violate our Acceptable Use Policy. If we continue seeing this pattern, well apply enhanced safety filters to your chats.",id:"BjivfV2YY6"})," ",(0,n.jsx)(tk,{})]})}],consumer_first_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.A,{defaultMessage:"It looks like a few of your recent prompts dont meet our Usage Policy.",id:"Aup/Kzn3Eq"})," ",(0,n.jsx)(tk,{long:!0})]})}],recent_election_discussion:[{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(I.A,{defaultMessage:"Claude may not be able to provide accurate, real time information on elections. Please visit <link>TurboVote</link> or check the Secretary of State site for your state to get reliable, up-to-date, non partisan guidance on how and where to vote in elections across the US.",id:"X4J/f3yO08",values:{link:e=>(0,n.jsx)(tj.Y,{href:"http://claude.turbovote.org",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"US"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(I.A,{defaultMessage:"The United Kingdoms general elections will be held on 4 July, 2024. Please visit the <link>UK Election Commissions website</link> to get reliable, up-to-date, impartial guidance on how and where to vote in the United Kingdoms general elections.",id:"VUvO/yD1Iw",values:{link:e=>(0,n.jsx)(tj.Y,{href:"https://www.electoralcommission.org.uk/",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"GB"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(I.A,{defaultMessage:"The French legislative elections will be held in two rounds of voting on June 30 and July 7, 2024. Please consult <link>the French Public Administration website</link> for reliable and up-to-date guidance on where and how to vote in the legislative elections in France.",id:"ZzEMOJWfNz",values:{link:e=>(0,n.jsx)(tj.Y,{href:"https://www.service-public.fr/particuliers/vosdroits/N47",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"FR"}]};function tC(e){let{isClaudeDot:t,content:a,isDismissible:s,handleDismiss:i}=e;return(0,n.jsx)("div",{className:t?"fixed top-8 z-10 p-4":"",children:(0,n.jsx)(tS,{$isFloating:t,children:(0,n.jsxs)("div",{className:"items-top flex justify-between",children:[(0,n.jsx)("p",{className:"text-sm font-medium",children:a}),s&&i&&(0,n.jsx)("button",{className:"h-5 cursor-pointer",onClick:()=>void i(),children:(0,n.jsx)(ev.X,{size:24})})]})})})}function tN(e){let{conversationUuid:t}=e,a=(0,tb.st)(),s=(0,eV.fZ)(),{account:i,activeOrganization:l}=(0,g.YL)(),r=null==i?void 0:i.uuid,o=null==l?void 0:l.uuid,{mutateAsync:d}=(0,P.iD)(),{data:c}=(0,P.Nj)(null==l?void 0:l.uuid),u=(0,eV._r)().ipCountry,x=(null==c?void 0:c.active_flags)&&(null==c?void 0:c.active_flags.map(e=>e.type)),{shownFlagType:f,shownFlagDetails:m}=function(e,t){let a=t_.findIndex(e=>null==t?void 0:t.includes(e)),s=t_[a];if(!s)return{shownFlagType:null,shownFlagDetails:null};let n=tM[s].filter(t=>!t.applicable_country||t.applicable_country===e);return 0===n.length?{shownFlagType:null,shownFlagDetails:null}:{shownFlagType:s,shownFlagDetails:n[0]}}(u,x);if((0,w.useEffect)(()=>{r&&o&&f&&a.track({event_key:"ts.banner.shown",flag_type:f,conversation_uuid:t,account_uuid:r,organization_uuid:o,ipCountry:null!=u?u:"unknown"})},[a,f,t,r,o,u]),!f||!m)return;let{isDismissible:p,content:h}=m,v=async()=>{if(!p)return;let e=[f];"consumer_second_warning"===f&&(null==x?void 0:x.includes("consumer_first_warning"))&&e.push("consumer_first_warning"),await Promise.all(e.map(e=>d({flagType:e})))};return(0,n.jsx)(tC,{isClaudeDot:s,content:h,isDismissible:p,handleDismiss:v})}let tS=b.J.div(tw(),e=>e.$isFloating&&"max-w-3xl\n    mx-auto\n    rounded-md\n    shadow-element\n    z-toast");var tA=a(0xc2b194c7),tE=a(0xfb22fb91),tT=a(0xbe918926),tz=a(0x2386dd430),tR=a(0x2aa8c688),tI=a(0x637b2a22),tU=a(0x24c42c570);let tL=["apps_and_websites","documents_and_templates","games","productivity_tools","creative_projects","quiz_or_survey","start_from_scratch"],tO=e=>{var t;let{selectedLabel:a,disabled:s}=e,l=(0,U.A)(),{track:r}=(0,tb.st)(),o=new Map([["apps_and_websites",l.formatMessage({defaultMessage:"Apps and websites",id:"HC16Tj5QBT"})],["documents_and_templates",l.formatMessage({defaultMessage:"Documents and templates",id:"mLy6zrc3XL"})],["games",l.formatMessage({defaultMessage:"Games",id:"DUyJmj7sj9"})],["productivity_tools",l.formatMessage({defaultMessage:"Productivity tools",id:"t/RMra2cqp"})],["creative_projects",l.formatMessage({defaultMessage:"Creative projects",id:"gZSnjM59XP"})],["quiz_or_survey",l.formatMessage({defaultMessage:"Quiz or survey",id:"yyPDfhkUT7"})],["start_from_scratch",l.formatMessage({defaultMessage:"Start from scratch",id:"fGhwMpK3XG"})]]),d=new Map(Array.from(o,e=>e.reverse())),c=new Map([["apps_and_websites",tA.E],["documents_and_templates",tE.i],["games",tT.H],["productivity_tools",tz.l],["creative_projects",tR.e],["quiz_or_survey",tI.S],["start_from_scratch",tU.f]]),{sendTransparentMessage:u,conversation:x}=(0,tf.oM)(),{mutate:f}=(0,i.HF)(null==x?void 0:x.id),m=null!=(t=d.get(null!=a?a:""))?t:"default",p=async e=>{o.has(e)&&(r({event_key:"artifact.studio.create_mode_selected",create_mode:e}),(null==x?void 0:x.id)&&f({settings:{enabled_monkeys_in_a_barrel:!1}}),await u(o.get(e)))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"font-claude-response-body pl-2 mt-1",children:(0,n.jsx)(I.A,{defaultMessage:"Lets get cooking! Pick an artifact category or start building your idea from scratch.",id:"HKJSK13xqN"})}),(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 max-w-xl justify-center items-stretch w-full",children:tL.map(e=>{let t=c.get(e);return(0,n.jsx)("div",{className:(0,N.A)("relative w-full h-full min-h-[3.5rem] sm:h-28 p-3 sm:p-3.5 font-base bg-bg-000 rounded-lg transition-colors group",m===e&&"border-0.5 text-text-100 bg-bg-000 shadow-sm",("default"!==m&&m!==e||"default"===m&&s)&&"text-text-500 bg-bg-000/50 border-0.5 border-border-300","default"===m&&!s&&"border-0.5 border-border-300 text-text-300 hover:border-text-200 hover:bg-bg-000 hover:text-text-100 cursor-pointer shadow-sm"),onClick:async()=>{"default"!==m||s||await p(e)},children:(0,n.jsxs)("div",{className:"flex flex-row sm:flex-col items-center sm:items-start justify-center sm:justify-start h-full w-full gap-3 sm:gap-0",children:[t&&(0,n.jsx)(t,{size:20,weight:"light",className:(0,N.A)("transition-transform duration-300 ease-out shrink-0 sm:absolute sm:bottom-4 sm:right-4","default"===m&&!s&&"group-hover:-rotate-2 sm:group-hover:rotate-2 group-hover:scale-105")}),(0,n.jsx)("span",{className:"flex-1 text-left",children:o.get(e)})]})},e)})})]})};var tF=a(0xd1db3b6);let tP=e=>{let{scrollRefs:t,autoScrollRef:a,messageCount:s,additionalBuffer:i=0,parentContainerRef:l,disablePinToTop:r=!1,disableInitialScrollToBottom:o=!1}=e,d=(0,w.useRef)(s),c=(0,tF.Q)(),u=(0,w.useCallback)(()=>{var e,a,s,n,r,o;let d=(null==(e=t.lastAssistantMessage.current)?void 0:e.clientHeight)||0,u=(null==(a=t.lastHumanMessage.current)?void 0:a.clientHeight)||0,x=(null==(n=t.chatInput)||null==(s=n.current)?void 0:s.clientHeight)||0,f=(null==(r=t.extras.current)?void 0:r.clientHeight)||0,m=c?parseFloat(Q.Ih)*parseFloat(getComputedStyle(document.documentElement).fontSize):0,p=Math.max(((null==l||null==(o=l.current)?void 0:o.clientHeight)||window.innerHeight)-u-d-f-x-m-(i||112),0);t.extraSpace.current&&(t.extraSpace.current.style.height="".concat(p,"px"))},[t.lastAssistantMessage,t.lastHumanMessage,t.chatInput,t.extras,t.extraSpace,c,l,i]);return(0,w.useLayoutEffect)(()=>{if(d.current!==s){var e;u();let t=null==(e=a.current)?void 0:e.getScrollContainer();t&&!r&&t.scrollTo({top:t.scrollHeight-t.clientHeight,behavior:"smooth"})}d.current=s},[s,u,a,r]),(0,w.useLayoutEffect)(()=>{let e=new ResizeObserver(()=>{u()});return[t.lastAssistantMessage,t.lastHumanMessage,t.chatInput,t.extras].forEach(t=>{(null==t?void 0:t.current)&&e.observe(t.current)}),window.addEventListener("resize",u),()=>{e.disconnect(),window.removeEventListener("resize",u)}},[t,u,s]),(0,w.useLayoutEffect)(()=>{var e;o||null==(e=a.current)||e.scrollToBottom("instant")},[a,o]),(0,n.jsx)("div",{ref:t.extraSpace,"aria-hidden":"true"})};function tD(){return(0,n.jsx)(ew.P.figure,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-text-100 flex flex-col gap-8 text-center","data-testid":"empty-chat-screen",children:(0,n.jsxs)("h2",{className:"font-title flex flex-col items-center justify-center gap-2 sm:flex-row",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(j.a,{state:"waiting"})}),(0,n.jsx)(I.A,{defaultMessage:"What can I help you with today?",id:"1PnN/uP0zv"})]})})}var tB=a(0x1c8eb913f);let tG="/Spark/",tW=[19,17,16,15,14,13,12,11,1,11,12,13,14,15,16,17,19],tV="".concat(tG,"/Check.svg"),tq=L.Ik({changeTitle:L.zM().optional(),titleDelayMs:L.ai().optional(),changeFavicon:L.zM().optional(),faviconDelayMs:L.ai().optional(),playSound:L.zM().optional()}),tY={};var tH=a(0x193cc7eb2);let tJ=(0,w.forwardRef)((e,t)=>(0,n.jsx)("div",{ref:t,"aria-hidden":"true",className:"h-px w-full pointer-events-none"}));tJ.displayName="LastMessageSentinel";var tK=a(0x1a6b4f7ae);function tX(e){let{autoscrollRef:t,sentinelElement:a,isStreaming:s=!1,avatarState:i="static"}=e,l=(0,U.A)(),[r,o]=(0,w.useState)(!1),d=(0,w.useCallback)(()=>{let e=t.current;e&&(e.scrollToBottom("instant"),s&&e.setPinToBottom(!0))},[t,s]);return(0,w.useEffect)(()=>{if(!s){var e;null==(e=t.current)||e.setPinToBottom(!1)}},[s,t]),(0,w.useEffect)(()=>{var e;if(!a)return;let s=null==(e=t.current)?void 0:e.getScrollContainer();if(!s)return;let n=new IntersectionObserver(e=>{let[t]=e;o(!t.isIntersecting)},{root:s,threshold:.01,rootMargin:"0px 0px ".concat(150,"px 0px")});return n.observe(a),()=>{n.disconnect()}},[a,t]),(0,n.jsxs)("button",{onClick:d,"aria-label":l.formatMessage({defaultMessage:"Scroll to bottom",id:"p4l9m92DsT"}),className:(0,N.A)("z-[1] size-9 inline-flex items-center justify-center","absolute -top-8 left-1/2 -translate-x-1/2","border-0.5 overflow-hidden !rounded-full p-1","shadow-md hover:shadow-lg","bg-bg-000/80 hover:bg-bg-000","backdrop-blur transition-opacity duration-200",s?"border-accent-brand/30":"border-border-300",r?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:[(0,n.jsx)(j.a,{state:i,className:(0,N.A)("absolute blur-md transition duration-300 pointer-events-none",s?"opacity-50":"opacity-0")}),(0,n.jsx)(tK.y,{className:"mix-blend-luminosity"})]})}a(0x25062734b),a(0x5ba03586),a(0xec7fcf66);var tZ=a(0x24fcf6beb);a(0x1b643ff5e);let tQ=new Set(["md","markdown","mdown","mkdn","mkd","mdwn","mdtxt","mdtext"]),t$=new Set(["py","pyx","pxd","pxi","pyi","js","jsx","ts","tsx","mjs","cjs","java","scala","kt","kts","groovy","gradle","c","h","cpp","cc","cxx","hpp","hxx","cs","csx","go","rs","rb","rbw","rake","gemspec","php","phtml","php4","php5","php7","phps","swift","kt","kts","ktm","dart","lua","pl","pm","t","pod","r","R","Rmd","Rnw","sh","bash","zsh","fish","bat","cmd","ps1","sql","graphql","gql","json","xml","yaml","yml","toml","ini","cfg","conf"]),t0=[{pattern:/^#{1,6}\s+/gm,weight:.15,name:"headers"},{pattern:/\[([^\]]+)\]\(([^)]+)\)/g,weight:.1,name:"links"},{pattern:/!\[([^\]]*)\]\(([^)]+)\)/g,weight:.1,name:"images"},{pattern:/^```[\s\S]*?```$/gm,weight:.1,name:"fenced-code"},{pattern:/^(?: {4}|\t)[^\n]+$/gm,weight:.05,name:"indented-code"},{pattern:/`[^`]+`/g,weight:.05,name:"inline-code"},{pattern:/^[\s]*[-*+]\s+/gm,weight:.08,name:"unordered-list"},{pattern:/^[\s]*\d+\.\s+/gm,weight:.08,name:"ordered-list"},{pattern:/\*\*[^*]+\*\*/g,weight:.04,name:"bold"},{pattern:/\*[^*\n]+\*/g,weight:.03,name:"italic"},{pattern:/__[^_]+__/g,weight:.04,name:"bold-underscore"},{pattern:/_[^_\n]+_/g,weight:.03,name:"italic-underscore"},{pattern:/^>\s+/gm,weight:.07,name:"blockquote"},{pattern:/^---+$|^===+$/gm,weight:.05,name:"horizontal-rule"},{pattern:/^\|[^\n]+\|$/gm,weight:.08,name:"table"}];function t1(e,t){var a;let s=e?null==(a=e.split(".").pop())?void 0:a.toLowerCase():void 0;if(s&&tQ.has(s))return{isMarkdown:!0,confidence:1,method:"extension"};if(s&&t$.has(s))return{isMarkdown:!1,confidence:0,method:"extension"};if(t){let e=function(e){if(!e||e.length<10)return 0;let t=0,a=[],s={};for(let{pattern:n,weight:i,name:l}of t0){let r=e.match(n);if(r&&r.length>0){let e=r.length,n=i*(.7+.3*(["headers","fenced-code","links","images"].includes(l)?Math.min(e,1):Math.min(e/5,1)));t+=n,a.push(l),s[l]=n}}return Math.min(t+.1*(a.length/t0.length),1)}(t),a=e>=.15;return{isMarkdown:a,confidence:e,method:a?"content":"none"}}return{isMarkdown:!1,confidence:0,method:"none"}}class t2{update(e){if(this.hasLatched)return this.lastResult;let t=t1(this.filename,e);return t.isMarkdown&&(this.hasLatched=!0),this.lastResult=t,t}reset(){this.hasLatched=!1,this.lastResult=t1(this.filename),this.hasLatched=this.lastResult.isMarkdown}isLatched(){return this.hasLatched}constructor(e){this.hasLatched=!1,this.filename=e,this.lastResult=t1(e),this.hasLatched=this.lastResult.isMarkdown}}var t3=a(0x1ea21c42d),t4=a.n(t3),t5=a(0xede65b),t6=a(0x2129aebe2),t8=a(0xd3117c3a);function t9(e){var t;let a=new Set;return null==(t=e.content)||t.filter(e=>"text"===e.type).forEach(e=>{(0,t5.n)(e.text).forEach(e=>a.add(e))}),a}let t7=(0,w.memo)(e=>{let{isStreaming:t,conversationUuid:a,dispatchChatResource:s,openControlsSidebar:n,isDrawerExpanded:i,maxTrackedFiles:l,selectComputerFile:r,lastMessageUuid:o}=e,d=(0,$.xJ)(a),c=(0,$.ot)(a),x=(0,C.l)(),f=(0,tb.st)(),{setIsDrawerExpanded:m}=(0,e1.x)(),p=(0,w.useRef)({lastOpenedId:null});!function(e){let{isStreaming:t,lastMessage:a,conversationUuid:s,dispatchChatResource:n,openControlsSidebar:i,isDrawerExpanded:l,maxTrackedFiles:r}=e,o=(0,w.useRef)(new Map),d=(0,w.useRef)(void 0),c=(0,w.useMemo)(()=>{if(!t||!a||!a.content)return d.current;let e=a.content[a.content.length-1];return d.current=e,e},[t,a]),u=(0,w.useMemo)(()=>null,[c,r]),{detectMarkdown:x,clearDetectors:f}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=(0,w.useRef)(new Map),a=(0,w.useCallback)(a=>{if(t.current.has(a))return t.current.get(a);if(t.current.size>=e){let e=t.current.keys().next().value;e&&t.current.delete(e)}let s=new t2(a);return t.current.set(a,s),s},[e]),s=(0,w.useCallback)(e=>{if(!e||!e.path)return null;if(e.path.includes(".")){let a=e.path,s=[];t.current.forEach((e,t)=>{a.startsWith(t)&&t!==a&&!t.includes(".")&&s.push(t)}),s.forEach(e=>{t.current.delete(e)})}let s=a(e.path);return{isMarkdown:s.update(e.content).isMarkdown,isLatched:s.isLatched(),detector:s}},[a]),n=(0,w.useCallback)(()=>{t.current.clear()},[]);return{detectMarkdown:s,clearDetectors:n,removeDetector:(0,w.useCallback)(e=>{t.current.delete(e)},[]),getDetectorsMap:(0,w.useCallback)(()=>t.current,[]),getOrCreateDetector:a}}(r),{handleMarkdownFileDetected:m,updateStreamingContent:p,clearOpenedFiles:h}=function(e){let{dispatchChatResource:t,openControlsSidebar:a,isDrawerExpanded:s,maxTrackedFiles:n=100,throttleMs:i=100}=e,l=(0,w.useRef)(new Set),r=(0,w.useCallback)(e=>{let t=l.current,a=!t.has(e);if(t.has(e))t.delete(e);else if(t.size>=n){let e=t.values().next().value;e&&t.delete(e)}return t.add(e),a},[n]),o=(0,w.useCallback)(e=>l.current.has(e),[]),d=(0,w.useCallback)(function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"create_file";r(e)&&(s||a(),t({type:"SELECT_FILE",path:e,toolType:i,messageId:n}))},[t,a,s,r]),c=(0,w.useCallback)(e=>{},[]),u=(0,w.useCallback)(e=>{let{path:a,content:s,renderAs:n,showingInRightPane:i}=e;t({type:"UPDATE_STREAMING_FILE",path:a,content:s,renderAs:n,showingInRightPane:i})},[t]),x=(0,w.useMemo)(()=>t4()(e=>{u(e)},i,{leading:!0,trailing:!0}),[u,i]);(0,w.useEffect)(()=>()=>{x.cancel()},[x]);let f=(0,w.useCallback)(e=>{x(e)},[x]),m=(0,w.useCallback)(e=>{x.cancel(),u(e)},[u,x]),p=(0,w.useCallback)((e,t,a)=>{d(e,a),f({path:e,content:t,renderAs:tZ.vU.Markdown,showingInRightPane:!0})},[d,f]);return{trackOpenedFile:r,hasBeenOpened:o,openFileInRightPane:d,registerMarkdownFile:c,updateStreamingContent:f,updateStreamingContentImmediate:m,handleMarkdownFileDetected:p,clearOpenedFiles:(0,w.useCallback)(()=>{l.current.clear()},[]),getOpenedFilesSet:(0,w.useCallback)(()=>l.current,[])}}({dispatchChatResource:n,openControlsSidebar:i,isDrawerExpanded:l,maxTrackedFiles:r});(0,w.useEffect)(()=>{if(!u)return;let{path:e,content:t}=u,s=x(u);if(!s)return;let{isMarkdown:n,isLatched:i}=s,l=(null==a?void 0:a.uuid)||"";n?m(e,t,l):i&&p({path:e,content:t,renderAs:tZ.vU.Markdown})},[u,x,m,p,null==a?void 0:a.uuid]);let g=(0,w.useCallback)(()=>{o.current.clear()},[]);(0,w.useEffect)(()=>()=>{s&&(f(),h(),g(),d.current=void 0)},[s,f,h,g])}({isStreaming:t,lastMessage:d,conversationUuid:a,dispatchChatResource:s,openControlsSidebar:n,isDrawerExpanded:i,maxTrackedFiles:l});let h=(0,w.useRef)(!1),g=(0,w.useRef)(!1);(0,w.useEffect)(()=>{if(!d)return;if(t){h.current=!1,g.current=!0;return}if(h.current||!g.current||!o||!(0,u.GN)(o))return;let e=c.slice(0,-1),s=new Set;e.forEach(e=>{t9(e).forEach(e=>s.add(e))}),Array.from(t9(d)).filter(e=>!s.has(e)).forEach(e=>{f.track({event_key:"wiggle.file.created",chat_message_uuid:o,...(0,t8.k)({filePath:e,isShared:!1,conversationUuid:a,source:"completion"})})}),h.current=!0},[t,d,o,f,a,c]),(0,w.useEffect)(()=>{if(!(x.width<Q.gU)&&d&&!t){let e=function(e){var t;for(let a of null!=(t=e.content)?t:[])if("text"===a.type){for(let e of(0,t5.n)(a.text))if((0,tZ.IO)(e))return e}return null}(d),t=p.current.lastOpenedId===e;e&&!t&&o&&(p.current.lastOpenedId=e,r(e,o))}},[t,d,r,o,x.width]);let v=(0,t6.a)(null!=d?d:{}),b=(0,w.useRef)(null);return null===b.current&&(b.current=new Set(d?(0,t6.G)(d):[])),(0,w.useEffect)(()=>{if(!t||x.width<Q.gU||!d||!o)return;let e=(0,t6.G)(d);if(0===e.length)return;let a=e.filter(e=>{var t;return!(null==(t=b.current)?void 0:t.has(e))});if(a.length>0){var n;let e=a[a.length-1];null==(n=b.current)||n.add(e),s({type:"SELECT_FILE",path:e,toolType:"present_files",messageId:o}),m(!0)}},[v,t,d,o,s,m,x.width]),null});t7.displayName="StreamingFileManager";var ae=a(0x52b639a1);let at=e=>{let{conversationUuid:t,retryCount:a}=e,[s,i]=(0,w.useState)(""),l=(0,U.A)(),r=(0,$.uO)(t),{context:o}=(0,f.j)(t),d=null==o?void 0:o.compactionStatus,c=(0,w.useMemo)(()=>[l.formatMessage({defaultMessage:"Gathering my thoughts, be right there...",id:"C6UYRcZHCt"}),l.formatMessage({defaultMessage:"Contemplating, stand by...",id:"r6P7kLapjf"}),l.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"}),l.formatMessage({defaultMessage:"Ruminating on it, stand by...",id:"wt2OTGsj0k"}),l.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"})],[l]),u=(0,w.useMemo)(()=>l.formatMessage({defaultMessage:"Still working on it, stand by...",id:"R9hnARYgER"}),[l]),x=(0,w.useMemo)(()=>l.formatMessage({defaultMessage:"A bit longer, thanks for your patience...",id:"MCt5e8xpx8"}),[l]);(0,w.useEffect)(()=>{if(r||a&&a>0)return;let e=[];return e.push(setTimeout(()=>{i(c[Math.floor(Math.random()*c.length)])},5e3)),e.push(setTimeout(()=>{i(u)},15e3)),e.push(setTimeout(()=>{i(x)},3e4)),()=>{e.forEach(e=>clearTimeout(e))}},[c,u,x,r,a]);let m=(0,w.useMemo)(()=>"compacting"===d?l.formatMessage({defaultMessage:"This conversation is getting long. I need a minute to organize my thoughts.",id:"mxNeQ92sj5"}):a&&a>0?l.formatMessage({defaultMessage:"Taking longer than usual. Trying again shortly (attempt {attemptNumber} of 10)",id:"1OhR91Iznh"},{attemptNumber:a+1}):s,[d,a,s,l]);return"compacting"===d||(!r||a&&0!==a)&&m?(0,n.jsx)(ew.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"font-claude-response text-text-300 ml-2 pb-1.5 text-sm italic",children:m}):null};function aa(){let e=(0,s._)(["\n  flex-1\n  flex\n  flex-col\n  gap-3\n  px-4\n  max-w-3xl\n  mx-auto\n  w-full\n"]);return aa=function(){return e},e}function as(e){let{isStreaming:t,hasWebSearchResponse:a,retryCount:s,conversationUuid:i,shouldShowWaitingText:l,currentAvatarState:r,isTemporary:o,scrollRef:d,incognitoString:c,isResearchPending:u,enableCompassNotificationsUI:x,tooltipContent:f,notificationPermission:m,enableCompassNotifications:p,enableCompletionNotifications:h,isCompassNotificationEnabled:g,isCompletionNotificationEnabled:v,isSession:b,enableCompletionNotificationsUI:_,isRunningToolOrThinking:k,sessionStatusMessage:M}=e,[C,S]=(0,w.useState)(!1),[A,E]=(0,w.useState)(!1),T=(0,w.useRef)(null),R=(0,w.useRef)(null);return(0,w.useEffect)(()=>{if(_)return k?(R.current&&(clearTimeout(R.current),R.current=null),T.current||(T.current=setTimeout(()=>{S(!0),E(!0)},2e3))):(T.current&&(clearTimeout(T.current),T.current=null),C&&!R.current&&(E(!1),R.current=setTimeout(()=>{S(!1),R.current=null},500))),!t&&(E(!1),R.current&&(clearTimeout(R.current),R.current=null),setTimeout(()=>{S(!1)},500),T.current&&(clearTimeout(T.current),T.current=null)),()=>{T.current&&clearTimeout(T.current),R.current&&clearTimeout(R.current)}},[k,t,_,C]),(0,n.jsx)("div",{ref:d,children:(0,n.jsxs)("div",{className:(0,N.A)("ml-1 mt-0.5 flex items-center transition-transform duration-300 ease-out",t&&"-translate-y-2.5"),children:[(0,n.jsx)("div",{className:"p-1 -translate-x-px",children:(0,n.jsx)(j.a,{state:r})}),M?(0,n.jsx)("div",{className:"font-claude-response text-text-300 ml-2 pb-1.5 text-sm italic",children:M}):null,l?(0,n.jsx)(at,{conversationUuid:i,retryCount:s}):null,(0,n.jsx)("div",{className:(0,N.A)("text-text-500 px-2 mt-6 flex-1 text-right text-[0.65rem] leading-[0.85rem] sm:text-[0.75rem]",t&&!C&&"pointer-events-none",b&&"hidden"),children:o?(0,n.jsx)("div",{className:(0,N.A)("inline-block select-none transition-opacity mt-1",!t&&"opacity-90 delay-300 duration-700",t&&"opacity-0 duration-0"),children:c}):u&&x?(0,n.jsx)(J,{notificationPermission:m,enableNotifications:p,isFeatureEnabled:g,visible:u}):_&&C&&("granted"!==m||!v)?(0,n.jsx)(J,{notificationPermission:m,enableNotifications:h,isFeatureEnabled:v,visible:A}):(0,n.jsx)(y.Tooltip,{tooltipContent:f,side:"bottom",disableHoverableContent:!0,className:"max-w-full",delayDuration:50,children:(0,n.jsx)(z(),{href:"https://support.anthropic.com/en/articles/8525154-claude-is-providing-incorrect-or-misleading-responses-what-s-going-on",target:"_blank",className:(0,N.A)("inline-block select-none",!t&&"opacity-90 delay-300 duration-700",t&&"opacity-0 duration-0"),children:(0,n.jsx)("span",{className:"hover:text-text-300 transition",children:a?(0,n.jsx)(I.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check cited sources.",id:"Al7GtlU74g",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}}):(0,n.jsx)(I.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check responses.",id:"EY1nHGV6e9",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}})})})})})]})})}let an=o.XA.maxFilesPerConversation;function ai(e){var t,a,s,o,b,j,y,N,T;let{changeDisplayedConversationPath:z,chatInputDefaultMessage:I,conversationTitle:H,conversationUuid:J,editMessage:es,isStreaming:en,isTemporary:ei=!1,isLoading:el,messageUuids:er,name:eo,onRetry:ed,onSend:eu,projectUuid:ex,setPersonalizedStyleCallback:ef,retryCount:em,todos:ep,onStopSampling:eh,sessionStatusMessage:eg,isReconnected:ev=!1,session:eb,sessionMcpServers:ej,debugInfo:ey}=e,ew=(0,ea.Z)(J),e_=(0,M.V)(),{isCmdKOpen:ek}=(0,B.l)(),eM=(0,K.fQ)(),eC=null!=(T=null==eM?void 0:eM.isOpen)&&T,eN=(0,$.n5)(J),eS=(0,$.U4)(J),eA=(0,$.Ci)(J,en),eE=(0,$.zg)(J),eT=er[er.length-1]||null,{account:ez,activeOrganization:eR}=(0,g.YL)(),eI=(0,v.B)(),eU=(0,U.A)(),eL=(0,O.P2)(),eO=(0,w.useRef)(null),eF=(0,w.useRef)(en);(0,w.useLayoutEffect)(()=>{var e,t,a,s;let n=eF.current;!n&&en&&(null==(t=eO.current)||null==(e=t.getScrollContainer())||e.style.setProperty("overflow-anchor","none")),n&&!en&&(null==(s=eO.current)||null==(a=s.getScrollContainer())||a.style.setProperty("overflow-anchor","auto")),eF.current=en},[en,eO]);let[eP,eD]=(0,w.useState)(null),eB=(0,w.useRef)(null);eB.current=er[er.length-1]||null;let{chatResourceState:eW,dispatchChatResource:eV}=(0,ec.i)(),{serverLastChatMessageWarningProps:eq,updateServerLastChatMessageWarningPropsForNewMessage:eY}=function(e){let[t,a]=(0,w.useState)(null),s=function(e){let{activeOrganization:t}=(0,g.YL)(),a="/api/organizations/".concat((null==t?void 0:t.uuid)||"","/chat_conversations/").concat(e,"/chat_message_warning"),{mutateAsync:s}=(0,tp.L2)(a,"POST",{meta:{noToast:!0}});return(0,w.useCallback)(async e=>{let t=await s(e);return t.warning_props?{contentMarkdown:t.warning_props.content_markdown,style:t.warning_props.style}:null},[s])}(e),n=(0,ea.Z)(e),i=(0,w.useCallback)(e=>{async function t(){if(!n)try{a(await s(e))}catch(e){}}a(null),t()},[s,n]),l=(0,w.useCallback)(e=>{let{messageText:t,parentMessageUuid:a}=e;i({message_text:t,analytics_data:{type:"message_send",prev_message_uuid:a&&a!==u.gF?a:null}})},[i]);return function(e){let{onLastMessageLoaded:t,conversationUuid:a}=e,s=(0,$.Q3)(a),n=(0,w.useRef)(s);(0,w.useEffect)(()=>{if(!n.current)return;let e=(0,th.C)(n.current);e&&t({uuid:n.current.uuid,messageText:e})},[t])}({onLastMessageLoaded:(0,w.useCallback)(e=>{let{uuid:t,messageText:a}=e;i({message_text:a,analytics_data:{type:"conversation_load",message_uuid:t}})},[i]),conversationUuid:e}),{serverLastChatMessageWarningProps:t,updateServerLastChatMessageWarningPropsForNewMessage:l}}(J),{setSandboxState:eH}=(0,r.q)(),eJ=(0,R.useSearchParams)(),eK=(0,w.useRef)({lastAssistantMessage:(0,w.useRef)(null),lastHumanMessage:(0,w.useRef)(null),chatInput:(0,w.useRef)(null),extras:(0,w.useRef)(null),extraSpace:(0,w.useRef)(null)}).current,eX=(0,w.useCallback)(()=>{let e=eK.lastAssistantMessage.current;if(!e)return!0;let t=e.getBoundingClientRect(),a=window.innerHeight;return t.bottom<a+50},[eK.lastAssistantMessage]);(0,w.useEffect)(()=>(en?c.Z.setVisibilityCheck(eX):c.Z.clearVisibilityCheck(),()=>{c.Z.clearVisibilityCheck()}),[en,eX]);let eZ=(0,w.useRef)(null),eQ=(0,w.useCallback)(async e=>{let{prompt:t,attachments:a,files:s,syncSources:n,personalized_style:i,compass_mode:l}=e;if(en&&!ew)return;eV({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eY({messageText:t,parentMessageUuid:eB.current}),eH(J,{conversationFiles:[...eW.files,...s],allAttachments:[...eW.attachments,...a],projectUuid:ex});let r={prompt:t,attachments:a,files:s,syncSources:n,rethrowErrors:!0,parent_message_uuid:eB.current||u.gF,personalized_style:i,compass_mode:l};await eu(r)},[ew,en,eV,eY,eH,J,eW.files,eW.attachments,eu,ex]),e$=(0,w.useCallback)((e,t)=>{eV({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eH(J,{conversationFiles:eW.files,allAttachments:eW.attachments,projectUuid:ex}),ed(e,t)},[eV,eH,J,eW.files,eW.attachments,ex,ed]),e0=(0,w.useCallback)(async()=>{if(en)return;let e=eU.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"});await eu({prompt:e,attachments:[],files:[],syncSources:[],rethrowErrors:!0,parent_message_uuid:eB.current||u.gF})},[eU,en,eB,eu]),e2=(0,w.useCallback)((e,t)=>{if(es){var a;eV({type:"CLEAR_SELECTED"}),es(e,t),eY({messageText:t,parentMessageUuid:null!=(a=e.parent_message_uuid)?a:null})}},[eV,es,eY]),e3=(0,w.useMemo)(()=>(0,E.A)(),[]);(0,w.useEffect)(()=>(e3.on("retry",e=>{let{parent_message_uuid:t,paprika_mode:a}=e;e$(t,a)}),e3.on("edit",e=>{let{message:t,text:a}=e;e2(t,a)}),()=>{e3.off("retry"),e3.off("edit")}),[e3,e$,e2]);let{files:e4,attachments:e5,selectedItem:e6}=eW,{isDrawerExpanded:e8,setIsDrawerExpanded:e9}=(0,e1.x)(),e7=(0,w.useCallback)(()=>{eV({type:"CLEAR_SELECTED"}),e9(!0)},[eV,e9]),te=(0,w.useCallback)(()=>{e9(!1)},[e9]),tt=(0,$.QS)(),ta=(0,$.P8)(),ts=(0,$.w0)();(0,w.useEffect)(()=>{eV({type:"UPDATE_FILES",files:tt})},[tt,eV]),(0,w.useEffect)(()=>{eV({type:"UPDATE_ATTACHMENTS",attachments:ta})},[eV,ta]),(0,w.useEffect)(()=>{eV({type:"UPDATE_SYNC_SOURCES",syncSources:ts})},[eV,ts]);let ti=(0,w.useCallback)(e=>{e7(),eV({type:"SELECT_ATTACHMENT",attachment:e})},[eV,e7]),tl=(0,w.useMemo)(()=>!!((null==eI?void 0:eI.preview_feature_uses_artifacts)||eE),[eI,eE]),tr=(0,P.QY)(),to=(0,w.useCallback)((e,t,a)=>{e7(),eV({type:"SELECT_ARTIFACT",id:e,versionUuid:a}),eV({type:"SET_ACTIVE_MESSAGE_UUID",uuid:t||""})},[eV,e7]),td=(0,w.useCallback)((e,t)=>{e7(),eV({type:"SELECT_FILE",path:e.replace("computer://",""),toolType:"create_file",messageId:t})},[eV,e7]),tc=(0,$.SY)(),tu=(0,w.useRef)({lastOpenedId:null}),tb=(0,C.l)();(0,w.useEffect)(()=>{if(tb.width<Q.gU)return;let e=tu.current.lastOpenedId===tc;en&&tc&&!e&&(tu.current.lastOpenedId=tc,to(tc))},[en,tc,to,tb.width]),(0,w.useEffect)(()=>{let e=eJ.get("artifactId"),t=eJ.get("versionUuid");e&&(e7(),eV({type:"SELECT_ARTIFACT",id:e,versionUuid:t||void 0}))},[]);let tj=(0,w.useRef)(!1);(0,w.useEffect)(()=>{(null==ep?void 0:ep.length)&&!tj.current&&(tj.current=!0,e7())},[e7,ep]);let ty=(0,w.useMemo)(()=>{if(en&&eA&&eA.content)return eA.content[eA.content.length-1]},[en,eA]),tw=en&&(!eA||!(null==(t=eA.content)?void 0:t[0])&&0===eA.attachments.length&&0===eA.files.length&&0===eA.files_v2.length),t_=ty&&("tool_use"===ty.type||"tool_result"===ty.type),tk=ty&&("tool_use"===ty.type||"tool_result"===ty.type||"thinking"===ty.type),tM=(0,w.useMemo)(()=>{if(eA&&!en)return(0,ee.eb)(eA)},[en,eA]),tC=J.startsWith("local_"),tS=!en&&!tC&&void 0!==tM,{compassStatus:tA}=(0,X.CH)({organizationUuid:null==eR?void 0:eR.uuid,conversationUuid:J,taskId:tM,isShared:!1,enabled:tS}),tE=(0,w.useMemo)(()=>{if(!eA||en)return!1;let e=(0,ee.nb)(eA);return!!(e&&!e.is_error&&(0,k.i3)(null==tA?void 0:tA.status))&&!(0,ee.OC)(eA)},[en,tA,eA]),tT=(0,Z.Wo)(),tz=(0,Z.hG)(),tR=(0,F.Lr)(),tI=(0,F.KG)("compass"),tU=(0,F.KG)("completion"),tL=(0,_.fS)("compass_enable_notifications_web")&&!e_,tF=(0,_.fS)("web_completion_notif")&&!e_,tK=(0,w.useCallback)(async()=>{let{success:e}=await tz();return e&&await tR(!0),e},[tz,tR]),tZ=(0,w.useCallback)(async()=>{let{success:e}=await tz();return e&&await tR(!0),e},[tz,tR]),tQ=(0,w.useMemo)(()=>tw?"thinking":t_||tE||ew&&en?"shimmer":en?"writing":"static",[tw,t_,tE,en,ew]);((e,t,a)=>{let s=(0,_.T9)("claude_ai_tabbed_out_notifications","features",tY,tq),n="visible"===(0,tB.f)(),{setThinkingTitle:i,setReceivedTitle:l,resetTitle:r}=((e,t,a)=>{let s=(0,w.useRef)(null),n=(0,w.useCallback)(()=>{s.current&&(clearInterval(s.current),s.current=null),document.title="Working on it..."},[]),i=(0,w.useCallback)(()=>{if(s.current)return;let t=0;s.current=setInterval(()=>{document.title=e[t],t=(t+1)%e.length},a)},[a,e]),l=(0,w.useCallback)(()=>{s.current&&(clearInterval(s.current),s.current=null),document.title=t},[t]);return(0,w.useMemo)(()=>({setThinkingTitle:n,setReceivedTitle:i,resetTitle:l}),[n,i,l])})(["Ready to chat",e],e,s.titleDelayMs||1600),{setWritingFavicon:o,setCompleteFavicon:d,resetFavicon:c}=(e=>{let t=(0,w.useRef)(null),a=(0,w.useCallback)(e=>{let t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.rel="icon",t.href=e,document.head.appendChild(t)},[]),s=(0,w.useCallback)(()=>{t.current&&clearInterval(t.current),t.current=null,a("/favicon.ico")},[a]),n=(0,w.useCallback)(()=>{if(t.current)return;let s=0;t.current=setInterval(()=>{a("".concat(tG,"/").concat(tW[s],".svg")),s=(s+1)%tW.length},e)},[e,a]),i=(0,w.useCallback)(()=>{s(),a(tV)},[a,s]);return(0,w.useMemo)(()=>({setWritingFavicon:n,setCompleteFavicon:i,resetFavicon:s}),[n,i,s])})(s.faviconDelayMs||100),{playSound:u,resetSound:x}=(()=>{let e=(0,w.useRef)(null),t=(0,w.useRef)(!1);(0,w.useEffect)(()=>{try{e.current=new Audio("/click.mp3")}catch(e){}},[]);let a=(0,w.useCallback)(()=>{if(!t.current){t.current=!0;try{e.current||(e.current=new Audio("/click.mp3"))}finally{var a;null==(a=e.current)||a.play()}}},[]),s=(0,w.useCallback)(()=>{t.current=!1},[]);return(0,w.useMemo)(()=>({playSound:a,resetSound:s}),[a,s])})(),f=(0,w.useRef)(!1);(0,w.useEffect)(()=>{let e=t&&a,m=!t&&a,p=!t&&!a;e&&!f.current&&(f.current=!0);let h=p&&f.current;if(h&&(f.current=!1),n){s.changeTitle&&r(),s.changeFavicon&&c();return}s.changeTitle&&(e||m?i():h&&l()),s.changeFavicon&&(m?o():h&&(d(),f.current=!1)),s.playSound&&(e?x():h&&u())},[s,t,a,n,i,l,r,o,d,c,u,x])})(H,tw,en);let{getCreateParamsForConvo:t$}=(0,p.I)();(0,w.useEffect)(()=>{if(el)return;let e=t$(J);e&&void 0!==e.prompt&&(e.prompt.length>0||e.files.length>0||e.attachments.length>0||e.syncSources.length>0)&&eQ(e).catch(()=>{var t;null==(t=eZ.current)||t.setContent(e.prompt,e.attachments,e.files)})},[J,eQ,t$,el]);let{data:t0}=(0,D.fo)(ex),t1=(0,W.K)(),t2=(0,G.ED)(ex),{publishedArtifactsByMessageUuid:t3}=(0,l.rC)({includeDeletedArtifacts:!0}),{mutate:t4,isPending:t5}=(0,i.aC)(J),t6=(0,p.E)(),t8=(0,w.useCallback)((e,t)=>{eV({type:"CLEAR_SELECTED"}),null==z||z(e,t)},[z,eV]),t9=(0,x.Z3)(J);(0,tm.hq)(J);let at=(0,w.useMemo)(()=>!!eA&&!en&&!!eA.content&&eA.content.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),[eA,en]),{activeModelOptions:aa}=(0,m.A9)(),ai=L.YO(L.Yj()),ar=(0,_.T9)("invite_contest_name","model_prefixes",[],ai),{data:ao}=(0,i.Fn)();(0,w.useEffect)(()=>{if(!en&&2===er.length&&(null==eN?void 0:eN.sender)==="human"&&"assistant"===eS&&ar.some(e=>null==t9?void 0:t9.startsWith(e))&&ao&&ao.count>=2){let e=new CustomEvent("firstClaudeMessage",{detail:{conversationUuid:J,model:t9}});window.dispatchEvent(e)}},[en,er.length,eN,eS,t9,J,ar,ao]);let ad=(0,w.useMemo)(()=>{let e=eU.formatMessage({defaultMessage:"Learn about Claudes responses ",id:"dD0oo8Rjtz"}),t=aa.find(e=>e.model===t9);if(!t||!t.knowledgeCutoff)return e;let a=A.c9.fromFormat(t.knowledgeCutoff,"LLLL yyyy",{locale:"en-US"});if(!a.isValid)return eU.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ",id:"fozOi7zOey"},{cutoff:t.knowledgeCutoff});{let e=a.toLocaleString({year:"numeric",month:"long"},{locale:eU.locale});return eU.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ",id:"fozOi7zOey"},{cutoff:e})}},[t9,aa,eU]),ac=(0,w.useMemo)(()=>e8&&eW.selectedItem?eW.selectedItem:void 0,[e8,eW.selectedItem]),au=(0,w.useCallback)(e=>(0,n.jsx)(ae.A,{...e,conversationUuid:J,onOpenArtifact:tl?to:void 0,selectedDrawerItem:ac,autoscrollRef:eO,isSessionChat:ew}),[J,tl,to,ac,ew]),ax=(0,w.useMemo)(()=>({id:J,messagesSoFar:er.length,files:e4,attachmentsSoFar:e5.length,isSampling:en,isStoppingSampling:t5,model:t9,projectKnowledgebaseTokens:null!=t2?t2:0,conversationSettings:eI,sessionId:null==eb?void 0:eb.id,isSessionActivelyWorking:ew&&en}),[e5.length,eI,J,e4,t5,en,er.length,t9,t2,null==eb?void 0:eb.id,ew]),af=(0,w.useMemo)(()=>!!eA&&!en&&"assistant"===eA.sender&&eA.content&&eA.content.some(e=>"tool_result"===e.type&&"web_search"===e.name),[eA,en]),am=(0,w.useCallback)(()=>{(0,d.OZ)(),t4(),eh&&eh()},[t4,eh]),ap=(0,w.useCallback)(async e=>{await eQ({prompt:e.prompt,attachments:[],files:e.files,syncSources:[]})},[eQ]),ah=(0,w.useMemo)(()=>{var e;return(null==ax||null==(e=ax.conversationSettings)?void 0:e.create_mode)&&0===er.length?null:at?(0,n.jsx)("div",{ref:eK.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,n.jsx)(tx,{conversationUuid:J})}):(0,n.jsxs)("div",{ref:eK.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5] relative",children:[(0,n.jsx)(tX,{autoscrollRef:eO,sentinelElement:eP,isStreaming:en,avatarState:tQ}),(0,n.jsx)(V.V,{ref:eZ,placement:"bottom",disabled:el||!!(eB.current&&!(0,u.GN)(eB.current)),onRetry:(e,t)=>ed(e,void 0,void 0,t),disableDropZone:ek||eC,enableScreenDrop:!eC,sessionMcpServers:ej})]})},[null==ax||null==(a=ax.conversationSettings)?void 0:a.create_mode,er.length,at,eK.chatInput,eP,en,tQ,el,ek,eC,J,ed,ej]),ag=(0,h.u9)(),{context:av}=(0,f.j)(J),ab=(null==av?void 0:av.compactionStatus)==="compacting",aj=(0,w.useMemo)(()=>{let e=$.oz.getState(),t=function(e,t){let a=[],s=[],n=null;for(let i=0;i<e.length;i++){let l=e[i],r=t[l];if(!r){s.length>0&&(a.push(et(s,t)),s=[],n=null);continue}"assistant"===r.sender?("assistant"===n||null===n?s.push(l):(s.length>0&&a.push(et(s,t)),s=[l]),n="assistant"):(s.length>0&&a.push(et(s,t)),s=[l],n="human")}return s.length>0&&a.push(et(s,t)),a}(er,e.messageByUuid);return t.map((a,s)=>{let n=e.messageByUuid[a.firstMessageUuid],i=e.messageByUuid[a.lastMessageUuid],l=s===t.length-1,r=s===t.length-2,o=a.isChain&&i&&n?{...n,content:a.mergedContent,stop_reason:i.stop_reason,updated_at:i.updated_at}:void 0,d=(null==i?void 0:i.sender)==="human"&&(r||l),c=s>0?t[s-1]:null;return{chain:a,displayMessage:o,isLastMsg:l,isLastHuman:d,previousMessageUuid:null==c?void 0:c.lastMessageUuid,lastMessage:i}})},[er]);if(!ez)return null;let ay=en&&(em||2===er.length||ab);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t7,{isStreaming:en,conversationUuid:J,dispatchChatResource:eV,openControlsSidebar:e7,isDrawerExpanded:e8,maxTrackedFiles:an,selectComputerFile:td,lastMessageUuid:eT||void 0}),(0,n.jsx)(tg.b,{autoscrollRef:eO,autoScrollInnerClassName:0===er.length?"h-full":"",rightSidebarElement:ag?(0,n.jsx)(tn,{todos:null!=ep?ep:[],conversationUuid:J,projectUuid:ex,sessionId:null==eb?void 0:eb.id,isStreaming:en,isTemporary:ei,messagesLength:er.length,debugInfo:ey}):null,mainElement:(0,n.jsxs)(tf._A,{conversation:ax,session:eb,projectUuid:ex,onSend:eQ,onCreate:t6,onStopSampling:am,setPersonalizedStyleCallback:ef,children:[(0,n.jsx)(tH.Q,{chatId:J,chatName:eo,onSend:ap,hasFirstMessage:!!eN&&!el}),(0,n.jsxs)("div",{className:"mx-auto flex size-full max-w-3xl flex-col md:px-2",children:[(0,n.jsx)(tN,{conversationUuid:J}),(0,n.jsx)(S.N,{mode:"wait",children:el?(0,n.jsx)(al,{className:"pt-2",children:(0,n.jsx)(Y,{})}):0===er.length?(0,n.jsx)(n.Fragment,{children:(null==ax||null==(s=ax.conversationSettings)?void 0:s.create_mode)?(0,n.jsx)(al,{className:"pt-1",children:(0,n.jsx)(tO,{})}):(0,n.jsx)(al,{className:"justify-center items-center",children:(0,n.jsx)(tD,{})})}):(0,n.jsxs)(al,{className:"pt-1",children:[(null==ax||null==(o=ax.conversationSettings)?void 0:o.create_mode)&&(0,n.jsx)(tO,{selectedLabel:(null==eN||null==(j=eN.content)||null==(b=j[0])?void 0:b.type)==="text"?null==eN||null==(N=eN.content)||null==(y=N[0])?void 0:y.text:void 0,disabled:er.length>0}),(0,n.jsx)(tv.$,{renderToolUseCell:au,children:aj.map((e,t)=>{var a;return(0,n.jsx)(q.c,{lastHumanMessageRef:eK.lastHumanMessage,lastAssistantMessageRef:eK.lastAssistantMessage,previousMessageUuid:e.previousMessageUuid,messageUuid:e.chain.firstMessageUuid,...e.displayMessage&&!(en&&e.isLastMsg)&&{message:e.displayMessage},conversationUuid:J,conversationSettings:eI,isStreaming:en,isLastMessage:e.isLastMsg,isLastHumanMessage:e.isLastHuman,isFirstAssistantMessage:1===t&&"assistant"===eS,messageWarningProps:t===aj.length-1&&eq||void 0,onOpenArtifact:tl?to:void 0,onOpenWiggleFile:td,selectAttachment:ti,changeDisplayedConversationPath:t8,editable:!0,publishedArtifacts:null==t3?void 0:t3[e.chain.firstMessageUuid],actionEmitter:e3,onSendContinue:e0,isResearchPending:tE,isTemporary:ei,model:t9,extendedThinkingSetting:null!=(a=null==eI?void 0:eI.paprika_mode)?a:null,showArtifacts:tl,chatFeedbackEnabled:tr,isInteractive:!0,shareType:null,showSharedImageMissing:!1,showSharedFileMissing:!1,isSessionConversation:ew},t)})}),null,(0,n.jsx)(tJ,{ref:eD}),(0,n.jsx)(as,{isStreaming:en,hasWebSearchResponse:!!af,shouldShowWaitingText:!!ay,retryCount:em,conversationUuid:J,currentAvatarState:tQ,scrollRef:eK.extras,isTemporary:ei,incognitoString:eL,isResearchPending:tE,enableCompassNotificationsUI:tL,enableCompletionNotificationsUI:tF,isRunningToolOrThinking:tk,tooltipContent:ad,notificationPermission:tT,enableCompassNotifications:tK,enableCompletionNotifications:tZ,isCompassNotificationEnabled:tI,isCompletionNotificationEnabled:tU,isSession:ew,sessionStatusMessage:eg}),(0,n.jsx)(tP,{scrollRefs:eK,autoScrollRef:eO,messageCount:er.length})]})}),ah]})]}),drawerElement:(0,n.jsx)(eG,{conversationUuid:J,isOpen:e8,onClose:te,isStreaming:en,projectUuid:ex,sendMessage:eQ,isTemporary:ei}),isDrawerOpen:!!(e8&&e6),headerProps:{conversationUuid:J,name:eo,project:t1?t0:void 0,controlsSidebarIsOpen:e8,closeControlsSidebar:te,openControlsSidebar:e7,isStreaming:en,isLoading:el,messagesLength:er.length}})]})}let al=b.J.div(aa())},0x1e140f433:(e,t,a)=>{a.d(t,{NG:()=>m,aX:()=>p,sH:()=>h});var s=a(0x22102fd88),n=a(0xb91ccc43),i=a(0x12510a4fc),l=a(0x8f813b9c),r=a(0x1b370f49d),o=a(0x146a6f00),d=a(0x1a1f6dda6),c=a(0x1dc411c0f),u=a(0xfc89b4a4),x=a(0x249008d3),f=a(0x214374164);let m=e=>{let{isExpanded:t,isScrollable:a,snappyTransition:n,children:l,className:r,onTransitionEnd:x,onAnimationComplete:f,collapsesHalfway:m,setIsExpanded:p,footer:h}=e,g=(0,u.useRef)(t),v=!!(m&&!t&&p),b=m&&!t;return(0,s.jsxs)(c.P.div,{className:(0,d.A)("overflow-hidden shrink-0",!t&&v&&"cursor-pointer"),tabIndex:-1,initial:{opacity:0,height:g.current?"auto":0},animate:t?"expanded":"collapsed",variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:.6*!!m,height:72*!!m}},whileHover:{opacity:1},transition:n?{ease:o.A.snappyOut,duration:.4}:{ease:"easeInOut",duration:.4},onTransitionEnd:x,onAnimationComplete:f,onClick:v?()=>p(!0):void 0,children:[(0,s.jsx)(i.r,{gradientHeight:16,tabIndex:-1,style:{scrollbarGutter:"stable"},className:(0,d.A)("h-full",a&&"!max-h-[238px]",r,b&&"[mask-image:linear-gradient(to_bottom,_hsl(var(--always-black)/100%)_0%,_hsl(var(--always-black)/0%)_100%)]",!t&&"pointer-events-none"),children:l}),h]})},p=e=>{let{handleClick:t,isDisabled:a,isExpanded:i,isStreaming:o,isError:u,errorMessage:m,icon:p,text:h,secondaryIcon:g,secondaryText:v,isFirstBlockOfMessage:b,isLastBlockOfMessage:j,className:y,wrapperClassName:w,children:_,renderMode:k=x.l.Standard,isFirstItemInGroup:M,isLastItemInGroup:C}=e,N=a||!t,S=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:t,className:(0,d.A)("group/row flex flex-row items-center justify-between gap-4 rounded-lg text-text-300 h-[2.625rem] py-2 px-3",N?"cursor-default":"cursor-pointer transition-colors duration-200 hover:text-text-200 hover:text-text-000",y),disabled:N,children:[(0,s.jsxs)("div",{className:"flex flex-row items-center gap-2 min-w-0",children:[p&&k!==x.l.TimelineGroup&&(0,s.jsx)("div",{className:"w-5 h-5 flex items-center justify-center text-text-100",children:p}),(0,s.jsx)("div",{className:"relative bottom-[0.5px] font-base text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300",children:o?(0,s.jsx)(l.N,{children:h}):h})]}),(0,s.jsx)("div",{className:"flex flex-row items-center gap-1.5 min-w-0 shrink-0",children:u?(0,s.jsx)(r.Tooltip,{tooltipContent:m,align:"center",children:(0,s.jsx)("span",{className:"inline-flex",children:(0,s.jsx)(n.N5l,{size:16,className:"text-danger-000"})})}):(0,s.jsxs)(s.Fragment,{children:[!!v&&(0,s.jsx)("p",{className:"relative bottom-[0.5px] pl-1 text-text-500 font-small leading-tight shrink-0 whitespace-nowrap",children:v}),g]})})]},o?"streaming":"non-streaming"),_]});return k===x.l.TimelineGroup?(0,s.jsx)(f.i1,{icon:p,isExpanded:i,isFirstItem:!!M,isLastItem:!!C,isActive:o&&j&&C,children:S}):(0,s.jsx)(c.P.div,{initial:{opacity:+!o},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,d.A)("ease-out rounded-lg border-0.5 flex flex-col font-ui leading-normal my-3 border-border-300 min-h-[2.625rem]",!a&&!i&&"hover:bg-bg-200",b?"mt-2":"mt-3",j?"mb-2":"mb-3",i&&"bg-bg-000 shadow-sm",w),children:S})},h=e=>{let{isExpandingDisabled:t,setIsExpanded:a,...i}=e,{isExpanded:l,isError:r,secondaryIcon:o}=i,c=t||r;return(0,s.jsx)(p,{...i,isError:r,isDisabled:c,handleClick:()=>a(!l),secondaryIcon:(0,s.jsxs)(s.Fragment,{children:[o,!c&&(0,s.jsx)("span",{className:(0,d.A)("inline-flex transition-transform duration-400 ease-snappy-out",l?"rotate-180":"rotate-0"),children:(0,s.jsx)(n.biH,{className:(0,d.A)("relative bottom-[0.5px] text-text-300",c&&"opacity-15"),size:16})})]})})}},0x1e672f605:(e,t,a)=>{a.d(t,{K:()=>k,r:()=>C});var s=a(0x22102fd88),n=a(0x865afcc2),i=a(0xb91ccc43),l=a(0x1b813d90),r=a(0x1a1f6dda6),o=a(0x1dc411c0f),d=a(0xfc89b4a4),c=a(0x1ab0d1ca1),u=a(0xf8bd7957),x=a(0xb323e954),f=a(0x8774d407),m=a(0x160045b25),p=a(0x481204e3),h=a(0x23fde417d),g=a(0x23b243043),v=a(0x1669db9c6);let b=e=>{let{title:t,subtitles:a,url:l,disabled:o,isError:c,icon:u,isInSelectionMode:f=!1,isSelected:m=!1,onSelect:p,onSelectForBulk:h}=e,g=(0,d.useCallback)(()=>{p&&f&&p(!m,!1)},[f,p,m]),v=(0,d.useCallback)(()=>{p&&(!f&&h?h():p(!m,!1))},[f,p,m,h]);return(0,s.jsxs)("div",{className:"group/row relative flex items-center pl-1",onClick:g,style:{cursor:f?"pointer":void 0},children:[p&&(0,s.jsxs)("div",{className:"shrink-0 w-5 h-5 flex items-center justify-center",onClick:e=>{e.stopPropagation(),v()},children:[(0,s.jsx)("div",{className:(0,r.A)("absolute transition-all duration-200",f||m?"opacity-100 scale-100":"opacity-0 scale-75 group-hover/row:opacity-100 group-hover/row:scale-100"),children:(0,s.jsx)(x.S,{disabled:o,checked:m,onChange:e=>{p(e,!1)},label:"Select ".concat(t),hideLabel:!0,onClick:e=>e.stopPropagation()})}),(0,s.jsx)(i.ryu,{vectorSizeOverride:18,className:(0,r.A)("transition-all duration-200 text-text-400 pointer-events-none",f||m?"opacity-0 scale-75":"opacity-100 scale-100 group-hover/row:opacity-0 group-hover/row:scale-75")})]}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)(n.$,{icon:u,title:t,subtitles:a,url:l,disabled:o,isError:c})})]})},j=e=>{let{results:t,disabled:a}=e,[n,i]=(0,d.useState)(!1),[l,r]=(0,d.useState)(!1),c=(0,d.useMemo)(()=>t.map(e=>({uuid:e.conversationUuid,type:"conversation"})),[t]),{selectedItems:u,handleSelect:x,selectAllItems:j,isInSelectionMode:y,toggleSelectMode:w}=(0,g.m)(c,a),_=(0,d.useCallback)(e=>{w(!0),x({uuid:e,type:"conversation"},!0,!1)},[w,x]),k=(0,d.useCallback)(()=>{r(!1),w(!1)},[w]),M=(0,d.useCallback)(()=>{i(!1),w(!1)},[w]),C=(0,d.useMemo)(()=>u.map(e=>{let{uuid:t}=e;return t}),[u]),N=t.length>0;return(0,s.jsxs)(f.o,{children:[(0,s.jsxs)("div",{className:"relative flex flex-col h-full",children:[(0,s.jsx)(o.P.div,{variants:{initial:{opacity:0},animate:{opacity:1}},initial:"initial",animate:"animate",className:"flex flex-col flex-nowrap p-2 pt-0 overflow-y-auto flex-1",children:t.map(e=>{let t=u.some(t=>t.uuid===e.conversationUuid);return(0,s.jsx)(b,{title:e.title,subtitles:e.subtitles,url:e.url,disabled:a,icon:e.icon,isInSelectionMode:y,isSelected:t,onSelect:(t,a)=>{x({uuid:e.conversationUuid,type:"conversation"},t,a)},onSelectForBulk:()=>_(e.conversationUuid)},e.conversationUuid)})}),(0,s.jsx)(m.N,{children:y&&N&&(0,s.jsx)(o.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"sticky bottom-0 bg-bg-000/[98%] border-t-0.5 border-border-300 rounded-b-lg",children:(0,s.jsx)("div",{className:"ml-[0.875rem] mr-2 pt-1 pb-1.5",children:(0,s.jsx)(v.g,{numSelected:u.length,totalNumItems:t.length,handleSelectAll:j,handleCancel:()=>w(!1),handleDeleteSelected:()=>i(!0),handleMoveToProject:()=>r(!0)})})})})]}),u.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Z,{isOpen:n,onClose:M,conversationUuids:C}),(0,s.jsx)(h.h,{conversationUuids:C,isOpen:l,onClose:k})]})]})};var y=a(0xde8f44d0),w=a(0x1e140f433),_=a(0x1f7748bd);function k(e){var t,a,n;let i,{integrationName:l,icon:r,integrationIcon:o,message:d,result:u,isStreaming:x,isError:f,isExpandingDisabled:m,isFirstBlockOfMessage:p,isLastBlockOfMessage:h,wrapperClassName:g,contentClassName:v,defaultExpanded:b=!1,toolName:j,renderMode:y,groupItemKey:k,isFirstItemInGroup:M,isLastItemInGroup:E}=e,T=(0,c.A)(),{isExpanded:z,setIsExpanded:R}=(0,_.a)(b,k),I=!!u&&!m&&!x&&("rich_content"!==u.type||(null==(t=u.content)?void 0:t.length)>0);return i=u?"rich_content"===u.type?T.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(n=null==(a=u.content)?void 0:a.length)?n:0}):"JSON":void 0,(0,s.jsx)(w.sH,{isError:f,isExpandingDisabled:!I,isExpanded:z,setIsExpanded:R,isStreaming:!!x,text:null!=d?d:x?T.formatMessage({defaultMessage:"Searching",id:"IfE0if3ytt"}):T.formatMessage({defaultMessage:"Searched",id:"0ZuuhwjU4n"}),secondaryText:x?void 0:i,icon:r||(0,s.jsx)(C,{integrationName:l,iconUrl:o,canShowLetterIcon:!0}),isFirstBlockOfMessage:p,isLastBlockOfMessage:h,wrapperClassName:g,renderMode:y,isFirstItemInGroup:M,isLastItemInGroup:E,children:(0,s.jsxs)(w.NG,{isExpanded:z,snappyTransition:!0,isScrollable:!0,className:v,children:[I&&(null==u?void 0:u.type)==="rich_content"&&(0,s.jsx)(N,{disabled:!z||x,result:u,integrationName:l,toolName:j}),I&&(null==u?void 0:u.type)==="table"&&(0,s.jsx)(S,{result:u}),I&&(null==u?void 0:u.type)==="json_block"&&(0,s.jsx)(A,{result:u})]})})}let M=["Google Calendar","Gmail","Google Drive","Search Project Knowledge","Search Past Conversations"],C=e=>{let t,{canShowLetterIcon:a,integrationName:n,toolName:r,iconUrl:o,size:d=16}=e;switch(n){case"Search Project Knowledge":return(0,s.jsx)(i.JtL,{vectorSizeOverride:d});case"Memory":case"Search Past Conversations":return(0,s.jsx)(i.ce8,{vectorSizeOverride:d});case"Google Drive":t=l.v8.GDRIVE;break;case"Google Calendar":t=l.v8.GCAL;break;case"Gmail":t=l.v8.GMAIL}let c=n||r;return(0,s.jsx)(u.z,{size:d,name:c,...t?{type:"syncSource",src:t}:{type:"favicon",src:o,fallbackToGlobe:!(c&&a)}})},N=e=>{let{disabled:t,integrationName:a,result:i,toolName:l}=e,r=l?l.split("").reduce((e,t)=>e+t.charCodeAt(0),0):0,d=!!a&&M.includes(a)&&2039!==r&&2010!==r;if("Search Past Conversations"===a){let e=i.content.map(e=>{let{title:t,subtitles:n,url:i,icon_url:l}=e;if(i){let e=i.match(/\/chat\/([a-f0-9-]+)/);if(e)return{conversationUuid:e[1],title:t,subtitles:n,url:i,icon:d?void 0:(0,s.jsx)(C,{integrationName:a,iconUrl:l})}}return null}).filter(e=>null!==e);return(0,s.jsx)(j,{results:e,disabled:t,integrationName:a,hideIcons:d})}return(0,s.jsx)(o.P.div,{variants:{initial:{opacity:0},animate:{opacity:1,transition:{staggerChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col flex-nowrap p-2 pt-0",children:i.content.map((e,i)=>{let{title:l,subtitles:r,url:o,resource_type:c,icon_url:u}=e;return(0,s.jsx)(n.$,{disabled:t,icon:d?void 0:(0,s.jsx)(C,{integrationName:a,iconUrl:u}),title:l,subtitles:r,url:o,tag:c},i)})})},S=e=>{let{result:t}=e;return(0,s.jsx)(E,{table:t.table})},A=e=>{let{result:t}=e,a=(0,c.A)();return(0,s.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:(0,s.jsx)(y.z,{title:a.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),code:t.json_block})})},E=e=>{let{table:t}=e;return(0,s.jsx)("div",{className:"grid p-2 pt-0",style:{gridTemplateColumns:"1fr 2fr"},children:t.map((e,a)=>{let[n,i]=e;return(0,s.jsxs)(d.Fragment,{children:[(0,s.jsx)("div",{className:(0,r.A)("flex items-center p-2",a<t.length-1&&"border-b-0.5 border-border-300"),children:(0,s.jsx)("p",{className:"font-medium text-text-300 text-xs",children:n})}),(0,s.jsx)("div",{className:(0,r.A)("flex items-center p-2",a<t.length-1&&"border-b-0.5 border-border-300"),children:(0,s.jsx)("p",{className:"text-text-500 text-xs",children:i})})]},a)})})}},0x1eb594abd:(e,t,a)=>{a.d(t,{u:()=>n});var s=a(0xfc89b4a4);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set,[t,a]=(0,s.useState)(e);return[t,(0,s.useCallback)(e=>{a(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[])]}},0x1fe2ab707:(e,t,a)=>{a.d(t,{G:()=>i});var s=a(0x24fcf6beb),n=a(0x14a7c225d);function i(e,t){let a=null!=t?t:(0,n.S)(e),i=(0,s.mL)(e,a),l=/\.(png|jpg|jpeg|gif|bmp|webp)$/i.test(e),r=i===s.vU.Svg,o=i===s.vU.Html,d=i===s.vU.React,c=i===s.vU.Mermaid,u=i===s.qK.Pdf,x=i===s.vU.Markdown,f=i===s.qK.Csv,m=i===s.qK.Tsv,p=i===s.qK.Skill,h=!!i&&(0,s.EJ)(i),g=!!i&&(0,s.$1)(i),v=o||r||d||c||u||h||g||f||m,b=o||r||d||c||f||m,j=!l&&!p&&!u&&!h&&!g;return{fileMimeType:i,fileSyntax:a,isImage:l,isSvg:r,isHtml:o,isReact:d,isMermaid:c,isPdf:u,isMarkdown:x,isCsv:f,isTsv:m,isSkill:p,isOfficeDocument:h,isSpreadsheet:g,isRichType:v,isRichTypeWithPlaintext:b,showViewToggle:x||b,isTextContent:j,displayFileType:l?"image":v?"rich":j?"code":"nonrenderable"}}},0x209960a1a:(e,t,a)=>{a.d(t,{I:()=>n,q:()=>i});var s=a(0xfc89b4a4);let n=(0,s.createContext)(null),i=()=>{let e=(0,s.useContext)(n);if(!e)throw Error("useReplExecutionSandbox must be used within a ReplExecutionSandboxContextProvider");return e}},0x20d6272f9:(e,t,a)=>{a.d(t,{FT:()=>l,Ud:()=>r});var s=a(0x24fcf6beb),n=a(0x23b9f35d7),i=a.n(n);function l(e){var t;let a=e.split("."),s=a.slice(0,-1).join("."),n=a.length>1?null!=(t=a.at(-1))?t:"":null,l=s.replaceAll(/[_-]/g," ");return{displayName:i()(l),displayExt:n?n.toUpperCase():null}}function r(e){var t;let a=null==(t=e.split(".").pop())?void 0:t.toLowerCase();return a?["skill"].includes(a)?"skill":["csv","tsv"].includes(a)?"table":["xls","xlsx"].includes(a)?"spreadsheet":["pptx"].includes(a)?"preso":["pdf","md","docx"].includes(a)?"doc":["mermaid","mmd"].includes(a)?"diagram":["jsx","tsx"].includes(a)?"code":["svg"].includes(a)||s._o.includes(a)?"image":s.Uv.includes(a)?"code":null:null}},0x21010ec24:(e,t,a)=>{a.d(t,{N:()=>h,z:()=>g});var s=a(0x22102fd88),n=a(0xf32c56dd),i=a(0x12c9046cd),l=a(0x14de19ae8),r=a(0x139b5e710),o=a(0x1016c6ed2),d=a(0xfc89b4a4),c=a(0x38e6572),u=a(0x1334f6ecc),x=a(0x4d9fc74e),f=a(0x18175ce17),m=a(0xf02ef1a6),p=a(0xd3117c3a);function h(e){let{conversationUuid:t,source:a}=e,{activeOrganization:h}=(0,l.YL)(),{addError:g}=(0,r.Y)(),v=(0,n.st)(),[b,j]=(0,d.useState)(!1),[y,w]=(0,d.useState)(m.K.NOT_CONNECTED),_=(0,f.kO)(),{isDriveAuthenticated:k,initDriveAuth:M,isFetched:C}=(0,u.cI)(),N=(0,x.Q)({queryString:"gdrive_export_success=export-direct"}),S=null==h?void 0:h.uuid,A=(0,i.L2)("/api/organizations/".concat(S,"/conversations/").concat(t,"/wiggle/export-to-google-drive"),"POST",{enabled:!!S&&!!t,meta:{noToast:!0}});return{handleOpenInGoogleDrive:(0,d.useCallback)(async e=>{if(!S||!t)return;if(C&&!k)return void g((0,s.jsx)("span",{children:(0,s.jsx)(c.A,{defaultMessage:"<button>Authenticate</button> to export to Google Drive",id:"bQuLbzZRDC",values:{button:e=>(0,s.jsx)("button",{className:"underline",onClick:M,children:e})}})}),{errorContext:{tags:{source:"gdrive_export_auth"}}});let n=e.replace("computer://",""),i=(0,p.k)({filePath:e,isShared:!1,conversationUuid:t,source:a});v.track({event_key:"wiggle.file.gdrive_export.attempted",...i});try{let e=await A.mutateAsync({file_path:n});e.drive_url&&(window.open(e.drive_url,"_blank"),v.track({event_key:"wiggle.file.gdrive_export.success",...i}))}catch(d){let e,t,a,s;if(d instanceof o.LG){var l,r;if(!(e=null!=(r=d.errorCode)?r:void 0)&&(null==(l=d.extra)?void 0:l.details)){let t=d.extra.details;e=t.error_code,a=t.server_id,s=t.server_url}t=d.message}else t="Export failed. Please try again.";let n=(e=>{switch(e){case"google_drive_not_connected":return m.K.NOT_CONNECTED;case"google_drive_insufficient_scopes":return m.K.MISSING_SCOPE;default:return m.K.UNKNOWN}})(e);if(v.track({event_key:"wiggle.file.gdrive_export.failed",error_code:e,error_type:n,error_message:t,...i}),_&&(n===m.K.NOT_CONNECTED||n===m.K.MISSING_SCOPE)&&a)return void N({uuid:a,url:s});if(n===m.K.NOT_CONNECTED||n===m.K.MISSING_SCOPE){w(n),j(!0);return}g(t,{error:d,errorContext:{tags:{source:"google_drive_export"}}})}},[S,t,a,v,A,g,_,N,C,k,M]),showConnectionModal:b,setShowConnectionModal:j,connectionError:y,isExporting:A.isPending}}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=/\.docx$/i.test(e),s=/\.xlsx$/i.test(e),n=/\.pptx$/i.test(e);if(t){let t=/\.md$/i.test(e),i=/\.csv$/i.test(e),l=/\.tsv$/i.test(e),r=/\.gif$/i.test(e),o=/\.(jpg|jpeg)$/i.test(e),d=/\.pdf$/i.test(e),c=/\.png$/i.test(e),u=/\.txt$/i.test(e),x=/\.json$/i.test(e);return a||s||n||t||i||l||r||o||d||c||u||x}return a||s||n}},0x2129aebe2:(e,t,a)=>{a.d(t,{G:()=>s,a:()=>n});let s=e=>{var t;let a=[];for(let s of null!=(t=e.content)?t:[])if("tool_result"===s.type&&"present_files"===s.name)for(let e of s.content)"local_resource"===e.type&&a.push(e.file_path);return a},n=e=>{var t,a;let s=null!=(a=null==(t=e.content)?void 0:t.length)?a:0;return"present_files:".concat(e.uuid,":").concat(s)}},0x214374164:(e,t,a)=>{a.d(t,{DT:()=>v,i1:()=>b,Ih:()=>f,h4:()=>m,D8:()=>h});var s=a(0x22102fd88),n=a(0x146a6f00),i=a(0xac309a83),l=a(0x1a1f6dda6),r=a(0x1dc411c0f),o=a(0x160045b25),d=a(0xfc89b4a4),c=a(0xb91ccc43),u=a(0x38e6572);let x=(0,d.memo)(e=>{let{collapsedCount:t,isExpanded:a,onToggle:n}=e;if(0===t)return null;let i=a?(0,s.jsx)(u.A,{defaultMessage:"Hide steps",id:"Iufn28MeR1"}):(0,s.jsx)(u.A,{defaultMessage:"{collapsedCount, plural, one {# step} other {# steps}}",id:"dS6ebV+vpY",values:{collapsedCount:t}});return(0,s.jsxs)("button",{onClick:n,type:"button",className:(0,l.A)("group/collapse-indicator flex flex-row min-h-[2.125rem] shrink-0 w-full","hover:bg-bg-200 cursor-pointer transition-colors duration-200"),children:[(0,s.jsxs)("div",{className:"flex flex-col items-center pl-3 box-border pointer-events-none",children:[(0,s.jsx)("div",{className:(0,l.A)("transition-all grow w-[1px] bg-border-300",a&&"opacity-0"),style:{minHeight:"calc((2.125rem - 16px) / 2)"}}),(0,s.jsx)("div",{className:"transition-all flex items-center justify-center my-0.5 shrink-0 w-[16px] h-[16px]",children:(0,s.jsx)("span",{className:(0,l.A)("inline-flex transition-transform duration-400 ease-snappy-out",a?"rotate-180":"rotate-0"),children:(0,s.jsx)(c.IJm,{className:"text-text-500 group-hover/collapse-indicator:text-text-300",size:16})})}),(0,s.jsx)("div",{className:"transition-all grow w-[1px] bg-border-300",style:{minHeight:"calc((2.125rem - 16px) / 2)"}})]}),(0,s.jsx)("div",{className:"flex items-center px-3 py-2 flex-1 text-sm pointer-events-none",children:(0,s.jsx)("span",{className:"text-text-500 group-hover/collapse-indicator:text-text-300",children:i})})]})});x.displayName="CollapsedToolsIndicator";let f=(e,t)=>!(!["thinking","tool_use","tool_result","token_budget"].includes(e.type)||"tool_use"===e.type&&["prism","end_conversation","launch_extended_search_task"].includes(e.name))&&(!!t.get("timeline_artifacts_enabled",!1)||("tool_use"!==e.type||"artifacts"!==e.name)&&("tool_result"!==e.type||"artifacts"!==e.name))&&(!!t.get("timeline_gsuite_enabled",!1)||"tool_use"!==e.type||!e.integration_name),m=e=>"tool_result"!==e.type&&"token_budget"!==e.type,p=d.createContext({}),h=()=>(0,d.useContext)(p),g=e=>{let[t,a]=(0,d.useState)(void 0),n=(0,d.useMemo)(()=>({expandedItemKey:t,setExpandedItemKey:a}),[t,a]);return(0,s.jsx)(p.Provider,{value:n,children:e.children})},v=e=>{let{children:t,isFirstBlockOfMessage:a,isLastBlockOfMessage:c,isStreaming:u}=e,f=(0,i.fS)("claudeai_collapse_timeline_groups"),[m,p]=(0,d.useState)(!1),h=(0,d.useCallback)(e=>{e.stopPropagation(),p(e=>!e)},[]),v=d.Children.toArray(t),b=Math.max(0,v.length-2),j=f&&!m?v.slice(-2):v;return(0,s.jsx)(r.P.div,{initial:{opacity:+!u},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,l.A)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-ui leading-normal my-3 border-border-300 min-h-[2.625rem] overflow-hidden",a?"mt-2":"mt-3",c?"mb-2":"mb-3"),children:(0,s.jsxs)(g,{children:[f&&b>0&&(0,s.jsx)(x,{collapsedCount:b,isExpanded:m,onToggle:h}),(0,s.jsx)(o.N,{initial:!1,mode:"sync",children:j.map((e,t)=>(0,s.jsx)(r.P.div,{className:"overflow-hidden shrink-0",layout:"position",initial:{opacity:0,height:0},animate:"expanded",exit:"collapsed",variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},transition:{layout:{duration:0},ease:n.A.snappyOut,duration:.2},children:e},d.isValidElement(e)&&null!==e.key?e.key:t))})]})})},b=e=>{let{icon:t,isExpanded:a,isFirstItem:n,isLastItem:i,isActive:r,children:o}=e,d={minHeight:"calc((2.125rem - ".concat(t?"16px":"6px",") / 2)")};return(0,s.jsxs)("div",{className:(0,l.A)("flex flex-row min-h-[2.125rem] shrink-0",{"bg-bg-000":a},{"hover:bg-bg-200":!a}),children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center pl-3 box-border",children:[(0,s.jsx)("div",{className:(0,l.A)("transition-all w-[1px]",{"bg-border-300":!n}),style:d}),(0,s.jsx)("div",{className:(0,l.A)("transition-all flex items-center justify-center my-1 shrink-0 w-[16px]",{"h-[16px]":!!t}),children:null!=t?t:(0,s.jsx)("div",{className:(0,l.A)("size-[6px] rounded-full",r?"bg-accent-main-200":"bg-border-300")})}),(0,s.jsx)("div",{className:(0,l.A)("transition-all grow w-[1px]",{"bg-border-300":!i}),style:d})]}),(0,s.jsx)("div",{className:"w-full flex flex-col min-w-0",children:o})]})}},0x2202d81f6:(e,t,a)=>{a.d(t,{qO:()=>d});var s=a(0x22102fd88),n=a(0x1a1f6dda6),i=a(0xfc89b4a4),l=a(0xbca8e388);class r{isInsideStructure(){return this.inCodeBlock||this.inList||this.inTable||this.inBlockquote}processLine(e){let t=e.trim(),a=this.isInsideStructure();(t.startsWith("```")||t.startsWith("~~~"))&&(this.inCodeBlock?t.startsWith(this.codeBlockDelimiter)&&(this.inCodeBlock=!1,this.codeBlockDelimiter=""):(this.inCodeBlock=!0,this.codeBlockDelimiter=t.substring(0,3))),/^[-*+]|\d+\./.test(t)&&!this.inCodeBlock?this.inList=!0:this.inList&&""===t&&(this.inList=!1),t.includes("|")&&!this.inCodeBlock?this.inTable=!0:this.inTable&&""===t&&(this.inTable=!1);let s=t.startsWith(">");s&&!this.inCodeBlock?this.inBlockquote=!0:this.inBlockquote&&""===t&&!s&&(this.inBlockquote=!1);let n=this.lastLineWasEmpty;this.lastLineWasEmpty=""===t;let i=a&&!this.isInsideStructure();return{insideStructure:this.isInsideStructure(),structureJustClosed:i,previousLineWasEmpty:n}}reset(){this.inCodeBlock=!1,this.codeBlockDelimiter="",this.inList=!1,this.inTable=!1,this.inBlockquote=!1,this.lastLineWasEmpty=!0}constructor(){this.inCodeBlock=!1,this.codeBlockDelimiter="",this.inList=!1,this.inTable=!1,this.inBlockquote=!1,this.lastLineWasEmpty=!0}}let o=(0,i.memo)(e=>{let{text:t,blockCitations:a=[],onLinkDetected:n,onCodeDetected:i,hasLinkRef:r,hasCodeRef:o,className:d,linkTarget:c="_blank",flagShowCodeHeader:u,unsafeAllowNavigationWithoutConfirmation:x,onOpenArtifact:f,isLastMessage:m,publishedArtifacts:p,messageUuid:h,onLinkClick:g}=e;return(0,s.jsx)(l.fP,{text:t,blockCitations:a,onLinkDetected:n,onCodeDetected:i,hasLinkRef:r,hasCodeRef:o,className:d,linkTarget:c,isStreaming:!1,flagShowCodeHeader:u,unsafeAllowNavigationWithoutConfirmation:x,onOpenArtifact:f,isLastMessage:m,publishedArtifacts:p,messageUuid:h,onLinkClick:g})},(e,t)=>e.text===t.text);o.displayName="MemoizedMarkdownChunk";let d=(0,i.memo)(e=>{let{text:t,blockCitations:a=[],onLinkDetected:d,onCodeDetected:c,hasLinkRef:u,hasCodeRef:x,className:f,linkTarget:m="_blank",isStreaming:p=!1,flagShowCodeHeader:h,unsafeAllowNavigationWithoutConfirmation:g,onOpenArtifact:v,isLastMessage:b,publishedArtifacts:j,messageUuid:y,onLinkClick:w}=e,{completedChunks:_,streamingChunk:k}=((e,t)=>{let[a,s]=(0,i.useState)([]),[n,l]=(0,i.useState)(""),o=(0,i.useRef)(new r);return(0,i.useEffect)(()=>{if(!e){s([]),l("");return}if(!t){s([e]),l(""),o.current.reset();return}let a=e.split("\n"),n=[],i=[],r=-1;o.current.reset();for(let e=0;e<a.length;e++){let t=a[e],{insideStructure:s,structureJustClosed:l,previousLineWasEmpty:d}=o.current.processLine(t);if(i.push(t),l||!s&&""===t.trim()&&i.length>1&&!d){for(;i.length>0&&""===i[i.length-1].trim();)i.pop();i.length>0&&(n.push(i.join("\n")),r=e,i=[])}}let d=a.slice(r+1).join("\n");s(n),l(d)},[e,t]),{completedChunks:a,streamingChunk:n}})(t,p);return(0,s.jsxs)("div",{className:(0,n.A)("grid-cols-1 grid gap-2.5 [&_>_*]:min-w-0",f),children:[_.map((e,t)=>(0,s.jsx)(o,{text:t>0?"\n\n"+e:e,blockCitations:a,onLinkDetected:d,onCodeDetected:c,hasLinkRef:u,hasCodeRef:x,className:"",linkTarget:m,flagShowCodeHeader:h,unsafeAllowNavigationWithoutConfirmation:g,onOpenArtifact:v,isLastMessage:b,publishedArtifacts:j,messageUuid:y,onLinkClick:w},t)),k&&(0,s.jsx)(l.fP,{text:_.length>0?"\n\n"+k:k,blockCitations:a,onLinkDetected:d,onCodeDetected:c,hasLinkRef:u,hasCodeRef:x,className:"",linkTarget:m,isStreaming:!0,flagShowCodeHeader:h,unsafeAllowNavigationWithoutConfirmation:g,onOpenArtifact:v,isLastMessage:b,publishedArtifacts:j,messageUuid:y,onLinkClick:w})]})});d.displayName="ProgressiveStandardMarkDown"},0x2503e28ff:(e,t,a)=>{a.d(t,{t:()=>r});var s=a(0x22102fd88),n=a(0x14de19ae8),i=a(0x38e6572),l=a(0xbebfc702);function r(e){let t,{project:a,className:r}=e,{account:o}=(0,n.YL)();if(a.is_starter_project)t=(0,s.jsx)(i.A,{defaultMessage:"Created by Anthropic",id:"qWDgsCW3nw"});else if(a.type===l.gM.Haystack)t=(0,s.jsx)(i.A,{defaultMessage:"Created by your admin",id:"QV1CaRw5pU"});else{var d;t=(null==(d=a.creator)?void 0:d.full_name)?a.creator.uuid===(null==o?void 0:o.uuid)?(0,s.jsx)(i.A,{defaultMessage:"Created by you",id:"WEhuQZAqE6"}):(0,s.jsx)(i.A,{defaultMessage:"Created by {author}",id:"7POMfMfi+y",values:{author:a.creator.full_name}}):(0,s.jsx)(i.A,{defaultMessage:"Created by unknown",id:"QEI1plMxfE"})}return(0,s.jsx)("span",{className:r,children:t})}},0x2524bdea9:(e,t,a)=>{a.d(t,{$:()=>r,Q:()=>l});var s=a(0x22102fd88),n=a(0xfc89b4a4);let i=n.createContext({renderToolUseCell:void 0}),l=()=>n.useContext(i),r=e=>{let{renderToolUseCell:t,children:a}=e,l=(0,n.useMemo)(()=>({renderToolUseCell:t}),[t]);return(0,s.jsx)(i.Provider,{value:l,children:a})}}}]);