(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1054],{74214:function(e,t,i){"use strict";i.r(t);let n={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_GenericFileInfo_attachment",selections:[{kind:"FragmentSpread",name:"FileInfo_useName_attachment"},{kind:"FragmentSpread",name:"FileInfo_useMimeType_attachment"},{kind:"FragmentSpread",name:"FileInfo_useUrl_attachment"},{kind:"FragmentSpread",name:"FileInfo_useSize_attachment"},{kind:"FragmentSpread",name:"FileInfo_useIsLoading_messageAttachment"}],type:"Attachment",abstractKey:"__isAttachment"};n.hash="86cf4a30ad884b1eaada9fdb947967f4",t.default=n},40849:function(e,t,i){"use strict";i.r(t);let n={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_ImageInfo_attachment",selections:[{kind:"FragmentSpread",name:"FileInfo_useName_attachment"},{kind:"FragmentSpread",name:"FileInfo_useDisplayUrl_attachment"},{kind:"ScalarField",name:"url"}],type:"Attachment",abstractKey:"__isAttachment"};n.hash="13105856d51381b5a0cae8d80bc4d0a2",t.default=n},97702:function(e,t,i){"use strict";i.r(t);let n={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_attachment",selections:[{kind:"FragmentSpread",name:"FileInfo_useMimeType_attachment"},{kind:"FragmentSpread",name:"FileInfo_GenericFileInfo_attachment"},{kind:"FragmentSpread",name:"FileInfo_ImageInfo_attachment"}],type:"Attachment",abstractKey:"__isAttachment"};n.hash="b929cc33574e7123fb2b38376f100621",t.default=n},76810:function(e,t,i){"use strict";i.r(t);let n={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useDisplayUrl_attachment",selections:[{kind:"FragmentSpread",name:"FileInfo_useUrl_attachment"},{kind:"ClientExtension",selections:[{kind:"ScalarField",name:"localUrl"}]}],type:"Attachment",abstractKey:"__isAttachment"};n.hash="f4666f1ed84fa76ff32cdea3cf17fb0d",t.default=n},80874:function(e,t,i){"use strict";i.r(t);let n={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useIsLoading_messageAttachment",selections:[{kind:"ClientExtension",selections:[{kind:"ScalarField",name:"isOptimistic"}]}],type:"MessageAttachment"};n.hash="6098b79cd856b6e809188cbe96e59d11",t.default=n},21558:function(e,t,i){"use strict";i.r(t);let n={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useMimeType_attachment",selections:[{concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[{kind:"ScalarField",name:"mimeType"}]}],type:"Attachment",abstractKey:"__isAttachment"};n.hash="72c9f77a03b034ddde99b734afc3570f",t.default=n},8205:function(e,t,i){"use strict";i.r(t);let n={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useName_attachment",selections:[{kind:"ScalarField",name:"name"}],type:"Attachment",abstractKey:"__isAttachment"};n.hash="3d7c6e009705079c358a3fe4ae27e326",t.default=n},32515:function(e,t,i){"use strict";i.r(t);let n={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useSize_attachment",selections:[{concreteType:"File",kind:"LinkedField",name:"file",plural:!1,selections:[{kind:"ScalarField",name:"size"}]}],type:"Attachment",abstractKey:"__isAttachment"};n.hash="bb68e0a5ab9e1b762d5adf7c3ba2c952",t.default=n},49778:function(e,t,i){"use strict";i.r(t);let n={argumentDefinitions:[],kind:"Fragment",name:"FileInfo_useUrl_attachment",selections:[{kind:"ScalarField",name:"url"}],type:"Attachment",abstractKey:"__isAttachment"};n.hash="d96d0e0cb3c06b0a75db717b2ee05226",t.default=n},31657:function(e,t,i){"use strict";var n=i(67294);let a=n.createContext(null);t.Z=a},30965:function(e,t,i){"use strict";var n=i(67294);let a=n.createContext(null);t.Z=a},21054:function(e,t,i){"use strict";i.d(t,{S1:function(){return GenericFileInfo},xD:function(){return useDisplayFileType}});var n=i(85893),a=i(94370),r=i(67294),l=i(22120);i(22578);var s=i(31657),o=i(30965),c=i(53679),u=i(94282),m=i(12251),d=i(3687),f=i(14813),p=i(93105),g=i(27311),h=i.n(g),_=i(24503);let useMimeType=e=>{let t=(0,f.J$)(i(21558),e);return(0,f.zE)(t)?t.type:t.file.mimeType},useName=e=>{let t=(0,f.J$)(i(8205),e);return t.name},useSize=e=>{let t=(0,f.J$)(i(32515),e);return(0,f.zE)(t)?t.size:t.file.size},useUrl=e=>{let t=(0,f.J$)(i(49778),e),n=(0,r.useMemo)(()=>(0,f.zE)(t)?URL.createObjectURL(t):t.url,[t]);return n},useDisplayUrl=e=>{let t=(0,f.J$)(i(76810),e),n=useUrl(t);return!(0,f.zE)(t)&&t.localUrl||n},useIsLoading=e=>{let t=(0,f.J$)(i(80874),e);return"isOptimistic"in t&&t.isOptimistic},useDisplayFileType=e=>{let{t}=(0,l.$G)(),i=(0,p.uy)(e);if(i){let[e,n]=i;if("text"===e){if("plain"===n)return t("text");if(["csv","html"].includes(n))return n}if("application"===e){if("pdf"===n)return"pdf";if("vnd.openxmlformats-officedocument.wordprocessingml.document"===n)return"docx"}if("image"===e)return["jpeg","png"].includes(n)?n:t("image");if("video"===e)return t("video");if("audio"===e)return t("audio")}return t("file")},useDisplaySize=e=>{let{t}=(0,l.$G)(),[i,n]=(0,u.w)(e);return t("{{displaySize, number}}",{displaySize:i,unit:n,style:"unit",unitDisplay:"short"})},F={};function isLocalUrl(e){return e.startsWith("blob:")}let canRenderAsImage=e=>{if(!e.startsWith("image/"))return!1;if(e.startsWith("image/jpeg")||e.startsWith("image/png")||e.startsWith("image/bmp")||e.startsWith("image/svg"))return!0;if(void 0===F[e])try{let t=document.createElement("canvas");t.getContext&&t.getContext("2d")?F[e]=0==t.toDataURL(e).indexOf("data:".concat(e)):F[e]=!1}catch(t){F[e]=!1}return F[e]},GenericFileInfo=e=>{let{file:t,className:l}=e,s=(0,f.J$)(i(74214),t),o=useName(s),c=useMimeType(s),u=c.startsWith("video/"),p=c.startsWith("audio/"),g=useUrl(s),_=useSize(s),F=useIsLoading(s),y=g&&!isLocalUrl(g)?"a":"div",v=useDisplaySize(_),b=useDisplayFileType(c),[I]=(0,d.O6)(),k=(0,r.useCallback)(e=>{e.preventDefault(),I(g,d.Jg.other,o,()=>{(0,d.km)(g,d.Jg.other,{})})},[I,g,o]);return o&&v&&b?(0,n.jsxs)(y,{className:(0,m.$)(h().fileInfo,F&&h().loading,l),...g?{href:g,target:"_blank",alt:o,onClick:k}:{},children:[u?(0,n.jsx)(a.Gn,{size:"lg"}):p?(0,n.jsx)(a.d2,{size:"lg"}):(0,n.jsx)(a.Xh,{size:"lg"}),(0,n.jsxs)("div",{className:h().textPane,children:[(0,n.jsx)("div",{className:h().title,children:o}),(0,n.jsxs)("div",{className:h().metadata,children:[(0,n.jsx)("span",{className:h().fileType,children:b})," \xb7 ",v]})]})]}):null},ImageInfo=e=>{let{file:t,className:a,showInteractiveMedia:l=!1}=e,u=(0,f.J$)(i(40849),t),p=(0,f.zE)(u)?void 0:u.url,g=useName(u),F=useDisplayUrl(u),y=(0,r.useContext)(s.Z),v=(0,r.useContext)(o.Z),{openImageViewer:b}=(0,c.z)(),I=(0,r.useCallback)(()=>{F&&(0,d.km)(F,d.Jg.image,{botId:null==y?void 0:y.botId,messageId:null==v?void 0:v.messageId,chatId:(null==y?void 0:y.chatId)||null})},[y,v,F]),k=(0,r.useCallback)(()=>{F&&b({src:p||F,alt:g,onDownload:I})},[F,p,g,b,I]);return F?(0,n.jsx)("img",{suppressHydrationWarning:!0,className:(0,m.$)(l?h().interactiveImage:h().image,a),src:F,alt:g,"data-cdn-url":isLocalUrl(F)?p:void 0,onClick:k}):(0,n.jsx)("div",{className:h().imageLoader,children:(0,n.jsx)(_.Z,{})})};t.ZP=e=>{let{file:t,className:a,showInteractiveMedia:r=!1}=e,l=(0,f.J$)(i(97702),t),s=useMimeType(l),o=canRenderAsImage(s)?ImageInfo:GenericFileInfo;return(0,n.jsx)(o,{file:l,className:a,showInteractiveMedia:r})}},24503:function(e,t,i){"use strict";i.d(t,{Z:function(){return patterns_LoadingSpinner}});var n,a=i(85893),r=i(74908),l=i(67294);function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(null,arguments)}var loadingSpinner=function(e){return l.createElement("svg",_extends({viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},e),n||(n=l.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 2.6a7.4 7.4 0 1 0 7.4 7.4 1 1 0 1 1 2 0A9.4 9.4 0 1 1 .6 10 9.4 9.4 0 0 1 10 .6a1 1 0 1 1 0 2Z"})))},s=i(12251),o=i(7849),c=i.n(o),patterns_LoadingSpinner=e=>{let{color:t="base",size:i}=e;return(0,a.jsx)(loadingSpinner,{className:(0,s.$)(c().loadingSpinner,c()[t],i?(0,r.MQ)(i):c().defaultSize)})}},94282:function(e,t,i){"use strict";i.d(t,{w:function(){return convertBytesUnit}});let n=["byte","kilobyte","megabyte","gigabyte","terabyte","petabyte"],convertBytesUnit=e=>{if(0===e)return[0,"byte"];let t=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),n.length-1);return[Math.round(e/Math.pow(1e3,t)),n[t]]}},3687:function(e,t,i){"use strict";i.d(t,{Jg:function(){return a},O6:function(){return useDownloadFile},km:function(){return logDownload}});var n,a,r=i(41143),l=i.n(r),s=i(67294),o=i(22120),c=i(8583),u=i(9729),m=i(30038),d=i(96384),f=i(73331),p=i(23595),g=i(64516);let generateRandomString=e=>[...Array(e)].map(()=>(26*Math.random()|0).toString(36)).join("");(n=a||(a={})).image="image",n.video="video",n.audio="audio",n.other="other";let h={mpeg:"mp3","x-ms-wma":"wma","x-m4a":"m4a","x-ms-asf":"asf"},_={"x-msvideo":"avi","x-matroska":"mkv",ogg:"ogv",quicktime:"mov","x-flv":"flv","x-ms-wmv":"wmv","x-sgi-movie":"movie","x-mpeg":"mpeg"},F={"svg+xml":"svg","x-icon":"ico"},y={"text/plain":"txt","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx"};let DownloadError=class DownloadError extends Error{};let getObjectUrl=async(e,t)=>{if(e.startsWith("blob:"))return[e,""];let i=await fetch(e);if(200!==i.status)throw new DownloadError("Failed to download ".concat(t," (").concat(e,"). Status code: ").concat(i.status,"."));let n=await i.blob(),a=null==n?void 0:n.type.split("/"),r=a[0].toLowerCase()!==t&&"other"!==t;if(!n||r)throw new DownloadError("Failed to download ".concat(t," (").concat(e,"). Invalid ").concat(t," type: ").concat(null==n?void 0:n.type,"."));return[URL.createObjectURL(n),n.type,!0]},logDownload=(e,t,i)=>{let n;let a={};switch(t){case"image":n=m.Z.save_image,a={image_src:e};break;case"video":n=m.Z.save_video;break;case"audio":n=m.Z.save_audio;break;case"other":n=m.Z.save_file_other_type;break;default:l()(n,"Unsupported fileType: ".concat(t))}n&&("image"===t?(0,u.Z)("poe/action_log",{action_type:(0,d.E)(n),bot_id:i.botId,chat_id:i.chatId,message_id:i.messageId,action_metadata:a}):(0,u.Z)("poe/attachment_action_log",{action_type:(0,d.E)(n),attachment_id:i.attachmentId}))},useDownloadFile=()=>{let[e,t]=(0,s.useState)(!1),{t:i}=(0,o.$G)(),n=(0,c.ZP)(),a=(0,s.useCallback)(e=>{let t="";switch(e){case"image":t=i("Failed to download image.");break;case"video":t=i("Failed to download video.");break;case"audio":t=i("Failed to download audio.");break;case"other":t=i("Failed to download file.")}n({type:c.pC.error,content:t})},[n,i]),r=(0,g.F)(),l=(0,p.au)(r),u=(0,p.G6)(r),m="";return[async(e,i,n,r)=>{if(e){r&&r();try{var s;t(!0);let[a,r,o]=await getObjectUrl(e,i);m=a;let c=null!==(s=r.split("/")[1])&&void 0!==s?s:"",d="";"audio"===i?c in h&&(d=h[c]):"video"===i?c in _&&(d=_[c]):"image"===i?c in F&&(d=F[c]):"other"===i&&r in y&&(d=y[r]);let f=document.createElement("a");if(f.href=m,!d&&n){let e=n.match(/\.([a-z0-9]+)$/i);e&&e.length>1&&(d=e[1])}if(u&&!d&&(d=c),n&&d&&n.endsWith("."+d)){let e=n.indexOf("."+d);n=n.substring(0,e)}n=(n=null==n?void 0:n.replaceAll(/[^a-zA-Z0-9.]+/g,"_").substring(0,250))+"."+d;let p=n||"poe_"+generateRandomString(6)+"."+d;f.download=p,f.target="_blank",f.rel="noopener noreferrer",document.body.appendChild(f),f.click(),document.body.removeChild(f);let g="audio"===i&&l;o&&!g&&URL.revokeObjectURL(m)}catch(e){e instanceof Error&&(0,f.H)(e),a(i)}finally{t(!1)}}},e]}},14813:function(e,t,i){"use strict";i.d(t,{J$:function(){return useFileFragment},mj:function(){return useFilesFragment},zE:function(){return isFile}});var n=i(41143),a=i.n(n),r=i(22578);let isFile=e=>e instanceof File,useFileFragment=(e,t)=>{let i=(0,r.useFragment)(e,isFile(t)?null:t);return isFile(t)?t:i||a()(!1,"Attachment file is undefined")},zipperMerge=(e,t)=>{let i=[],n=0,a=0;for(;n<e.length||a<t.length;)n>=e.length?i.push(t[a++][1]):a>=t.length?i.push(e[n++][1]):e[n][0]<t[a][0]?i.push(e[n++][1]):i.push(t[a++][1]);return i},useFilesFragment=(e,t)=>{let i=t.map((e,t)=>[t,e]),n=i.filter(e=>isFile(e[1])),a=i.filter(e=>!isFile(e[1])),l=(0,r.useFragment)(e,a.map(e=>{let[,t]=e;return t}))||[],s=l.map((e,t)=>[a[t][0],e]);return zipperMerge(n,s)}},93105:function(e,t,i){"use strict";i.d(t,{K9:function(){return getFileSizeErrorMessage},Mj:function(){return checkIfFileIsOverLimit},VX:function(){return parseMessageAttachmentFileSizeLimits},rG:function(){return validateFileSizes},sv:function(){return getTotalFileSize},uy:function(){return parseMimeType}});var n=i(94282);let parseMimeType=e=>{let t=e.split(";")[0],[i,n]=t.split("/");return i&&n?[i,n]:null},parseMessageAttachmentFileSizeLimits=e=>{if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},getFileSizeErrorMessage=(e,t,i,a)=>{let[r,l]=(0,n.w)(i);return e?a("Attachments of type {{typeDisplayName, string}} must be {{limit, number}} or smaller.",{typeDisplayName:t,limit:r,style:"unit",unit:l,unitDisplay:"short"}):a("The combined size of all attachments must be {{limit, number}} or smaller.",{limit:r,style:"unit",unit:l,unitDisplay:"short"})},getFileTypeDisplayName=(e,t)=>{let i=parseMimeType(e);if(i){let[e,n]=i;if("text"===e){if("plain"===n)return t("text");if(["csv","html"].includes(n))return n}if("application"===e){if("pdf"===n)return"pdf";if("vnd.openxmlformats-officedocument.wordprocessingml.document"===n)return"docx"}if("image"===e)return["jpeg","png"].includes(n)?n:t("image");if("video"===e)return t("video");if("audio"===e)return t("audio")}return t("file")},getFileTypeSizeLimit=(e,t)=>{let i=t.total,n=parseMimeType(e);if(n){let[e,a]=n;"application"===e&&(i=t.application),"audio"===e&&(i=t.audio),"image"===e&&(i=t.image),"text"===e&&(i=t.text),"video"===e&&(i=t.video),"octet-stream"===a&&(i=t.total)}return i},getTotalFileSize=e=>{let t=0;for(let i of e)t+=i.size;return t},checkIfFileIsOverLimit=(e,t)=>{if(!t)return{isFileOverLimit:!1,fileTypeOverLimit:"",fileTypeSizeLimit:0};let i="",n=!1,a=t.total;return e.forEach(e=>{!n&&(a=getFileTypeSizeLimit(e.type,t),e.size>a&&(i=e.type,n=!0))}),{isFileOverLimit:n,fileTypeOverLimit:i,fileTypeSizeLimit:a}},validateFileSizes=e=>{let{files:t,limits:i,t:n}=e;if(!t.length)return null;let a=0;for(let e of t){a+=e.size;let t=getFileTypeSizeLimit(e.type,i);if(e.size>t)return getFileSizeErrorMessage(!0,getFileTypeDisplayName(e.type,n),t,n)}return a>i.total?getFileSizeErrorMessage(!1,getFileTypeDisplayName("",n),i.total,n):null}},27311:function(e){e.exports={fileInfo:"FileInfo_fileInfo__5ZvMO",loading:"FileInfo_loading__XwVJt",textPane:"FileInfo_textPane__d9VVB",title:"FileInfo_title__sUM2l",metadata:"FileInfo_metadata__Wu4uZ",fileType:"FileInfo_fileType__KZDVV",image:"FileInfo_image__M_cAh",imageLoader:"FileInfo_imageLoader__czDR_",interactiveImage:"FileInfo_interactiveImage__AHKat"}},7849:function(e){e.exports={loadingSpinner:"LoadingSpinner_loadingSpinner__vCqHc",spin:"LoadingSpinner_spin__DgELP",defaultSize:"LoadingSpinner_defaultSize__ekQCH",accent:"LoadingSpinner_accent__7GqPF",base:"LoadingSpinner_base__bJwcP"}}}]);